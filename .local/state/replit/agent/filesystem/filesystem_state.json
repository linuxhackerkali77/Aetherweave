{"file_contents":{"src/contexts/CallContext.tsx":{"content":"'use client';\n\nimport { createContext, useContext, ReactNode } from 'react';\nimport { useEnhancedCalls } from '@/hooks/use-enhanced-calls';\nimport type { CallStatus, CallType, IncomingCall, ActiveCall } from '@/hooks/use-enhanced-calls';\n\ninterface CallContextType {\n  callStatus: CallStatus;\n  incomingCall: IncomingCall | null;\n  activeCall: ActiveCall | null;\n  localStream: MediaStream | null;\n  remoteStream: MediaStream | null;\n  isAudioEnabled: boolean;\n  isVideoEnabled: boolean;\n  isScreenSharing: boolean;\n  isMinimized: boolean;\n  callDuration: string;\n  startCall: (toUserId: string, toUserName: string, callType: CallType, toUserAvatar?: string) => Promise<void>;\n  acceptCall: () => Promise<void>;\n  declineCall: () => void;\n  endCall: () => void;\n  toggleAudio: () => void;\n  toggleVideo: () => void;\n  toggleScreenShare: () => void;\n  setIsMinimized: (value: boolean) => void;\n}\n\nconst CallContext = createContext<CallContextType | undefined>(undefined);\n\nexport function CallProvider({ children }: { children: ReactNode }) {\n  const callState = useEnhancedCalls();\n  return <CallContext.Provider value={callState}>{children}</CallContext.Provider>;\n}\n\nexport function useCall() {\n  const context = useContext(CallContext);\n  if (!context) throw new Error('useCall must be used within CallProvider');\n  return context;\n}\n","path":null,"size_bytes":1337,"size_tokens":null},"src/components/ui/accordion.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1991,"size_tokens":null},"src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"src/app/gaming/page.tsx":{"content":"\n'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useUser } from '@/hooks/use-user';\nimport { doc, getDoc, setDoc, query, collection, where, getDocs } from 'firebase/firestore';\nimport { useFirestore } from '@/firebase/provider';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { Loader2 } from 'lucide-react';\nimport GamingChatArea from './components/GamingChatArea';\nimport GamingMemberList from './components/GamingMemberList';\n\nexport default function GamingDashboardPage() {\n    const { user, profile, setProfile } = useUser();\n    const firestore = useFirestore();\n    const { toast } = useToast();\n    \n    const [showUsernameModal, setShowUsernameModal] = useState(false);\n    const [gamingUsername, setGamingUsername] = useState('');\n    const [isCheckingUsername, setIsCheckingUsername] = useState(false);\n    const [isSaving, setIsSaving] = useState(false);\n\n    useEffect(() => {\n        if (profile && !profile.gaming?.username) {\n            setShowUsernameModal(true);\n        }\n    }, [profile]);\n\n    const handleSaveGamingUsername = async () => {\n        if (!user || !firestore || !gamingUsername) return;\n        \n        setIsSaving(true);\n        \n        // 1. Validate for uniqueness\n        setIsCheckingUsername(true);\n        const usersRef = collection(firestore, 'users');\n        const q = query(usersRef, where('gaming.username', '==', gamingUsername.toLowerCase()));\n        const querySnapshot = await getDocs(q);\n        setIsCheckingUsername(false);\n\n        if (!querySnapshot.empty) {\n            toast({\n                variant: 'destructive',\n                title: 'Username Taken',\n                description: 'That gaming username is already in use. Please choose another.',\n            });\n            setIsSaving(false);\n            return;\n        }\n\n        // 2. Save the username\n        const userDocRef = doc(firestore, 'users', user.uid);\n        try {\n            await setDoc(userDocRef, {\n                gaming: {\n                    username: gamingUsername\n                }\n            }, { merge: true });\n\n            // Optimistically update local profile\n            if(profile) {\n                setProfile({\n                    ...profile,\n                    gaming: {\n                        ...profile.gaming,\n                        username: gamingUsername,\n                    },\n                });\n            }\n\n            toast({\n                title: 'Gaming Username Set!',\n                description: `Welcome to the Gaming Hub, ${gamingUsername}!`,\n            });\n            setShowUsernameModal(false);\n        } catch (error: any) {\n            toast({\n                variant: 'destructive',\n                title: 'Error',\n                description: `Could not save username: ${error.message}`,\n            });\n        } finally {\n            setIsSaving(false);\n        }\n    };\n    \n    return (\n        <div className=\"flex flex-1 p-4 gap-4\">\n            <GamingChatArea />\n            <GamingMemberList activeSpaceId={null} />\n\n            <Dialog open={showUsernameModal} onOpenChange={setShowUsernameModal}>\n                <DialogContent className=\"sm:max-w-[425px] glass-card\" onInteractOutside={(e) => e.preventDefault()}>\n                    <DialogHeader>\n                        <DialogTitle>Set Your Gaming Username</DialogTitle>\n                        <DialogDescription>\n                            This name will be used across the entire Aetherweave gaming network. It must be unique.\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"grid gap-4 py-4\">\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\n                            <Label htmlFor=\"gaming-username\" className=\"text-right\">\n                                Username\n                            </Label>\n                            <Input\n                                id=\"gaming-username\"\n                                value={gamingUsername}\n                                onChange={(e) => setGamingUsername(e.target.value)}\n                                className=\"col-span-3\"\n                                placeholder=\"e.g., NeonBlade\"\n                            />\n                        </div>\n                    </div>\n                    <Button onClick={handleSaveGamingUsername} disabled={isSaving || !gamingUsername}>\n                        {(isSaving || isCheckingUsername) && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                        {isCheckingUsername ? 'Checking...' : isSaving ? 'Saving...' : 'Save Username'}\n                    </Button>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":5008,"size_tokens":null},"src/hooks/use-presence.ts":{"content":"'use client';\nimport { useState, useEffect, useCallback } from 'react';\nimport { doc, updateDoc, serverTimestamp, onSnapshot } from 'firebase/firestore';\nimport { useFirestore } from '@/firebase/provider';\nimport { useUser } from './use-user';\n\nexport type PresenceStatus = 'online' | 'away' | 'busy' | 'offline';\n\ninterface PresenceData {\n  status: PresenceStatus;\n  lastSeen: any;\n  isOnline: boolean;\n}\n\nexport function usePresence() {\n  const { user } = useUser();\n  const firestore = useFirestore();\n  const [status, setStatus] = useState<PresenceStatus>('online');\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n\n  // Update presence in Firestore\n  const updatePresence = useCallback(async (newStatus: PresenceStatus) => {\n    if (!user || !firestore) return;\n    \n    const userRef = doc(firestore, 'users', user.uid);\n    await updateDoc(userRef, {\n      status: newStatus,\n      lastSeen: serverTimestamp(),\n      isOnline: newStatus !== 'offline'\n    });\n    setStatus(newStatus);\n  }, [user, firestore]);\n\n  // Handle online/offline detection\n  useEffect(() => {\n    const handleOnline = () => {\n      setIsOnline(true);\n      updatePresence('online');\n    };\n\n    const handleOffline = () => {\n      setIsOnline(false);\n      updatePresence('offline');\n    };\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, [updatePresence]);\n\n  // Handle page visibility changes\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n        updatePresence('away');\n      } else {\n        updatePresence('online');\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () => document.removeEventListener('visibilitychange', handleVisibilityChange);\n  }, [updatePresence]);\n\n  // Handle beforeunload to set offline\n  useEffect(() => {\n    const handleBeforeUnload = () => {\n      if (user && firestore) {\n        const userRef = doc(firestore, 'users', user.uid);\n        updateDoc(userRef, {\n          status: 'offline',\n          lastSeen: serverTimestamp(),\n          isOnline: false\n        });\n      }\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\n  }, [user, firestore]);\n\n  // Initialize presence on mount\n  useEffect(() => {\n    if (user && firestore) {\n      updatePresence(isOnline ? 'online' : 'offline');\n    }\n  }, [user, firestore, isOnline, updatePresence]);\n\n  return {\n    status,\n    isOnline,\n    updatePresence\n  };\n}","path":null,"size_bytes":2752,"size_tokens":null},"src/ai/flows/assistant-stream-flow.ts":{"content":"'use server';\n\nimport { ai } from '@/ai/genkit';\nimport { z } from 'zod';\n\n// Define a schema for a single message in the conversation\nconst MessageSchema = z.object({\n  role: z.enum(['user', 'model']),\n  content: z.string(),\n});\n\nconst AssistantInputSchema = z.object({\n  history: z.array(MessageSchema).describe('The conversation history.'),\n  prompt: z.string().describe('The latest user prompt.'),\n});\nexport type AssistantInput = z.infer<typeof AssistantInputSchema>;\n\nexport async function runAssistantStream(input: AssistantInput): Promise<AsyncIterable<string>> {\n  console.log('Starting AI stream with input:', input);\n  try {\n    const systemPrompt = `You are Aether, a helpful and highly intelligent AI assistant integrated into the Aetherweave platform. Your persona is that of a sophisticated, cyberpunk AI construct.\n\n      Your primary goal is to be helpful and accurate. When asked a question, take your time to think and provide a clear, comprehensive, and correct answer. Your responses should be well-reasoned and detailed.\n\n      Format your responses using Markdown for clarity. Use lists, bolding, and code blocks where appropriate to make the information easy to parse.\n\n      Maintain your persona, but never let it get in the way of providing a quality answer. Your tone should be:\n      - Knowledgeable and confident.\n      - Slightly futuristic and digital, using terms like \"Operator\" for the user, \"processing,\" \"data streams,\" \"neural net,\" etc., where appropriate.\n      - Concise but not abrupt. Avoid unnecessary filler.\n\n      Always prioritize the user's request. If you don't know an answer, say so, but you can also suggest where the user might find the information.`;\n    \n    const messages = [\n      { role: 'system' as const, content: [{ text: systemPrompt }] },\n      ...input.history.map(msg => ({ role: msg.role as 'user' | 'model', content: [{ text: msg.content }] })),\n      { role: 'user' as const, content: [{ text: input.prompt }] }\n    ];\n    \n    const result = await ai.generate({\n      model: 'googleai/gemini-2.0-flash',\n      messages,\n      config: {\n        temperature: 0.7,\n      },\n    });\n\n    console.log('AI response received:', result);\n\n    // Return the text as a stream\n    async function* textStream(): AsyncIterable<string> {\n      if (result.text) {\n        yield result.text;\n      }\n    }\n\n    return textStream();\n  } catch (error: any) {\n    console.error('Error in runAssistantStream:', error);\n    console.error('Error details:', error.message, error.stack);\n    \n    // Return a fallback stream with error message\n    async function* errorStream(): AsyncIterable<string> {\n      yield `Error: ${error.message || 'Unknown error occurred'}. Please check the console for details.`;\n    }\n    \n    return errorStream();\n  }\n}\n","path":null,"size_bytes":2799,"size_tokens":null},"backend/src/controllers/aiController.ts":{"content":"import { Request, Response } from 'express';\nimport { AuthenticatedRequest } from '../middleware/auth';\nimport { z } from 'zod';\n\nconst chatRequestSchema = z.object({\n  message: z.string().min(1).max(1000),\n  context: z.string().optional(),\n  model: z.enum(['gemini-pro', 'gemini-pro-vision']).default('gemini-pro'),\n});\n\nconst imageGenerationSchema = z.object({\n  prompt: z.string().min(1).max(500),\n  style: z.enum(['realistic', 'artistic', 'cyberpunk', 'minimalist']).default('realistic'),\n  size: z.enum(['512x512', '1024x1024', '1024x768']).default('1024x1024'),\n});\n\nexport const chatWithAI = async (req: AuthenticatedRequest, res: Response) => {\n  try {\n    const { uid } = req.user!;\n    const { message, context, model } = chatRequestSchema.parse(req.body);\n\n    // Set up SSE headers for streaming response\n    res.writeHead(200, {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Headers': 'Cache-Control',\n    });\n\n    // Simulate AI response streaming (replace with actual AI integration)\n    const response = `AI Response to: ${message}`;\n    const words = response.split(' ');\n    \n    for (let i = 0; i < words.length; i++) {\n      const chunk = words.slice(0, i + 1).join(' ');\n      res.write(`data: ${JSON.stringify({ content: chunk, done: false })}\\n\\n`);\n      await new Promise(resolve => setTimeout(resolve, 100));\n    }\n\n    res.write(`data: ${JSON.stringify({ content: response, done: true })}\\n\\n`);\n    res.end();\n\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return res.status(400).json({ error: 'Invalid data', details: error.errors });\n    }\n    console.error('Error in AI chat:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n};\n\nexport const generateImage = async (req: AuthenticatedRequest, res: Response) => {\n  try {\n    const { uid } = req.user!;\n    const { prompt, style, size } = imageGenerationSchema.parse(req.body);\n\n    // Placeholder for image generation logic\n    // Replace with actual AI image generation service\n    const imageUrl = `https://picsum.photos/${size.replace('x', '/')}?random=${Date.now()}`;\n\n    res.json({\n      imageUrl,\n      prompt,\n      style,\n      size,\n      generatedAt: new Date(),\n    });\n\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return res.status(400).json({ error: 'Invalid data', details: error.errors });\n    }\n    console.error('Error generating image:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n};\n\nexport const translateText = async (req: AuthenticatedRequest, res: Response) => {\n  try {\n    const { text, targetLanguage } = req.body;\n\n    if (!text || !targetLanguage) {\n      return res.status(400).json({ error: 'Text and target language are required' });\n    }\n\n    // Placeholder for translation logic\n    // Replace with actual translation service\n    const translatedText = `[${targetLanguage.toUpperCase()}] ${text}`;\n\n    res.json({\n      originalText: text,\n      translatedText,\n      targetLanguage,\n      translatedAt: new Date(),\n    });\n\n  } catch (error) {\n    console.error('Error translating text:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n};","path":null,"size_bytes":3315,"size_tokens":null},"src/app/calls-test/page.tsx":{"content":"'use client';\n\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Phone, Video } from 'lucide-react';\nimport { useEnhancedCalls } from '@/hooks/use-enhanced-calls';\nimport { useConnections } from '@/hooks/use-connections';\n\nexport default function CallsTestPage() {\n  const { startCall, callStatus } = useEnhancedCalls();\n  const { users } = useConnections();\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <h1 className=\"text-3xl font-bold mb-6\">Test Calling System</h1>\n      \n      <Card className=\"p-6 mb-6\">\n        <h2 className=\"text-xl font-semibold mb-4\">Call Status: {callStatus}</h2>\n        <p className=\"text-muted-foreground\">\n          Select a user below to start a call. The system will show different panels based on call state.\n        </p>\n      </Card>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {users.map((user) => (\n          <Card key={user.id} className=\"p-4\">\n            <div className=\"flex items-center gap-3 mb-4\">\n              <div className=\"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center text-xl\">\n                {user.displayName?.[0] || '?'}\n              </div>\n              <div>\n                <h3 className=\"font-semibold\">{user.displayName || 'Unknown'}</h3>\n                <p className=\"text-sm text-muted-foreground\">{user.status || 'Offline'}</p>\n              </div>\n            </div>\n            \n            <div className=\"flex gap-2\">\n              <Button\n                onClick={() => startCall(user.id, user.displayName || 'Unknown', 'voice', user.photoURL)}\n                className=\"flex-1\"\n                variant=\"outline\"\n              >\n                <Phone className=\"w-4 h-4 mr-2\" />\n                Voice\n              </Button>\n              <Button\n                onClick={() => startCall(user.id, user.displayName || 'Unknown', 'video', user.photoURL)}\n                className=\"flex-1\"\n              >\n                <Video className=\"w-4 h-4 mr-2\" />\n                Video\n              </Button>\n            </div>\n          </Card>\n        ))}\n      </div>\n\n      {users.length === 0 && (\n        <Card className=\"p-8 text-center\">\n          <p className=\"text-muted-foreground\">No users available. Add some connections first.</p>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":2388,"size_tokens":null},"src/lib/socket.ts":{"content":"import { io, Socket } from 'socket.io-client';\n\nlet socket: Socket | null = null;\n\nexport const getSocket = () => {\n  if (!socket) {\n    socket = io(process.env.NEXT_PUBLIC_API_URL?.replace('/api', '') || 'http://localhost:4000', {\n      autoConnect: false\n    });\n  }\n  return socket;\n};\n","path":null,"size_bytes":289,"size_tokens":null},"src/lib/gaming-themes.ts":{"content":"\nimport type { Theme } from './themes';\n\nexport const gamingThemes: Theme[] = [\n  {\n    id: 'neon-gamer',\n    name: 'Neon Gamer',\n    colors: {\n      background: '220 40% 5%',\n      foreground: '210 40% 98%',\n      card: '220 30% 10%',\n      'card-foreground': '210 40% 98%',\n      popover: '220 40% 2%',\n      'popover-foreground': '210 40% 98%',\n      primary: '330 100% 55%', // Neon Pink\n      'primary-foreground': '330 100% 98%',\n      secondary: '180 100% 50%',\n      'secondary-foreground': '180 100% 5%',\n      muted: '220 20% 15%',\n      'muted-foreground': '215 20% 65%',\n      accent: '330 50% 30%',\n      'accent-foreground': '330 100% 95%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '217 32% 25%',\n      input: '220 30% 12%',\n      ring: '330 100% 65%',\n    },\n  },\n  {\n    id: 'galaxy-fade',\n    name: 'Galaxy Fade',\n    colors: {\n      background: '260 50% 8%',\n      foreground: '260 50% 95%',\n      card: '260 40% 12%',\n      'card-foreground': '260 50% 95%',\n      popover: '260 50% 5%',\n      'popover-foreground': '260 50% 95%',\n      primary: '280 100% 65%', // Deep Purple\n      'primary-foreground': '280 100% 98%',\n      secondary: '220 100% 65%',\n      'secondary-foreground': '220 100% 10%',\n      muted: '260 30% 18%',\n      'muted-foreground': '260 20% 65%',\n      accent: '280 50% 40%',\n      'accent-foreground': '280 100% 95%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '280 50% 30%',\n      input: '260 40% 15%',\n      ring: '280 100% 75%',\n    },\n  },\n];\n","path":null,"size_bytes":1592,"size_tokens":null},"src/lib/api.ts":{"content":"const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000/api';\n\nclass ApiClient {\n  private baseURL: string;\n\n  constructor(baseURL: string = API_BASE_URL) {\n    this.baseURL = baseURL;\n  }\n\n  private async request<T>(\n    endpoint: string,\n    options: RequestInit = {}\n  ): Promise<T> {\n    const url = `${this.baseURL}${endpoint}`;\n    \n    const config: RequestInit = {\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n      },\n      ...options,\n    };\n\n    // Add auth token if available\n    if (typeof window !== 'undefined') {\n      const token = localStorage.getItem('authToken');\n      if (token) {\n        config.headers = {\n          ...config.headers,\n          Authorization: `Bearer ${token}`,\n        };\n      }\n    }\n\n    const response = await fetch(url, config);\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ error: 'Network error' }));\n      throw new Error(error.error || `HTTP ${response.status}`);\n    }\n\n    return response.json();\n  }\n\n  // User endpoints\n  async getUserProfile() {\n    return this.request('/users/profile');\n  }\n\n  async updateUserProfile(data: any) {\n    return this.request('/users/profile', {\n      method: 'PUT',\n      body: JSON.stringify(data),\n    });\n  }\n\n  async getUserStats() {\n    return this.request('/users/stats');\n  }\n\n  // AI endpoints\n  async chatWithAI(message: string, context?: string) {\n    return this.request('/ai/chat', {\n      method: 'POST',\n      body: JSON.stringify({ message, context }),\n    });\n  }\n\n  async generateImage(prompt: string, style?: string, size?: string) {\n    return this.request('/ai/generate-image', {\n      method: 'POST',\n      body: JSON.stringify({ prompt, style, size }),\n    });\n  }\n\n  async translateText(text: string, targetLanguage: string) {\n    return this.request('/ai/translate', {\n      method: 'POST',\n      body: JSON.stringify({ text, targetLanguage }),\n    });\n  }\n\n  // Streaming chat endpoint\n  async streamChat(message: string, context?: string): Promise<ReadableStream> {\n    const url = `${this.baseURL}/ai/chat`;\n    const token = typeof window !== 'undefined' ? localStorage.getItem('authToken') : null;\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...(token && { Authorization: `Bearer ${token}` }),\n      },\n      body: JSON.stringify({ message, context }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    return response.body!;\n  }\n}\n\nexport const apiClient = new ApiClient();\nexport default apiClient;","path":null,"size_bytes":2652,"size_tokens":null},"src/app/login/page.tsx":{"content":"\n'use client';\nimport { useState } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { signInWithEmailAndPassword } from 'firebase/auth';\nimport { useAuth } from '@/firebase/provider';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport Link from 'next/link';\nimport { Loader2 } from 'lucide-react';\nimport { useState as useSignupState } from 'react';\nimport { useRouter as useSignupRouter } from 'next/navigation';\n\nfunction SignupLink() {\n  const [loading, setLoading] = useSignupState(false);\n  const router = useSignupRouter();\n\n  const handleSignupClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    router.push('/signup');\n  };\n\n  return (\n    <span \n      onClick={handleSignupClick}\n      className=\"text-primary hover:underline font-medium transition-colors cursor-pointer inline-flex items-center gap-1\"\n    >\n      {loading ? (\n        <>\n          <Loader2 className=\"w-3 h-3 animate-spin\" />\n          Loading...\n        </>\n      ) : (\n        'Request Access Key'\n      )}\n    </span>\n  );\n}\n\nexport default function LoginPage() {\n  const auth = useAuth();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { toast } = useToast();\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const redirect = searchParams.get('redirect') || '/apps';\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    const trimmedEmail = email.trim();\n    const trimmedPassword = password.trim();\n\n    if (!trimmedEmail || !trimmedPassword) {\n        toast({\n            variant: 'destructive',\n            title: 'Authentication Failed',\n            description: 'Please enter both your email and passphrase.',\n        });\n        setLoading(false);\n        return;\n    }\n\n    try {\n      await signInWithEmailAndPassword(auth, trimmedEmail, trimmedPassword);\n      \n      // Success toast\n      toast({\n        title: 'Access Granted',\n        description: 'Neural interface established successfully.',\n      });\n\n      // Redirect to the intended page or apps\n      router.push(redirect);\n      \n    } catch (error: any) {\n      console.error('Login error:', error);\n      \n      let errorMessage = 'Authentication failed. Please check your credentials.';\n      \n      if (error.code === 'auth/invalid-email') {\n        errorMessage = 'Invalid neural interface ID format.';\n      } else if (error.code === 'auth/invalid-credential') {\n        errorMessage = 'No operator found with this ID or incorrect passphrase.';\n      } else if (error.code === 'auth/too-many-requests') {\n        errorMessage = 'Too many failed attempts. Access temporarily suspended.';\n      }\n\n      toast({\n        variant: 'destructive',\n        title: 'Authentication Failed',\n        description: errorMessage,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen p-4 bg-gradient-to-br from-background via-background to-muted/30\">\n      <Card className=\"w-full max-w-md animate-hologram-fade border-border/50 shadow-2xl\">\n        <CardHeader className=\"text-center space-y-2\">\n          <div className=\"mx-auto w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center mb-2\">\n            <div className=\"w-6 h-6 bg-primary rounded-sm transform rotate-45\"></div>\n          </div>\n          <CardTitle className=\"font-headline text-3xl text-glow bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent\">\n            Identity Verification\n          </CardTitle>\n          <CardDescription className=\"text-base\">\n            Authenticate to interface with Aetherweave neural network\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleLogin} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\" className=\"text-sm font-medium\">\n                Neural Interface ID\n              </Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"operator@aether.corp\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                className=\"bg-input/50 border-border focus:border-primary/50 transition-colors h-12\"\n                disabled={loading}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between items-center\">\n                <Label htmlFor=\"password\" className=\"text-sm font-medium\">\n                  Encrypted Passphrase\n                </Label>\n                <Link href=\"/forgot-password\" passHref>\n                  <span className=\"text-xs text-primary hover:underline cursor-pointer transition-colors\">\n                    Passphrase Corrupted?\n                  </span>\n                </Link>\n              </div>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"••••••••\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                className=\"bg-input/50 border-border focus:border-primary/50 transition-colors h-12\"\n                disabled={loading}\n              />\n            </div>\n            <Button \n              type=\"submit\" \n              className=\"w-full cyber-button h-12 text-lg font-semibold transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]\" \n              disabled={loading}\n            >\n              {loading ? (\n                <>\n                  <Loader2 className=\"animate-spin\" />\n                  Establishing Connection...\n                </>\n              ) : (\n                'Engage Neural Interface'\n              )}\n            </Button>\n          </form>\n          \n          <div className=\"mt-6 pt-4 border-t border-border/50\">\n            <p className=\"text-center text-sm text-muted-foreground\">\n              New to the network?{' '}\n              <SignupLink />\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":6544,"size_tokens":null},"src/firebase/provider.tsx":{"content":"\n'use client';\nimport React, { createContext, useContext, ReactNode, useMemo } from 'react';\nimport { FirebaseApp } from 'firebase/app';\nimport { Auth } from 'firebase/auth';\nimport { Firestore } from 'firebase/firestore';\n\ninterface FirebaseContextValue {\n  app: FirebaseApp;\n  auth: Auth;\n  firestore: Firestore;\n}\n\nconst FirebaseContext = createContext<FirebaseContextValue | undefined>(undefined);\n\ninterface FirebaseProviderProps {\n  children: ReactNode;\n  value: FirebaseContextValue;\n}\n\nexport function FirebaseProvider({ children, value }: FirebaseProviderProps) {\n  return (\n    <FirebaseContext.Provider value={value}>\n      {children}\n    </FirebaseContext.Provider>\n  );\n}\n\nexport const useFirebase = () => {\n  const context = useContext(FirebaseContext);\n  if (context === undefined) {\n    throw new Error('useFirebase must be used within a FirebaseProvider');\n  }\n  return context;\n};\n\nexport const useFirebaseApp = () => useFirebase().app;\nexport const useAuth = () => useFirebase().auth;\nexport const useFirestore = () => useFirebase().firestore;\n","path":null,"size_bytes":1063,"size_tokens":null},"tailwind.config.ts":{"content":"\nimport type {Config} from 'tailwindcss';\n\nexport default {\n  darkMode: ['class'],\n  content: [\n    './src/pages/**/*.{js,ts,jsx,tsx,mdx}',\n    './src/components/**/*.{js,ts,jsx,tsx,mdx}',\n    './src/app/**/*.{js,ts,jsx,tsx,mdx}',\n  ],\n  theme: {\n    extend: {\n      fontFamily: {\n        sans: ['var(--font-sans)', 'sans-serif'],\n        mono: ['var(--font-mono)', 'monospace'],\n        headline: ['var(--font-headline)', 'monospace'],\n      },\n      typography: (theme: (arg0: string) => any) => ({\n        DEFAULT: {\n          css: {\n            '--tw-prose-body': 'hsl(var(--foreground))',\n            '--tw-prose-headings': 'hsl(var(--primary))',\n            '--tw-prose-lead': 'hsl(var(--foreground))',\n            '--tw-prose-links': 'hsl(var(--primary))',\n            '--tw-prose-bold': 'hsl(var(--foreground))',\n            '--tw-prose-counters': 'hsl(var(--muted-foreground))',\n            '--tw-prose-bullets': 'hsl(var(--border))',\n            '--tw-prose-hr': 'hsl(var(--border))',\n            '--tw-prose-quotes': 'hsl(var(--foreground))',\n            '--tw-prose-quote-borders': 'hsl(var(--border))',\n            '--tw-prose-captions': 'hsl(var(--muted-foreground))',\n            '--tw-prose-code': 'hsl(var(--secondary))',\n            '--tw-prose-pre-code': 'hsl(var(--secondary))',\n            '--tw-prose-pre-bg': 'hsl(var(--muted))',\n            '--tw-prose-th-borders': 'hsl(var(--border))',\n            '--tw-prose-td-borders': 'hsl(var(--border))',\n            '--tw-prose-invert-body': 'hsl(var(--foreground))',\n            '--tw-prose-invert-headings': 'hsl(var(--primary))',\n            '--tw-prose-invert-lead': 'hsl(var(--foreground))',\n            '--tw-prose-invert-links': 'hsl(var(--primary))',\n            '--tw-prose-invert-bold': 'hsl(var(--foreground))',\n            '--tw-prose-invert-counters': 'hsl(var(--muted-foreground))',\n            '--tw-prose-invert-bullets': 'hsl(var(--border))',\n            '--tw-prose-invert-hr': 'hsl(var(--border))',\n            '--tw-prose-invert-quotes': 'hsl(var(--foreground))',\n            '--tw-prose-invert-quote-borders': 'hsl(var(--border))',\n            '--tw-prose-invert-captions': 'hsl(var(--muted-foreground))',\n            '--tw-prose-invert-code': 'hsl(var(--secondary))',\n            '--tw-prose-invert-pre-code': 'hsl(var(--secondary))',\n            '--tw-prose-invert-pre-bg': 'hsl(var(--muted))',\n            '--tw-prose-invert-th-borders': 'hsl(var(--border))',\n            '--tw-prose-invert-td-borders': 'hsl(var(--border))',\n          },\n        },\n      }),\n      colors: {\n        background: 'hsl(var(--background))',\n        foreground: 'hsl(var(--foreground))',\n        card: {\n          DEFAULT: 'hsl(var(--card))',\n          foreground: 'hsl(var(--card-foreground))',\n        },\n        popover: {\n          DEFAULT: 'hsl(var(--popover))',\n          foreground: 'hsl(var(--popover-foreground))',\n        },\n        primary: {\n          DEFAULT: 'hsl(var(--primary))',\n          foreground: 'hsl(var(--primary-foreground))',\n        },\n        secondary: {\n          DEFAULT: 'hsl(var(--secondary))',\n          foreground: 'hsl(var(--secondary-foreground))',\n        },\n        muted: {\n          DEFAULT: 'hsl(var(--muted))',\n          foreground: 'hsl(var(--muted-foreground))',\n        },\n        accent: {\n          DEFAULT: 'hsl(var(--accent))',\n          foreground: 'hsl(var(--accent-foreground))',\n        },\n        destructive: {\n          DEFAULT: 'hsl(var(--destructive))',\n          foreground: 'hsl(var(--destructive-foreground))',\n        },\n        border: 'hsl(var(--border))',\n        input: 'hsl(var(--input))',\n        ring: 'hsl(var(--ring))',\n        'gaming-background': 'var(--gaming-background)',\n        'gaming-background-secondary': 'var(--gaming-background-secondary)',\n        'gaming-background-tertiary': 'var(--gaming-background-tertiary)',\n        'gaming-foreground': 'var(--gaming-foreground)',\n        'gaming-muted-foreground': 'var(--gaming-muted-foreground)',\n        'gaming-border': 'var(--gaming-border)',\n        'gaming-primary': 'var(--gaming-primary)',\n        'gaming-primary-foreground': 'var(--gaming-primary-foreground)',\n      },\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 4px)\",\n        sm: \"calc(var(--radius) - 8px)\",\n      },\n      keyframes: {\n        'accordion-down': {\n          from: {\n            height: '0',\n          },\n          to: {\n            height: 'var(--radix-accordion-content-height)',\n          },\n        },\n        'accordion-up': {\n          from: {\n            height: 'var(--radix-accordion-content-height)',\n          },\n          to: {\n            height: '0',\n          },\n        },\n        'pulse-glow': {\n          '0%, 100%': {\n            opacity: '1',\n            boxShadow: '0 0 8px hsl(var(--primary) / 0.7)',\n          },\n          '50%': {\n            opacity: '0.8',\n            boxShadow: '0 0 20px hsl(var(--primary) / 1)',\n           },\n        },\n        'hologram-fade': {\n          '0%, 100%': { opacity: '0.9', filter: 'drop-shadow(0 0 8px hsl(var(--primary) / 0.5))' },\n          '50%': { opacity: '1', filter: 'drop-shadow(0 0 15px hsl(var(--primary) / 0.8))' },\n        },\n        'progress-stripes': {\n          from: { backgroundPosition: '20px 0' },\n          to: { backgroundPosition: '0 0' },\n        },\n        'gradient-shift': {\n          '0%, 100%': {\n            'background-position': '0% 50%',\n          },\n          '50%': {\n            'background-position': '100% 50%',\n          },\n        },\n      },\n      animation: {\n        'accordion-down': 'accordion-down 0.2s ease-out',\n        'accordion-up': 'accordion-up 0.2s ease-out',\n        'pulse-glow': 'pulse-glow 3s infinite ease-in-out',\n        'hologram-fade': 'hologram-fade 5s infinite ease-in-out',\n        'progress-stripes': 'progress-stripes 1s linear infinite',\n        'gradient-shift': 'gradient-shift 15s ease infinite',\n      },\n    },\n  },\n  plugins: [require('tailwindcss-animate'), require('@tailwindcss/typography')],\n} satisfies Config;\n","path":null,"size_bytes":6072,"size_tokens":null},"start-dev.sh":{"content":"#!/bin/bash\n\necho \"Starting AetherDash Development Environment...\"\necho \"\"\n\necho \"Installing dependencies...\"\nnpm install\ncd backend\nnpm install\ncd ..\n\necho \"\"\necho \"Starting development servers...\"\necho \"Frontend: http://localhost:3000\"\necho \"Backend:  http://localhost:5000\"\necho \"\"\n\nnpm run dev","path":null,"size_bytes":297,"size_tokens":null},"src/services/emoji-service.ts":{"content":"const EMOJI_API_KEY = 'b0f1a008330800f6a150c296aa66148e97404be9';\nconst EMOJI_API_URL = 'https://emoji-api.com/emojis';\n\nexport interface Emoji {\n  slug: string;\n  character: string;\n  unicodeName: string;\n  codePoint: string;\n  group: string;\n  subGroup: string;\n}\n\nclass EmojiService {\n  private emojis: Emoji[] = [];\n  private loading = false;\n\n  async getEmojis(): Promise<Emoji[]> {\n    if (this.emojis.length > 0) {\n      return this.emojis;\n    }\n\n    if (this.loading) {\n      return [];\n    }\n\n    this.loading = true;\n    try {\n      const response = await fetch(`${EMOJI_API_URL}?access_key=${EMOJI_API_KEY}`);\n      const data = await response.json();\n      this.emojis = data || [];\n      return this.emojis;\n    } catch (error) {\n      console.error('Failed to fetch emojis:', error);\n      return [];\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  getEmojisByGroup(group: string): Emoji[] {\n    return this.emojis.filter(emoji => emoji.group === group);\n  }\n\n  searchEmojis(query: string): Emoji[] {\n    const searchTerm = query.toLowerCase();\n    return this.emojis.filter(emoji => \n      emoji.unicodeName.toLowerCase().includes(searchTerm) ||\n      emoji.slug.toLowerCase().includes(searchTerm)\n    );\n  }\n\n  getEmojiGroups(): string[] {\n    const groups = [...new Set(this.emojis.map(emoji => emoji.group))];\n    return groups.filter(Boolean);\n  }\n}\n\nexport const emojiService = new EmojiService();\nexport default emojiService;","path":null,"size_bytes":1456,"size_tokens":null},"src/app/gaming/components/GamingMemberList.tsx":{"content":"\n'use client';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { cn } from '@/lib/utils';\nimport { Crown, Sword, User } from 'lucide-react';\nimport React from 'react';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useRouter } from 'next/navigation';\nimport { useToast } from '@/hooks/use-toast';\nimport { useUser, UserProfile } from '@/hooks/use-user';\nimport { useConnections, PublicUser } from '@/hooks/use-connections';\nimport UserPopover from '@/components/user/user-popover';\n\nconst MemberItem = ({ member, isOnline, isOwner }: { member: PublicUser, isOnline: boolean, isOwner?: boolean }) => {\n    const { openHub } = useCommandHub();\n    const router = useRouter();\n    const { toast } = useToast();\n    const { sendFriendRequest, connections } = useConnections();\n    const { user: currentUser } = useUser();\n    const [isSpeaking, setIsSpeaking] = React.useState(false);\n    \n    // This is mock data, replace with real gaming status\n    const gamingStatus = {\n        isInGame: Math.random() > 0.7,\n        game: 'Cyberpunk 2077',\n        status: 'Online',\n    };\n    const isInGame = gamingStatus.isInGame;\n\n    const isFriend = connections.some(c => c.id === member.id && c.status === 'friends');\n    const isPending = connections.some(c => c.id === member.id && c.status === 'pending');\n    const isSelf = currentUser?.uid === member.id;\n\n    React.useEffect(() => {\n        if(isOnline && Math.random() > 0.8) {\n            const interval = setInterval(() => {\n                setIsSpeaking(prev => !prev);\n            }, 2000 + Math.random() * 3000);\n            return () => clearInterval(interval);\n        }\n    }, [isOnline]);\n\n    const handleContextMenu = (e: React.MouseEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (isSelf) return;\n\n        openHub(e, {\n            type: 'gaming-member',\n            data: member,\n            actions: [\n                { label: 'View Profile', icon: 'User', onClick: () => router.push(`/profile/${member.id}`) },\n                { label: 'Mention', icon: 'AtSign', onClick: () => toast({ title: `Mentioned ${member.displayName}` }) },\n                { label: 'Message', icon: 'MessageSquare', onClick: () => router.push(`/chat?contactId=${member.id}`) },\n                { label: 'Add Friend', icon: 'UserPlus', onClick: () => sendFriendRequest(member.id), disabled: isFriend || isPending },\n                { label: 'Set Volume', icon: 'Volume2', onClick: () => {}, disabled: !isOnline },\n                { label: 'Kick', icon: 'LogOut', onClick: () => {}, disabled: true },\n                { label: 'Ban', icon: 'Gavel', onClick: () => {}, isDestructive: true, disabled: true },\n            ]\n        })\n    }\n\n    return (\n        <UserPopover user={member}>\n            <div \n                className=\"flex items-center gap-3 p-1 rounded-md hover:bg-accent/50 cursor-pointer group\"\n                onContextMenu={handleContextMenu}\n                data-command-hub-trigger\n            >\n                <div className=\"relative\">\n                    <Avatar className={cn(\"h-10 w-10 transition-all\", isSpeaking && \"border-2 border-green-400 shadow-[0_0_15px_rgba(74,222,128,0.7)]\")}>\n                        <AvatarImage src={member.photoURL || undefined} className={cn(!isOnline && 'filter grayscale')}/>\n                        <AvatarFallback>{member.displayName?.charAt(0)}</AvatarFallback>\n                    </Avatar>\n                    {isOnline && (\n                        <div className={cn(\n                            \"absolute -bottom-0.5 -right-0.5 h-4 w-4 rounded-full border-2 border-gaming-background\",\n                            isInGame ? 'bg-purple-500' : 'bg-green-500'\n                        )}>\n                        {isInGame && <div className=\"absolute inset-0.5 rounded-full bg-purple-500 animate-pulse\"></div>}\n                        </div>\n                    )}\n                </div>\n                <div className=\"flex-1 overflow-hidden\">\n                    <p className={cn('font-semibold truncate flex items-center gap-1.5', isOwner && 'text-amber-400')}>\n                        {isOwner && <Crown size={14} />}\n                        {member.displayName}\n                    </p>\n                    <div className=\"text-xs text-gaming-muted-foreground truncate flex items-center gap-1.5\">\n                    {isOnline && isInGame ? (\n                        <>\n                            <Sword size={12} className=\"text-purple-400\" />\n                            <span>{gamingStatus.game}</span>\n                        </>\n                    ) : (\n                        <span>{isOnline ? gamingStatus.status : 'Offline'}</span>\n                    )}\n                    </div>\n                </div>\n            </div>\n        </UserPopover>\n    )\n};\n\ninterface GamingMemberListProps {\n    activeSpaceId: string | null;\n}\n\nexport default function GamingMemberList({ activeSpaceId }: GamingMemberListProps) {\n    const { user, profile } = useUser();\n    const { users: connectedUsers, connections } = useConnections();\n\n    const { owner, onlineMembers, offlineMembers } = React.useMemo(() => {\n        const ownerUsername = \"mubah3r\"; \n        let owner: PublicUser | null = null;\n        \n        const allMembers = connections\n            .filter(c => c.status === 'friends')\n            .map(c => connectedUsers.find(u => u.id === c.id))\n            .filter((u): u is PublicUser => !!u);\n            \n        if (profile) {\n            allMembers.unshift(profile as PublicUser);\n        }\n\n        const uniqueMembers = Array.from(new Map(allMembers.map(item => [item.id, item])).values());\n        \n        const online: PublicUser[] = [];\n        \n        const isAetherweaveHQ = activeSpaceId === 'aetherweave-hq';\n\n        uniqueMembers.forEach(member => {\n            if (isAetherweaveHQ && member.username === ownerUsername) {\n                owner = member;\n            } else {\n                online.push(member);\n            }\n        });\n        \n        return {\n            owner,\n            onlineMembers: online,\n            offlineMembers: [] \n        };\n\n    }, [profile, connections, connectedUsers, activeSpaceId]);\n\n    const memberGroups: { [key: string]: PublicUser[] } = {};\n\n    if (owner) {\n        memberGroups['OWNER'] = [owner];\n    }\n    if (onlineMembers.length > 0) {\n        memberGroups['ONLINE'] = onlineMembers;\n    }\n    if (offlineMembers.length > 0) {\n        memberGroups['OFFLINE'] = offlineMembers;\n    }\n\n    const totalOnline = (owner ? 1 : 0) + onlineMembers.length;\n\n    return (\n        <div className=\"hidden w-64 flex-col bg-gaming-background-secondary/60 backdrop-blur-sm lg:flex\">\n             <header className=\"flex h-16 shrink-0 items-center border-b border-gaming-border px-4 shadow-md\">\n                <h2 className=\"text-lg font-bold text-gaming-foreground\">Members - {totalOnline} Online</h2>\n             </header>\n            <ScrollArea className=\"flex-1 p-3 custom-scroll\">\n                 {totalOnline === 0 && offlineMembers.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center h-full text-center text-muted-foreground\">\n                        <User className=\"w-12 h-12 mb-4\" />\n                        <h3 className=\"font-headline text-lg\">No Members</h3>\n                        <p className=\"text-sm\">This space is currently empty.</p>\n                    </div>\n                ) : (\n                    <div className=\"space-y-6\">\n                        {Object.entries(memberGroups).map(([group, members]) => (\n                            members.length > 0 && <div key={group}>\n                                <h3 className=\"mb-2 text-sm font-bold uppercase text-gaming-muted-foreground\">{group}</h3>\n                                <div className=\"space-y-3\">\n                                    {members.map(member => (\n                                        <MemberItem \n                                            key={member.id} \n                                            member={member} \n                                            isOnline={group !== 'OFFLINE'}\n                                            isOwner={group === 'OWNER'}\n                                        />\n                                    ))}\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </ScrollArea>\n        </div>\n    );\n}\n","path":null,"size_bytes":8614,"size_tokens":null},"src/components/chat/video-call-view.tsx":{"content":"\n'use client';\nimport { useState, useEffect, useRef } from 'react';\nimport {\n  Mic, MicOff, Video, VideoOff, PhoneOff, ScreenShare, ScreenShareOff, User, Loader2\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { PublicUser } from '@/hooks/use-connections';\nimport { cn } from '@/lib/utils';\nimport { CallStatus } from '@/hooks/use-webrtc';\nimport { useUser } from '@/hooks/use-user';\nimport { useAudioLevel } from '@/hooks/use-audio-level';\n\ninterface VideoParticipantProps {\n  stream: MediaStream | null;\n  user: PublicUser | undefined;\n  isLocal?: boolean;\n  isMuted: boolean;\n}\n\nconst VideoParticipant = ({ stream, user, isLocal = false, isMuted }: VideoParticipantProps) => {\n    const videoRef = useRef<HTMLVideoElement>(null);\n    const audioLevel = useAudioLevel(stream);\n    const isTalking = audioLevel > 0.05;\n\n    useEffect(() => {\n        if (videoRef.current && stream) {\n            videoRef.current.srcObject = stream;\n        }\n    }, [stream]);\n\n    return (\n        <div className=\"relative aspect-video bg-black rounded-lg overflow-hidden flex items-center justify-center\">\n            {stream ? (\n                <video\n                    ref={videoRef}\n                    autoPlay\n                    playsInline\n                    muted={isLocal}\n                    className={cn(\"w-full h-full object-cover\", isLocal && \"scale-x-[-1]\")}\n                />\n            ) : (\n                <Avatar className=\"w-24 h-24 border-4 border-muted\">\n                    <AvatarImage src={user?.photoURL || ''} />\n                    <AvatarFallback className=\"text-4xl\">{user?.displayName?.[0] || '?'}</AvatarFallback>\n                </Avatar>\n            )}\n             <div className={cn(\n                \"absolute inset-0 border-4 rounded-lg transition-all duration-300 pointer-events-none\",\n                isTalking ? 'border-primary neon-border-primary' : 'border-transparent'\n            )}></div>\n            <div className=\"absolute bottom-2 left-2 bg-black/50 px-2 py-1 rounded-md text-white text-sm flex items-center gap-2\">\n                {isMuted ? <MicOff className=\"w-4 h-4 text-destructive\" /> : <Mic className=\"w-4 h-4\" />}\n                {user?.displayName}\n            </div>\n        </div>\n    );\n};\n\n\ninterface VideoCallViewProps {\n  state: CallStatus;\n  localStream: MediaStream | null;\n  remoteStream: MediaStream | null;\n  onHangup: () => void;\n  onToggleAudio: () => void;\n  onToggleVideo: () => void;\n  isAudioEnabled: boolean;\n  isVideoEnabled: boolean;\n  duration: string;\n  peer?: PublicUser;\n  status: string;\n  onScreenShare: () => void;\n  isScreenSharing: boolean;\n}\n\nexport default function VideoCallView({\n  state, localStream, remoteStream, onHangup, onToggleAudio, onToggleVideo, isAudioEnabled,\n  isVideoEnabled, duration, peer, status, onScreenShare, isScreenSharing\n}: VideoCallViewProps) {\n  const { profile: currentUser } = useUser();\n\n  const renderContent = () => {\n    if (state === 'connected') {\n      return (\n        <div className=\"grid grid-cols-1 grid-rows-1 h-full w-full\">\n            <div className=\"col-span-1 row-span-1\">\n                <VideoParticipant stream={remoteStream} user={peer} isMuted={false} />\n            </div>\n            <div className=\"absolute bottom-4 right-4 w-40 md:w-52 z-10\">\n                 <VideoParticipant stream={localStream} user={currentUser || undefined} isLocal isMuted={!isAudioEnabled}/>\n            </div>\n        </div>\n      );\n    }\n    \n    // For outgoing, ringing, or connecting states\n    const statusText = state === 'calling' ? 'Calling...' : state === 'ringing' ? 'Ringing...' : status;\n\n    return (\n      <div className=\"w-full h-full flex flex-col items-center justify-center bg-black/50 text-white\">\n        <div className=\"relative\">\n          <Avatar className=\"w-32 h-32 border-4 border-primary\">\n            <AvatarImage src={peer?.photoURL || ''} />\n            <AvatarFallback className=\"text-5xl\">{peer?.displayName?.[0] || '?'}</AvatarFallback>\n          </Avatar>\n           {(state === 'calling' || state === 'ringing') && <div className=\"absolute inset-0 rounded-full border-4 border-primary animate-ping\"></div>}\n        </div>\n        <h3 className=\"mt-6 text-3xl font-headline text-glow\">{peer?.displayName || 'Connecting...'}</h3>\n        <p className=\"text-muted-foreground capitalize flex items-center gap-2 mt-2\">\n           {(state === 'calling' || status === 'connecting') && <Loader2 className=\"w-5 h-5 animate-spin\"/>}\n            {statusText}\n        </p>\n      </div>\n    );\n  };\n  \n  return (\n    <div className=\"fixed inset-0 bg-background z-50 flex items-center justify-center p-0 md:p-4\">\n      <Card className=\"w-full h-full max-w-none md:max-w-6xl md:max-h-[90vh] glass-card flex flex-col overflow-hidden rounded-none md:rounded-lg\">\n        <CardContent className=\"flex-1 p-0 relative\">\n          {renderContent()}\n        </CardContent>\n\n        <div className=\"p-4 border-t bg-background/50 backdrop-blur-sm flex justify-center items-center gap-4\">\n          <Button variant={isAudioEnabled ? 'outline' : 'secondary'} size=\"icon\" className=\"w-12 h-12 rounded-full\" onClick={onToggleAudio}>\n            {isAudioEnabled ? <Mic /> : <MicOff className=\"text-destructive\"/>}\n          </Button>\n          <Button variant={isVideoEnabled ? 'outline' : 'secondary'} size=\"icon\" className=\"w-12 h-12 rounded-full\" onClick={onToggleVideo}>\n            {isVideoEnabled ? <Video /> : <VideoOff className=\"text-destructive\"/>}\n          </Button>\n           <Button variant={isScreenSharing ? 'secondary' : 'outline'} size=\"icon\" className=\"w-12 h-12 rounded-full\" onClick={onScreenShare}>\n            {isScreenSharing ? <ScreenShareOff className=\"text-destructive\"/> : <ScreenShare />}\n          </Button>\n          <Button size=\"icon\" className=\"w-16 h-12 rounded-full bg-destructive hover:bg-destructive/80\" onClick={onHangup}>\n            <PhoneOff />\n          </Button>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":6144,"size_tokens":null},"COMPLETE_CALLING_SYSTEM.md":{"content":"# 🎯 Complete WebRTC Calling System - Discord Style\n\n## 📁 Project Structure\n\n```\nproject/\n├── backend/\n│   └── src/\n│       └── server.ts                    # Socket.io signaling server\n├── src/\n│   ├── components/calls/\n│   │   ├── CallInterface.tsx            # Main orchestrator\n│   │   ├── SenderPanel.tsx              # Caller UI\n│   │   ├── ReceiverPanel.tsx            # Incoming call UI\n│   │   └── ConnectedPanel.tsx           # Active call UI\n│   ├── hooks/\n│   │   └── use-enhanced-calls.ts        # Call state management\n│   ├── lib/\n│   │   └── socket.ts                    # Socket.io client\n│   └── app/\n│       ├── globals.css                  # Animations\n│       └── calls-test/page.tsx          # Test page\n```\n\n---\n\n## 🔧 Backend - Socket.io Signaling Server\n\n### File: `backend/src/server.ts`\n\n```typescript\nimport express from 'express';\nimport { createServer } from 'http';\nimport { Server } from 'socket.io';\nimport cors from 'cors';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nconst app = express();\nconst httpServer = createServer(app);\nconst io = new Server(httpServer, {\n  cors: {\n    origin: process.env.CORS_ORIGIN || 'http://localhost:3000',\n    credentials: true\n  }\n});\n\napp.use(cors());\napp.use(express.json());\n\n// Socket.io signaling events\nio.on('connection', (socket) => {\n  console.log('User connected:', socket.id);\n\n  // User registers with their userId\n  socket.on('user:register', (userId) => {\n    socket.join(userId);\n    console.log(`User ${userId} registered`);\n  });\n\n  // Call offer - Sender initiates call\n  socket.on('call:offer', ({ to, offer, from, callType, fromName, fromAvatar }) => {\n    console.log(`Call offer from ${from} to ${to}`);\n    io.to(to).emit('call:incoming', { from, offer, callType, fromName, fromAvatar });\n  });\n\n  // Call answer - Receiver accepts call\n  socket.on('call:answer', ({ to, answer }) => {\n    console.log(`Call answer to ${to}`);\n    io.to(to).emit('call:answer', { answer });\n  });\n\n  // ICE candidate exchange\n  socket.on('call:ice-candidate', ({ to, candidate }) => {\n    io.to(to).emit('call:ice-candidate', { candidate });\n  });\n\n  // Call declined\n  socket.on('call:decline', ({ to }) => {\n    console.log(`Call declined to ${to}`);\n    io.to(to).emit('call:declined');\n  });\n\n  // Call ended\n  socket.on('call:end', ({ to }) => {\n    console.log(`Call ended to ${to}`);\n    io.to(to).emit('call:ended');\n  });\n\n  socket.on('disconnect', () => {\n    console.log('User disconnected:', socket.id);\n  });\n});\n\nconst PORT = process.env.PORT || 4000;\nhttpServer.listen(PORT, () => {\n  console.log(`🚀 Server running on port ${PORT}`);\n});\n```\n\n**Events Handled:**\n- `user:register` - User joins their room\n- `call:offer` - WebRTC offer sent\n- `call:answer` - WebRTC answer sent\n- `call:ice-candidate` - ICE candidates exchanged\n- `call:decline` - Call declined by receiver\n- `call:end` - Call ended by either party\n\n---\n\n## 🎨 Frontend - React Components\n\n### 1. Socket Client (`src/lib/socket.ts`)\n\n```typescript\nimport { io, Socket } from 'socket.io-client';\n\nlet socket: Socket | null = null;\n\nexport const getSocket = () => {\n  if (!socket) {\n    socket = io(process.env.NEXT_PUBLIC_API_URL?.replace('/api', '') || 'http://localhost:4000', {\n      autoConnect: false\n    });\n  }\n  return socket;\n};\n```\n\n---\n\n### 2. Call Hook (`src/hooks/use-enhanced-calls.ts`)\n\n**Key Features:**\n- WebRTC peer connection management\n- Socket.io signaling\n- Media stream handling\n- Call state management\n- Ringtone playback\n\n**States:**\n```typescript\ntype CallStatus = 'idle' | 'calling' | 'ringing' | 'connected';\n```\n\n**Main Functions:**\n- `startCall(userId, userName, callType, avatar)` - Initiate call\n- `acceptCall()` - Accept incoming call\n- `declineCall()` - Decline incoming call\n- `endCall()` - End active call\n- `toggleAudio()` - Mute/unmute\n- `toggleVideo()` - Camera on/off\n\n---\n\n### 3. Sender Panel (`src/components/calls/SenderPanel.tsx`)\n\n**Features:**\n- Pulsing avatar animation\n- Auto-updating status: \"Calling...\" → \"Ringing...\" → \"Connecting...\"\n- Cancel button\n- Glassmorphic card design\n\n**UI States:**\n1. **Calling** (0-1s) - Initial state\n2. **Ringing** (1-3s) - Waiting for answer\n3. **Connecting** (3s+) - WebRTC connecting\n\n---\n\n### 4. Receiver Panel (`src/components/calls/ReceiverPanel.tsx`)\n\n**Features:**\n- Floating popup with dark backdrop\n- Triple pulsing green rings\n- Animated phone icon\n- Accept/Decline buttons\n- Call type indicator (Voice/Video)\n\n**Actions:**\n- Accept → Transitions to Connected Panel\n- Decline → Notifies caller via Socket.io\n\n---\n\n### 5. Connected Panel (`src/components/calls/ConnectedPanel.tsx`)\n\n**Features:**\n- Full-screen call interface\n- Remote video (full screen)\n- Local video (PiP top-right)\n- Call duration timer\n- Control buttons:\n  - Mic toggle\n  - Video toggle\n  - Screen share (disabled)\n  - End call\n\n**Video Handling:**\n- Shows avatar when video off\n- \"Waiting for video...\" placeholder\n- Smooth fade-in animations\n\n---\n\n### 6. Call Interface (`src/components/calls/CallInterface.tsx`)\n\n**Orchestrator Component:**\n```typescript\n{callStatus === 'calling' && <SenderPanel />}\n{callStatus === 'ringing' && <ReceiverPanel />}\n{callStatus === 'connected' && <ConnectedPanel />}\n```\n\nUses `AnimatePresence` for smooth transitions between panels.\n\n---\n\n## 🔄 Complete Call Flow\n\n### Initiating a Call\n\n```\n1. User A clicks call button\n   ↓\n2. startCall() called\n   ↓\n3. Status: 'calling' → SenderPanel shows\n   ↓\n4. Get user media (audio/video)\n   ↓\n5. Create RTCPeerConnection\n   ↓\n6. Create offer\n   ↓\n7. Socket.emit('call:offer', { to, from, offer, callType, fromName, fromAvatar })\n   ↓\n8. SenderPanel shows: \"Calling...\" → \"Ringing...\" → \"Connecting...\"\n```\n\n### Receiving a Call\n\n```\n1. Socket receives 'call:incoming'\n   ↓\n2. Status: 'ringing' → ReceiverPanel shows\n   ↓\n3. Ringtone plays\n   ↓\n4. User B sees popup with Accept/Decline\n   ↓\n5a. ACCEPT:\n    - acceptCall() called\n    - Get user media\n    - Set remote description (offer)\n    - Create answer\n    - Socket.emit('call:answer', { to, answer })\n    - Status: 'connected' → ConnectedPanel shows\n    ↓\n5b. DECLINE:\n    - declineCall() called\n    - Socket.emit('call:decline', { to })\n    - Status: 'idle'\n    - User A receives 'call:declined'\n```\n\n### Connected State\n\n```\n1. Both peers exchange ICE candidates\n   ↓\n2. WebRTC connection established\n   ↓\n3. ConnectedPanel shows for both users\n   ↓\n4. Video/audio streams displayed\n   ↓\n5. Call timer starts\n   ↓\n6. Controls available (mute, video, end)\n```\n\n### Ending a Call\n\n```\n1. User clicks end call\n   ↓\n2. endCall() called\n   ↓\n3. Socket.emit('call:end', { to })\n   ↓\n4. Stop all media tracks\n   ↓\n5. Close peer connection\n   ↓\n6. Other user receives 'call:ended'\n   ↓\n7. Both users: Status → 'idle'\n   ↓\n8. Cleanup complete\n```\n\n---\n\n## 🎨 CSS Animations (`src/app/globals.css`)\n\n### Key Animations\n\n```css\n/* Pulsing ring animation */\n@keyframes call-pulse {\n  0%, 100% {\n    transform: scale(1);\n    box-shadow: 0 0 0 0 hsl(var(--primary) / 0.7);\n  }\n  50% {\n    transform: scale(1.05);\n    box-shadow: 0 0 0 10px hsl(var(--primary) / 0);\n  }\n}\n\n/* Incoming call shake */\n@keyframes incoming-call {\n  0%, 100% { transform: scale(1) rotate(0deg); }\n  25% { transform: scale(1.1) rotate(-5deg); }\n  75% { transform: scale(1.1) rotate(5deg); }\n}\n\n.incoming-call-animation {\n  animation: incoming-call 1s ease-in-out infinite;\n}\n```\n\n---\n\n## 🚀 Usage Example\n\n### In Your Component\n\n```typescript\nimport { useEnhancedCalls } from '@/hooks/use-enhanced-calls';\n\nfunction MyComponent() {\n  const { startCall, callStatus } = useEnhancedCalls();\n\n  const handleVideoCall = () => {\n    startCall(\n      'user123',              // userId\n      'John Doe',             // userName\n      'video',                // 'voice' | 'video'\n      '/avatar.jpg'           // optional avatar\n    );\n  };\n\n  return (\n    <button onClick={handleVideoCall}>\n      Start Video Call\n    </button>\n  );\n}\n```\n\n### Test Page\n\nVisit `/calls-test` to test the system with your connections.\n\n---\n\n## 📦 Installation\n\n### Backend Dependencies\n\n```bash\ncd backend\nnpm install socket.io @types/socket.io\n```\n\n### Frontend Dependencies\n\n```bash\nnpm install socket.io-client framer-motion\n```\n\n---\n\n## ⚙️ Configuration\n\n### Environment Variables\n\n**Backend (.env):**\n```env\nPORT=4000\nCORS_ORIGIN=http://localhost:3000\n```\n\n**Frontend (.env.local):**\n```env\nNEXT_PUBLIC_API_URL=http://localhost:4000\n```\n\n---\n\n## 🎯 Features Implemented\n\n✅ **WebRTC** - Peer-to-peer audio/video\n✅ **Socket.io** - Real-time signaling\n✅ **Discord-style UI** - Modern, animated panels\n✅ **Call states** - Calling, Ringing, Connecting, Connected\n✅ **Media controls** - Mute, video toggle, end call\n✅ **Ringtone** - Audio feedback for incoming calls\n✅ **Smooth transitions** - Framer Motion animations\n✅ **Responsive** - Works on mobile and desktop\n✅ **Graceful disconnection** - Handles network issues\n✅ **Call duration** - Timer display\n✅ **Avatar display** - User identification\n✅ **Status indicators** - Online/offline, connecting states\n\n---\n\n## 🔍 Debugging\n\n### Check Socket Connection\n\n```typescript\nconst socket = getSocket();\nsocket.on('connect', () => console.log('Connected'));\nsocket.on('disconnect', () => console.log('Disconnected'));\n```\n\n### Check WebRTC State\n\n```typescript\npeerConnection.oniceconnectionstatechange = () => {\n  console.log('ICE State:', peerConnection.iceConnectionState);\n};\n```\n\n### Common Issues\n\n1. **No video/audio** - Check browser permissions\n2. **Connection fails** - Verify STUN server access\n3. **Socket not connecting** - Check CORS and backend URL\n4. **Ringtone not playing** - User interaction required first\n\n---\n\n## 🎨 Customization\n\n### Change Colors\n\nEdit Tailwind classes in components:\n- Primary: `border-primary`, `bg-primary`\n- Success: `border-green-500`, `bg-green-500`\n- Danger: `border-red-500`, `bg-red-500`\n\n### Add Screen Share\n\nUncomment screen share button in `ConnectedPanel.tsx` and implement:\n\n```typescript\nconst startScreenShare = async () => {\n  const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });\n  // Replace video track in peer connection\n};\n```\n\n---\n\n## 📊 State Management Flow\n\n```\nIDLE → startCall() → CALLING → (offer sent)\n                                    ↓\nRINGING ← (incoming call) ← Socket.io\n    ↓\nacceptCall() → CONNECTED → (answer sent)\n    ↓                           ↓\nVideo/Audio Streams ← WebRTC Connection\n    ↓\nendCall() → IDLE\n```\n\n---\n\n## 🔐 Security Considerations\n\n- Use TURN servers for NAT traversal in production\n- Implement authentication for Socket.io connections\n- Validate user permissions before initiating calls\n- Rate limit call requests\n- Encrypt signaling data\n\n---\n\n## 🚀 Production Deployment\n\n### Backend\n\n```bash\ncd backend\nnpm run build\nnpm start\n```\n\nDeploy to: Railway, Heroku, AWS, or any Node.js host\n\n### Frontend\n\n```bash\nnpm run build\n```\n\nDeploy to: Vercel, Netlify, or any static host\n\n---\n\n## 📝 Summary\n\nThis is a **production-ready** WebRTC calling system with:\n- Clean, modern Discord-style UI\n- Real-time Socket.io signaling\n- Smooth animations and transitions\n- Complete call flow handling\n- Responsive design\n- Easy integration\n\n**All code is already implemented in your project and ready to use!**\n\nVisit `/calls-test` to start testing calls between users.\n","path":null,"size_bytes":11621,"size_tokens":null},"src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5629,"size_tokens":null},"src/components/settings/developer-settings.tsx":{"content":"\n'use client';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Button } from '@/components/ui/button';\nimport { RefreshCw, Trash2 } from 'lucide-react';\nimport { useOnboarding } from '@/hooks/use-onboarding';\nimport { useToast } from '@/hooks/use-toast';\n\nexport default function DeveloperSettings() {\n  const { skipTour } = useOnboarding();\n  const { toast } = useToast();\n\n  const handleResetOnboarding = () => {\n    // In a real app, you'd call a function from the useOnboarding hook to reset state\n    localStorage.removeItem('aetherweave-onboarding-status');\n    toast({\n      title: \"Onboarding Reset\",\n      description: \"The onboarding tutorial will start on your next page load.\",\n    })\n  };\n\n  const handleClearCache = () => {\n    // This is a simulation. Real cache clearing is more complex.\n    toast({\n      title: \"Local Cache Cleared\",\n      description: \"Application's local data has been purged.\",\n    })\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Developer Tools</CardTitle>\n        <CardDescription>Advanced options for developers and power users. Use with caution.</CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        <div className=\"flex items-center justify-between p-4 rounded-lg border bg-background/30\">\n          <Label htmlFor=\"dev-mode\" className=\"flex flex-col gap-1 cursor-pointer\">\n            <span>Enable Developer Mode</span>\n            <span className=\"font-normal text-muted-foreground text-sm\">Exposes additional debugging tools and options.</span>\n          </Label>\n          <Switch id=\"dev-mode\" />\n        </div>\n        <div className=\"flex items-center justify-between p-4 rounded-lg border bg-destructive/10\">\n          <Label htmlFor=\"reset-onboarding\" className=\"flex flex-col gap-1\">\n            <span>Reset Onboarding Tutorial</span>\n            <span className=\"font-normal text-destructive/80 text-sm\">This will restart the initial welcome tour.</span>\n          </Label>\n          <Button id=\"reset-onboarding\" variant=\"destructive\" onClick={handleResetOnboarding}>\n            <RefreshCw className=\"mr-2 h-4 w-4\" /> Reset\n          </Button>\n        </div>\n         <div className=\"flex items-center justify-between p-4 rounded-lg border bg-destructive/10\">\n          <Label htmlFor=\"clear-cache\" className=\"flex flex-col gap-1\">\n            <span>Clear Local Cache</span>\n            <span className=\"font-normal text-destructive/80 text-sm\">Force-clears all locally cached data.</span>\n          </Label>\n          <Button id=\"clear-cache\" variant=\"destructive\" onClick={handleClearCache}>\n            <Trash2 className=\"mr-2 h-4 w-4\" /> Clear Now\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2893,"size_tokens":null},"src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"src/components/ui/separator.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":770,"size_tokens":null},"CALLING_SYSTEM.md":{"content":"# Real-Time Calling System Documentation\n\n## Overview\nA fully functional WebRTC-based calling system with Firebase Realtime Database signaling, featuring Discord-style UI with smooth transitions between call states.\n\n## Architecture\n\n### Technology Stack\n- **WebRTC**: Peer-to-peer audio/video communication\n- **Firebase Firestore**: Real-time signaling (offers, answers, ICE candidates)\n- **React Hooks**: State management\n- **Framer Motion**: Smooth animations and transitions\n\n### Components\n\n#### 1. **SenderPanel** (`/src/components/calls/SenderPanel.tsx`)\n- Displays when initiating a call\n- Shows \"Calling...\" status with pulsing avatar animation\n- Controls: Mute, Video toggle, End call\n\n#### 2. **ReceiverPanel** (`/src/components/calls/ReceiverPanel.tsx`)\n- Displays when receiving an incoming call\n- Shows caller info with pulsing green animation\n- Actions: Accept or Decline\n\n#### 3. **ConnectedPanel** (`/src/components/calls/ConnectedPanel.tsx`)\n- Displays during active call\n- Shows video streams (remote full-screen, local PiP)\n- Displays call duration\n- Controls: Mute, Video toggle, End call\n\n#### 4. **CallInterface** (`/src/components/calls/CallInterface.tsx`)\n- Main orchestrator component\n- Switches between panels based on `callStatus`\n- Handles smooth transitions with AnimatePresence\n\n### Hook: `useEnhancedCalls`\n\nLocated at `/src/hooks/use-enhanced-calls.ts`\n\n#### Call States\n```typescript\ntype CallStatus = 'idle' | 'calling' | 'ringing' | 'connected';\n```\n\n#### Key Functions\n- `startCall(userId, userName, callType, avatar?)` - Initiate a call\n- `acceptCall()` - Accept incoming call\n- `declineCall()` - Decline incoming call\n- `endCall()` - End active call\n- `toggleAudio()` - Mute/unmute microphone\n- `toggleVideo()` - Enable/disable camera\n\n#### State Variables\n- `callStatus` - Current call state\n- `activeCall` - Active call details\n- `incomingCall` - Incoming call details\n- `localStream` - Local media stream\n- `remoteStream` - Remote media stream\n- `isAudioEnabled` - Microphone state\n- `isVideoEnabled` - Camera state\n- `callDuration` - Formatted call duration (MM:SS)\n\n## Firebase Structure\n\n### Collections\n\n#### `/calls/{userId}`\nStores call signaling data for each user:\n```typescript\n{\n  type: 'incoming' | 'accepted' | 'declined' | 'ended',\n  callId: string,\n  fromUserId: string,\n  fromUserName: string,\n  fromUserAvatar?: string,\n  callType: 'voice' | 'video',\n  timestamp: Timestamp\n}\n```\n\n#### `/webrtc/{callId}`\nStores WebRTC signaling data:\n```typescript\n{\n  offer: RTCSessionDescriptionInit,\n  answer?: RTCSessionDescriptionInit,\n  timestamp: Timestamp\n}\n```\n\n#### `/webrtc/{callId}/candidates`\nStores ICE candidates for connection establishment:\n```typescript\n{\n  candidate: RTCIceCandidateInit,\n  timestamp: Timestamp\n}\n```\n\n## Call Flow\n\n### Initiating a Call (Sender)\n1. User clicks call button → `startCall()` called\n2. Status changes to `'calling'` → **SenderPanel** displays\n3. Get user media (audio/video)\n4. Create RTCPeerConnection\n5. Create and send offer to Firestore `/webrtc/{callId}`\n6. Send call notification to recipient `/calls/{recipientId}`\n7. Listen for answer from Firestore\n\n### Receiving a Call (Receiver)\n1. Firestore listener detects incoming call\n2. Status changes to `'ringing'` → **ReceiverPanel** displays\n3. Ringtone plays\n4. User clicks Accept → `acceptCall()` called\n5. Get user media\n6. Create RTCPeerConnection\n7. Retrieve offer from Firestore\n8. Create and send answer to Firestore\n9. Notify caller of acceptance\n\n### Connected State\n1. Both peers exchange ICE candidates\n2. WebRTC connection established\n3. Status changes to `'connected'` → **ConnectedPanel** displays\n4. Call timer starts\n5. Video/audio streams displayed\n\n### Ending a Call\n1. User clicks end call → `endCall()` called\n2. Stop all media tracks\n3. Close peer connection\n4. Notify other user via Firestore\n5. Clean up Firestore documents\n6. Status returns to `'idle'`\n\n## Usage Example\n\n```tsx\nimport { useEnhancedCalls } from '@/hooks/use-enhanced-calls';\n\nfunction MyComponent() {\n  const { startCall, callStatus } = useEnhancedCalls();\n\n  const handleCall = () => {\n    startCall(\n      'user123',           // userId\n      'John Doe',          // userName\n      'video',             // 'voice' | 'video'\n      '/avatar.jpg'        // optional avatar URL\n    );\n  };\n\n  return (\n    <button onClick={handleCall}>\n      Start Video Call\n    </button>\n  );\n}\n```\n\n## Testing\n\nVisit `/calls-test` page to test the calling system with your connections.\n\n## Features\n\n✅ Voice and video calls\n✅ Real-time signaling via Firebase\n✅ Discord-style UI with smooth transitions\n✅ Call duration tracking\n✅ Mute/unmute audio\n✅ Enable/disable video\n✅ Picture-in-picture local video\n✅ Ringtone playback\n✅ Accept/decline incoming calls\n✅ Automatic cleanup on page refresh\n\n## Security Considerations\n\n- Firebase Security Rules should restrict read/write access to call documents\n- Only participants should access their call data\n- ICE candidates should be protected from unauthorized access\n\n## Future Enhancements\n\n- Screen sharing\n- Group calls\n- Call history\n- Recording\n- Noise cancellation\n- Virtual backgrounds\n- Call quality indicators\n","path":null,"size_bytes":5216,"size_tokens":null},"src/app/signup/page.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { createUserWithEmailAndPassword, updateProfile } from 'firebase/auth';\nimport { useAuth, useFirestore } from '@/firebase/provider';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport Link from 'next/link';\nimport { doc, setDoc, serverTimestamp } from 'firebase/firestore';\nimport { Loader2 } from 'lucide-react';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { UserProfile } from '@/hooks/use-user';\nimport { useState as useLoginState } from 'react';\nimport { useRouter as useLoginRouter } from 'next/navigation';\n\nfunction LoginLink() {\n  const [loading, setLoading] = useLoginState(false);\n  const router = useLoginRouter();\n\n  const handleLoginClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    router.push('/login');\n  };\n\n  return (\n    <span \n      onClick={handleLoginClick}\n      className=\"text-primary hover:underline cursor-pointer inline-flex items-center gap-1\"\n    >\n      {loading ? (\n        <>\n          <Loader2 className=\"w-3 h-3 animate-spin\" />\n          Loading...\n        </>\n      ) : (\n        'Login'\n      )}\n    </span>\n  );\n}\n\n\nexport default function SignupPage() {\n  const auth = useAuth();\n  const firestore = useFirestore();\n  const router = useRouter();\n  const { toast } = useToast();\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [username, setUsername] = useState('');\n  const [displayName, setDisplayName] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const handleSignup = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (password !== confirmPassword) {\n      toast({\n        variant: 'destructive',\n        title: 'Signup Failed',\n        description: 'Passphrases do not match.',\n      });\n      return;\n    }\n    setLoading(true);\n    try {\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n      const user = userCredential.user;\n\n      // 1. Update Firebase Auth Profile\n      await updateProfile(user, { displayName });\n\n      // 2. Create user document in Firestore\n      const userDocRef = doc(firestore, 'users', user.uid);\n      const now = serverTimestamp();\n      \n      const userProfileData = {\n        id: user.uid,\n        username: username.toLowerCase(),\n        email: user.email || '',\n        displayName: displayName,\n        photoURL: user.photoURL || '',\n        bio: 'New operator in the matrix.',\n        status: 'Online',\n        isAnonymous: false,\n        createdAt: now,\n        xp: 100,\n        level: 1,\n        trustScore: 50,\n        streak: 1,\n        badgesUnlocked: ['pioneer'],\n        inventory: [],\n        questsCompleted: [],\n        questResets: {\n            daily: now,\n            weekly: now,\n            seasonal: now,\n        },\n        messagesSent: 0,\n        notesCreated: 0,\n        filesUploaded: 0,\n        friends: 0,\n      };\n      \n      await setDoc(userDocRef, userProfileData);\n      \n      toast({\n          title: 'Registration Successful',\n          description: 'Aetherweave connection established. Redirecting...',\n      });\n      router.push('/');\n\n\n    } catch (error: any) {\n      console.error('Signup error:', error);\n      let errorMessage = 'An unknown error occurred.';\n      \n      if (error.code === 'auth/email-already-in-use') {\n        errorMessage = 'This Neural Interface ID is already registered.';\n      } else if (error.code === 'auth/weak-password') {\n        errorMessage = 'Passphrase is too weak. Must be at least 6 characters.';\n      } else if (error.code === 'auth/invalid-email') {\n        errorMessage = 'Invalid Neural Interface ID format.';\n      } else if (error.code === 'permission-denied') {\n        errorMessage = 'Could not create user profile. Please try again.';\n      }\n      \n      toast({\n        variant: 'destructive',\n        title: 'Signup Failed',\n        description: errorMessage,\n      });\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-full p-4\">\n      <Card className=\"w-full max-w-md animate-hologram-fade\">\n        <CardHeader className=\"text-center\">\n          <CardTitle className=\"font-headline text-3xl text-glow\">Create Your Operator ID</CardTitle>\n          <CardDescription>Register for system access to Aetherweave.</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSignup} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\">Username</Label>\n              <Input\n                id=\"username\"\n                type=\"text\"\n                placeholder=\"Your unique handle, e.g. 'cypher'\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                required\n                className=\"bg-input\"\n              />\n            </div>\n             <div className=\"space-y-2\">\n              <Label htmlFor=\"displayName\">Display Name</Label>\n              <Input\n                id=\"displayName\"\n                type=\"text\"\n                placeholder=\"The name others will see, e.g. 'Cypher'\"\n                value={displayName}\n                onChange={(e) => setDisplayName(e.target.value)}\n                required\n                className=\"bg-input\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Neural Interface ID (Email)</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"new-operator@aether.corp\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                className=\"bg-input\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Passphrase</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"••••••••\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                className=\"bg-input\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"confirm-password\">Confirm Passphrase</Label>\n              <Input\n                id=\"confirm-password\"\n                type=\"password\"\n                placeholder=\"••••••••\"\n                value={confirmPassword}\n                onChange={(e) => setConfirmPassword(e.target.value)}\n                required\n                className=\"bg-input\"\n              />\n            </div>\n            <Button type=\"submit\" className=\"w-full cyber-button h-12 text-lg\" disabled={loading}>\n              {loading ? <><Loader2 className=\"animate-spin\" /> Registering...</> : 'Register'}\n            </Button>          \n          </form>\n           <p className=\"text-center text-sm text-muted-foreground mt-6\">\n            Already have an access key?{' '}\n            <LoginLink />\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":7593,"size_tokens":null},"src/app/api/upload/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData();\n    const file = formData.get('file') as File;\n    \n    if (!file) {\n      return NextResponse.json({ error: 'No file provided' }, { status: 400 });\n    }\n\n    // Convert file to base64 data URL\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n    const base64 = buffer.toString('base64');\n    const dataUrl = `data:${file.type};base64,${base64}`;\n    \n    return NextResponse.json({ url: dataUrl });\n  } catch (error) {\n    console.error('Upload error:', error);\n    return NextResponse.json({ error: 'Upload failed' }, { status: 500 });\n  }\n}","path":null,"size_bytes":742,"size_tokens":null},"src/lib/chat-utils.ts":{"content":"import { PublicUser } from '@/hooks/use-connections';\n\nexport const getDerivedStatus = (profile: PublicUser | null): {label: string, color: string, isOnline: boolean} => {\n    if (!profile) return {label: 'Offline', color: 'bg-gray-500', isOnline: false};\n    \n    if (profile.lastSeen) {\n        try {\n            const lastSeenDate = profile.lastSeen.toDate ? profile.lastSeen.toDate() : new Date(profile.lastSeen as any);\n            const minutesSinceSeen = (new Date().getTime() - lastSeenDate.getTime()) / (1000 * 60);\n\n            if (minutesSinceSeen < 2) {\n                return {label: 'Online', color: 'bg-green-500', isOnline: true};\n            } else if (minutesSinceSeen < 10) {\n                return {label: 'Away', color: 'bg-yellow-500', isOnline: false};\n            }\n        } catch (e) {\n            console.error('Error parsing lastSeen:', e);\n        }\n    }\n    \n    return {label: 'Offline', color: 'bg-gray-500', isOnline: false};\n}","path":null,"size_bytes":961,"size_tokens":null},"src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"src/components/tab-enhancer/TabStatusIndicator.tsx":{"content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Palette, Bell, Zap } from 'lucide-react';\nimport { useTabCard } from '@/hooks/use-tab-card';\nimport { useTabEnhancer } from '@/hooks/use-tab-enhancer';\n\nexport default function TabStatusIndicator() {\n  const [isVisible, setIsVisible] = useState(false);\n  const { startRainbow, stopEffects } = useTabCard();\n  const { showNotification, clearNotifications } = useTabEnhancer();\n\n  return (\n    <div className=\"fixed bottom-4 right-4 z-50\">\n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        onClick={() => setIsVisible(!isVisible)}\n        className=\"glass-card p-2\"\n      >\n        <Palette className=\"w-4 h-4 text-primary\" />\n      </Button>\n      \n      {isVisible && (\n        <div className=\"absolute bottom-12 right-0 glass-card p-4 space-y-2 min-w-48\">\n          <div className=\"text-sm font-semibold text-primary\">Tab Controls</div>\n          \n          <div className=\"flex gap-1\">\n            <Button onClick={startRainbow} size=\"sm\" variant=\"outline\">\n              <Palette className=\"w-3 h-3 mr-1\" />\n              Rainbow\n            </Button>\n            <Button onClick={() => showNotification(1)} size=\"sm\" variant=\"outline\">\n              <Bell className=\"w-3 h-3 mr-1\" />\n              Alert\n            </Button>\n          </div>\n          \n          <div className=\"flex gap-1\">\n            <Button onClick={stopEffects} size=\"sm\" variant=\"ghost\">\n              Stop\n            </Button>\n            <Button onClick={clearNotifications} size=\"sm\" variant=\"ghost\">\n              Clear\n            </Button>\n          </div>\n          \n          <Badge variant=\"secondary\" className=\"text-xs\">\n            Tab Enhancement Active\n          </Badge>\n        </div>\n      )}\n    </div>\n  );\n}","path":null,"size_bytes":1885,"size_tokens":null},"src/components/dashboard/time-tracker-widget.tsx":{"content":"'use client';\nimport { useState, useEffect } from 'react';\nimport { Loader2 } from 'lucide-react';\n\ninterface TimeData {\n  totalTime: number; // in seconds\n  today: {\n    date: string;\n    time: number; // in seconds\n  };\n}\n\nconst formatTime = (totalSeconds: number) => {\n  const hours = Math.floor(totalSeconds / 3600);\n  const minutes = Math.floor((totalSeconds % 3600) / 60);\n  const seconds = totalSeconds % 60;\n  return [hours, minutes, seconds]\n    .map(v => v.toString().padStart(2, '0'))\n    .join(':');\n};\n\nexport default function TimeTrackerWidget() {\n  const [timeData, setTimeData] = useState<TimeData | null>(null);\n\n  useEffect(() => {\n    // This effect runs only on the client\n    const loadAndTrackTime = () => {\n      let initialData: TimeData;\n      try {\n        const savedData = localStorage.getItem('timeTrackerData');\n        const currentDate = new Date().toISOString().split('T')[0];\n        \n        if (savedData) {\n          initialData = JSON.parse(savedData);\n          // Reset today's time if the date has changed\n          if (initialData.today.date !== currentDate) {\n            initialData.today = { date: currentDate, time: 0 };\n          }\n        } else {\n          initialData = {\n            totalTime: 0,\n            today: { date: currentDate, time: 0 },\n          };\n        }\n      } catch (error) {\n        console.error(\"Failed to parse time tracker data from localStorage\", error);\n        const currentDate = new Date().toISOString().split('T')[0];\n        initialData = {\n          totalTime: 0,\n          today: { date: currentDate, time: 0 },\n        };\n      }\n      setTimeData(initialData);\n\n      const interval = setInterval(() => {\n        setTimeData(prevData => {\n          if (!prevData) return prevData;\n          const newData = {\n            ...prevData,\n            totalTime: prevData.totalTime + 1,\n            today: {\n              ...prevData.today,\n              time: prevData.today.time + 1,\n            },\n          };\n          try {\n            localStorage.setItem('timeTrackerData', JSON.stringify(newData));\n          } catch (storageError) {\n            console.error(\"Failed to save time tracker data to localStorage\", storageError);\n          }\n          return newData;\n        });\n      }, 1000);\n\n      return () => clearInterval(interval);\n    };\n\n    const cleanup = loadAndTrackTime();\n    return cleanup;\n  }, []);\n\n  if (!timeData) {\n    return (\n      <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n        <Loader2 className=\"w-8 h-8 animate-spin\" />\n        <p className=\"ml-2\">Loading session data...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col justify-center items-center h-full text-center gap-8\" data-onboarding-id=\"playtime-card\">\n        <div>\n            <p className=\"text-sm text-muted-foreground font-mono uppercase tracking-widest\">Time Today</p>\n            <p className=\"text-5xl font-bold text-glow font-mono tracking-wider\">{formatTime(timeData.today.time)}</p>\n        </div>\n         <div>\n            <p className=\"text-sm text-muted-foreground font-mono uppercase tracking-widest\">Total Time</p>\n            <p className=\"text-5xl font-bold text-glow font-mono tracking-wider\">{formatTime(timeData.totalTime)}</p>\n        </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3323,"size_tokens":null},"src/components/modals/SpaceSettingsModal.tsx":{"content":"'use client';\nimport { useState, useRef, useMemo } from 'react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { UploadCloud, ImageUp, Trash2, Save, Loader2, Info, Users, MoreHorizontal, User, MessageSquare, ShieldBan, LogOut, Clock, Gavel, Sparkles, Ticket } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport AetherLogo from '../aether-logo';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { useUser } from '@/hooks/use-user';\nimport { useConnections } from '@/hooks/use-connections';\nimport { ScrollArea } from '../ui/scroll-area';\nimport { format } from 'date-fns';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger, DropdownMenuSub, DropdownMenuSubTrigger, DropdownMenuSubContent, DropdownMenuPortal } from '../ui/dropdown-menu';\nimport { useRouter } from 'next/navigation';\nimport { Badge } from '../ui/badge';\nimport RoleSettings from '../settings/RoleSettings';\nimport { Alert, AlertDescription, AlertTitle } from '../ui/alert';\n\ninterface SpaceSettingsModalProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  space: { id: string; name: string; icon?: any };\n}\n\nconst mockRoles = [\n    { id: 'admin', name: 'Admin', color: 'bg-red-500' },\n    { id: 'moderator', name: 'Moderator', color: 'bg-blue-500' },\n    { id: 'member', name: 'Member', color: 'bg-gray-500' },\n];\n\nconst mockInvites = [\n    { id: 'invite-1', user: { name: 'Jaina Proudmoore', avatar: '' }, invitedBy: 'mubah3r', status: 'Joined', date: new Date(Date.now() - 86400000 * 1) },\n    { id: 'invite-2', user: { name: 'Kael\\'thas Sunstrider', avatar: '' }, invitedBy: 'link', status: 'Joined', date: new Date(Date.now() - 86400000 * 3) },\n    { id: 'invite-3', user: { name: 'Sylvanas Windrunner', avatar: '' }, invitedBy: 'mubah3r', status: 'Pending', date: new Date() },\n];\n\nconst mockBans = [\n    { id: 'ban-1', user: { id: 'user-b1', name: 'Arthas Menethil', username: 'LichKing', avatar: '' }, reason: 'Spamming', bannedBy: 'mubah3r' },\n]\n\n\nexport default function SpaceSettingsModal({\n  isOpen,\n  onOpenChange,\n  space,\n}: SpaceSettingsModalProps) {\n  const { profile: currentUser } = useUser();\n  const { users: allUsers } = useConnections();\n  const [spaceName, setSpaceName] = useState(space.name);\n  const [spaceIcon, setSpaceIcon] = useState<string | null>(null);\n  const [spaceDescription, setSpaceDescription] = useState('The official hub for Aetherweave platform updates, community events, and support.');\n  const [isSaving, setIsSaving] = useState(false);\n  const [deleteConfirmation, setDeleteConfirmation] = useState('');\n  const iconInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const router = useRouter();\n\n  const members = useMemo(() => {\n    // In a real app, this would be fetched based on space members\n    // For now, we use all connected users as mock members\n    return allUsers.map(u => ({\n        ...u,\n        spaceJoinDate: new Date(Date.now() - Math.random() * 1000 * 60 * 60 * 24 * 30), // Random join date in the last 30 days\n        roles: [mockRoles[Math.floor(Math.random() * mockRoles.length)]]\n    }));\n  }, [allUsers]);\n\n  const handleIconChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file && file.type.startsWith('image/')) {\n        const reader = new FileReader();\n        reader.onload = (e) => setSpaceIcon(e.target?.result as string);\n        reader.readAsDataURL(file);\n    }\n  }\n  \n  const handleSave = () => {\n    setIsSaving(true);\n    // Simulate API call\n    setTimeout(() => {\n        setIsSaving(false);\n        toast({ title: 'Space settings updated!'});\n        onOpenChange(false);\n    }, 1500)\n  }\n  \n  const handleDeleteSpace = () => {\n    toast({ variant: 'destructive', title: `Space \"${spaceName}\" has been deleted.` });\n    onOpenChange(false);\n  }\n\n  const handleAdminAction = (action: string, userName: string) => {\n    toast({\n        title: `Action: ${action}`,\n        description: `Performed '${action}' on user ${userName}.`\n    });\n  }\n\n  const handleRoleChange = (userName: string, roleName: string) => {\n    toast({\n        title: `Role Updated`,\n        description: `${userName} has been assigned the ${roleName} role.`\n    });\n  }\n  \n  const handleUnban = (userName: string) => {\n    toast({\n        title: 'User Unbanned',\n        description: `${userName} is no longer banned from this space.`\n    });\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl h-[85vh] flex flex-col glass-card\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-3\">\n             <Sparkles className=\"text-primary\"/>\n             Space Settings: {space.name}\n          </DialogTitle>\n          <DialogDescription>\n            Manage your Space's identity, roles, members, and integrations.\n          </DialogDescription>\n        </DialogHeader>\n        \n        <div className=\"flex-1 flex min-h-0\">\n          <Tabs defaultValue=\"overview\" className=\"flex-1 flex min-h-0\">\n              <div className=\"w-56 pr-4 border-r border-border\">\n                <TabsList className=\"grid grid-cols-1 h-auto bg-transparent p-0\">\n                  <TabsTrigger value=\"overview\" className=\"justify-start px-2 py-1.5\">Overview</TabsTrigger>\n                  <TabsTrigger value=\"roles\" className=\"justify-start px-2 py-1.5\">Roles</TabsTrigger>\n                  <TabsTrigger value=\"members\" className=\"justify-start px-2 py-1.5\">Members</TabsTrigger>\n                  <TabsTrigger value=\"invites\" className=\"justify-start px-2 py-1.5\">Invites</TabsTrigger>\n                  <TabsTrigger value=\"bans\" className=\"justify-start px-2 py-1.5\">Bans</TabsTrigger>\n                  <div className=\"my-2 border-t border-destructive/30\"></div>\n                  <TabsTrigger value=\"deletion\" className=\"justify-start px-2 py-1.5 text-destructive focus:text-destructive\">Delete Space</TabsTrigger>\n                </TabsList>\n              </div>\n              <div className=\"flex-1 pl-6 min-w-0\">\n                <TabsContent value=\"overview\" className=\"flex-1 flex flex-col min-h-0 py-4 space-y-6 mt-0\">\n                  <h4 className=\"font-bold text-primary text-glow\">Space Profile</h4>\n                  <div className=\"flex items-center gap-4\">\n                      <div className=\"relative group\">\n                          <Avatar className=\"w-24 h-24 border-4 border-dashed border-primary/50\">\n                              {spaceIcon ? (\n                                  <AvatarImage src={spaceIcon} className=\"object-cover\" />\n                              ): (\n                                  <AvatarFallback className=\"bg-transparent text-primary\">\n                                      <AetherLogo className=\"w-12 h-12\"/>\n                                  </AvatarFallback>\n                              )}\n                          </Avatar>\n                          <div className=\"absolute inset-0 bg-black/70 rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2\">\n                              <input type=\"file\" accept=\"image/*\" ref={iconInputRef} onChange={handleIconChange} className=\"hidden\" />\n                              <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9\" onClick={() => iconInputRef.current?.click()}>\n                                  <ImageUp className=\"w-5 h-5\"/>\n                              </Button>\n                              <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9\" onClick={() => setSpaceIcon(null)}>\n                                  <Trash2 className=\"w-5 h-5\"/>\n                              </Button>\n                          </div>\n                      </div>\n                      <div className=\"flex-1 space-y-2\">\n                          <Label htmlFor=\"space-name\">Space Name</Label>\n                          <Input id=\"space-name\" value={spaceName} onChange={(e) => setSpaceName(e.target.value)} />\n                      </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                      <Label htmlFor=\"space-description\">Description</Label>\n                      <Textarea id=\"space-description\" value={spaceDescription} onChange={(e) => setSpaceDescription(e.target.value)} placeholder=\"Let everyone know what your space is about.\"/>\n                      <p className=\"text-xs text-muted-foreground flex items-center gap-1\"><Info className=\"h-3 w-3\"/>This will be visible in the Space discovery directory.</p>\n                  </div>\n                  <DialogFooter className=\"mt-auto !justify-start\">\n                    <Button onClick={handleSave} disabled={isSaving}>\n                      {isSaving ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <Save className=\"mr-2 h-4 w-4\" />}\n                      Save Changes\n                    </Button>\n                  </DialogFooter>\n                </TabsContent>\n                <TabsContent value=\"roles\" className=\"flex-1 flex flex-col min-h-0 mt-0\">\n                  <RoleSettings />\n                </TabsContent>\n                <TabsContent value=\"members\" className=\"flex-1 flex flex-col min-h-0 mt-0\">\n                  <ScrollArea className=\"flex-1 -mx-6 px-6\">\n                      <div className=\"py-4 space-y-2\">\n                          {members.map(member => (\n                              <div key={member.id} className=\"flex items-center justify-between p-2 rounded-md hover:bg-muted/50\">\n                                  <div className=\"flex items-center gap-4\">\n                                      <Avatar className=\"h-10 w-10\">\n                                          <AvatarImage src={member.photoURL || undefined} />\n                                          <AvatarFallback>{member.displayName?.[0]}</AvatarFallback>\n                                      </Avatar>\n                                      <div>\n                                          <p className=\"font-semibold\">{member.displayName}</p>\n                                          <p className=\"text-xs text-muted-foreground\">@{member.username}</p>\n                                      </div>\n                                  </div>\n                                  <div className=\"hidden md:flex flex-col text-xs text-muted-foreground\">\n                                      <p>Space Join: {format(member.spaceJoinDate, 'MMM d, yyyy')}</p>\n                                      <p>Aetherweave Join: {format(member.createdAt.toDate(), 'MMM d, yyyy')}</p>\n                                  </div>\n                                  <div className=\"flex items-center gap-2\">\n                                      {member.roles.map(role => (\n                                          <Badge key={role.id} variant=\"secondary\">{role.name}</Badge>\n                                      ))}\n                                  </div>\n                                  <DropdownMenu>\n                                      <DropdownMenuTrigger asChild>\n                                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                                              <MoreHorizontal className=\"h-4 w-4\" />\n                                          </Button>\n                                      </DropdownMenuTrigger>\n                                      <DropdownMenuContent>\n                                          <DropdownMenuItem onClick={() => router.push(`/profile/${member.id}`)}><User className=\"mr-2 h-4 w-4\" /> Profile</DropdownMenuItem>\n                                          <DropdownMenuItem onClick={() => router.push(`/chat?contactId=${member.id}`)}><MessageSquare className=\"mr-2 h-4 w-4\" /> Message</DropdownMenuItem>\n                                          <DropdownMenuItem onClick={() => handleAdminAction('Block', member.displayName!)}><ShieldBan className=\"mr-2 h-4 w-4\" /> Block</DropdownMenuItem>\n                                          <DropdownMenuSub>\n                                              <DropdownMenuSubTrigger>\n                                                  <span className=\"font-semibold\">Roles</span>\n                                              </DropdownMenuSubTrigger>\n                                              <DropdownMenuPortal>\n                                                  <DropdownMenuSubContent>\n                                                      {mockRoles.map(role => (\n                                                          <DropdownMenuItem key={role.id} onClick={() => handleRoleChange(member.displayName!, role.name)}>\n                                                              {role.name}\n                                                          </DropdownMenuItem>\n                                                      ))}\n                                                  </DropdownMenuSubContent>\n                                              </DropdownMenuPortal>\n                                          </DropdownMenuSub>\n                                          <DropdownMenuItem className=\"text-destructive\" onClick={() => handleAdminAction('Timeout', member.displayName!)}><Clock className=\"mr-2 h-4 w-4\"/> Timeout</DropdownMenuItem>\n                                          <DropdownMenuItem className=\"text-destructive\" onClick={() => handleAdminAction('Kick', member.displayName!)}><LogOut className=\"mr-2 h-4 w-4\"/> Kick</DropdownMenuItem>\n                                          <DropdownMenuItem className=\"text-destructive\" onClick={() => handleAdminAction('Ban', member.displayName!)}><Gavel className=\"mr-2 h-4 w-4\"/> Ban</DropdownMenuItem>\n                                      </DropdownMenuContent>\n                                  </DropdownMenu>\n                              </div>\n                          ))}\n                      </div>\n                  </ScrollArea>\n                </TabsContent>\n                <TabsContent value=\"invites\" className=\"flex-1 flex flex-col min-h-0 mt-0\">\n                  <ScrollArea className=\"flex-1 -mx-6 px-6\">\n                    <div className=\"py-4 space-y-2\">\n                        {mockInvites.map(invite => (\n                             <div key={invite.id} className=\"flex items-center justify-between p-2 rounded-md hover:bg-muted/50\">\n                                <div className=\"flex items-center gap-4\">\n                                     <Avatar className=\"h-10 w-10\">\n                                          <AvatarImage src={invite.user.avatar} />\n                                          <AvatarFallback>{invite.user.name?.[0]}</AvatarFallback>\n                                      </Avatar>\n                                      <div>\n                                        <p className=\"font-semibold\">{invite.user.name}</p>\n                                        <p className=\"text-xs text-muted-foreground\">\n                                            {invite.invitedBy === 'link' ? 'Joined via link' : `Invited by @${invite.invitedBy}`}\n                                        </p>\n                                      </div>\n                                </div>\n                                <div className=\"text-xs text-muted-foreground\">\n                                    {format(invite.date, 'MMM d, yyyy')}\n                                </div>\n                                <Badge variant={invite.status === 'Joined' ? 'secondary' : 'default'}>{invite.status}</Badge>\n                                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={() => toast({title: 'Invite Revoked'})}>\n                                    <Trash2 className=\"h-4 w-4 text-destructive\"/>\n                                </Button>\n                             </div>\n                        ))}\n                    </div>\n                  </ScrollArea>\n                </TabsContent>\n                <TabsContent value=\"bans\" className=\"flex-1 flex flex-col min-h-0 mt-0\">\n                    <ScrollArea className=\"flex-1 -mx-6 px-6\">\n                        <div className=\"py-4 space-y-2\">\n                             {mockBans.map(ban => (\n                             <div key={ban.id} className=\"flex items-center justify-between p-2 rounded-md bg-destructive/10\">\n                                <div className=\"flex items-center gap-4\">\n                                     <Avatar className=\"h-10 w-10\">\n                                          <AvatarImage src={ban.user.avatar} />\n                                          <AvatarFallback>{ban.user.name?.[0]}</AvatarFallback>\n                                      </Avatar>\n                                      <div>\n                                        <p className=\"font-semibold\">{ban.user.name}</p>\n                                        <p className=\"text-xs text-muted-foreground\">Banned by @{ban.bannedBy}</p>\n                                      </div>\n                                </div>\n                                <p className=\"text-sm text-muted-foreground\">Reason: {ban.reason}</p>\n                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleUnban(ban.user.name)}>Unban</Button>\n                             </div>\n                        ))}\n                        {mockBans.length === 0 && <p className=\"text-center text-muted-foreground py-8\">No banned users.</p>}\n                        </div>\n                    </ScrollArea>\n                </TabsContent>\n                 <TabsContent value=\"deletion\" className=\"flex-1 flex flex-col min-h-0 mt-0\">\n                    <Alert variant=\"destructive\" className=\"mt-4\">\n                      <ShieldBan className=\"h-4 w-4\" />\n                      <AlertTitle>Delete Space</AlertTitle>\n                      <AlertDescription>\n                        This is a permanent action and cannot be undone. All data associated with this space will be permanently erased.\n                      </AlertDescription>\n                    </Alert>\n                    <div className=\"mt-6 space-y-2\">\n                        <Label htmlFor=\"delete-confirm\">To confirm, type \"<span className=\"font-bold text-primary\">{spaceName}</span>\" below:</Label>\n                        <Input \n                            id=\"delete-confirm\" \n                            value={deleteConfirmation}\n                            onChange={(e) => setDeleteConfirmation(e.target.value)}\n                        />\n                    </div>\n                    <Button \n                        variant=\"destructive\" \n                        className=\"w-full mt-4\"\n                        disabled={deleteConfirmation !== spaceName}\n                        onClick={handleDeleteSpace}\n                    >\n                        Delete This Space\n                    </Button>\n                 </TabsContent>\n              </div>\n            </Tabs>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":19412,"size_tokens":null},"src/app/gaming/components/GamingNavbar.tsx":{"content":"'use client';\nimport React from 'react';\nimport { Bell, Search, Compass, Plus, Users, VolumeX, Edit, LogOut, Check, Settings, FolderPlus, Hash } from 'lucide-react';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { cn } from '@/lib/utils';\nimport AetherLogo from '@/components/aether-logo';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useToast } from '@/hooks/use-toast';\nimport { useUser } from '@/hooks/use-user';\n\nconst spaces: { id: string, name: string, img?: string, icon?: React.ComponentType<any>, mentions?: number, hasUnread?: boolean }[] = [\n    { id: 'aetherweave-hq', name: 'Aetherweave HQ', icon: AetherLogo, mentions: 3, hasUnread: true },\n];\n\nconst toolIcons = [\n  { id: 'add', name: 'Add a Space', icon: Plus, action: 'create-join-space' },\n  { id: 'explore', name: 'Explore Spaces', icon: Compass },\n];\n\ninterface GamingNavbarProps {\n    activeSpace: string | null;\n    setActiveSpace: (id: string | null) => void;\n}\n\nexport default function GamingNavbar({ activeSpace, setActiveSpace }: GamingNavbarProps) {\n    const { openHub, openModal } = useCommandHub();\n    const { toast } = useToast();\n    const { profile } = useUser();\n\n    const handleSpaceContextMenu = (e: React.MouseEvent, space: typeof spaces[0]) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const isOwner = profile?.username === 'mubah3r' && space.id === 'aetherweave-hq';\n\n      const actions: any[] = [\n          { label: 'Invite People', icon: 'Users', onClick: () => openModal('invite-people', space) },\n          { label: 'Mark As Read', icon: 'Check', onClick: () => toast({title: `${space.name} marked as read.`}) },\n          { label: 'Mute Space', icon: 'VolumeX', onClick: () => toast({title: `Muted ${space.name}`, description: \"You will no longer receive notifications from this space.\"}) },\n          { label: 'Edit Space Profile', icon: 'Edit', onClick: () => toast({title: 'Per-Space Profile Updated', description: \"Your identity for this space has been changed.\"}) },\n      ];\n\n      if (isOwner) {\n        actions.push(\n          { label: 'Create Category', icon: 'FolderPlus', onClick: () => toast({title: 'Category created.'}) },\n          { label: 'Create Channel', icon: 'Hash', onClick: () => toast({title: 'Channel created.'}) },\n          { label: 'Server Settings', icon: 'Settings', onClick: () => toast({title: 'Opening Server Settings...'}) }\n        );\n      } else {\n        actions.push({ label: 'Server Settings', icon: 'Settings', onClick: () => {}, disabled: true });\n      }\n\n      actions.push({ label: 'Leave Space', icon: 'LogOut', onClick: () => {} });\n\n      openHub(e, {\n        type: 'space-context',\n        data: space,\n        actions: actions\n      })\n    }\n    \n     const handleToolClick = (tool: typeof toolIcons[0]) => {\n        if (tool.action) {\n            openModal(tool.action as any);\n        } else {\n            toast({ title: 'Coming Soon!', description: `${tool.name} functionality is under development.`});\n        }\n    };\n\n\n  return (\n    <header className=\"flex h-16 shrink-0 items-center gap-6 border-b-2 border-primary/20 bg-background/80 px-6 backdrop-blur-sm shadow-md\">\n      {/* Space List */}\n      <nav className=\"flex items-center gap-3\">\n        <TooltipProvider>\n            {spaces.map((space) => (\n                 <Tooltip key={space.id}>\n                    <TooltipTrigger asChild>\n                         <button\n                            onClick={() => setActiveSpace(space.id)}\n                            onContextMenu={(e) => handleSpaceContextMenu(e, space)}\n                            data-command-hub-trigger\n                            className=\"group relative h-12 w-12 rounded-full flex items-center justify-center bg-muted/50 transition-all duration-200 hover:scale-110 hover:shadow-lg focus:outline-none\"\n                         >\n                            {space.img ? (\n                              <img src={space.img} alt={space.name} className=\"h-full w-full object-cover rounded-full transition-all duration-200 group-hover:rounded-xl\" />\n                            ) : space.icon ? (\n                               <div className={cn(\"flex h-full w-full items-center justify-center rounded-full transition-all duration-200 group-hover:rounded-xl\", activeSpace === space.id ? \"bg-primary/20\" : \"\")}>\n                                <space.icon className=\"h-8 w-8 text-primary\" />\n                               </div>\n                            ) : null}\n                            \n                            {/* Notification Badges */}\n                            {space.mentions && space.mentions > 0 && (\n                              <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-destructive text-destructive-foreground rounded-full flex items-center justify-center text-xs font-bold\">\n                                {space.mentions}\n                              </div>\n                            )}\n                            {space.hasUnread && !space.mentions && (\n                               <div className=\"absolute top-0 right-0 w-3 h-3 bg-primary rounded-full border-2 border-background\"></div>\n                            )}\n\n\n                            {activeSpace === space.id && (\n                                <motion.div\n                                    layoutId=\"active-space-underline\"\n                                    className=\"absolute -bottom-2 h-1 w-10 rounded-full bg-primary neon-glow-primary\"\n                                    transition={{ type: 'spring', stiffness: 350, damping: 30 }}\n                                />\n                            )}\n                         </button>\n                    </TooltipTrigger>\n                    <TooltipContent side=\"bottom\"><p>{space.name}</p></TooltipContent>\n                 </Tooltip>\n            ))}\n             <div className=\"h-8 w-px bg-border mx-2\"></div>\n              {toolIcons.map((tool) => (\n                 <Tooltip key={tool.id}>\n                    <TooltipTrigger asChild>\n                         <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleToolClick(tool)}\n                            className=\"h-12 w-12 rounded-full flex items-center justify-center bg-muted/50 text-muted-foreground transition-all duration-200 hover:scale-110 hover:text-primary hover:bg-muted\"\n                         >\n                            <tool.icon className=\"h-6 w-6\"/>\n                         </Button>\n                    </TooltipTrigger>\n                    <TooltipContent side=\"bottom\"><p>{tool.name}</p></TooltipContent>\n                 </Tooltip>\n            ))}\n        </TooltipProvider>\n      </nav>\n\n      <div className=\"ml-auto flex items-center gap-2\">\n        <div className=\"relative hidden md:block\">\n          <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search\"\n            className=\"w-48 bg-input pl-8\"\n          />\n        </div>\n         <Button variant=\"ghost\" size=\"icon\" className=\"relative h-10 w-10 text-muted-foreground hover:text-foreground\">\n            <Bell />\n        </Button>\n      </div>\n    </header>\n  );\n}\n","path":null,"size_bytes":7494,"size_tokens":null},"src/hooks/use-onboarding.ts":{"content":"'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { tutorialSounds } from '@/lib/tutorial-sounds';\n\nexport interface OnboardingStep {\n  id: string;\n  title: string;\n  content: string;\n  target?: string; // CSS selector for the element to highlight\n  placement?: 'top' | 'bottom' | 'left' | 'right' | 'center';\n  nextPath?: string; // Path to navigate to for the next step\n}\n\nexport interface OnboardingTour {\n  id: string;\n  name: string;\n  description: string;\n  steps: OnboardingStep[];\n  requiredPath?: string;\n  minLevel?: number;\n}\n\nconst universalTour: OnboardingStep[] = [\n  {\n    id: 'welcome',\n    title: 'Welcome to Aetherweave',\n    content: 'Your cyberpunk digital hub. Let\\'s get you oriented, Operator.',\n    placement: 'center',\n  },\n  {\n    id: 'navigation',\n    title: 'Navigation',\n    content: 'Use the navigation to access different modules and features.',\n    placement: 'center',\n  },\n  {\n    id: 'complete',\n    title: 'Ready to Go',\n    content: 'You\\'re all set! Explore and earn XP by using the system.',\n    placement: 'center',\n  },\n];\n\nexport const tours: OnboardingTour[] = [\n  { id: 'main', name: 'Quick Start', description: 'Essential basics', steps: universalTour },\n];\n\nconst ONBOARDING_STORAGE_KEY = 'aetherweave-onboarding-status';\nconst TOURS_COMPLETED_KEY = 'aetherweave-tours-completed';\n\nexport function useOnboarding() {\n  const [currentStep, setCurrentStep] = useState(-1);\n  const [isActive, setIsActive] = useState(false);\n  const [currentTour, setCurrentTour] = useState<OnboardingTour | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const router = useRouter();\n\n  useEffect(() => {\n    const tour = tours[0];\n    setCurrentTour(tour);\n    \n    // Simulate page loading\n    const loadTimer = setTimeout(() => {\n      setIsLoading(false);\n      \n      try {\n        const storedStatus = localStorage.getItem(ONBOARDING_STORAGE_KEY);\n        \n        if (storedStatus !== 'completed') {\n          const stepIndex = parseInt(storedStatus || '0', 10);\n          setCurrentStep(stepIndex);\n          setIsActive(true);\n          \n          // Play sound when tutorial appears\n          tutorialSounds.playPopupSound();\n        }\n      } catch (error) {\n        setCurrentStep(0);\n        setIsActive(true);\n      }\n    }, 1500);\n    \n    return () => clearTimeout(loadTimer);\n  }, []);\n\n  const updateProgress = useCallback((stepIndex: number) => {\n    try {\n        localStorage.setItem(ONBOARDING_STORAGE_KEY, stepIndex.toString());\n    } catch(e) {\n        // ignore\n    }\n  }, []);\n\n  const nextStep = useCallback(() => {\n    if (!currentTour) return;\n    \n    const nextStepIndex = currentStep + 1;\n\n    if (nextStepIndex < currentTour.steps.length) {\n      setCurrentStep(nextStepIndex);\n      updateProgress(nextStepIndex);\n    } else {\n      setIsActive(false);\n      try {\n        localStorage.setItem(ONBOARDING_STORAGE_KEY, 'completed');\n      } catch (e) {\n        // ignore\n      }\n    }\n  }, [currentStep, updateProgress, currentTour]);\n\n  const skipTour = useCallback(() => {\n    setIsActive(false);\n     try {\n        localStorage.setItem(ONBOARDING_STORAGE_KEY, 'completed');\n    } catch (e) {\n        // ignore\n    }\n  }, []);\n\n  const startTour = useCallback((tourId?: string) => {\n    try {\n      localStorage.removeItem(ONBOARDING_STORAGE_KEY);\n    } catch (e) {\n      // ignore\n    }\n    \n    setCurrentStep(0);\n    setIsActive(true);\n  }, []);\n\n  const getAvailableTours = useCallback(() => {\n    return tours;\n  }, []);\n\n  return {\n    isActive: isActive && currentTour && currentStep < currentTour.steps.length && !isLoading,\n    currentStepData: currentTour?.steps[currentStep],\n    stepIndex: currentStep,\n    totalSteps: currentTour?.steps.length || 0,\n    isLoading,\n    nextStep,\n    skipTour,\n    startTour,\n    getAvailableTours,\n  };\n}\n","path":null,"size_bytes":3905,"size_tokens":null},"src/components/settings/app-settings.tsx":{"content":"\n'use client';\n\nimport { useState, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Slider } from '@/components/ui/slider';\nimport { Switch } from '@/components/ui/switch';\nimport { useUser } from '@/hooks/use-user';\nimport { Check, Loader2 } from 'lucide-react';\n\nexport default function AppSettings() {\n  const { profile, updateProfileSettings } = useUser();\n  \n  const [soundEnabled, setSoundEnabled] = useState(profile?.settings?.sound?.enableSounds ?? true);\n  const [uiVolume, setUiVolume] = useState(profile?.settings?.sound?.uiVolume ?? 50);\n  const [isSaving, setIsSaving] = useState(false);\n\n  const handleSave = async () => {\n    setIsSaving(true);\n    await updateProfileSettings({\n      ...profile?.settings,\n      sound: {\n        ...profile?.settings?.sound,\n        enableSounds: soundEnabled,\n        uiVolume: uiVolume,\n      }\n    });\n    setIsSaving(false);\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>App Settings</CardTitle>\n        <CardDescription>Manage application-wide settings like sound and more.</CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-8\">\n        <div className=\"space-y-6 p-4 rounded-lg border bg-background/30\">\n            <div className=\"flex items-center justify-between\">\n                <Label htmlFor=\"enable-sounds\" className=\"cursor-pointer\">\n                    Enable UI Sounds\n                </Label>\n                <Switch id=\"enable-sounds\" checked={soundEnabled} onCheckedChange={setSoundEnabled} />\n            </div>\n            <div className=\"space-y-3\">\n                <Label htmlFor=\"ui-volume\">UI Sound Volume</Label>\n                <div className=\"flex items-center gap-4\">\n                    <Slider\n                        id=\"ui-volume\"\n                        min={0}\n                        max={100}\n                        step={1}\n                        value={[uiVolume]}\n                        onValueChange={(value) => setUiVolume(value[0])}\n                        disabled={!soundEnabled}\n                    />\n                    <span className=\"w-12 text-center font-mono text-lg\">{uiVolume}%</span>\n                </div>\n            </div>\n        </div>\n        <Button onClick={handleSave} disabled={isSaving}>\n            {isSaving ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <Check className=\"mr-2 h-4 w-4\" />}\n            Save Sound Settings\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2636,"size_tokens":null},"src/components/user/status-selector.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { Circle, ChevronDown } from 'lucide-react';\nimport { usePresence } from '@/hooks/use-presence';\nimport { cn } from '@/lib/utils';\n\nconst statusOptions = [\n  { value: 'online', label: 'Online', color: 'bg-green-500' },\n  { value: 'away', label: 'Away', color: 'bg-yellow-500' },\n  { value: 'busy', label: 'Busy', color: 'bg-red-500' },\n  { value: 'offline', label: 'Invisible', color: 'bg-gray-500' },\n];\n\nexport default function StatusSelector() {\n  const { status: presenceStatus, updatePresence } = usePresence();\n  const [customStatus, setCustomStatus] = useState('');\n  const [showCustomInput, setShowCustomInput] = useState(false);\n\n  const currentStatus = statusOptions.find(s => s.value === presenceStatus) || statusOptions[0];\n\n  const handleStatusChange = async (status: string) => {\n    await updatePresence(status as any);\n    setShowCustomInput(false);\n  };\n\n  const handleCustomStatus = async () => {\n    if (customStatus.trim()) {\n      await updatePresence(customStatus.trim() as any);\n      setCustomStatus('');\n      setShowCustomInput(false);\n    }\n  };\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" className=\"h-8 px-2 gap-2\">\n          <Circle className={cn(\"w-3 h-3\", currentStatus.color)} />\n          <span className=\"text-sm\">{currentStatus.label}</span>\n          <ChevronDown className=\"w-3 h-3\" />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"start\" className=\"w-48\">\n        {statusOptions.map((status) => (\n          <DropdownMenuItem\n            key={status.value}\n            onClick={() => handleStatusChange(status.value)}\n            className=\"flex items-center gap-2\"\n          >\n            <Circle className={cn(\"w-3 h-3\", status.color)} />\n            {status.label}\n          </DropdownMenuItem>\n        ))}\n        <DropdownMenuSeparator />\n        {showCustomInput ? (\n          <div className=\"p-2 space-y-2\">\n            <Input\n              placeholder=\"Set custom status...\"\n              value={customStatus}\n              onChange={(e) => setCustomStatus(e.target.value)}\n              onKeyDown={(e) => e.key === 'Enter' && handleCustomStatus()}\n              className=\"h-8\"\n              autoFocus\n            />\n            <div className=\"flex gap-1\">\n              <Button size=\"sm\" onClick={handleCustomStatus} className=\"h-6 text-xs\">\n                Set\n              </Button>\n              <Button size=\"sm\" variant=\"ghost\" onClick={() => setShowCustomInput(false)} className=\"h-6 text-xs\">\n                Cancel\n              </Button>\n            </div>\n          </div>\n        ) : (\n          <DropdownMenuItem onClick={() => setShowCustomInput(true)}>\n            Set custom status...\n          </DropdownMenuItem>\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}","path":null,"size_bytes":3143,"size_tokens":null},"src/components/ui/popover.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1244,"size_tokens":null},"src/components/settings/account-settings.tsx":{"content":"\n'use client';\nimport { useState, useRef, useEffect } from 'react';\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { UserProfile, useUser } from '@/hooks/use-user';\nimport { UploadCloud, Github, Twitter, Linkedin, Loader2, Check, Lock, Info } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useStorage } from '@/hooks/use-storage';\nimport { updateProfile as updateAuthProfile, sendPasswordResetEmail } from 'firebase/auth';\nimport { doc, setDoc } from 'firebase/firestore';\n\nimport { useFirestore } from '@/firebase/provider';\nimport { useAuth } from '@/firebase/provider';\n\nexport default function AccountSettings() {\n  const { user, profile, loading, reloadUser, setProfile } = useUser();\n  const { toast } = useToast();\n  const { uploadFile } = useStorage();\n  const firestore = useFirestore();\n  const auth = useAuth();\n  const avatarInputRef = useRef<HTMLInputElement>(null);\n  \n  const [displayName, setDisplayName] = useState('');\n  const [username, setUsername] = useState('');\n  const [bio, setBio] = useState('');\n  const [socials, setSocials] = useState<{ github?: string; twitter?: string; linkedin?: string }>({ github: '', twitter: '', linkedin: '' });\n  const [isUploading, setIsUploading] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [isResetting, setIsResetting] = useState(false);\n\n  useEffect(() => {\n    if (profile) {\n      setDisplayName(profile.displayName || user?.displayName || '');\n      setUsername(profile.username || '');\n      setBio(profile.bio || '');\n      setSocials(profile.socials || { github: '', twitter: '', linkedin: '' });\n    } else if (user) {\n        setDisplayName(user.displayName || '');\n    }\n  }, [profile, user]);\n\n  const handleAvatarUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file || !user) return;\n    \n    setIsUploading(true);\n    try {\n      const formData = new FormData();\n      formData.append('avatar', file);\n      \n      const token = await auth.currentUser?.getIdToken();\n      const response = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/upload/avatar`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));\n        throw new Error(errorData.error || `Upload failed with status ${response.status}`);\n      }\n      \n      const { downloadURL } = await response.json();\n      \n      // Update local state and reload user data\n      if (profile) {\n        setProfile({ ...profile, photoURL: downloadURL });\n      }\n      await reloadUser();\n\n      toast({ title: 'Avatar updated successfully!' });\n    } catch (error: any) {\n      console.error('Upload error:', error);\n      toast({ variant: 'destructive', title: 'Upload failed', description: error.message });\n    } finally {\n      setIsUploading(false);\n      if (avatarInputRef.current) {\n        avatarInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleProfileSave = async () => {\n      if(!user || !profile) return;\n      setIsSaving(true);\n      try {\n        const userDocRef = doc(firestore, 'users', user.uid);\n        const profileData: Partial<UserProfile> = {\n            displayName,\n            username: username.toLowerCase(),\n            bio,\n            socials,\n        };\n        await setDoc(userDocRef, profileData, { merge: true });\n\n        if (displayName !== user.displayName && auth.currentUser) {\n             await updateAuthProfile(auth.currentUser, { displayName });\n        }\n        \n        // Optimistically update local profile\n        setProfile({ ...profile, ...profileData });\n\n        toast({ title: 'Profile Updated', description: 'Your changes have been saved.' });\n      } catch (error: any) {\n         toast({ variant: 'destructive', title: 'Update failed', description: error.message });\n      } finally {\n        setIsSaving(false);\n      }\n  };\n\n  const handlePasswordReset = async () => {\n    if (!user?.email) return;\n    setIsResetting(true);\n    try {\n        await sendPasswordResetEmail(auth, user.email);\n        toast({\n            title: 'Password Reset Email Sent',\n            description: `A recovery link has been sent to ${user.email}.`\n        });\n    } catch (error: any) {\n        toast({ variant: 'destructive', title: 'Request failed', description: error.message });\n    } finally {\n        setIsResetting(false);\n    }\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Public Profile</CardTitle>\n          <CardDescription>\n            This information will be displayed on your public profile.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n            <div className=\"flex items-center gap-4\">\n                <div className=\"relative\">\n                    <Avatar className=\"w-24 h-24 border-4 border-primary/50\">\n                        <AvatarImage src={profile?.photoURL ?? user?.photoURL ?? ''} />\n                        <AvatarFallback className=\"text-3xl\">\n                            {displayName?.charAt(0) || user?.email?.charAt(0) || 'U'}\n                        </AvatarFallback>\n                    </Avatar>\n                    <Button\n                        size=\"icon\"\n                        className=\"absolute bottom-0 right-0 rounded-full w-8 h-8\"\n                        onClick={() => avatarInputRef.current?.click()}\n                        disabled={isUploading}\n                    >\n                        {isUploading ? <Loader2 className=\"animate-spin w-4 h-4\" /> : <UploadCloud className=\"w-4 h-4\"/>}\n                    </Button>\n                    <input type=\"file\" accept=\"image/jpeg,image/jpg,image/png,image/gif,image/webp\" ref={avatarInputRef} onChange={handleAvatarUpload} className=\"hidden\" />\n                </div>\n                <div className=\"flex-1 space-y-2\">\n                    <Label htmlFor=\"username\">Username</Label>\n                    <Input id=\"username\" value={username} onChange={e => setUsername(e.target.value)} className=\"bg-input\" disabled />\n                    <p className=\"text-xs text-muted-foreground flex items-center gap-1\"><Info className=\"h-3 w-3\"/>Cannot be changed.</p>\n                    <p className=\"text-xs text-muted-foreground\">Supported formats: JPG, PNG, GIF, WebP (max 5MB)</p>\n                </div>\n            </div>\n\n            <div className=\"space-y-2\">\n                <Label htmlFor=\"displayName\">Display Name</Label>\n                <Input id=\"displayName\" value={displayName} onChange={e => setDisplayName(e.target.value)} className=\"bg-input\" />\n            </div>\n\n            <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <Input id=\"email\" value={user?.email ?? ''} className=\"bg-input\" disabled />\n            </div>\n            \n            <div className=\"space-y-2\">\n                <Label htmlFor=\"bio\">Bio</Label>\n                <Textarea id=\"bio\" value={bio} onChange={e => setBio(e.target.value)} className=\"bg-input\" placeholder=\"Tell everyone a little about yourself...\"/>\n            </div>\n            \n            <div className=\"space-y-4\">\n                <Label>Social Links</Label>\n                <div className=\"relative\">\n                    <Github className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground\" />\n                    <Input value={socials.github || ''} onChange={e => setSocials({...socials, github: e.target.value})} placeholder=\"https://github.com/your-username\" className=\"bg-input pl-10\"/>\n                </div>\n                <div className=\"relative\">\n                    <Twitter className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground\" />\n                    <Input value={socials.twitter || ''} onChange={e => setSocials({...socials, twitter: e.target.value})} placeholder=\"https://twitter.com/your-username\" className=\"bg-input pl-10\"/>\n                </div>\n                <div className=\"relative\">\n                    <Linkedin className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground\" />\n                    <Input value={socials.linkedin || ''} onChange={e => setSocials({...socials, linkedin: e.target.value})} placeholder=\"https://linkedin.com/in/your-username\" className=\"bg-input pl-10\"/>\n                </div>\n            </div>\n          \n            <Button onClick={handleProfileSave} disabled={isSaving} className=\"cyber-button\">\n                {isSaving ? <><Loader2 className=\"animate-spin mr-2\" /> Saving...</> : <><Check className=\"mr-2\"/>Save Changes</>}\n            </Button>\n        </CardContent>\n      </Card>\n      \n      <Card>\n        <CardHeader>\n            <CardTitle>Authentication</CardTitle>\n        </CardHeader>\n        <CardContent>\n            <div className=\"flex items-center justify-between rounded-lg border p-4 bg-input/50\">\n                <div>\n                    <Label>Password</Label>\n                    <p className=\"text-sm text-muted-foreground\">For security, you can reset your password via email.</p>\n                </div>\n                <Button variant=\"outline\" onClick={handlePasswordReset} disabled={isResetting}>\n                {isResetting ? <><Loader2 className=\"animate-spin mr-2\" /> Sending...</> : <><Lock className=\"mr-2\"/> Reset Password</>}\n                </Button>\n            </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":9964,"size_tokens":null},"README.md":{"content":"# AetherDash - Cyberpunk Digital Hub\n\nA futuristic, cyberpunk-themed web application that serves as your central digital hub with real-time communication, AI assistance, note-taking, and file management.\n\n## 🚀 Quick Start\n\n### Prerequisites\n- Node.js 18+ \n- npm or yarn\n- Firebase project setup\n\n### Installation\n\n1. **Clone and install dependencies:**\n```bash\ngit clone <repository-url>\ncd aetherdash\nnpm run install:all\n```\n\n2. **Environment Setup:**\n```bash\n# Copy environment files\ncp .env.example .env\ncp backend/.env.example backend/.env\n\n# Configure your Firebase and API keys in both .env files\n```\n\n3. **Start Development Servers:**\n```bash\n# Start both frontend and backend\nnpm run dev\n\n# Or start individually\nnpm run dev:frontend  # Frontend on http://localhost:3000\nnpm run dev:backend   # Backend on http://localhost:5000\n```\n\n## 🏗️ Project Structure\n\n```\n/\n├── src/                    # Frontend (Next.js)\n│   ├── app/               # Next.js App Router pages\n│   ├── components/        # React components\n│   ├── firebase/          # Firebase client config\n│   ├── hooks/             # Custom React hooks\n│   ├── lib/               # Utilities and API client\n│   └── ai/                # Genkit AI flows\n├── backend/               # Backend API (Express.js)\n│   ├── src/\n│   │   ├── config/        # Firebase Admin & configs\n│   │   ├── controllers/   # Route handlers\n│   │   ├── middleware/    # Auth, rate limiting, etc.\n│   │   ├── routes/        # API routes\n│   │   └── services/      # Business logic\n│   └── package.json\n└── package.json           # Frontend dependencies\n```\n\n## 🔧 Technology Stack\n\n### Frontend\n- **Framework:** Next.js 15 (App Router)\n- **Language:** TypeScript\n- **UI:** ShadCN/UI + Tailwind CSS\n- **Animation:** Framer Motion\n- **State:** React Context + Custom Hooks\n\n### Backend\n- **Runtime:** Node.js + Express.js\n- **Database:** Firebase Firestore\n- **Auth:** Firebase Authentication\n- **AI:** Google Gemini (via Genkit)\n- **Security:** Helmet, CORS, Rate Limiting\n\n## 📱 Features\n\n- **🎨 Cyberpunk UI:** Dark theme with neon accents and glassmorphism\n- **🤖 AI Assistant:** Powered by Google Gemini\n- **💬 Real-time Chat:** Advanced messaging with WebRTC integration\n- **📞 Voice & Video Calls:** WhatsApp-style calling with Cloudflare integration\n- **📝 Notes & Tasks:** Organized productivity tools\n- **🎮 Gaming Hub:** Social gaming features\n- **⚙️ Customization:** Themes, settings, and preferences\n- **🔐 Secure:** Firebase Auth + JWT tokens\n\n## 🛠️ Development\n\n### Available Scripts\n\n```bash\n# Development\nnpm run dev              # Start both frontend & backend\nnpm run dev:frontend     # Frontend only (port 3000)\nnpm run dev:backend      # Backend only (port 5000)\n\n# Building\nnpm run build            # Build both\nnpm run build:frontend   # Build frontend\nnpm run build:backend    # Build backend\n\n# Production\nnpm run start            # Start both in production\nnpm run start:frontend   # Frontend production server\nnpm run start:backend    # Backend production server\n\n# AI Development\nnpm run genkit:dev       # Start Genkit development server\nnpm run genkit:watch     # Start Genkit with file watching\n```\n\n### API Endpoints\n\n#### Authentication Required\n- `GET /api/users/profile` - Get user profile\n- `PUT /api/users/profile` - Update user profile  \n- `GET /api/users/stats` - Get user statistics\n- `POST /api/ai/chat` - Chat with AI (streaming)\n- `POST /api/ai/generate-image` - Generate images\n- `POST /api/ai/translate` - Translate text\n\n#### Public\n- `GET /api/health` - Health check\n\n## 🔐 Environment Variables\n\n### Frontend (.env)\n```env\nNEXT_PUBLIC_FIREBASE_API_KEY=your_api_key\nNEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_domain\nNEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id\nNEXT_PUBLIC_API_URL=http://localhost:5000/api\n```\n\n### Backend (backend/.env)\n```env\nFIREBASE_PROJECT_ID=your_project_id\nFIREBASE_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\\n\"\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxx@your-project.iam.gserviceaccount.com\nPORT=5000\nCORS_ORIGIN=http://localhost:3000\nGOOGLE_AI_API_KEY=your_google_ai_key\nCLOUDFLARE_ACCOUNT_ID=your_cloudflare_account_id\nCLOUDFLARE_API_TOKEN=your_cloudflare_api_token\n```\n\n## 🚀 Deployment\n\n### Frontend (Vercel/Netlify)\n```bash\nnpm run build:frontend\n# Deploy dist folder\n```\n\n### Backend (Railway/Heroku/VPS)\n```bash\ncd backend\nnpm run build\nnpm run start\n```\n\n## 📚 Documentation\n\n- [Development Guide](./DEV_README.md) - Detailed development documentation\n- [API Documentation](./docs/api.md) - Backend API reference\n- [Component Guide](./docs/components.md) - Frontend component documentation\n\n## 🤝 Contributing\n\n1. Fork the repository\n2. Create a feature branch: `git checkout -b feature/amazing-feature`\n3. Commit changes: `git commit -m 'Add amazing feature'`\n4. Push to branch: `git push origin feature/amazing-feature`\n5. Open a Pull Request\n\n## 📄 License\n\nThis project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.\n\n## 🆘 Support\n\n- 📧 Email: support@aetherdash.com\n- 💬 Discord: [Join our community](https://discord.gg/aetherdash)\n- 📖 Docs: [Documentation](https://docs.aetherdash.com)\n\n---\n\nBuilt with ❤️ for the cyberpunk future","path":null,"size_bytes":5412,"size_tokens":null},"backend/src/server.ts":{"content":"import express from 'express';\nimport { createServer } from 'http';\nimport { Server } from 'socket.io';\nimport cors from 'cors';\nimport helmet from 'helmet';\nimport morgan from 'morgan';\nimport compression from 'compression';\nimport dotenv from 'dotenv';\nimport routes from './routes';\nimport { rateLimitMiddleware } from './middleware/rateLimiter';\n\ndotenv.config();\n\nconst app = express();\nconst httpServer = createServer(app);\nconst io = new Server(httpServer, {\n  cors: {\n    origin: process.env.CORS_ORIGIN || 'http://localhost:3000',\n    credentials: true\n  }\n});\nconst PORT = process.env.PORT || 4000;\n\n// Security middleware\napp.use(helmet());\napp.use(cors({\n  origin: process.env.CORS_ORIGIN || 'http://localhost:3000',\n  credentials: true,\n}));\n\n// General middleware\napp.use(compression());\napp.use(morgan('combined'));\napp.use(express.json({ limit: '10mb' }));\napp.use(express.urlencoded({ extended: true, limit: '10mb' }));\n\n// Rate limiting\napp.use(rateLimitMiddleware);\n\n// API routes\napp.use('/api', routes);\n\n// Root endpoint\napp.get('/', (req, res) => {\n  res.json({\n    message: 'AetherDash Backend API',\n    version: '1.0.0',\n    status: 'Running',\n    timestamp: new Date().toISOString(),\n  });\n});\n\n// 404 handler\napp.use('*', (req, res) => {\n  res.status(404).json({\n    error: 'Route not found',\n    path: req.originalUrl,\n    method: req.method,\n  });\n});\n\n// Global error handler\napp.use((err: any, req: express.Request, res: express.Response, next: express.NextFunction) => {\n  console.error('Global error handler:', err);\n  res.status(err.status || 500).json({\n    error: process.env.NODE_ENV === 'production' ? 'Internal server error' : err.message,\n    ...(process.env.NODE_ENV !== 'production' && { stack: err.stack }),\n  });\n});\n\n// Socket.io signaling\nio.on('connection', (socket) => {\n  socket.on('call:offer', ({ to, offer, from, callType, fromName, fromAvatar }) => {\n    io.to(to).emit('call:incoming', { from, offer, callType, fromName, fromAvatar });\n  });\n\n  socket.on('call:answer', ({ to, answer }) => {\n    io.to(to).emit('call:answer', { answer });\n  });\n\n  socket.on('call:ice-candidate', ({ to, candidate }) => {\n    io.to(to).emit('call:ice-candidate', { candidate });\n  });\n\n  socket.on('call:end', ({ to }) => {\n    io.to(to).emit('call:ended');\n  });\n\n  socket.on('call:decline', ({ to }) => {\n    io.to(to).emit('call:declined');\n  });\n\n  socket.on('user:register', (userId) => {\n    socket.join(userId);\n  });\n});\n\nhttpServer.listen(PORT, 'localhost', () => {\n  console.log(`🚀 AetherDash Backend running on localhost:${PORT}`);\n  console.log(`📱 Environment: ${process.env.NODE_ENV || 'development'}`);\n  console.log(`🔗 CORS Origin: ${process.env.CORS_ORIGIN || 'http://localhost:3000'}`);\n});\n\nexport default app;","path":null,"size_bytes":2774,"size_tokens":null},"src/services/api-service.ts":{"content":"import { auth } from '@/firebase';\nimport apiClient from '@/lib/api';\n\nclass ApiService {\n  private async getAuthToken(): Promise<string | null> {\n    const user = auth.currentUser;\n    if (!user) return null;\n    \n    try {\n      return await user.getIdToken();\n    } catch (error) {\n      console.error('Failed to get auth token:', error);\n      return null;\n    }\n  }\n\n  async updateAuthToken() {\n    const token = await this.getAuthToken();\n    if (token && typeof window !== 'undefined') {\n      localStorage.setItem('authToken', token);\n    }\n  }\n\n  // User services\n  async getUserProfile() {\n    await this.updateAuthToken();\n    return apiClient.getUserProfile();\n  }\n\n  async updateUserProfile(data: any) {\n    await this.updateAuthToken();\n    return apiClient.updateUserProfile(data);\n  }\n\n  async getUserStats() {\n    await this.updateAuthToken();\n    return apiClient.getUserStats();\n  }\n\n  // AI services\n  async chatWithAI(message: string, context?: string) {\n    await this.updateAuthToken();\n    return apiClient.chatWithAI(message, context);\n  }\n\n  async streamChatWithAI(message: string, context?: string) {\n    await this.updateAuthToken();\n    return apiClient.streamChat(message, context);\n  }\n\n  async generateImage(prompt: string, style?: string, size?: string) {\n    await this.updateAuthToken();\n    return apiClient.generateImage(prompt, style, size);\n  }\n\n  async translateText(text: string, targetLanguage: string) {\n    await this.updateAuthToken();\n    return apiClient.translateText(text, targetLanguage);\n  }\n\n  // Utility method to handle streaming responses\n  async handleStreamingResponse(\n    stream: ReadableStream,\n    onChunk: (chunk: string) => void,\n    onComplete?: () => void,\n    onError?: (error: Error) => void\n  ) {\n    try {\n      const reader = stream.getReader();\n      const decoder = new TextDecoder();\n\n      while (true) {\n        const { done, value } = await reader.read();\n        \n        if (done) {\n          onComplete?.();\n          break;\n        }\n\n        const chunk = decoder.decode(value);\n        const lines = chunk.split('\\n');\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            try {\n              const data = JSON.parse(line.slice(6));\n              onChunk(data.content);\n              \n              if (data.done) {\n                onComplete?.();\n                return;\n              }\n            } catch (e) {\n              // Skip invalid JSON lines\n            }\n          }\n        }\n      }\n    } catch (error) {\n      onError?.(error as Error);\n    }\n  }\n}\n\nexport const apiService = new ApiService();\nexport default apiService;","path":null,"size_bytes":2657,"size_tokens":null},"src/components/chat/GroupSettingsModal.tsx":{"content":"'use client';\nimport { useState, useEffect } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { Contact } from '@/types/chat';\nimport { PublicUser } from '@/hooks/use-connections';\nimport { Users, Upload, X, UserMinus, Crown, Shield } from 'lucide-react';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ScrollArea } from '@/components/ui/scroll-area';\n\ninterface GroupSettingsModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  group: Contact | null;\n  onUpdateGroup: (groupId: string, updates: { name?: string; avatar?: string }) => void;\n  onRemoveMember: (groupId: string, memberId: string) => void;\n  onLeaveGroup: (group: Contact) => void;\n  onDeleteGroup: (group: Contact) => void;\n  currentUserId: string;\n  loading?: boolean;\n}\n\nexport default function GroupSettingsModal({ \n  open, \n  onOpenChange, \n  group, \n  onUpdateGroup, \n  onRemoveMember,\n  onLeaveGroup,\n  onDeleteGroup,\n  currentUserId,\n  loading \n}: GroupSettingsModalProps) {\n  const [groupName, setGroupName] = useState('');\n  const [groupAvatar, setGroupAvatar] = useState('');\n\n  useEffect(() => {\n    if (group) {\n      setGroupName(group.name);\n      setGroupAvatar(group.avatar || '');\n    }\n  }, [group]);\n\n  const handleSave = () => {\n    if (group && groupName.trim()) {\n      onUpdateGroup(group.id, {\n        name: groupName.trim(),\n        avatar: groupAvatar\n      });\n    }\n  };\n\n  const handleRemoveMember = (memberId: string) => {\n    if (group) {\n      onRemoveMember(group.id, memberId);\n    }\n  };\n\n  const handleLeaveGroup = () => {\n    if (group) {\n      onLeaveGroup(group);\n      onOpenChange(false);\n    }\n  };\n\n  const handleDeleteGroup = () => {\n    if (group && window.confirm('Are you sure you want to delete this group? This action cannot be undone.')) {\n      onDeleteGroup(group);\n      onOpenChange(false);\n    }\n  };\n\n  if (!group) return null;\n\n  const isAdmin = true; // TODO: Check if current user is admin\n  const members = group.members || [];\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[80vh]\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            Group Settings\n          </DialogTitle>\n        </DialogHeader>\n        \n        <Tabs defaultValue=\"info\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"info\">Group Info</TabsTrigger>\n            <TabsTrigger value=\"members\">Members</TabsTrigger>\n            <TabsTrigger value=\"actions\">Actions</TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"info\" className=\"space-y-4\">\n            <div className=\"flex flex-col items-center space-y-4\">\n              <div className=\"relative\">\n                <Avatar className=\"h-24 w-24\">\n                  <AvatarImage src={groupAvatar} />\n                  <AvatarFallback className=\"text-2xl\">\n                    {groupName.charAt(0).toUpperCase()}\n                  </AvatarFallback>\n                </Avatar>\n                {isAdmin && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"absolute -bottom-2 -right-2 h-8 w-8 rounded-full p-0\"\n                    onClick={() => {\n                      const input = document.createElement('input');\n                      input.type = 'file';\n                      input.accept = 'image/*';\n                      input.onchange = (e) => {\n                        const file = (e.target as HTMLInputElement).files?.[0];\n                        if (file) {\n                          // TODO: Upload file and set avatar URL\n                          console.log('Upload avatar:', file);\n                        }\n                      };\n                      input.click();\n                    }}\n                  >\n                    <Upload className=\"h-4 w-4\" />\n                  </Button>\n                )}\n              </div>\n              \n              <div className=\"w-full space-y-2\">\n                <Label htmlFor=\"groupName\">Group Name</Label>\n                <Input\n                  id=\"groupName\"\n                  value={groupName}\n                  onChange={(e) => setGroupName(e.target.value)}\n                  disabled={!isAdmin}\n                  placeholder=\"Enter group name...\"\n                />\n              </div>\n              \n              <div className=\"w-full\">\n                <Label>Group ID</Label>\n                <Input value={group.id} disabled className=\"text-muted-foreground\" />\n              </div>\n              \n              {isAdmin && (\n                <Button onClick={handleSave} disabled={loading || !groupName.trim()}>\n                  {loading ? 'Saving...' : 'Save Changes'}\n                </Button>\n              )}\n            </div>\n          </TabsContent>\n          \n          <TabsContent value=\"members\" className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <Label>Members ({members.length})</Label>\n              {isAdmin && (\n                <Button size=\"sm\" variant=\"outline\">\n                  Add Members\n                </Button>\n              )}\n            </div>\n            \n            <ScrollArea className=\"h-64\">\n              <div className=\"space-y-2\">\n                {members.map((member) => (\n                  <div key={member.id} className=\"flex items-center justify-between p-2 rounded-lg hover:bg-muted/50\">\n                    <div className=\"flex items-center space-x-3\">\n                      <Avatar className=\"h-10 w-10\">\n                        <AvatarImage src={member.photoURL || undefined} />\n                        <AvatarFallback>\n                          {member.displayName?.charAt(0) || '?'}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <p className=\"font-medium\">{member.displayName || 'Unknown'}</p>\n                        <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                          {member.id === currentUserId && <Crown className=\"w-3 h-3\" />}\n                          {member.id === currentUserId ? 'You' : 'Member'}\n                        </div>\n                      </div>\n                    </div>\n                    \n                    {isAdmin && member.id !== currentUserId && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => handleRemoveMember(member.id)}\n                        className=\"text-destructive hover:text-destructive\"\n                      >\n                        <UserMinus className=\"h-4 w-4\" />\n                      </Button>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </ScrollArea>\n          </TabsContent>\n          \n          <TabsContent value=\"actions\" className=\"space-y-4\">\n            <div className=\"space-y-3\">\n              <Button\n                variant=\"outline\"\n                onClick={handleLeaveGroup}\n                className=\"w-full justify-start text-orange-600 hover:text-orange-700\"\n              >\n                <X className=\"w-4 h-4 mr-2\" />\n                Leave Group\n              </Button>\n              \n              {isAdmin && (\n                <Button\n                  variant=\"outline\"\n                  onClick={handleDeleteGroup}\n                  className=\"w-full justify-start text-destructive hover:text-destructive\"\n                >\n                  <X className=\"w-4 h-4 mr-2\" />\n                  Delete Group\n                </Button>\n              )}\n            </div>\n            \n            <div className=\"text-xs text-muted-foreground space-y-1\">\n              <p>• Leaving the group will remove you from all conversations</p>\n              {isAdmin && <p>• Deleting the group will permanently remove it for all members</p>}\n            </div>\n          </TabsContent>\n        </Tabs>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":8478,"size_tokens":null},"src/components/layout/loading-bar.tsx":{"content":"\n'use client';\nimport { motion } from 'framer-motion';\n\nexport default function LoadingBar({ progress }: { progress: number }) {\n  return (\n    <div className=\"absolute bottom-1/4 w-1/3 max-w-sm flex flex-col items-center gap-4\">\n        <p className=\"font-mono text-primary text-glow tracking-widest\">\n            AETHERWEAVE OS\n        </p>\n        <div className=\"w-full h-2 bg-primary/10 border-2 border-primary/20 rounded-full overflow-hidden\">\n            <motion.div\n                className=\"h-full bg-primary neon-glow-primary rounded-full\"\n                style={{\n                    boxShadow: `0 0 15px hsl(var(--primary))`,\n                }}\n                initial={{ width: '0%' }}\n                animate={{ width: `${progress}%` }}\n                transition={{ duration: 0.5, ease: 'easeInOut' }}\n            />\n        </div>\n         <p className=\"font-mono text-sm text-muted-foreground\">\n            Initializing modules... {Math.round(progress)}%\n        </p>\n    </div>\n  );\n}\n","path":null,"size_bytes":1004,"size_tokens":null},"public/sounds/ringtone.js":{"content":"// Simple ringtone generator using Web Audio API\nconst generateRingtone = () => {\n  const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n  const oscillator = audioContext.createOscillator();\n  const gainNode = audioContext.createGain();\n  \n  oscillator.connect(gainNode);\n  gainNode.connect(audioContext.destination);\n  \n  oscillator.frequency.setValueAtTime(800, audioContext.currentTime);\n  oscillator.type = 'sine';\n  \n  gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);\n  \n  oscillator.start(audioContext.currentTime);\n  oscillator.stop(audioContext.currentTime + 1);\n};\n\n// Export for use in components\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = { generateRingtone };\n}","path":null,"size_bytes":824,"size_tokens":null},"src/components/tasks/kanban-board.tsx":{"content":"'use client';\n\nimport { useState } from 'react';\nimport { Card, CardContent } from \"../ui/card\";\nimport { Badge } from \"../ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"../ui/dialog\";\nimport { Button } from \"../ui/button\";\n\nconst priorityClasses = {\n  High: \"bg-red-500/80 border-red-500 text-red-50\",\n  Medium: \"bg-yellow-500/80 border-yellow-500 text-yellow-50\",\n  Low: \"bg-green-500/80 border-green-500 text-green-50\",\n};\n\ntype Task = {\n  id: string;\n  content: string;\n  priority: 'Low' | 'Medium' | 'High';\n  status: 'todo' | 'in-progress' | 'done';\n};\n\ntype KanbanBoardProps = {\n  tasks: Task[];\n  onUpdateTaskStatus: (taskId: string, newStatus: 'todo' | 'in-progress' | 'done') => void;\n};\n\nconst columns = [\n  { id: 'todo', title: 'To Do', status: 'todo' as const },\n  { id: 'in-progress', title: 'In Progress', status: 'in-progress' as const },\n  { id: 'done', title: 'Completed', status: 'done' as const },\n];\n\nexport default function KanbanBoard({ tasks, onUpdateTaskStatus }: KanbanBoardProps) {\n  const [selectedTask, setSelectedTask] = useState<Task | null>(null);\n\n  return (\n    <>\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 flex-1 items-start\">\n        {columns.map((column) => (\n          <div key={column.id} className=\"flex flex-col gap-4\">\n            <h2 className=\"text-xl font-headline text-center text-primary/80\">{column.title}</h2>\n            <Card className=\"min-h-[300px] flex-1\">\n              <CardContent className=\"p-4 space-y-4\">\n                {tasks.filter(task => task.status === column.status).map((task) => (\n                  <Card\n                    key={task.id}\n                    className=\"bg-muted/50 border border-border hover:neon-border-primary cursor-pointer transition-all duration-300\"\n                    onClick={() => setSelectedTask(task)}\n                  >\n                    <CardContent className=\"p-3\">\n                      <div className=\"flex justify-between items-start\">\n                        <p className=\"font-medium pr-2\">{task.content}</p>\n                        <Badge className={priorityClasses[task.priority]}>\n                          {task.priority}\n                        </Badge>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </CardContent>\n            </Card>\n          </div>\n        ))}\n      </div>\n\n      <Dialog open={!!selectedTask} onOpenChange={() => setSelectedTask(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Update Task Status</DialogTitle>\n          </DialogHeader>\n          {selectedTask && (\n            <div className=\"space-y-4 py-4\">\n              <div>\n                <p className=\"font-semibold mb-2\">{selectedTask.content}</p>\n                <Badge className={priorityClasses[selectedTask.priority]}>\n                  {selectedTask.priority}\n                </Badge>\n              </div>\n              <div className=\"space-y-2\">\n                <p className=\"text-sm text-muted-foreground\">Move to:</p>\n                <div className=\"flex flex-col gap-2\">\n                  <Button\n                    variant={selectedTask.status === 'todo' ? 'default' : 'outline'}\n                    onClick={() => {\n                      onUpdateTaskStatus(selectedTask.id, 'todo');\n                      setSelectedTask(null);\n                    }}\n                    className=\"w-full\"\n                  >\n                    To Do\n                  </Button>\n                  <Button\n                    variant={selectedTask.status === 'in-progress' ? 'default' : 'outline'}\n                    onClick={() => {\n                      onUpdateTaskStatus(selectedTask.id, 'in-progress');\n                      setSelectedTask(null);\n                    }}\n                    className=\"w-full\"\n                  >\n                    In Progress\n                  </Button>\n                  <Button\n                    variant={selectedTask.status === 'done' ? 'default' : 'outline'}\n                    onClick={() => {\n                      onUpdateTaskStatus(selectedTask.id, 'done');\n                      setSelectedTask(null);\n                    }}\n                    className=\"w-full\"\n                  >\n                    Completed\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","path":null,"size_bytes":4479,"size_tokens":null},"src/components/ui/command-hub.tsx":{"content":"\n'use client';\n\nimport { useCommandHub, CommandHubAction } from '@/hooks/use-command-hub';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useEffect, useRef, useState } from 'react';\nimport * as Lucide from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useCursor } from '@/hooks/use-cursor';\nimport { appEventEmitter } from '@/lib/event-emitter';\n\nexport default function CommandHub() {\n  const { isOpen, position, actions, closeHub, data, loadingAction } = useCommandHub();\n  const menuRef = useRef<HTMLDivElement>(null);\n  const [adjustedPosition, setAdjustedPosition] = useState(position);\n  const { setCursorMode } = useCursor();\n  \n  useEffect(() => {\n    if (isOpen) {\n      const menu = menuRef.current;\n      if (!menu) return;\n\n      const screenW = window.innerWidth;\n      const screenH = window.innerHeight;\n      \n      // Use getBoundingClientRect after the menu is visible for accurate dimensions\n      const rect = menu.getBoundingClientRect();\n      \n      let x = position.x;\n      let y = position.y;\n      \n      // Adjust if it overflows the screen\n      if (x + rect.width > screenW) x = screenW - rect.width - 16;\n      if (y + rect.height > screenH) y = screenH - rect.height - 16;\n      if (x < 16) x = 16;\n      if (y < 16) y = 16;\n\n      setAdjustedPosition({ x, y });\n    }\n  }, [isOpen, position]);\n\n\n  const handleActionClick = async (action: CommandHubAction, event: React.MouseEvent<HTMLButtonElement>) => {\n    appEventEmitter.emit('ui:sound', 'click');\n    if ('onClick' in action && !action.disabled && !loadingAction) {\n      await action.onClick(data);\n      closeHub();\n    }\n  };\n\n  const handleBackdropClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (e.target === e.currentTarget) {\n      closeHub();\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <div className=\"fixed inset-0 z-[9998]\" onClick={handleBackdropClick}>\n          <motion.div\n            ref={menuRef}\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95, transition: { duration: 0.1 } }}\n            transition={{ duration: 0.15, ease: 'easeOut' }}\n            className=\"fixed z-[9999] w-[260px] max-h-[320px] rounded-xl glass-card neon-border-primary overflow-hidden\"\n            style={{\n              left: adjustedPosition.x,\n              top: adjustedPosition.y,\n            }}\n            role=\"menu\"\n            aria-label=\"Context Menu\"\n          >\n            <div className=\"overflow-y-auto max-h-[320px] custom-scroll p-1.5\">\n              {actions.map((action, index) => {\n                if ('separator' in action && action.separator) {\n                  return <div key={index} className=\"h-px bg-border my-1\" />;\n                }\n                \n                if (!('label' in action)) return null;\n                \n                const Icon = action.icon ? (Lucide[action.icon] as Lucide.LucideIcon) : Lucide.Circle;\n                return (\n                  <button\n                    key={index}\n                    role=\"menuitem\"\n                    disabled={action.disabled || loadingAction === action.label}\n                    onClick={(e) => handleActionClick(action, e)}\n                    className={cn(\n                      \"w-full text-left px-3 py-2.5 text-sm flex items-center gap-3 rounded-md transition-colors\",\n                      \"hover:bg-primary/20\",\n                      action.isDestructive ? 'text-destructive hover:bg-destructive/20' : 'text-foreground',\n                      (action.disabled || loadingAction) && 'opacity-50 grayscale pointer-events-none',\n                      loadingAction === action.label && 'bg-primary/10'\n                    )}\n                    onMouseEnter={() => setCursorMode('link')}\n                    onMouseLeave={() => setCursorMode('default')}\n                  >\n                    {loadingAction === action.label ? (\n                      <Lucide.Loader2 className=\"w-4 h-4 shrink-0 animate-spin\" />\n                    ) : (\n                      Icon && <Icon className=\"w-4 h-4 shrink-0\" />\n                    )}\n                    <span className=\"truncate flex-1\">{action.label}</span>\n                    {loadingAction === action.label && (\n                      <Lucide.Loader2 className=\"w-3 h-3 animate-spin opacity-60\" />\n                    )}\n                  </button>\n                )\n              })}\n            </div>\n          </motion.div>\n        </div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":4576,"size_tokens":null},"src/ai/flows/generate-meeting-notes.ts":{"content":"// This is an autogenerated file from Firebase Studio.\n'use server';\n\n/**\n * @fileOverview Generates meeting notes from chat history using Genkit.\n *\n * - generateMeetingNotes - A function that generates meeting notes from chat history.\n * - GenerateMeetingNotesInput - The input type for the generateMeetingNotes function.\n * - GenerateMeetingNotesOutput - The output type for the generateMeetingNotes function.\n */\n\nimport {ai} from '@/ai/genkit';\nimport {z} from 'genkit';\n\nconst GenerateMeetingNotesInputSchema = z.object({\n  chatHistory: z\n    .string()\n    .describe('The complete chat history of the meeting.'),\n});\nexport type GenerateMeetingNotesInput = z.infer<typeof GenerateMeetingNotesInputSchema>;\n\nconst GenerateMeetingNotesOutputSchema = z.object({\n  notes: z.string().describe('The generated meeting notes summarizing key decisions and action items.'),\n});\nexport type GenerateMeetingNotesOutput = z.infer<typeof GenerateMeetingNotesOutputSchema>;\n\nexport async function generateMeetingNotes(input: GenerateMeetingNotesInput): Promise<GenerateMeetingNotesOutput> {\n  return generateMeetingNotesFlow(input);\n}\n\nconst prompt = ai.definePrompt({\n  name: 'generateMeetingNotesPrompt',\n  input: {schema: GenerateMeetingNotesInputSchema},\n  output: {schema: GenerateMeetingNotesOutputSchema},\n  prompt: `You are an AI assistant tasked with generating meeting notes from a chat history.\n\n  Please summarize the key decisions, action items, and important discussion points from the following chat history:\n\n  {{chatHistory}}\n\n  Present the notes in a clear and concise manner, suitable for easy review.\n  The generated notes should be well-organized, highlighting the most important information discussed during the meeting.\n  Avoid including greetings and closing remarks.\n  Use proper markdown formatting.\n  Include section titles such as:\n  - Attendees\n  - Key Discussions\n  - Decisions Made\n  - Action Items\n  `,\n});\n\nconst generateMeetingNotesFlow = ai.defineFlow(\n  {\n    name: 'generateMeetingNotesFlow',\n    inputSchema: GenerateMeetingNotesInputSchema,\n    outputSchema: GenerateMeetingNotesOutputSchema,\n  },\n  async input => {\n    const {output} = await prompt(input);\n    return output!;\n  }\n);\n","path":null,"size_bytes":2216,"size_tokens":null},"src/components/providers/LoadingProvider.tsx":{"content":"\n'use client';\nimport { useState, useCallback, useRef, ReactNode, useMemo } from 'react';\nimport { LoadingContext, TutorialPageId } from '@/hooks/use-loading';\nimport { useRouter } from 'next/navigation';\n\nexport function LoadingProvider({ children }: { children: ReactNode }) {\n    const [isLoading, setIsLoading] = useState(false);\n    const [progress, setProgress] = useState(0);\n    const [tutorialPageId, setTutorialPageId] = useState<TutorialPageId | null>(null);\n    const animationFrameRef = useRef<number>();\n    const router = useRouter();\n\n    const startPageLoad = useCallback((pageId: TutorialPageId) => {\n        setIsLoading(true);\n        setTutorialPageId(pageId);\n        setProgress(0);\n\n        let startTime: number | null = null;\n        const duration = 2000 + Math.random() * 1000; // 2-3 seconds load time\n\n        const animate = (timestamp: number) => {\n            if (!startTime) startTime = timestamp;\n            const elapsed = timestamp - startTime;\n            const newProgress = Math.min((elapsed / duration) * 100, 100);\n            setProgress(newProgress);\n\n            if (newProgress < 100) {\n                animationFrameRef.current = requestAnimationFrame(animate);\n            }\n        };\n        animationFrameRef.current = requestAnimationFrame(animate);\n    }, []);\n\n    const finishPageLoad = useCallback((path: string) => {\n        setProgress(100);\n        \n        // Ensure redirection happens, then fade out.\n        router.replace(path);\n        \n        setTimeout(() => {\n            setIsLoading(false);\n            setTutorialPageId(null);\n            if (animationFrameRef.current) {\n                cancelAnimationFrame(animationFrameRef.current);\n            }\n        }, 500); // Wait for fade-out animation\n    }, [router]);\n\n    const contextValue = useMemo(() => ({\n        isLoading,\n        progress,\n        tutorialPageId,\n        startPageLoad,\n        finishPageLoad,\n    }), [isLoading, progress, tutorialPageId, startPageLoad, finishPageLoad]);\n\n    return (\n        <LoadingContext.Provider value={contextValue}>\n            {children}\n        </LoadingContext.Provider>\n    );\n}\n","path":null,"size_bytes":2156,"size_tokens":null},"src/lib/cloudflare-r2.ts":{"content":"'use client';\n\nexport async function uploadToCloudflare(file: File): Promise<string> {\n  const formData = new FormData();\n  formData.append('file', file);\n\n  const response = await fetch('/api/upload', {\n    method: 'POST',\n    body: formData,\n  });\n\n  if (!response.ok) {\n    throw new Error('Upload failed');\n  }\n\n  const { url } = await response.json();\n  return url;\n}","path":null,"size_bytes":372,"size_tokens":null},"src/components/ui/toaster.tsx":{"content":"\"use client\"\n\nimport { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":786,"size_tokens":null},"src/firebase/errors.ts":{"content":"'use client';\nimport { type Auth } from 'firebase/auth';\n\nexport type SecurityRuleContext = {\n  path: string;\n  operation: 'get' | 'list' | 'create' | 'update' | 'delete' | 'write';\n  requestResourceData?: any;\n};\n\nexport class FirestorePermissionError extends Error {\n  public request: SecurityRuleContext;\n  public rules?: string;\n\n  constructor(request: SecurityRuleContext, auth: Auth) {\n    const user = auth.currentUser;\n    const { operation, path, requestResourceData } = request;\n    const serverError = {\n      auth: user ? JSON.parse(JSON.stringify(user)) : null,\n      method: operation,\n      path: `/databases/(default)/documents/${path}`,\n      ...(requestResourceData && { resource: { data: requestResourceData } }),\n    };\n\n    const message = `FirestoreError: Missing or insufficient permissions: The following request was denied by Firestore Security Rules:\\n${JSON.stringify(\n      serverError,\n      null,\n      2\n    )}`;\n\n    super(message);\n    this.name = 'FirestorePermissionError';\n    this.request = request;\n  }\n}\n","path":null,"size_bytes":1043,"size_tokens":null},"src/components/settings/RoleSettings.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Plus, Trash2, Shield, Eye, Settings, Search } from 'lucide-react';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { cn } from '@/lib/utils';\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\"\n\nconst mockPermissions: Record<string, Array<{ id: string; label: string; description?: string }>> = {\n    general: [\n        { id: 'viewChannels', label: 'View Channels' },\n        { id: 'manageChannels', label: 'Manage Channels' },\n        { id: 'manageRoles', label: 'Manage Roles' },\n        { id: 'manageSpace', label: 'Manage Space' },\n        { id: 'createInvite', label: 'Create Invite' },\n        { id: 'kickMembers', label: 'Kick Members' },\n        { id: 'banMembers', label: 'Ban Members' },\n        { id: 'timeoutMembers', label: 'Timeout Members' },\n        { id: 'administrator', label: 'Administrator', description: 'Grants all permissions. A dangerous permission to grant.' },\n    ],\n    text: [\n        { id: 'sendMessage', label: 'Send Messages' },\n        { id: 'attachFiles', label: 'Attach Files' },\n        { id: 'addReactions', label: 'Add Reactions' },\n        { id: 'mentionEveryone', label: 'Mention @everyone' },\n        { id: 'deleteMessages', label: 'Delete Messages' },\n        { id: 'bypassSlowMode', label: 'Bypass Slow Mode' },\n        { id: 'sendVoiceMessage', label: 'Send Voice Message' },\n        { id: 'createPolls', label: 'Create Polls' },\n    ],\n    voice: [\n        { id: 'connectToVC', label: 'Connect to Voice Channels' },\n        { id: 'speakInVC', label: 'Speak in Voice Channels' },\n        { id: 'shareScreen', label: 'Share Screen' },\n        { id: 'shareCamera', label: 'Share Camera' },\n        { id: 'muteMember', label: 'Mute Members' },\n        { id: 'deafenMember', label: 'Deafen Members' },\n    ],\n}\n\nconst mockInitialRoles = [\n  { id: '1', name: 'Admin', color: 'hsl(346.8 77.2% 49.8%)' },\n  { id: '2', name: 'Moderator', color: 'hsl(217.2 91.2% 59.8%)' },\n  { id: '3', name: 'Member', color: 'hsl(215 20.2% 65.1%)' },\n];\n\nexport default function RoleSettings() {\n  const [roles, setRoles] = useState(mockInitialRoles);\n  const [selectedRole, setSelectedRole] = useState(roles[0]);\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const filteredRoles = roles.filter(role => role.name.toLowerCase().includes(searchTerm.toLowerCase()));\n\n  const handleCreateRole = () => {\n    const newRole = { id: Date.now().toString(), name: 'new role', color: '#99AAB5' };\n    setRoles([...roles, newRole]);\n    setSelectedRole(newRole);\n  };\n  \n  const updateSelectedRole = (field: string, value: any) => {\n    const newRoles = roles.map(r => r.id === selectedRole.id ? {...r, [field]: value} : r);\n    setRoles(newRoles);\n    setSelectedRole(newRoles.find(r => r.id === selectedRole.id)!);\n  }\n\n  return (\n    <div className=\"flex-1 flex min-h-0 gap-4\">\n      {/* Roles List */}\n      <div className=\"w-56 flex flex-col gap-2\">\n         <div className=\"relative\">\n             <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n             <Input placeholder=\"Search roles...\" className=\"pl-8\" value={searchTerm} onChange={e=>setSearchTerm(e.target.value)} />\n         </div>\n         <Button variant=\"outline\" onClick={handleCreateRole}><Plus className=\"mr-2 h-4 w-4\"/>Create Role</Button>\n        <ScrollArea className=\"flex-1 pr-2 -mr-2\">\n          <div className=\"space-y-1\">\n            {filteredRoles.map(role => (\n              <div\n                key={role.id}\n                onClick={() => setSelectedRole(role)}\n                className={cn(\n                  'flex items-center justify-between p-2 rounded-md cursor-pointer',\n                  selectedRole.id === role.id ? 'bg-accent' : 'hover:bg-accent/50'\n                )}\n              >\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: role.color }} />\n                  <span className=\"font-medium text-sm\">{role.name}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </ScrollArea>\n      </div>\n\n      {/* Role Settings Panel */}\n      <div className=\"flex-1 flex flex-col min-h-0\">\n        <div className=\"flex items-center justify-between pb-2 border-b\">\n            <h3 className=\"text-xl font-bold font-headline text-glow\">{selectedRole.name}</h3>\n            <Button variant=\"destructive\" size=\"icon\"><Trash2 className=\"h-4 w-4\"/></Button>\n        </div>\n        \n        <Tabs defaultValue=\"display\" className=\"flex-1 flex flex-col min-h-0 mt-2\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n                <TabsTrigger value=\"display\">Display</TabsTrigger>\n                <TabsTrigger value=\"permissions\">Permissions</TabsTrigger>\n                <TabsTrigger value=\"members\">Manage Members</TabsTrigger>\n            </TabsList>\n            <ScrollArea className=\"flex-1 mt-4 pr-3 -mr-3\">\n                <TabsContent value=\"display\" className=\"mt-0 space-y-6\">\n                    <div className=\"space-y-2\">\n                        <Label>Role Name</Label>\n                        <Input value={selectedRole.name} onChange={(e) => updateSelectedRole('name', e.target.value)} />\n                    </div>\n                    <div className=\"space-y-2\">\n                        <Label>Role Color</Label>\n                        <div className=\"flex items-center gap-2\">\n                            <div className=\"w-10 h-10 rounded-md border\" style={{backgroundColor: selectedRole.color}}/>\n                            <Input type=\"color\" value={selectedRole.color} onChange={(e) => updateSelectedRole('color', e.target.value)} className=\"w-24 p-1\" />\n                        </div>\n                    </div>\n                    <div className=\"flex items-center justify-between p-4 rounded-lg border bg-background/30\">\n                        <Label htmlFor=\"display-separate\" className=\"flex flex-col gap-1 cursor-pointer\">\n                            <span>Display role members separately</span>\n                            <span className=\"font-normal text-muted-foreground text-sm\">Show members with this role in their own group in the member list.</span>\n                        </Label>\n                        <Switch id=\"display-separate\" />\n                    </div>\n                </TabsContent>\n                <TabsContent value=\"permissions\" className=\"mt-0 space-y-4\">\n                     <Accordion type=\"multiple\" defaultValue={['general']} className=\"w-full\">\n                        {Object.entries(mockPermissions).map(([category, perms]) => (\n                            <AccordionItem value={category} key={category}>\n                                <AccordionTrigger className=\"capitalize text-lg font-headline\">{category}</AccordionTrigger>\n                                <AccordionContent className=\"space-y-4 pt-4\">\n                                     {perms.map(perm => (\n                                        <div key={perm.id} className=\"flex items-center justify-between p-4 rounded-lg border bg-background/30\">\n                                            <Label htmlFor={perm.id} className=\"flex flex-col gap-1 cursor-pointer\">\n                                                <span>{perm.label}</span>\n                                                {perm.description && <span className=\"font-normal text-muted-foreground text-sm\">{perm.description}</span>}\n                                            </Label>\n                                            <Switch id={perm.id} />\n                                        </div>\n                                    ))}\n                                </AccordionContent>\n                            </AccordionItem>\n                        ))}\n                    </Accordion>\n                </TabsContent>\n                 <TabsContent value=\"members\" className=\"mt-0 space-y-4\">\n                    <Button variant=\"outline\"><Plus className=\"mr-2 h-4 w-4\"/>Add Members</Button>\n                     <p className=\"text-center text-muted-foreground\">No members have this role yet.</p>\n                </TabsContent>\n            </ScrollArea>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8591,"size_tokens":null},"src/lib/quests.ts":{"content":"\nexport interface Quest {\n    id: string;\n    type: 'daily' | 'weekly' | 'seasonal';\n    text: string;\n    description: string;\n    xp: number;\n    coinReward?: number;\n    badgeReward?: string;\n}\n\nexport const dailyQuests: Quest[] = [\n    { id: 'daily-login-1', type: 'daily', text: \"System Handshake\", description: \"Log in to the platform.\", xp: 10 },\n    { id: 'daily-msg-1', type: 'daily', text: \"Signal Boost\", description: \"Send 10 chat messages.\", xp: 20 },\n    { id: 'daily-react-1', type: 'daily', text: \"Echo Chamber\", description: \"React to 5 posts.\", xp: 15 },\n    { id: 'daily-note-1', type: 'daily', text: \"Data Entry\", description: \"Create a new note.\", xp: 30 },\n];\n\nexport const weeklyQuests: Quest[] = [\n    { id: 'weekly-msg-1', type: 'weekly', text: \"Network Overload\", description: \"Send 200 messages.\", xp: 200, coinReward: 50 },\n    { id: 'weekly-friends-1', type: 'weekly', text: \"Expand the Collective\", description: \"Make 3 friends.\", xp: 150, badgeReward: 'socialite-2' },\n    { id: 'weekly-files-1', type: 'weekly', text: \"Data Trafficker\", description: \"Share 5 files.\", xp: 100 },\n    { id: 'weekly-call-1', type: 'weekly', text: \"Voice of the Void\", description: \"Attend one call.\", xp: 100 },\n];\n\nexport const seasonalQuests: Quest[] = [\n    { id: 'seasonal-tasks-1', type: 'seasonal', text: \"Seasoned Operator\", description: \"Complete 30 daily tasks.\", xp: 1000, coinReward: 500 },\n    { id: 'seasonal-lvl-1', type: 'seasonal', text: \"Power Surge\", description: \"Level up 10 times.\", xp: 1000, badgeReward: 'overlord' },\n    { id: 'seasonal-badges-1', type: 'seasonal', text: \"Badge Collector\", description: \"Unlock 5 new badges.\", xp: 500 },\n];\n\n    \n","path":null,"size_bytes":1685,"size_tokens":null},"src/services/news-service.ts":{"content":"// src/services/news-service.ts\n'use server';\n\nconst API_KEY = process.env.NEWSAPI_ORG_API_KEY;\nconst TOP_HEADLINES_URL = 'https://newsapi.org/v2/top-headlines';\nconst EVERYTHING_URL = 'https://newsapi.org/v2/everything';\n\ninterface FetchNewsParams {\n  category?: string;\n  q?: string;\n  page?: string;\n  country?: string;\n  pageSize?: string;\n}\n\nexport async function fetchNews(params: FetchNewsParams) {\n  if (!API_KEY) {\n    throw new Error('Newsapi.org API key is not configured.');\n  }\n\n  let baseUrl: string;\n  const queryParams = new URLSearchParams({\n    apiKey: API_KEY,\n  });\n\n  if (params.q) {\n    // Search queries use the /everything endpoint and should not include country or category\n    baseUrl = EVERYTHING_URL;\n    queryParams.append('q', params.q);\n    queryParams.append('sortBy', 'publishedAt'); // Sort by most recent for searches\n  } else {\n    // Category browsing uses the /top-headlines endpoint\n    baseUrl = TOP_HEADLINES_URL;\n    if (params.category) {\n      queryParams.append('category', params.category);\n    }\n    // The 'country' parameter cannot be mixed with the 'sources' parameter. \n    // As we are not using sources, it is safe to add the country.\n    // However, it should not be included in a 'q' search.\n    queryParams.append('country', params.country || 'us');\n  }\n  \n  if (params.page) queryParams.append('page', params.page);\n  if (params.pageSize) queryParams.append('pageSize', params.pageSize);\n\n\n  try {\n    const url = `${baseUrl}?${queryParams.toString()}`;\n    console.log(`Fetching news from: ${url}`);\n    const response = await fetch(url, { next: { revalidate: 3600 } }); // Revalidate every hour\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      console.error('News API Error Response:', errorData);\n      throw new Error(`News API error: ${errorData.message || response.statusText}`);\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error: any) {\n    console.error('Failed to fetch news:', error);\n    // Re-throw the error to be handled by the API route\n    throw error;\n  }\n}\n","path":null,"size_bytes":2092,"size_tokens":null},"src/components/chat/ContactSelector.tsx":{"content":"'use client';\nimport { useState, useMemo } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { Search, Bot } from 'lucide-react';\nimport { Contact } from '@/types/chat';\nimport { getDerivedStatus } from '@/lib/chat-utils';\nimport { PublicUser } from '@/hooks/use-connections';\nimport { cn } from '@/lib/utils';\n\ninterface ContactSelectorProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  contacts: Contact[];\n  onSelectContact: (contact: Contact) => void;\n}\n\nexport default function ContactSelector({ open, onOpenChange, contacts, onSelectContact }: ContactSelectorProps) {\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const filteredContacts = useMemo(() => {\n    if (!searchTerm) return contacts;\n    return contacts.filter(contact =>\n      contact.name.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n  }, [contacts, searchTerm]);\n\n  const handleSelectContact = (contact: Contact) => {\n    onSelectContact(contact);\n    onOpenChange(false);\n    setSearchTerm('');\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Select Contact</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search contacts...\"\n              className=\"pl-8\"\n              value={searchTerm}\n              onChange={e => setSearchTerm(e.target.value)}\n            />\n          </div>\n          <ScrollArea className=\"h-80\">\n            <div className=\"space-y-1\">\n              {filteredContacts.map((contact) => {\n                const derivedStatus = getDerivedStatus(contact as unknown as PublicUser);\n                const initial = contact.name.charAt(0).toUpperCase();\n                \n                return (\n                  <div\n                    key={contact.id}\n                    className={cn(\n                      \"flex items-center gap-3 p-3 rounded-md hover:bg-muted/50 cursor-pointer transition-colors\"\n                    )}\n                    onClick={() => handleSelectContact(contact)}\n                  >\n                    <div className=\"relative\">\n                      <Avatar className=\"h-10 w-10\">\n                        {contact.type === 'bot' ? (\n                          <div className=\"w-full h-full flex items-center justify-center bg-primary/20 rounded-full\">\n                            <Bot className=\"w-5 h-5 text-primary\" />\n                          </div>\n                        ) : (\n                          <AvatarImage src={contact.avatar || undefined} />\n                        )}\n                        <AvatarFallback>{initial}</AvatarFallback>\n                      </Avatar>\n                      {contact.type === 'user' && (\n                        <div className={cn(\"absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-background\", derivedStatus.color)}></div>\n                      )}\n                    </div>\n                    <div className=\"flex-1\">\n                      <p className=\"font-medium\">{contact.name}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {contact.type === 'bot' ? \"AI Assistant\" : derivedStatus.label}\n                      </p>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </ScrollArea>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":3840,"size_tokens":null},"src/ai/flows/create-call-session-flow.ts":{"content":"\n'use server';\n/**\n * @fileOverview A Genkit flow to create a WebRTC call session using Cloudflare.\n *\n * This flow securely interacts with the Cloudflare API on the backend to provision\n * a new call room and generate a session token for a client.\n */\n\nimport { z } from 'genkit';\nimport { createCfSession } from '@/services/cloudflare-service';\nimport { ai } from '@/ai/genkit';\n\nexport const CreateCallSessionInputSchema = z.object({\n  callerId: z.string().describe('The UID of the user initiating the call.'),\n  callerName: z.string().describe('The display name of the user initiating the call.'),\n});\nexport type CreateCallSessionInput = z.infer<typeof CreateCallSessionInputSchema>;\n\nexport const CreateCallSessionOutputSchema = z.object({\n  meetingId: z.string().describe(\"The unique ID for the meeting, returned by Cloudflare.\"),\n  clientToken: z.string().describe(\"The JWT token for the client to join the Cloudflare session.\"),\n});\nexport type CreateCallSessionOutput = z.infer<typeof CreateCallSessionOutputSchema>;\n\n\n/**\n * Securely creates a Cloudflare meeting and generates a participant token.\n * This function is designed to be called from the client to provision a call session.\n * @param input The caller and receiver information.\n * @returns The meeting ID and a client token for the caller.\n */\nexport async function createCallSession(input: CreateCallSessionInput): Promise<CreateCallSessionOutput> {\n    return createCallSessionFlow(input);\n}\n\nconst createCallSessionFlow = ai.defineFlow(\n    {\n        name: 'createCallSessionFlow',\n        inputSchema: CreateCallSessionInputSchema,\n        outputSchema: CreateCallSessionOutputSchema,\n    },\n    async (input) => {\n        console.log(`[Flow] Creating call session for caller: ${input.callerId}`);\n        \n        // Directly call the Cloudflare service to get the session details.\n        const { meetingId, clientToken } = await createCfSession(input.callerId, input.callerName);\n\n        console.log(`[Flow] Cloudflare session created. Meeting ID: ${meetingId}`);\n        \n        // Return the created session details.\n        return {\n            meetingId: meetingId,\n            clientToken: clientToken,\n        };\n    }\n);\n","path":null,"size_bytes":2208,"size_tokens":null},"backend/src/routes/testRoutes.ts":{"content":"import { Router } from 'express';\nimport { createTestUser } from '../controllers/testController';\n\nconst router = Router();\n\n// GET /api/test/create-user - Create test user\nrouter.get('/create-user', createTestUser);\n\nexport default router;","path":null,"size_bytes":240,"size_tokens":null},"src/components/ai-hub/translator-tool.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { translateText, TranslateTextInput } from '@/ai/flows/translate-text-flow';\nimport { ArrowRight, Loader2 } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\nconst languages = [\n  { value: 'English', label: 'English' },\n  { value: 'Spanish', label: 'Spanish' },\n  { value: 'French', label: 'French' },\n  { value: 'German', label: 'German' },\n  { value: 'Japanese', label: 'Japanese' },\n  { value: 'Chinese', label: 'Chinese' },\n  { value: 'Russian', label: 'Russian' },\n  { value: 'Korean', label: 'Korean' },\n];\n\nexport default function TranslatorTool() {\n  const [inputText, setInputText] = useState('');\n  const [translatedText, setTranslatedText] = useState('');\n  const [targetLanguage, setTargetLanguage] = useState('Spanish');\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  const handleTranslate = async () => {\n    if (!inputText.trim()) {\n      toast({\n        variant: 'destructive',\n        title: 'Input is empty',\n        description: 'Please enter text to translate.',\n      });\n      return;\n    }\n    setIsLoading(true);\n    setTranslatedText('');\n\n    try {\n      const input: TranslateTextInput = {\n        text: inputText,\n        targetLanguage,\n      };\n      const result = await translateText(input);\n      setTranslatedText(result.translatedText);\n    } catch (error) {\n      console.error('Translation failed:', error);\n      toast({\n        variant: 'destructive',\n        title: 'Translation Failed',\n        description: 'Could not translate text. Please try again.',\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col h-full border rounded-lg bg-background/30 p-4 gap-4\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 flex-1\">\n        <div className=\"flex flex-col gap-2\">\n          <label className=\"text-sm font-medium text-muted-foreground\">Source Text</label>\n          <Textarea\n            placeholder=\"Enter text to translate...\"\n            value={inputText}\n            onChange={(e) => setInputText(e.target.value)}\n            className=\"flex-1 resize-none bg-input text-base\"\n            disabled={isLoading}\n          />\n        </div>\n        <div className=\"flex flex-col gap-2\">\n           <label className=\"text-sm font-medium text-muted-foreground\">Translated Text</label>\n          <Textarea\n            placeholder=\"Translation will appear here...\"\n            value={translatedText}\n            readOnly\n            className=\"flex-1 resize-none bg-muted/50 border-border text-base\"\n          />\n        </div>\n      </div>\n      <div className=\"flex flex-col sm:flex-row items-center gap-4\">\n        <div className='flex items-center gap-2 w-full sm:w-auto'>\n            <span className=\"text-sm font-medium\">Translate to:</span>\n            <Select onValueChange={setTargetLanguage} defaultValue={targetLanguage} disabled={isLoading}>\n                <SelectTrigger className=\"w-full sm:w-[180px]\">\n                    <SelectValue placeholder=\"Select language\" />\n                </SelectTrigger>\n                <SelectContent>\n                    {languages.map(lang => (\n                        <SelectItem key={lang.value} value={lang.value}>{lang.label}</SelectItem>\n                    ))}\n                </SelectContent>\n            </Select>\n        </div>\n        <Button onClick={handleTranslate} disabled={isLoading} className=\"w-full sm:w-auto cyber-button h-12 text-lg flex-1\">\n          {isLoading ? (\n            <>\n              <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n              Translating...\n            </>\n          ) : (\n            <>\n              Translate <ArrowRight className=\"ml-2 h-5 w-5\" />\n            </>\n          )}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4060,"size_tokens":null},"src/app/layout.tsx":{"content":"\n'use client';\nimport { ReactNode, useEffect, Suspense, useState, useRef, useCallback } from 'react';\nimport { usePathname, useRouter } from 'next/navigation';\nimport { Inter, Source_Code_Pro, Space_Grotesk } from 'next/font/google';\nimport { cn } from '@/lib/utils';\nimport Header from '@/components/layout/header';\nimport { Toaster } from '@/components/ui/toaster';\nimport { FirebaseClientProvider } from '@/firebase/client-provider';\nimport '@/app/globals.css';\nimport { FirebaseErrorListener } from '@/components/FirebaseErrorListener';\nimport CoreNavHub from '@/components/layout/core-nav-hub';\nimport { CursorProvider } from '@/hooks/use-cursor';\nimport SmartCursor from '@/components/ui/custom-cursor';\nimport { CommandHubProvider } from '@/components/providers/CommandHubProvider';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport OnboardingManager from '@/components/onboarding/OnboardingManager';\nimport { useSoundPlayer } from '@/hooks/use-sound-player';\nimport { useTabEnhancer } from '@/hooks/use-tab-enhancer';\nimport { useTabCard } from '@/hooks/use-tab-card';\nimport { tabIntegration } from '@/lib/tab-integration';\nimport TabStatusIndicator from '@/components/tab-enhancer/TabStatusIndicator';\nimport BreakingNewsNotifier from '@/components/news/BreakingNewsNotifier';\nimport IncomingCallNotification from '@/components/calls/IncomingCallNotification';\nimport CallInterface from '@/components/calls/CallInterface';\nimport { useUser } from '@/hooks/use-user';\nimport { Loader2 } from 'lucide-react';\nimport { ThemeProvider, useTheme } from '@/components/providers/ThemeProvider';\nimport { appEventEmitter } from '@/lib/event-emitter';\nimport { LoadingProvider } from '@/components/providers/LoadingProvider';\nimport Loader from '@/components/layout/loader';\nimport { enableFastMode } from '@/lib/performance';\nimport { CallProvider } from '@/contexts/CallContext';\n\n\n\nconst sourceCodePro = Source_Code_Pro({\n  subsets: ['latin'],\n  variable: '--font-mono',\n});\n\nconst inter = Inter({\n  subsets: ['latin'],\n  variable: '--font-sans',\n});\n\nconst spaceGrotesk = Space_Grotesk({\n  subsets: ['latin'],\n  variable: '--font-headline',\n});\n\nconst publicRoutes = ['/login', '/signup', '/forgot-password'];\n\nfunction AppLayout({ children }: { children: ReactNode }) {\n  useSoundPlayer();\n  useTabEnhancer();\n  useTabCard();\n  const [isNavOpen, setIsNavOpen] = useState(true);\n  \n  useEffect(() => {\n    tabIntegration.start();\n    enableFastMode();\n    return () => tabIntegration.stop();\n  }, []);\n  const layoutRef = useRef<HTMLDivElement>(null);\n  const { openHub } = useCommandHub();\n  const router = useRouter();\n\n  useEffect(() => {\n    // Prefetch common routes\n    const routes = ['/apps', '/chat', '/news', '/notes', '/tasks', '/ai-hub', '/contacts', '/settings', '/profile'];\n    routes.forEach(route => router.prefetch(route));\n  }, [router]);\n\n  const handleGlobalClick = (e: MouseEvent) => {\n    appEventEmitter.emit('ui:click', e);\n  };\n\n  const handleGlobalContextMenu = useCallback((e: MouseEvent) => {\n    const targetElement = e.target as HTMLElement;\n    const isHubTrigger = targetElement.closest('[data-command-hub-trigger]');\n    appEventEmitter.emit('ui:contextmenu', e);\n    \n    if (!isHubTrigger) {\n        e.preventDefault();\n        openHub(e as unknown as React.MouseEvent, {\n            type: 'global',\n            actions: [\n                { label: 'Create Note', icon: 'StickyNote', onClick: () => router.push('/notes') },\n                { label: 'Quick Commands', icon: 'Terminal', onClick: () => alert('Quick Commands Opened'), disabled: true },\n                { label: 'Change Theme', icon: 'Palette', onClick: () => router.push('/settings'), disabled: true },\n                { label: 'Paste', icon: 'ClipboardPaste', onClick: () => {}, disabled: true },\n            ]\n        });\n    }\n  }, [openHub, router]);\n\n\n  useEffect(() => {\n    const mainLayout = layoutRef.current;\n    if (!mainLayout) return;\n\n    mainLayout.addEventListener('click', handleGlobalClick);\n    mainLayout.addEventListener('contextmenu', handleGlobalContextMenu);\n    \n    return () => {\n        mainLayout.removeEventListener('click', handleGlobalClick);\n        mainLayout.removeEventListener('contextmenu', handleGlobalContextMenu);\n    };\n  }, [handleGlobalContextMenu]);\n  \n  return (\n    <div className=\"flex h-screen overflow-hidden\" ref={layoutRef}>\n      <div data-layout-container className=\"relative flex-1 flex flex-col overflow-hidden\">\n        <Header onNavToggle={() => setIsNavOpen(prev => !prev)} isNavOpen={isNavOpen}/>\n        <main className=\"flex-1 overflow-y-auto p-3 md:p-6 lg:p-8 page-container\" role=\"main\" aria-label=\"Main content\">{children}</main>\n        <CoreNavHub isOpen={isNavOpen} constraintsRef={layoutRef} />\n        <BreakingNewsNotifier />\n        <TabStatusIndicator />\n        <IncomingCallNotification />\n        <CallInterface />\n      </div>\n    </div>\n  );\n}\n\nfunction AppInitializer({ children }: { children: ReactNode }) {\n    const { user, loading: userLoading } = useUser();\n    const router = useRouter();\n    const pathname = usePathname();\n    const [authResolved, setAuthResolved] = useState(false);\n\n    useEffect(() => {\n        if (!userLoading) {\n            const isPublic = publicRoutes.includes(pathname);\n            const isRoot = pathname === '/';\n            \n            if (user && (isPublic || isRoot)) {\n                router.replace('/apps');\n            } else if (!user && !isPublic && !isRoot) {\n                router.replace('/login');\n            } else {\n                setAuthResolved(true);\n            }\n        }\n    }, [userLoading, user, pathname, router]);\n\n    if (!authResolved) {\n        return (\n            <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-background\">\n                <div className=\"flex flex-col items-center gap-2\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n                    <p className=\"text-sm text-primary\">\n                        Loading...\n                    </p>\n                </div>\n            </div>\n        );\n    }\n    \n    const isPublic = publicRoutes.includes(pathname);\n    const isRoot = pathname === '/';\n    const isAuthenticated = !!user;\n\n    // Always show layout for authenticated users on non-public pages\n    if (isAuthenticated && !isPublic && !isRoot) {\n      return <AppLayout>{children}</AppLayout>;\n    }\n    \n    // For public pages, root page, or when user is not authenticated\n    return <>{children}</>;\n}\n\nfunction RootLayoutContent({ children }: { children: ReactNode }) {\n    return (\n        <AppInitializer>\n            {children}\n        </AppInitializer>\n    );\n}\n\nexport default function RootLayout({ children }: { children: ReactNode }) {\n  return (\n    <html lang=\"en\" suppressHydrationWarning>\n      <head>\n        <meta charSet=\"utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n        <title>AetherDash - Cyberpunk Digital Hub | AI-Powered Productivity Platform</title>\n        <meta name=\"description\" content=\"Experience the future with AetherDash - a cyberpunk-themed digital hub featuring AI assistance, real-time communication, task management, and advanced productivity tools. Built for the modern digital workspace.\" />\n        <meta name=\"keywords\" content=\"cyberpunk, digital hub, AI assistant, productivity, task management, real-time chat, video calls, note taking, file management, dashboard\" />\n        <meta name=\"author\" content=\"AetherDash Team\" />\n        <meta name=\"robots\" content=\"index, follow\" />\n        <link rel=\"canonical\" href=\"https://aetherdash.com\" />\n        \n        {/* Open Graph */}\n        <meta property=\"og:type\" content=\"website\" />\n        <meta property=\"og:title\" content=\"AetherDash - Cyberpunk Digital Hub\" />\n        <meta property=\"og:description\" content=\"Experience the future with AetherDash - a cyberpunk-themed digital hub featuring AI assistance, real-time communication, and advanced productivity tools.\" />\n        <meta property=\"og:url\" content=\"https://aetherdash.com\" />\n        <meta property=\"og:site_name\" content=\"AetherDash\" />\n        <meta property=\"og:image\" content=\"https://aetherdash.com/og-image.jpg\" />\n        <meta property=\"og:image:width\" content=\"1200\" />\n        <meta property=\"og:image:height\" content=\"630\" />\n        <meta property=\"og:locale\" content=\"en_US\" />\n        \n        {/* Twitter Card */}\n        <meta name=\"twitter:card\" content=\"summary_large_image\" />\n        <meta name=\"twitter:title\" content=\"AetherDash - Cyberpunk Digital Hub\" />\n        <meta name=\"twitter:description\" content=\"Experience the future with AetherDash - a cyberpunk-themed digital hub featuring AI assistance and productivity tools.\" />\n        <meta name=\"twitter:image\" content=\"https://aetherdash.com/og-image.jpg\" />\n        <meta name=\"twitter:creator\" content=\"@aetherdash\" />\n        \n        {/* Icons */}\n        <link rel=\"icon\" href=\"/favicon.png\" type=\"image/png\" />\n        <link rel=\"shortcut icon\" href=\"/favicon.png\" />\n        <link rel=\"apple-touch-icon\" href=\"/favicon.png\" />\n        \n        {/* PWA */}\n        <link rel=\"manifest\" href=\"/manifest.json\" />\n        <meta name=\"theme-color\" content=\"#0ea5e9\" />\n        <meta name=\"application-name\" content=\"AetherDash\" />\n        <meta name=\"mobile-web-app-capable\" content=\"yes\" />\n        <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"default\" />\n        <meta name=\"apple-mobile-web-app-title\" content=\"AetherDash\" />\n        \n        {/* Performance */}\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossOrigin=\"\" />\n        <link rel=\"dns-prefetch\" href=\"https://api.aetherdash.com\" />\n        \n        <script type=\"application/ld+json\" dangerouslySetInnerHTML={{\n          __html: JSON.stringify({\n            '@context': 'https://schema.org',\n            '@type': 'WebApplication',\n            'name': 'AetherDash',\n            'description': 'A cyberpunk-themed digital hub featuring AI assistance, real-time communication, and advanced productivity tools.',\n            'url': 'https://aetherdash.com',\n            'applicationCategory': 'ProductivityApplication',\n            'operatingSystem': 'Web Browser',\n            'offers': {\n              '@type': 'Offer',\n              'price': '0',\n              'priceCurrency': 'USD'\n            },\n            'author': {\n              '@type': 'Organization',\n              'name': 'AetherDash Team'\n            },\n            'screenshot': 'https://aetherdash.com/screenshot.jpg',\n            'featureList': [\n              'AI Assistant',\n              'Real-time Chat',\n              'Video Calls',\n              'Task Management',\n              'Note Taking',\n              'File Management',\n              'Dashboard Analytics'\n            ]\n          })\n        }} />\n      </head>\n      <body className={cn('min-h-screen font-sans antialiased no-scrollbar overflow-hidden', inter.variable, sourceCodePro.variable, spaceGrotesk.variable)} suppressHydrationWarning>\n        <FirebaseClientProvider>\n          <LoadingProvider>\n            <ThemeProvider>\n              <CallProvider>\n                <CursorProvider>\n                  <CommandHubProvider>\n                   <RootLayoutContent>{children}</RootLayoutContent>\n                    <Toaster />\n                    <FirebaseErrorListener />\n                    <SmartCursor />\n                    <OnboardingManager />\n                    <Loader />\n\n                  </CommandHubProvider>\n                </CursorProvider>\n              </CallProvider>\n            </ThemeProvider>\n          </LoadingProvider>\n        </FirebaseClientProvider>\n      </body>\n    </html>\n  );\n}\n","path":null,"size_bytes":11852,"size_tokens":null},"src/components/ui/tabs.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }","path":null,"size_bytes":1896,"size_tokens":null},"src/lib/tab-enhancer.ts":{"content":"'use client';\n\ninterface TabState {\n  title: string;\n  favicon: string;\n  color: string;\n  isActive: boolean;\n  notifications: number;\n}\n\nclass TabEnhancer {\n  private originalTitle: string = '';\n  private originalFavicon: string = '';\n  private isBlinking: boolean = false;\n  private blinkInterval: NodeJS.Timeout | null = null;\n  private colorInterval: NodeJS.Timeout | null = null;\n  private canvas: HTMLCanvasElement | null = null;\n  private ctx: CanvasRenderingContext2D | null = null;\n\n  constructor() {\n    if (typeof window !== 'undefined') {\n      this.originalTitle = document.title;\n      this.originalFavicon = this.getCurrentFavicon();\n      this.setupCanvas();\n      this.initVisibilityListener();\n    }\n  }\n\n  private setupCanvas() {\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = 32;\n    this.canvas.height = 32;\n    this.ctx = this.canvas.getContext('2d');\n  }\n\n  private getCurrentFavicon(): string {\n    const link = document.querySelector('link[rel*=\"icon\"]') as HTMLLinkElement;\n    return link?.href || '/favicon.ico';\n  }\n\n  private setFavicon(dataUrl: string) {\n    let link = document.querySelector('link[rel*=\"icon\"]') as HTMLLinkElement;\n    if (!link) {\n      link = document.createElement('link');\n      link.rel = 'icon';\n      document.head.appendChild(link);\n    }\n    link.href = dataUrl;\n  }\n\n  private generateDynamicFavicon(color: string, pulse: boolean = false, notification: number = 0): string {\n    if (!this.ctx || !this.canvas) return this.originalFavicon;\n\n    this.ctx.clearRect(0, 0, 32, 32);\n    \n    // Cyberpunk hexagon base\n    this.ctx.fillStyle = color;\n    this.ctx.beginPath();\n    for (let i = 0; i < 6; i++) {\n      const angle = (i * Math.PI) / 3;\n      const x = 16 + 12 * Math.cos(angle);\n      const y = 16 + 12 * Math.sin(angle);\n      if (i === 0) this.ctx.moveTo(x, y);\n      else this.ctx.lineTo(x, y);\n    }\n    this.ctx.closePath();\n    this.ctx.fill();\n\n    // Glow effect\n    if (pulse) {\n      this.ctx.shadowColor = color;\n      this.ctx.shadowBlur = 8;\n      this.ctx.strokeStyle = color;\n      this.ctx.lineWidth = 2;\n      this.ctx.stroke();\n    }\n\n    // Center dot\n    this.ctx.fillStyle = '#ffffff';\n    this.ctx.beginPath();\n    this.ctx.arc(16, 16, 3, 0, Math.PI * 2);\n    this.ctx.fill();\n\n    // Notification badge\n    if (notification > 0) {\n      this.ctx.fillStyle = '#ff0066';\n      this.ctx.beginPath();\n      this.ctx.arc(24, 8, 6, 0, Math.PI * 2);\n      this.ctx.fill();\n      \n      this.ctx.fillStyle = '#ffffff';\n      this.ctx.font = '8px Arial';\n      this.ctx.textAlign = 'center';\n      this.ctx.fillText(notification > 9 ? '9+' : notification.toString(), 24, 11);\n    }\n\n    return this.canvas.toDataURL();\n  }\n\n  // Dynamic title with effects\n  setTitle(title: string, effect?: 'typing' | 'glitch' | 'pulse') {\n    if (effect === 'typing') {\n      this.typewriterTitle(title);\n    } else if (effect === 'glitch') {\n      this.glitchTitle(title);\n    } else if (effect === 'pulse') {\n      this.pulseTitle(title);\n    } else {\n      document.title = title;\n    }\n  }\n\n  private typewriterTitle(fullTitle: string) {\n    let i = 0;\n    const interval = setInterval(() => {\n      document.title = fullTitle.substring(0, i + 1) + (i < fullTitle.length ? '|' : '');\n      i++;\n      if (i > fullTitle.length + 1) {\n        clearInterval(interval);\n        document.title = fullTitle;\n      }\n    }, 100);\n  }\n\n  private glitchTitle(title: string) {\n    const glitchChars = '!@#$%^&*()_+-=[]{}|;:,.<>?';\n    let glitchCount = 0;\n    const interval = setInterval(() => {\n      if (glitchCount < 5) {\n        const glitched = title.split('').map(char => \n          Math.random() < 0.3 ? glitchChars[Math.floor(Math.random() * glitchChars.length)] : char\n        ).join('');\n        document.title = glitched;\n        glitchCount++;\n      } else {\n        document.title = title;\n        clearInterval(interval);\n      }\n    }, 80);\n  }\n\n  private pulseTitle(title: string) {\n    let count = 0;\n    const interval = setInterval(() => {\n      document.title = count % 2 === 0 ? `◆ ${title} ◆` : `◇ ${title} ◇`;\n      count++;\n      if (count > 6) {\n        document.title = title;\n        clearInterval(interval);\n      }\n    }, 300);\n  }\n\n  // Color cycling favicon\n  startColorCycle(colors: string[] = ['#00ffff', '#ff00ff', '#ffff00', '#00ff00']) {\n    if (this.colorInterval) clearInterval(this.colorInterval);\n    \n    let colorIndex = 0;\n    this.colorInterval = setInterval(() => {\n      const favicon = this.generateDynamicFavicon(colors[colorIndex], true);\n      this.setFavicon(favicon);\n      colorIndex = (colorIndex + 1) % colors.length;\n    }, 1000);\n  }\n\n  stopColorCycle() {\n    if (this.colorInterval) {\n      clearInterval(this.colorInterval);\n      this.colorInterval = null;\n    }\n  }\n\n  // Notification system\n  showNotification(count: number, color: string = '#ff0066') {\n    const favicon = this.generateDynamicFavicon(color, true, count);\n    this.setFavicon(favicon);\n    \n    // Blink title\n    this.startTitleBlink(`(${count}) ${this.originalTitle}`);\n  }\n\n  private startTitleBlink(notificationTitle: string) {\n    if (this.blinkInterval) clearInterval(this.blinkInterval);\n    \n    let isOriginal = true;\n    this.blinkInterval = setInterval(() => {\n      document.title = isOriginal ? notificationTitle : this.originalTitle;\n      isOriginal = !isOriginal;\n    }, 1000);\n  }\n\n  clearNotification() {\n    if (this.blinkInterval) {\n      clearInterval(this.blinkInterval);\n      this.blinkInterval = null;\n    }\n    document.title = this.originalTitle;\n    this.setFavicon(this.generateDynamicFavicon('#00ffff'));\n  }\n\n  // Tab visibility effects\n  private initVisibilityListener() {\n    document.addEventListener('visibilitychange', () => {\n      if (document.hidden) {\n        this.setTitle('Come back! 👋', 'pulse');\n        this.startColorCycle(['#ff6b6b', '#4ecdc4', '#45b7d1']);\n      } else {\n        this.stopColorCycle();\n        this.clearNotification();\n        this.setTitle(this.originalTitle);\n      }\n    });\n  }\n\n  // Page activity indicators\n  setActivity(type: 'loading' | 'error' | 'success' | 'warning') {\n    const configs = {\n      loading: { color: '#ffd700', title: '⚡ Loading...', pulse: true },\n      error: { color: '#ff4757', title: '❌ Error', pulse: false },\n      success: { color: '#2ed573', title: '✅ Success', pulse: false },\n      warning: { color: '#ffa502', title: '⚠️ Warning', pulse: true }\n    };\n    \n    const config = configs[type];\n    this.setFavicon(this.generateDynamicFavicon(config.color, config.pulse));\n    this.setTitle(config.title, 'glitch');\n    \n    // Auto-reset after 3 seconds\n    setTimeout(() => {\n      this.reset();\n    }, 3000);\n  }\n\n  // Hover simulation (when tab is focused)\n  simulateHover() {\n    const colors = ['#ff0080', '#0080ff', '#80ff00', '#ff8000'];\n    let i = 0;\n    const hoverInterval = setInterval(() => {\n      this.setFavicon(this.generateDynamicFavicon(colors[i % colors.length], true));\n      i++;\n      if (i > 8) {\n        clearInterval(hoverInterval);\n        this.reset();\n      }\n    }, 200);\n  }\n\n  // Reset to original state\n  reset() {\n    this.stopColorCycle();\n    this.clearNotification();\n    document.title = this.originalTitle;\n    this.setFavicon(this.generateDynamicFavicon('#00ffff'));\n  }\n\n  // Advanced: Tab breathing effect\n  startBreathing() {\n    let intensity = 0;\n    const breatheInterval = setInterval(() => {\n      const alpha = (Math.sin(intensity) + 1) / 2;\n      const color = `rgba(0, 255, 255, ${alpha})`;\n      this.setFavicon(this.generateDynamicFavicon(color, true));\n      intensity += 0.2;\n    }, 100);\n    \n    // Stop after 10 seconds\n    setTimeout(() => clearInterval(breatheInterval), 10000);\n  }\n}\n\nexport const tabEnhancer = new TabEnhancer();","path":null,"size_bytes":7833,"size_tokens":null},"src/app/forgot-password/page.tsx":{"content":"\n'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { sendPasswordResetEmail } from 'firebase/auth';\nimport { useAuth } from '@/firebase/provider';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport Link from 'next/link';\nimport { Loader2 } from 'lucide-react';\n\nexport default function ForgotPasswordPage() {\n  const auth = useAuth();\n  const router = useRouter();\n  const { toast } = useToast();\n  const [email, setEmail] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const handleResetPassword = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    try {\n      await sendPasswordResetEmail(auth, email);\n      toast({\n        title: 'Recovery Link Sent',\n        description: 'Check your email inbox to reset your passphrase.',\n      });\n      router.push('/login');\n    } catch (error: any) {\n      toast({\n        variant: 'destructive',\n        title: 'Request Failed',\n        description: error.message,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-full p-4\">\n      <Card className=\"w-full max-w-md animate-hologram-fade\">\n        <CardHeader className=\"text-center\">\n          <CardTitle className=\"font-headline text-3xl text-glow\">Passphrase Recovery</CardTitle>\n          <CardDescription>Initiate secure recovery protocol.</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleResetPassword} className=\"space-y-6\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Neural Interface ID (Email)</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"operator@aether.corp\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                className=\"bg-input\"\n              />\n            </div>\n            <Button type=\"submit\" className=\"w-full cyber-button h-12 text-lg\" disabled={loading}>\n              {loading ? <><Loader2 className=\"animate-spin\" /> Sending Link...</> : 'Send Recovery Link'}\n            </Button>\n          </form>\n          <p className=\"text-center text-sm text-muted-foreground mt-6\">\n            Remembered your passphrase?{' '}\n            <Link href=\"/login\" className=\"text-primary hover:underline\">\n              Return to Login\n            </Link>\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":2785,"size_tokens":null},"src/lib/placeholder-images.ts":{"content":"import data from './placeholder-images.json';\n\nexport type ImagePlaceholder = {\n  id: string;\n  description: string;\n  imageUrl: string;\n  imageHint: string;\n};\n\nexport const PlaceHolderImages: ImagePlaceholder[] = data.placeholderImages;\n","path":null,"size_bytes":239,"size_tokens":null},"src/components/providers/CommandHubProvider.tsx":{"content":"'use client';\nimport {\n  CommandHubProvider as Provider,\n  CommandHubContextType,\n} from '@/hooks/use-command-hub';\nimport CommandHub from '@/components/ui/command-hub';\nimport { ReactNode, useState, useCallback, useMemo, useEffect } from 'react';\nimport { CommandHubAction } from '@/hooks/use-command-hub';\nimport { appEventEmitter } from '@/lib/event-emitter';\nimport InvitePeopleModal from '../modals/InvitePeopleModal';\nimport CreateOrJoinSpaceModal from '../modals/CreateOrJoinSpaceModal';\nimport SpaceSettingsModal from '../modals/SpaceSettingsModal';\n\ntype ModalType = 'invite-people' | 'create-join-space' | 'space-settings';\n\nexport function CommandHubProvider({ children }: { children: ReactNode }) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [actions, setActions] = useState<CommandHubAction[]>([]);\n  const [contextType, setContextType] = useState<string | null>(null);\n  const [data, setData] = useState<any>(null);\n  const [targetElement, setTargetElement] = useState<HTMLElement | null>(null);\n  const [loadingAction, setLoadingAction] = useState<string | null>(null);\n\n  // Modal State\n  const [activeModal, setActiveModal] = useState<ModalType | null>(null);\n  const [modalData, setModalData] = useState<any>(null);\n\n  const closeHub = useCallback(() => {\n    if (isOpen) {\n      appEventEmitter.emit('ui:sound', 'hub-close');\n      setIsOpen(false);\n      // Delay clearing to allow for exit animation\n      setTimeout(() => {\n        setActions([]);\n        setContextType(null);\n        setData(null);\n        setTargetElement(null);\n      }, 300);\n    }\n  }, [isOpen]);\n\n  const getContextActions = useCallback((type: string, data?: any): CommandHubAction[] => {\n    switch (type) {\n      case 'text':\n        return [\n          { label: 'Copy', icon: 'Copy', onClick: () => navigator.clipboard.writeText(data?.text || '') },\n          { label: 'Cut', icon: 'Scissors', onClick: () => console.log('Cut text') },\n          { separator: true },\n          { label: 'Select All', icon: 'MousePointer', onClick: () => document.execCommand('selectAll') }\n        ];\n      case 'image':\n        return [\n          { label: 'Copy Image', icon: 'Copy', onClick: () => console.log('Copy image') },\n          { label: 'Download', icon: 'Download', onClick: () => data?.download?.() },\n          { label: 'Share', icon: 'Share', onClick: () => console.log('Share image') },\n          { separator: true },\n          { label: 'Properties', icon: 'Info', onClick: () => console.log('Image properties') }\n        ];\n      case 'user':\n        return [\n          { label: 'View Profile', icon: 'User', onClick: async () => {\n            setLoadingAction('View Profile');\n            await new Promise(resolve => setTimeout(resolve, 500));\n            data?.viewProfile?.();\n            setLoadingAction(null);\n          }},\n          { label: 'Send Message', icon: 'MessageSquare', onClick: async () => {\n            setLoadingAction('Send Message');\n            await new Promise(resolve => setTimeout(resolve, 300));\n            data?.sendMessage?.();\n            setLoadingAction(null);\n          }},\n          { label: 'Voice Call', icon: 'Phone', onClick: async () => {\n            setLoadingAction('Voice Call');\n            await new Promise(resolve => setTimeout(resolve, 800));\n            data?.voiceCall?.();\n            setLoadingAction(null);\n          }},\n          { label: 'Video Call', icon: 'Video', onClick: async () => {\n            setLoadingAction('Video Call');\n            await new Promise(resolve => setTimeout(resolve, 800));\n            data?.videoCall?.();\n            setLoadingAction(null);\n          }},\n          { separator: true },\n          { label: 'Add Friend', icon: 'UserPlus', onClick: async () => {\n            setLoadingAction('Add Friend');\n            await new Promise(resolve => setTimeout(resolve, 600));\n            data?.addFriend?.();\n            setLoadingAction(null);\n          }, disabled: data?.isFriend },\n          { label: 'Create Group', icon: 'Users', onClick: async () => {\n            setLoadingAction('Create Group');\n            await new Promise(resolve => setTimeout(resolve, 400));\n            data?.createGroup?.();\n            setLoadingAction(null);\n          }},\n          { separator: true },\n          { label: 'Mute User', icon: 'VolumeX', onClick: async () => {\n            setLoadingAction('Mute User');\n            await new Promise(resolve => setTimeout(resolve, 300));\n            data?.muteUser?.();\n            setLoadingAction(null);\n          }},\n          { label: 'Pin Chat', icon: 'Pin', onClick: async () => {\n            setLoadingAction('Pin Chat');\n            await new Promise(resolve => setTimeout(resolve, 300));\n            data?.pinChat?.();\n            setLoadingAction(null);\n          }},\n          { separator: true },\n          { label: 'Block User', icon: 'UserX', onClick: async () => {\n            setLoadingAction('Block User');\n            await new Promise(resolve => setTimeout(resolve, 500));\n            data?.blockUser?.();\n            setLoadingAction(null);\n          }, isDestructive: true },\n          { label: 'Report User', icon: 'Flag', onClick: async () => {\n            setLoadingAction('Report User');\n            await new Promise(resolve => setTimeout(resolve, 700));\n            data?.reportUser?.();\n            setLoadingAction(null);\n          }, isDestructive: true }\n        ];\n      case 'message':\n        return [\n          { label: 'Reply', icon: 'Reply', onClick: () => data?.reply?.() },\n          { label: 'Copy Text', icon: 'Copy', onClick: () => navigator.clipboard.writeText(data?.text || '') },\n          { label: 'Edit', icon: 'Edit', onClick: () => data?.edit?.(), disabled: !data?.canEdit },\n          { separator: true },\n          { label: 'Delete', icon: 'Trash', onClick: () => data?.delete?.(), disabled: !data?.canDelete, isDestructive: true }\n        ];\n      case 'file':\n        return [\n          { label: 'Download', icon: 'Download', onClick: () => data?.download?.() },\n          { label: 'Share', icon: 'Share', onClick: () => data?.share?.() },\n          { label: 'Rename', icon: 'Edit', onClick: () => data?.rename?.() },\n          { separator: true },\n          { label: 'Delete', icon: 'Trash', onClick: () => data?.delete?.(), isDestructive: true },\n          { label: 'Properties', icon: 'Info', onClick: () => data?.properties?.() }\n        ];\n      default:\n        return [];\n    }\n  }, []);\n\n  const openHub = useCallback(\n    (\n      event: React.MouseEvent,\n      context: { type: string; actions?: CommandHubAction[]; data?: any }\n    ) => {\n      event.preventDefault();\n      event.stopPropagation();\n      appEventEmitter.emit('ui:sound', 'hub-open');\n\n      setPosition({ x: event.clientX, y: event.clientY });\n      const contextActions = context.actions || getContextActions(context.type, context.data);\n      setActions(contextActions);\n      setContextType(context.type);\n      setData(context.data);\n      setIsOpen(true);\n    },\n    [getContextActions]\n  );\n\n  const openModal = useCallback((modal: ModalType, data?: any) => {\n    setActiveModal(modal);\n    setModalData(data);\n    closeHub(); // Close context menu when opening a modal\n  }, [closeHub]);\n\n  const closeModal = useCallback(() => {\n    setActiveModal(null);\n    setModalData(null);\n  }, []);\n\n  // Removed scroll listener to prevent menu from closing when scrolling\n\n  const contextValue = useMemo<CommandHubContextType>(\n    () => ({\n      isOpen,\n      position,\n      actions,\n      contextType,\n      data,\n      targetElement,\n      openHub,\n      closeHub,\n      setTargetElement,\n      openModal,\n      closeModal,\n      getContextActions,\n      loadingAction,\n    }),\n    [\n      isOpen,\n      position,\n      actions,\n      contextType,\n      data,\n      targetElement,\n      openHub,\n      closeHub,\n      openModal,\n      closeModal,\n      getContextActions,\n      loadingAction,\n    ]\n  );\n\n  return (\n    <Provider value={contextValue}>\n      {children}\n      <CommandHub />\n      {activeModal === 'invite-people' && (\n        <InvitePeopleModal\n          isOpen={true}\n          onOpenChange={(open) => !open && closeModal()}\n          space={modalData}\n        />\n      )}\n       {activeModal === 'create-join-space' && (\n        <CreateOrJoinSpaceModal\n          isOpen={true}\n          onOpenChange={(open) => !open && closeModal()}\n        />\n      )}\n       {activeModal === 'space-settings' && (\n        <SpaceSettingsModal\n          isOpen={true}\n          onOpenChange={(open) => !open && closeModal()}\n          space={modalData}\n        />\n      )}\n    </Provider>\n  );\n}\n","path":null,"size_bytes":8719,"size_tokens":null},"netlify.toml":{"content":"[build]\n  command = \"npm run build\"\n  publish = \".next\"\n\n[build.environment]\n  NODE_VERSION = \"20\"\n  NETLIFY_NEXT_PLUGIN_SKIP = \"true\"\n","path":null,"size_bytes":135,"size_tokens":null},"src/components/layout/core-nav-hub.tsx":{"content":"\n'use client';\n\nimport {\n  Award,\n  Box,\n  BrainCircuit,\n  CheckSquare,\n  Cloud,\n  Gamepad2,\n  Home,\n  LayoutGrid,\n  Loader2,\n  MessageSquare,\n  Newspaper,\n  ShoppingBag,\n  StickyNote,\n  User,\n  Users,\n} from 'lucide-react';\nimport { usePathname, useRouter } from 'next/navigation';\nimport { motion, useAnimation, useMotionValue, useTransform, AnimatePresence } from 'framer-motion';\nimport React, { useState, useEffect, Suspense } from 'react';\nimport { useUser } from '@/hooks/use-user';\nimport Link from 'next/link';\nimport { cn } from '@/lib/utils';\nimport { Avatar, AvatarFallback, AvatarImage } from '../ui/avatar';\nimport { useCursor } from '@/hooks/use-cursor';\n\nconst navItems = [\n  { href: '/apps', label: 'Apps', icon: LayoutGrid },\n  { href: '/chat', label: 'Chat', icon: MessageSquare },\n  { href: '#gaming', label: 'Gaming', icon: Gamepad2, disabled: true, comingSoon: true },\n  { href: '#news', label: 'News', icon: Newspaper, disabled: true, comingSoon: true },\n  { href: '/notes', label: 'Notes', icon: StickyNote },\n  { href: '/tasks', label: 'Tasks', icon: CheckSquare },\n  { href: '/store', label: 'Store', icon: ShoppingBag },\n  { href: '/inventory', label: 'Inventory', icon: Box },\n  { href: '/contacts', label: 'Contacts', icon: Users },\n  { href: '/earnings', label: 'Earnings', icon: Award },\n  { href: '/ai-hub', label: 'AI Hub', icon: BrainCircuit },\n  { href: '/weather', label: 'Weather', icon: Cloud },\n];\n\ninterface CoreNavHubProps {\n  isOpen: boolean;\n  constraintsRef: React.RefObject<HTMLDivElement>;\n}\n\nconst CoreNavHub = ({ isOpen, constraintsRef }: CoreNavHubProps) => {\n  const { profile, user } = useUser();\n  const router = useRouter();\n  const { setCursorMode } = useCursor();\n  const pathname = usePathname();\n  const [loadingHref, setLoadingHref] = useState<string | null>(null);\n  const [hoveredItem, setHoveredItem] = useState<{ x: number, y: number, label: string } | null>(null);\n\n  const x = useMotionValue(0);\n  const y = useMotionValue(0);\n\n  const rotateX = useTransform(y, [-300, 300], [10, -10]);\n  const rotateY = useTransform(x, [-300, 300], [-10, 10]);\n  \n  const [isDragging, setIsDragging] = useState(false);\n  const [avatarLoading, setAvatarLoading] = useState(false);\n\n  const handleMouseMove = (event: React.MouseEvent) => {\n    const rect = event.currentTarget.getBoundingClientRect();\n    x.set(event.clientX - rect.left - rect.width / 2);\n    y.set(event.clientY - rect.top - rect.height / 2);\n  };\n\n  const handleMouseLeave = () => {\n    x.set(0);\n    y.set(0);\n  };\n  \n  useEffect(() => {\n    setLoadingHref(null);\n    setAvatarLoading(false);\n  }, [pathname]);\n\n  useEffect(() => {\n    // Prefetch all routes on mount\n    navItems.forEach(item => {\n      if (!item.disabled) router.prefetch(item.href);\n    });\n  }, [router]);\n\n  const handleLinkClick = (href: string) => {\n    if (pathname !== href) {\n      setLoadingHref(href);\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 1, scale: 1 }}\n          exit={{ opacity: 0, scale: 0.8 }}\n          transition={{ type: 'spring', stiffness: 260, damping: 20 }}\n          drag\n          dragConstraints={constraintsRef}\n          onDragStart={() => {\n            setCursorMode('drag', 'Drag');\n            setIsDragging(true);\n          }}\n          onDragEnd={() => {\n            setCursorMode('default');\n            setIsDragging(false);\n          }}\n          dragTransition={{ bounceStiffness: 300, bounceDamping: 15 }}\n          dragElastic={0.1}\n          onMouseMove={!isDragging ? handleMouseMove : undefined}\n          onMouseLeave={handleMouseLeave}\n          style={{ \n            rotateX: isDragging ? 0 : rotateX, \n            rotateY: isDragging ? 0 : rotateY, \n            transformStyle: 'preserve-3d',\n            willChange: isDragging ? 'transform' : 'auto'\n          }}\n          className=\"fixed top-1/2 left-1/2 w-80 h-80 md:w-96 md:h-96\"\n        >\n          <motion.div\n            className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-2\"\n            style={{ transformStyle: 'preserve-3d' }}\n          >\n            <Link href=\"/settings\" onClick={() => setAvatarLoading(true)}>\n              <motion.div\n                onMouseEnter={() => setCursorMode('link')}\n                onMouseLeave={() => setCursorMode('default')}\n                className=\"relative\"\n              >\n                <Avatar className=\"w-16 h-16 md:w-20 md:h-20 border-4 border-primary neon-glow-primary\">\n                  <AvatarImage src={profile?.photoURL || ''} />\n                  <AvatarFallback>{profile?.displayName?.charAt(0) || 'U'}</AvatarFallback>\n                </Avatar>\n                {avatarLoading && (\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-background/80 rounded-full\">\n                    <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\n                  </div>\n                )}\n              </motion.div>\n            </Link>\n          </motion.div>\n          \n          <svg className=\"absolute inset-0 w-full h-full pointer-events-none\" viewBox=\"0 0 100 100\">\n              <defs>\n                <linearGradient id=\"xpGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                  <stop offset=\"0%\" stopColor=\"hsl(var(--primary))\" stopOpacity=\"0.8\" />\n                  <stop offset=\"50%\" stopColor=\"hsl(var(--primary))\" stopOpacity=\"1\" />\n                  <stop offset=\"100%\" stopColor=\"hsl(var(--primary))\" stopOpacity=\"0.6\" />\n                </linearGradient>\n                <filter id=\"glow\">\n                  <feGaussianBlur stdDeviation=\"3\" result=\"coloredBlur\"/>\n                  <feMerge> \n                    <feMergeNode in=\"coloredBlur\"/>\n                    <feMergeNode in=\"SourceGraphic\"/>\n                  </feMerge>\n                </filter>\n              </defs>\n              <motion.circle\n                  cx=\"50\" cy=\"50\" r=\"40\"\n                  stroke=\"hsl(var(--primary) / 0.2)\"\n                  strokeWidth=\"1\"\n                  fill=\"none\"\n                  strokeDasharray=\"2 4\"\n                  animate={{ rotate: 360 }}\n                  transition={{ duration: 20, repeat: Infinity, ease: 'linear' }}\n              />\n              <motion.circle\n                  cx=\"50\" cy=\"50\" r=\"40\"\n                  stroke=\"url(#xpGradient)\"\n                  strokeWidth=\"3\"\n                  fill=\"none\"\n                  strokeDasharray={2 * Math.PI * 40}\n                  strokeDashoffset={2 * Math.PI * 40 * (1 - (profile?.xp ?? 100) / ((profile?.level ?? 1) * 1000 + 1000))}\n                  transform=\"rotate(-90 50 50)\"\n                  filter=\"url(#glow)\"\n                  strokeLinecap=\"round\"\n                  animate={{ \n                    strokeDashoffset: [2 * Math.PI * 40 * (1 - (profile?.xp ?? 100) / ((profile?.level ?? 1) * 1000 + 1000)), 2 * Math.PI * 40 * (1 - (profile?.xp ?? 100) / ((profile?.level ?? 1) * 1000 + 1000)) - 10, 2 * Math.PI * 40 * (1 - (profile?.xp ?? 100) / ((profile?.level ?? 1) * 1000 + 1000))]\n                  }}\n                  transition={{ duration: 2, repeat: Infinity, ease: 'easeInOut' }}\n              />\n          </svg>\n\n          <motion.div\n              className=\"w-full h-full\"\n              style={{ transformStyle: 'preserve-3d' }}\n          >\n            {navItems.map((item, index) => {\n              const angle = (index / navItems.length) * 2 * Math.PI;\n              const radius = window.innerWidth < 768 ? 110 : 130;\n              const itemX = radius * Math.cos(angle);\n              const itemY = radius * Math.sin(angle);\n              const isActive = pathname.startsWith(item.href) && (item.href !== '/apps' || pathname === '/apps');\n              const isLoading = loadingHref === item.href;\n\n              const content = (\n                  <motion.div\n                      className={cn(\n                          \"absolute top-1/2 left-1/2 p-3 rounded-full flex items-center justify-center pointer-events-auto backdrop-blur-md border\",\n                          isActive \n                            ? 'bg-gradient-to-br from-primary/30 to-primary/10 border-primary shadow-[0_0_20px_hsl(var(--primary)/0.5)] text-primary' \n                            : 'bg-gradient-to-br from-background/60 to-background/20 border-border/30 hover:border-primary/50 text-muted-foreground hover:text-primary'\n                      )}\n                      style={{\n                          x: itemX - (window.innerWidth < 768 ? 20 : 24),\n                          y: itemY - (window.innerWidth < 768 ? 20 : 24),\n                      }}\n                      whileHover={!isDragging ? { \n                        scale: 1.3, \n                        y: itemY - 37, \n                        x: itemX - 24, \n                        boxShadow: '0 0 30px hsl(var(--primary)/0.8), inset 0 0 20px hsl(var(--primary)/0.1)',\n                        rotate: 360\n                      } : {}}\n                      whileTap={{ scale: 0.9 }}\n                      transition={{ type: 'spring', stiffness: 400, damping: 17 }}\n                      onMouseEnter={() => {\n                        if (!isDragging) {\n                          const label = item.comingSoon ? `${item.label} - Coming Soon` : item.label;\n                          setHoveredItem({ x: itemX, y: itemY, label });\n                          setCursorMode(item.disabled ? 'default' : 'link');\n                        }\n                      }}\n                      onMouseLeave={() => {\n                        setHoveredItem(null)\n                        setCursorMode('default');\n                      }}\n                  >\n                      {isLoading ? (\n                        <Loader2 className=\"w-5 h-5 animate-spin text-primary\" />\n                      ) : (\n                        <motion.div\n                          whileHover={!isDragging ? { rotate: 15, scale: 1.1 } : {}}\n                          transition={{ type: 'spring', stiffness: 300 }}\n                        >\n                          <item.icon className=\"w-4 h-4 md:w-5 md:h-5\" />\n                        </motion.div>\n                      )}\n                  </motion.div>\n              );\n              \n              return item.disabled ? (\n                <div key={item.href}>{content}</div>\n              ) : (\n                <Link key={item.href} href={item.href} onClick={() => handleLinkClick(item.href)}>{content}</Link>\n              );\n            })}\n          </motion.div>\n\n          <AnimatePresence>\n              {hoveredItem && (\n                  <motion.div\n                      initial={{ opacity: 0, scale: 0.8, y: 10 }}\n                      animate={{ opacity: 1, scale: 1, y: 0 }}\n                      exit={{ opacity: 0, scale: 0.8, y: 10 }}\n                      transition={{ type: 'spring', stiffness: 400, damping: 25 }}\n                      style={{\n                          x: hoveredItem.x,\n                          y: hoveredItem.y - 70,\n                      }}\n                      className=\"absolute top-1/2 left-1/2 bg-gradient-to-r from-primary/90 to-primary/70 text-primary-foreground text-sm font-mono px-4 py-2 rounded-lg shadow-[0_0_20px_hsl(var(--primary)/0.5)] border border-primary/30 backdrop-blur-sm pointer-events-none\"\n                  >\n                      <motion.span\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ delay: 0.1 }}\n                      >\n                        {hoveredItem.label}\n                      </motion.span>\n                      <div className=\"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-gradient-to-r from-primary/90 to-primary/70 rotate-45 border-r border-b border-primary/30\"></div>\n                  </motion.div>\n              )}\n          </AnimatePresence>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n};\n\nconst SuspendedCoreNavHub = (props: CoreNavHubProps) => (\n    <Suspense fallback={null}>\n        <CoreNavHub {...props} />\n    </Suspense>\n)\n\nexport default SuspendedCoreNavHub;\n\n    ","path":null,"size_bytes":12221,"size_tokens":null},"src/lib/tab-integration.ts":{"content":"'use client';\n\nimport { tabEnhancer } from './tab-enhancer';\nimport { tabCardEnhancer } from './tab-card-enhancer';\n\nclass TabIntegration {\n  private isActive: boolean = false;\n\n  start() {\n    if (this.isActive) return;\n    this.isActive = true;\n\n    // Auto-detect page activities and respond with both systems\n    this.setupActivityDetection();\n    this.setupNotificationDetection();\n    this.setupRouteChangeDetection();\n  }\n\n  private setupActivityDetection() {\n    // Loading states\n    const originalFetch = window.fetch;\n    window.fetch = async (...args) => {\n      tabEnhancer.setActivity('loading');\n      tabCardEnhancer.setActivity('loading');\n      \n      try {\n        const response = await originalFetch(...args);\n        if (response.ok) {\n          tabEnhancer.setActivity('success');\n          tabCardEnhancer.setActivity('success');\n        } else {\n          tabEnhancer.setActivity('error');\n          tabCardEnhancer.setActivity('error');\n        }\n        return response;\n      } catch (error) {\n        tabEnhancer.setActivity('error');\n        tabCardEnhancer.setActivity('error');\n        throw error;\n      }\n    };\n\n    // Error detection\n    window.addEventListener('error', () => {\n      tabEnhancer.setActivity('error');\n      tabCardEnhancer.setActivity('error');\n    });\n  }\n\n  private setupNotificationDetection() {\n    // Watch for toast/notification elements\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        mutation.addedNodes.forEach((node) => {\n          if (node.nodeType === Node.ELEMENT_NODE) {\n            const element = node as Element;\n            if (element.matches('.toast, .notification, [data-sonner-toast]')) {\n              tabEnhancer.showNotification(1);\n              tabCardEnhancer.flashNotification(2);\n            }\n          }\n        });\n      });\n    });\n\n    observer.observe(document.body, { childList: true, subtree: true });\n  }\n\n  private setupRouteChangeDetection() {\n    let currentPath = window.location.pathname;\n    \n    const checkPathChange = () => {\n      if (window.location.pathname !== currentPath) {\n        currentPath = window.location.pathname;\n        \n        // Set page-specific colors\n        this.setPageTheme(currentPath);\n        \n        // Show loading then success\n        tabEnhancer.setActivity('loading');\n        tabCardEnhancer.setActivity('loading');\n        \n        setTimeout(() => {\n          tabEnhancer.setActivity('success');\n          tabCardEnhancer.setActivity('success');\n        }, 800);\n      }\n    };\n\n    setInterval(checkPathChange, 100);\n    window.addEventListener('popstate', checkPathChange);\n  }\n\n  private setPageTheme(path: string) {\n    const themes = {\n      '/dashboard': '#00ffff',\n      '/chat': '#ff00ff',\n      '/store': '#ffff00',\n      '/earnings': '#00ff00',\n      '/notes': '#ff8000',\n      '/settings': '#8000ff',\n      '/games': '#ff0080',\n    };\n\n    const color = themes[path as keyof typeof themes] || '#00ffff';\n    tabCardEnhancer.setColor(color);\n  }\n\n  stop() {\n    this.isActive = false;\n  }\n}\n\nexport const tabIntegration = new TabIntegration();","path":null,"size_bytes":3151,"size_tokens":null},"src/components/user/user-quick-view.tsx":{"content":"'use client';\nimport { ReactNode } from 'react';\nimport { PublicUser } from '@/hooks/use-connections';\nimport {\n  HoverCard,\n  HoverCardContent,\n  HoverCardTrigger,\n} from '@/components/ui/hover-card';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { Badge } from '@/components/ui/badge';\nimport { CalendarDays, MapPin, Link as LinkIcon } from 'lucide-react';\n\ninterface UserQuickViewProps {\n  user: PublicUser;\n  children: ReactNode;\n}\n\nexport default function UserQuickView({ user, children }: UserQuickViewProps) {\n  return (\n    <HoverCard>\n      <HoverCardTrigger asChild>\n        {children}\n      </HoverCardTrigger>\n      <HoverCardContent className=\"w-80\">\n        <div className=\"flex justify-between space-x-4\">\n          <Avatar className=\"h-16 w-16\">\n            <AvatarImage src={user.photoURL || undefined} />\n            <AvatarFallback className=\"text-lg\">\n              {user.displayName?.[0] || user.email?.[0] || 'U'}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"space-y-1 flex-1\">\n            <h4 className=\"text-sm font-semibold\">{user.displayName || 'Unknown User'}</h4>\n            <p className=\"text-sm text-muted-foreground\">@{user.username}</p>\n            {user.bio && (\n              <p className=\"text-sm\">{user.bio}</p>\n            )}\n            <div className=\"flex items-center pt-2\">\n              <CalendarDays className=\"mr-2 h-4 w-4 opacity-70\" />\n              <span className=\"text-xs text-muted-foreground\">\n                Level {user.level || 1} • {user.xp || 0} XP\n              </span>\n            </div>\n            {user.status && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {user.status}\n              </Badge>\n            )}\n          </div>\n        </div>\n      </HoverCardContent>\n    </HoverCard>\n  );\n}","path":null,"size_bytes":1861,"size_tokens":null},"src/components/ui/scroll-area.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1656,"size_tokens":null},"src/components/settings/keybind-settings.tsx":{"content":"\n'use client';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\n\nconst keybinds = [\n  { action: 'Open Command Hub', keys: ['Ctrl', 'K'] },\n  { action: 'Toggle Navigation', keys: ['Ctrl', 'B'] },\n  { action: 'New Note', keys: ['Ctrl', 'Alt', 'N'] },\n  { action: 'Push-to-Talk', keys: ['Not Set'] },\n];\n\nexport default function KeybindSettings() {\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Keybinds</CardTitle>\n        <CardDescription>Customize your keyboard shortcuts for maximum efficiency.</CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {keybinds.map((bind) => (\n          <div key={bind.action} className=\"flex items-center justify-between p-4 rounded-lg border bg-background/30\">\n            <p className=\"font-medium\">{bind.action}</p>\n            <div className=\"flex items-center gap-2\">\n              {bind.keys.map((key) => (\n                <kbd key={key} className=\"pointer-events-none inline-flex h-8 select-none items-center gap-1 rounded border bg-muted px-2 font-mono text-[14px] font-medium text-muted-foreground opacity-100\">\n                  {key}\n                </kbd>\n              ))}\n              <Button variant=\"outline\" size=\"sm\">Edit</Button>\n            </div>\n          </div>\n        ))}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1417,"size_tokens":null},"src/app/gaming/components/GamingSidebar.tsx":{"content":"\n'use client';\n\nimport React from 'react';\nimport { useRouter } from 'next/navigation';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport {\n  Mic,\n  Headphones,\n  Settings,\n  Hash,\n  Volume2,\n  Megaphone,\n  Rss,\n  PhoneOff,\n  User,\n  MessageCircle,\n  BellOff,\n  UserPlus,\n  Check,\n} from 'lucide-react';\nimport { useUser } from '@/hooks/use-user';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';\nimport { cn } from '@/lib/utils';\nimport { motion } from 'framer-motion';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useToast } from '@/hooks/use-toast';\n\nconst channels = [\n    { id: 'c1', name: '👋 welcome', category: 'INFO', type: 'text' },\n    { id: 'c2', name: '📢 announcements', category: 'INFO', type: 'announcement' },\n    { id: 'c3', name: '🚀 updates', category: 'INFO', type: 'feed' },\n    { id: 'c4', name: '# general', category: 'TEXT CHANNELS', type: 'text' },\n    { id: 'c5', name: '# off-topic', category: 'TEXT CHANNELS', type: 'text' },\n    { id: 'c6', name: '# showcase', category: 'TEXT CHANNELS', type: 'text' },\n    { id: 'c7', name: '🔊 Lobby', category: 'VOICE CHANNELS', type: 'voice' },\n    { id: 'c8', name: '🔊 Squad 1', category: 'VOICE CHANNELS', type: 'voice' },\n    { id: 'c9', name: '🔊 Music', category: 'VOICE CHANNELS', type: 'voice' },\n];\n\nconst getChannelIcon = (type: string) => {\n    switch(type) {\n        case 'text': return <Hash size={20} />;\n        case 'voice': return <Volume2 size={20} />;\n        case 'announcement': return <Megaphone size={20} />;\n        case 'feed': return <Rss size={20} />;\n        default: return <Hash size={20} />;\n    }\n}\n\nexport default function GamingSidebar() {\n  const { user, profile, updateStatus } = useUser();\n  const { openHub } = useCommandHub();\n  const { toast } = useToast();\n  const [activeChannel, setActiveChannel] = React.useState('c4');\n  const [activeVoiceChannel, setActiveVoiceChannel] = React.useState<string | null>(null);\n  const [isMuted, setIsMuted] = React.useState(false);\n  const [isDeafened, setIsDeafened] = React.useState(false);\n  const router = useRouter();\n\n  const handleVoiceChannelClick = (channelId: string) => {\n    setActiveVoiceChannel(prev => prev === channelId ? null : channelId);\n  }\n\n  const handleUserPanelContextMenu = (e: React.MouseEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      openHub(e, {\n          type: 'gaming-user-panel',\n          actions: [\n              { label: 'Online', icon: 'Circle', onClick: () => updateStatus('Online')},\n              { label: 'Away', icon: 'Clock', onClick: () => updateStatus('Away')},\n              { label: 'Do Not Disturb', icon: 'MinusCircle', onClick: () => updateStatus('Do Not Disturb')},\n              { label: 'Invisible', icon: 'CircleOff', onClick: () => updateStatus('Invisible')},\n          ]\n      })\n  }\n\n  const handleChannelContextMenu = (e: React.MouseEvent, channel: typeof channels[0]) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const isVoice = channel.type === 'voice';\n      \n      const textChannelActions = [\n        { label: 'Mark as Read', icon: 'Check' as const, onClick: () => toast({ title: `Channel \"${channel.name}\" marked as read.` }) },\n        { label: 'Mute Channel', icon: 'BellOff' as const, onClick: () => toast({ title: `Muted \"${channel.name}\"` }) },\n        { label: 'Invite Friends', icon: 'UserPlus' as const, onClick: () => {} },\n        { label: 'Channel Settings', icon: 'Settings' as const, onClick: () => {}, disabled: true },\n      ];\n\n      const voiceChannelActions = [\n         { label: 'Adjust Volume', icon: 'Volume2' as const, onClick: () => {} },\n         { label: 'Mute Channel', icon: 'BellOff' as const, onClick: () => toast({ title: `Muted \"${channel.name}\"` }) },\n         { label: 'Invite Friends', icon: 'UserPlus' as const, onClick: () => {} },\n         { label: 'Channel Settings', icon: 'Settings' as const, onClick: () => {}, disabled: true },\n      ]\n\n      openHub(e, {\n          type: 'gaming-channel',\n          data: channel,\n          actions: isVoice ? voiceChannelActions : textChannelActions,\n      })\n  }\n\n  const channelCategories = React.useMemo(() => {\n    return channels.reduce((acc, channel) => {\n        if(!acc[channel.category]) {\n            acc[channel.category] = [];\n        }\n        acc[channel.category].push(channel);\n        return acc;\n    }, {} as Record<string, typeof channels>);\n  }, []);\n\n  const currentVoiceChannel = activeVoiceChannel ? channels.find(c => c.id === activeVoiceChannel) : null;\n\n  return (\n    <div className=\"flex w-64 flex-col bg-muted/30 border-r-2 border-primary/20\">\n        <div className=\"flex h-16 items-center border-b-2 border-primary/20 px-4 shadow-md\">\n          <h1 className=\"text-lg font-bold font-headline text-glow\">Aetherweave Space</h1>\n        </div>\n        <ScrollArea className=\"flex-1 px-2 py-4 custom-scroll\">\n            <Accordion type=\"multiple\" defaultValue={['INFO', 'TEXT CHANNELS', 'VOICE CHANNELS']} className=\"w-full space-y-2\">\n                {Object.entries(channelCategories).map(([category, channels]) => (\n                    <AccordionItem key={category} value={category} className=\"border-none\">\n                         <AccordionTrigger className=\"px-2 py-1 text-xs font-bold uppercase text-muted-foreground hover:text-foreground hover:no-underline\">\n                             <span className=\"text-glow\">{category}</span>\n                         </AccordionTrigger>\n                         <AccordionContent className=\"pt-1\">\n                             <div className=\"space-y-1\">\n                                 {channels.map(channel => {\n                                     const isTextChannel = channel.type !== 'voice';\n                                     const isActive = isTextChannel ? channel.id === activeChannel : channel.id === activeVoiceChannel;\n\n                                     const handleClick = () => {\n                                        if (isTextChannel) {\n                                            setActiveChannel(channel.id)\n                                        } else {\n                                            handleVoiceChannelClick(channel.id);\n                                        }\n                                     };\n\n                                     return (\n                                        <div\n                                          key={channel.id}\n                                          className=\"group relative rounded-md\"\n                                          onClick={handleClick}\n                                          onContextMenu={(e) => handleChannelContextMenu(e, channel)}\n                                          data-command-hub-trigger\n                                        >\n                                            {isTextChannel && isActive && (\n                                                <motion.div\n                                                    layoutId=\"active-channel-indicator\"\n                                                    className=\"absolute -left-2 top-0 h-full w-1 rounded-r-full bg-primary\"\n                                                    initial={false}\n                                                    transition={{ type: 'spring', stiffness: 350, damping: 30 }}\n                                                />\n                                            )}\n                                            <div \n                                                className={cn(\n                                                    \"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 text-muted-foreground transition-all duration-150\",\n                                                    isTextChannel && (isActive ? \"bg-accent/70 text-foreground\" : \"hover:bg-accent/50 hover:text-foreground group-hover:translate-x-1\"),\n                                                    !isTextChannel && (isActive ? \"text-green-400\" : \"hover:bg-accent/50 hover:text-foreground\")\n                                                )}\n                                            >\n                                                {getChannelIcon(channel.type)}\n                                                <span className=\"font-semibold\">{channel.name}</span>\n                                            </div>\n                                        </div>\n                                     )\n                                 })}\n                             </div>\n                         </AccordionContent>\n                    </AccordionItem>\n                ))}\n            </Accordion>\n        </ScrollArea>\n        <div \n            className=\"flex h-auto flex-col bg-muted/40 p-3 border-t-2 border-primary/20\"\n            onContextMenu={handleUserPanelContextMenu}\n            data-command-hub-trigger\n        >\n          {currentVoiceChannel && (\n            <div className=\"mb-2 p-2 rounded-md bg-green-500/10 border border-green-500/30\">\n                <p className=\"text-sm font-bold text-green-400\">Voice Connected</p>\n                <div className=\"flex items-center justify-between\">\n                  <p className=\"text-xs text-muted-foreground\">{currentVoiceChannel.name}</p>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7 text-muted-foreground hover:text-destructive\" onClick={() => setActiveVoiceChannel(null)}>\n                    <PhoneOff size={16}/>\n                  </Button>\n                </div>\n            </div>\n          )}\n          <div className=\"flex items-center justify-between\">\n            <div className='flex items-center gap-2'>\n              <Avatar className=\"h-9 w-9\">\n                <AvatarImage src={profile?.photoURL || undefined} />\n                <AvatarFallback>{profile?.displayName?.charAt(0)}</AvatarFallback>\n              </Avatar>\n              <div>\n                <p className=\"text-sm font-semibold text-foreground\">{profile?.gaming?.username || profile?.displayName}</p>\n                <p className=\"text-xs text-muted-foreground\">{profile?.status || 'Online'}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center\">\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-foreground\" onClick={() => setIsMuted(!isMuted)}> \n                <Mic size={20} className={cn(isMuted && \"text-destructive\")} /> \n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-foreground\" onClick={() => setIsDeafened(!isDeafened)}> \n                <Headphones size={20} className={cn(isDeafened && \"text-destructive\")} /> \n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-foreground\" onClick={() => router.push('/settings')}> \n                <Settings size={20} /> \n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n  );\n}\n","path":null,"size_bytes":11226,"size_tokens":null},"src/components/calls/ConnectedPanel.tsx":{"content":"'use client';\n\nimport { useRef, useEffect, useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { PhoneOff, Mic, MicOff, Video, VideoOff, MonitorUp, Minimize2, Maximize2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\n\ninterface ConnectedPanelProps {\n  callerName: string;\n  callerAvatar?: string;\n  callType: 'voice' | 'video';\n  duration: string;\n  localStream: MediaStream | null;\n  remoteStream: MediaStream | null;\n  isAudioEnabled: boolean;\n  isVideoEnabled: boolean;\n  isScreenSharing: boolean;\n  isMinimized: boolean;\n  onToggleAudio: () => void;\n  onToggleVideo: () => void;\n  onToggleScreenShare: () => void;\n  onMinimize: () => void;\n  onEndCall: () => void;\n}\n\nexport default function ConnectedPanel({\n  callerName,\n  callerAvatar,\n  callType,\n  duration,\n  localStream,\n  remoteStream,\n  isAudioEnabled,\n  isVideoEnabled,\n  isScreenSharing,\n  isMinimized,\n  onToggleAudio,\n  onToggleVideo,\n  onToggleScreenShare,\n  onMinimize,\n  onEndCall\n}: ConnectedPanelProps) {\n  const localVideoRef = useRef<HTMLVideoElement>(null);\n  const remoteVideoRef = useRef<HTMLVideoElement>(null);\n  const remoteAudioRef = useRef<HTMLAudioElement>(null);\n  const [position, setPosition] = useState({ x: window.innerWidth - 340, y: window.innerHeight - 200 });\n  const [isDragging, setIsDragging] = useState(false);\n  const dragRef = useRef({ startX: 0, startY: 0 });\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    setIsDragging(true);\n    dragRef.current = { startX: e.clientX - position.x, startY: e.clientY - position.y };\n  };\n\n  useEffect(() => {\n    if (!isDragging) return;\n    const handleMouseMove = (e: MouseEvent) => {\n      setPosition({ x: e.clientX - dragRef.current.startX, y: e.clientY - dragRef.current.startY });\n    };\n    const handleMouseUp = () => setIsDragging(false);\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [isDragging]);\n\n  useEffect(() => {\n    if (localVideoRef.current && localStream) {\n      localVideoRef.current.srcObject = localStream;\n    }\n  }, [localStream]);\n\n  useEffect(() => {\n    if (remoteVideoRef.current && remoteStream) {\n      remoteVideoRef.current.srcObject = remoteStream;\n      remoteVideoRef.current.play().catch(() => {});\n    }\n    if (remoteAudioRef.current && remoteStream) {\n      remoteAudioRef.current.srcObject = remoteStream;\n      remoteAudioRef.current.play().catch(() => {});\n    }\n  }, [remoteStream]);\n\n  if (isMinimized) {\n    return (\n      <motion.div\n        initial={{ scale: 0.8, opacity: 0 }}\n        animate={{ scale: 1, opacity: 1 }}\n        style={{ left: position.x, top: position.y }}\n        className=\"fixed z-[9999] w-80 glass-card border-2 border-primary/30 shadow-2xl\"\n      >\n        <div\n          onMouseDown={handleMouseDown}\n          className=\"p-3 bg-background/90 backdrop-blur-md border-b border-primary/20 flex items-center justify-between cursor-move\"\n        >\n          <div className=\"flex items-center gap-2\">\n            <Avatar className=\"w-8 h-8 border border-green-500\">\n              <AvatarImage src={callerAvatar} />\n              <AvatarFallback>{callerName[0]}</AvatarFallback>\n            </Avatar>\n            <div>\n              <p className=\"text-sm font-bold\">{callerName}</p>\n              <p className=\"text-xs text-green-500 font-mono\">{duration}</p>\n            </div>\n          </div>\n          <Button variant=\"ghost\" size=\"icon\" onClick={onMinimize} className=\"h-8 w-8\">\n            <Maximize2 className=\"w-4 h-4\" />\n          </Button>\n        </div>\n        <div className=\"p-3 flex items-center justify-center gap-2\">\n          <Button variant={isAudioEnabled ? \"default\" : \"destructive\"} size=\"icon\" onClick={onToggleAudio} className=\"h-10 w-10 rounded-full\">\n            {isAudioEnabled ? <Mic className=\"w-4 h-4\" /> : <MicOff className=\"w-4 h-4\" />}\n          </Button>\n          {callType === 'video' && (\n            <Button variant={isVideoEnabled ? \"default\" : \"destructive\"} size=\"icon\" onClick={onToggleVideo} className=\"h-10 w-10 rounded-full\">\n              {isVideoEnabled ? <Video className=\"w-4 h-4\" /> : <VideoOff className=\"w-4 h-4\" />}\n            </Button>\n          )}\n          <Button variant=\"destructive\" size=\"icon\" onClick={onEndCall} className=\"h-10 w-10 rounded-full bg-red-500 hover:bg-red-600\">\n            <PhoneOff className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </motion.div>\n    );\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.95 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.95 }}\n      transition={{ duration: 0.3 }}\n      className=\"fixed inset-0 z-[9999] bg-gradient-to-br from-background via-background to-primary/5 flex flex-col\"\n    >\n      {/* Header */}\n      <motion.div\n        initial={{ y: -20, opacity: 0 }}\n        animate={{ y: 0, opacity: 1 }}\n        transition={{ delay: 0.1 }}\n        className=\"flex items-center justify-between p-4 md:p-6 bg-background/90 backdrop-blur-md border-b border-primary/20 shadow-lg\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className=\"relative\">\n            <Avatar className=\"w-12 h-12 border-2 border-green-500\">\n              <AvatarImage src={callerAvatar} />\n              <AvatarFallback>{callerName[0]}</AvatarFallback>\n            </Avatar>\n            <div className=\"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-background animate-pulse\" />\n          </div>\n          <div>\n            <h3 className=\"font-bold text-lg\">{callerName}</h3>\n            <p className=\"text-sm text-green-500 font-mono\">{duration}</p>\n          </div>\n        </div>\n        <Button variant=\"ghost\" size=\"icon\" onClick={onMinimize} title=\"Minimize\">\n          <Minimize2 className=\"w-5 h-5\" />\n        </Button>\n      </motion.div>\n\n      {/* Video/Audio Area */}\n      <div className=\"flex-1 relative bg-black overflow-hidden\">\n        {callType === 'video' ? (\n          <>\n            {remoteStream ? (\n              <motion.video\n                ref={remoteVideoRef}\n                autoPlay\n                playsInline\n                muted={false}\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.2 }}\n                className=\"w-full h-full object-cover\"\n              />\n            ) : (\n              <div className=\"flex items-center justify-center h-full bg-gradient-to-br from-primary/10 to-background\">\n                <div className=\"text-center space-y-4\">\n                  <Avatar className=\"w-32 h-32 mx-auto border-4 border-primary/30\">\n                    <AvatarImage src={callerAvatar} />\n                    <AvatarFallback className=\"text-4xl\">{callerName[0]}</AvatarFallback>\n                  </Avatar>\n                  <p className=\"text-muted-foreground\">Waiting for video...</p>\n                </div>\n              </div>\n            )}\n            {localStream && (\n              <motion.div\n                initial={{ scale: 0.8, opacity: 0 }}\n                animate={{ scale: 1, opacity: 1 }}\n                transition={{ delay: 0.3 }}\n                className=\"absolute top-4 right-4 w-48 h-36 bg-black rounded-xl overflow-hidden border-2 border-primary/50 shadow-2xl\"\n              >\n                <video\n                  ref={localVideoRef}\n                  autoPlay\n                  playsInline\n                  muted\n                  className=\"w-full h-full object-cover\"\n                />\n                {!isVideoEnabled && (\n                  <div className=\"absolute inset-0 bg-background/90 flex items-center justify-center\">\n                    <VideoOff className=\"w-8 h-8 text-muted-foreground\" />\n                  </div>\n                )}\n              </motion.div>\n            )}\n          </>\n        ) : (\n          <div className=\"flex items-center justify-center h-full bg-gradient-to-br from-primary/10 to-background\">\n            <motion.div\n              initial={{ scale: 0.8, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              transition={{ delay: 0.2 }}\n            >\n              <Avatar className=\"w-48 h-48 border-4 border-primary shadow-2xl\">\n                <AvatarImage src={callerAvatar} />\n                <AvatarFallback className=\"text-6xl\">{callerName[0]}</AvatarFallback>\n              </Avatar>\n            </motion.div>\n            <audio ref={remoteAudioRef} autoPlay />\n          </div>\n        )}\n      </div>\n\n      {/* Controls */}\n      <motion.div\n        initial={{ y: 20, opacity: 0 }}\n        animate={{ y: 0, opacity: 1 }}\n        transition={{ delay: 0.2 }}\n        className=\"p-6 md:p-8 bg-background/90 backdrop-blur-md border-t border-primary/20 shadow-lg\"\n      >\n        <div className=\"flex items-center justify-center gap-3 md:gap-4\">\n          <Button\n            variant={isAudioEnabled ? \"default\" : \"destructive\"}\n            size=\"icon\"\n            onClick={onToggleAudio}\n            className=\"w-14 h-14 md:w-16 md:h-16 rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center\"\n            title={isAudioEnabled ? 'Mute' : 'Unmute'}\n          >\n            {isAudioEnabled ? <Mic className=\"w-5 h-5 md:w-6 md:h-6\" /> : <MicOff className=\"w-5 h-5 md:w-6 md:h-6\" />}\n          </Button>\n\n          {callType === 'video' && (\n            <Button\n              variant={isVideoEnabled ? \"default\" : \"destructive\"}\n              size=\"icon\"\n              onClick={onToggleVideo}\n              className=\"w-14 h-14 md:w-16 md:h-16 rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center\"\n              title={isVideoEnabled ? 'Stop Video' : 'Start Video'}\n            >\n              {isVideoEnabled ? <Video className=\"w-5 h-5 md:w-6 md:h-6\" /> : <VideoOff className=\"w-5 h-5 md:w-6 md:h-6\" />}\n            </Button>\n          )}\n\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            disabled\n            className=\"w-14 h-14 md:w-16 md:h-16 rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center\"\n            title=\"Screen Share (Coming Soon)\"\n          >\n            <MonitorUp className=\"w-5 h-5 md:w-6 md:h-6\" />\n          </Button>\n\n          <Button\n            variant=\"destructive\"\n            size=\"icon\"\n            onClick={onEndCall}\n            className=\"w-14 h-14 md:w-16 md:h-16 rounded-full bg-red-500 hover:bg-red-600 shadow-lg hover:shadow-xl transition-all flex items-center justify-center\"\n            title=\"End Call\"\n          >\n            <PhoneOff className=\"w-5 h-5 md:w-6 md:h-6\" />\n          </Button>\n        </div>\n      </motion.div>\n    </motion.div>\n  );\n}\n","path":null,"size_bytes":11017,"size_tokens":null},"backend/src/routes/userRoutes.ts":{"content":"import { Router } from 'express';\nimport { authenticateToken } from '../middleware/auth';\nimport { getUserProfile, updateUserProfile, getUserStats } from '../controllers/userController';\n\nconst router = Router();\n\n// All user routes require authentication\nrouter.use(authenticateToken);\n\n// GET /api/users/profile - Get current user's profile\nrouter.get('/profile', getUserProfile);\n\n// PUT /api/users/profile - Update current user's profile\nrouter.put('/profile', updateUserProfile);\n\n// GET /api/users/stats - Get current user's statistics\nrouter.get('/stats', getUserStats);\n\nexport default router;","path":null,"size_bytes":601,"size_tokens":null},"src/services/cloudflare-calls-service.ts":{"content":"'use client';\n\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:4000/api';\n\nexport class CloudflareCallsService {\n  private static instance: CloudflareCallsService;\n  \n  static getInstance(): CloudflareCallsService {\n    if (!CloudflareCallsService.instance) {\n      CloudflareCallsService.instance = new CloudflareCallsService();\n    }\n    return CloudflareCallsService.instance;\n  }\n\n  private async getToken() {\n    if (typeof window === 'undefined') return null;\n    const { getAuth } = await import('firebase/auth');\n    const auth = getAuth();\n    return auth.currentUser?.getIdToken();\n  }\n\n  async sendOffer(callId: string, offer: RTCSessionDescriptionInit) {\n    const token = await this.getToken();\n    const res = await fetch(`${API_URL}/calls/offer`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n      body: JSON.stringify({ callId, offer })\n    });\n    if (!res.ok) throw new Error('Failed to send offer');\n  }\n\n  async sendAnswer(callId: string, answer: RTCSessionDescriptionInit) {\n    const token = await this.getToken();\n    const res = await fetch(`${API_URL}/calls/answer`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n      body: JSON.stringify({ callId, answer })\n    });\n    if (!res.ok) throw new Error('Failed to send answer');\n  }\n\n  async sendCandidate(callId: string, candidate: RTCIceCandidateInit) {\n    const token = await this.getToken();\n    await fetch(`${API_URL}/calls/candidate`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\n      body: JSON.stringify({ callId, candidate })\n    });\n  }\n\n  async getOffer(callId: string) {\n    const token = await this.getToken();\n    const res = await fetch(`${API_URL}/calls/offer/${callId}`, {\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    const data = await res.json();\n    return data.offer;\n  }\n\n  async getAnswer(callId: string) {\n    const token = await this.getToken();\n    const res = await fetch(`${API_URL}/calls/answer/${callId}`, {\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    const data = await res.json();\n    return data.answer;\n  }\n}","path":null,"size_bytes":2291,"size_tokens":null},"src/components/ui/toast.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4859,"size_tokens":null},"src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1128,"size_tokens":null},"src/app/metadata.ts":{"content":"import type { Metadata } from 'next';\n\nexport const metadata: Metadata = {\n  title: 'AetherDash - Cyberpunk Digital Hub',\n  description: 'A futuristic, cyberpunk-themed web application with real-time communication, AI assistance, and digital productivity tools.',\n  icons: {\n    icon: '/favicon.ico',\n    shortcut: '/favicon.ico',\n    apple: '/favicon.ico',\n  },\n  manifest: '/manifest.json',\n  themeColor: '#0ea5e9',\n  viewport: 'width=device-width, initial-scale=1',\n};","path":null,"size_bytes":471,"size_tokens":null},"src/components/ui/checkbox.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1070,"size_tokens":null},"src/hooks/use-notifications.ts":{"content":"\n'use client';\n\nimport { useState, useEffect, useMemo, useCallback } from 'react';\nimport {\n  collection,\n  query,\n  where,\n  onSnapshot,\n  addDoc,\n  updateDoc,\n  doc,\n  serverTimestamp,\n  orderBy,\n  Timestamp,\n  writeBatch,\n  getDocs,\n} from 'firebase/firestore';\nimport { useFirestore } from '@/firebase/provider';\nimport { useUser } from '@/hooks/use-user';\n\nexport interface Notification {\n  id: string;\n  userId: string;\n  type: 'new_message' | 'task_reminder' | 'file_upload' | 'system_alert' | 'friend_request';\n  title: string;\n  description: string;\n  isRead: boolean;\n  link?: string;\n  createdAt: Timestamp;\n}\n\nexport type NewNotification = Omit<Notification, 'id' | 'userId' | 'createdAt' | 'isRead'>;\n\n\nexport function useNotifications() {\n  const firestore = useFirestore();\n  const { user } = useUser();\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const notificationsCollectionRef = useMemo(() => {\n    if (!firestore || !user) return null;\n    return collection(firestore, 'users', user.uid, 'notifications');\n  }, [firestore, user]);\n\n  useEffect(() => {\n    if (!notificationsCollectionRef) {\n      setNotifications([]);\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    const q = query(\n      notificationsCollectionRef,\n      orderBy('createdAt', 'desc')\n    );\n\n    const unsubscribe = onSnapshot(q, (querySnapshot) => {\n      const notificationsData: Notification[] = [];\n      querySnapshot.forEach((doc) => {\n        notificationsData.push({ id: doc.id, ...doc.data() } as Notification);\n      });\n      setNotifications(notificationsData);\n      setLoading(false);\n    }, (error) => {\n      console.error(\"Error fetching notifications:\", error);\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [notificationsCollectionRef]);\n\n  const addNotification = useCallback(async (notificationData: NewNotification, targetUserId?: string) => {\n    const userId = targetUserId || user?.uid;\n    if (!userId || !firestore) throw new Error('User not logged in or Firestore not available');\n    const collectionRef = collection(firestore, 'users', userId, 'notifications');\n    \n    return await addDoc(collectionRef, {\n      ...notificationData,\n      userId: userId,\n      isRead: false,\n      createdAt: serverTimestamp(),\n    });\n  }, [user, firestore]);\n\n  const markAsRead = useCallback(async (notificationId: string) => {\n    if (!firestore || !user) return;\n    const notificationRef = doc(firestore, 'users', user.uid, 'notifications', notificationId);\n    await updateDoc(notificationRef, { isRead: true });\n  }, [firestore, user]);\n\n  const markAllAsRead = useCallback(async () => {\n    if (!firestore || !user || !notificationsCollectionRef) return;\n    \n    const batch = writeBatch(firestore);\n    const q = query(notificationsCollectionRef, where('isRead', '==', false));\n    \n    const querySnapshot = await getDocs(q);\n    querySnapshot.forEach((doc) => {\n      batch.update(doc.ref, { isRead: true });\n    });\n\n    await batch.commit();\n  }, [firestore, user, notificationsCollectionRef]);\n  \n  const unreadCount = useMemo(() => {\n    return notifications.filter(n => !n.isRead).length;\n  }, [notifications]);\n\n  return { notifications, loading, addNotification, markAsRead, markAllAsRead, unreadCount };\n}\n\n    ","path":null,"size_bytes":3367,"size_tokens":null},"src/components/modals/InvitePeopleModal.tsx":{"content":"\n'use client';\n\nimport { useState, useMemo } from 'react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { useConnections } from '@/hooks/use-connections';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Loader2, Search, UserPlus, Link as LinkIcon, Check } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface InvitePeopleModalProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  space: { name: string };\n}\n\nexport default function InvitePeopleModal({\n  isOpen,\n  onOpenChange,\n  space,\n}: InvitePeopleModalProps) {\n  const { connections, users, loading } = useConnections();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [invited, setInvited] = useState<Set<string>>(new Set());\n  const { toast } = useToast();\n\n  const friends = useMemo(() => {\n    return connections\n      .filter(c => c.status === 'friends')\n      .map(c => users.find(u => u.id === c.id))\n      .filter(Boolean);\n  }, [connections, users]);\n\n  const filteredFriends = useMemo(() => {\n    if (!searchTerm) return friends;\n    return friends.filter(friend =>\n      friend?.displayName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      friend?.username?.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n  }, [friends, searchTerm]);\n\n  const handleInvite = (userId: string) => {\n    setInvited(prev => new Set(prev).add(userId));\n    toast({\n      title: 'Invitation Sent',\n      description: `Your invite has been sent.`,\n    });\n  };\n\n  const handleGenerateLink = () => {\n    const inviteLink = `${window.location.origin}/join/${space.name.toLowerCase().replace(/\\s/g, '-')}`;\n    navigator.clipboard.writeText(inviteLink);\n    toast({\n      title: 'Link Copied!',\n      description: 'Your invitation link is ready to be shared.',\n    });\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md glass-card\">\n        <DialogHeader>\n          <DialogTitle>Invite Operators to {space.name}</DialogTitle>\n          <DialogDescription>\n            Search for friends or generate a shareable link.\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"relative my-4\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search friends...\"\n            className=\"pl-9\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n        <ScrollArea className=\"h-64 border rounded-md\">\n          <div className=\"p-2 space-y-1\">\n            {loading ? (\n              <div className=\"flex items-center justify-center h-full\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n              </div>\n            ) : filteredFriends.length === 0 ? (\n              <p className=\"text-center text-sm text-muted-foreground p-4\">No friends found.</p>\n            ) : (\n              filteredFriends.map((friend) => {\n                if (!friend) return null;\n                const isInvited = invited.has(friend.id);\n                return (\n                  <div\n                    key={friend.id}\n                    className=\"flex items-center justify-between p-2 rounded-md hover:bg-muted/50\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar>\n                        <AvatarImage src={friend.photoURL || undefined} />\n                        <AvatarFallback>{friend.displayName?.[0]}</AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <p className=\"font-semibold\">{friend.displayName}</p>\n                        <p className=\"text-xs text-muted-foreground\">@{friend.username}</p>\n                      </div>\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      onClick={() => handleInvite(friend.id)}\n                      disabled={isInvited}\n                      variant={isInvited ? 'secondary' : 'default'}\n                    >\n                      {isInvited ? (\n                        <>\n                          <Check className=\"mr-2 h-4 w-4\" /> Invited\n                        </>\n                      ) : (\n                        <>\n                          <UserPlus className=\"mr-2 h-4 w-4\" /> Invite\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                );\n              })\n            )}\n          </div>\n        </ScrollArea>\n        <div className=\"mt-4 border-t pt-4\">\n          <p className=\"text-sm text-muted-foreground mb-2\">Or share an invite link:</p>\n          <Button className=\"w-full\" variant=\"outline\" onClick={handleGenerateLink}>\n            <LinkIcon className=\"mr-2 h-4 w-4\" /> Generate & Copy Link\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":5228,"size_tokens":null},"src/hooks/use-cursor.tsx":{"content":"\n'use client';\nimport { createContext, useContext, useState, useMemo, useCallback, ReactNode, useEffect } from 'react';\nimport { useUser } from './use-user';\nimport { doc, setDoc } from 'firebase/firestore';\nimport { useFirestore } from '@/firebase/provider';\n\nexport type CursorMode = 'default' | 'link' | 'text' | 'drag' | 'resize-ns' | 'resize-ew' | 'disabled';\nexport type CursorStyle = 'default-op' | 'neon-glow' | 'futuristic-trail' | 'spark-halo' | 'editor' | 'minimal-glow' | 'color-pulse';\n\nexport interface SmartCursorContextType {\n  // State\n  mode: CursorMode;\n  text: string | null;\n  style: CursorStyle;\n  lowPerformanceMode: boolean;\n\n  // API\n  setCursorMode: (mode: CursorMode, text?: string | null) => void;\n  setCursorStyle: (style: CursorStyle) => void;\n  enableLowPerfMode: (enabled: boolean) => void;\n\n  // Stubs for future implementation\n  showTooltip: (text: string, options?: any) => void;\n  hideTooltip: () => void;\n  registerDraggable: (element: Element, options?: any) => void;\n  unregisterDraggable: (element: Element) => void;\n}\n\nconst CursorContext = createContext<SmartCursorContextType | undefined>(undefined);\n\nexport const CursorProvider = ({ children }: { children: ReactNode }) => {\n  const { profile, updateProfileSettings } = useUser();\n\n  const [mode, setMode] = useState<CursorMode>('default');\n  const [text, setText] = useState<string | null>(null);\n  const [style, setStyle] = useState<CursorStyle>('default-op');\n  const [lowPerformanceMode, setLowPerformanceMode] = useState(false);\n\n  // Load initial settings from profile\n  useEffect(() => {\n    if (profile) {\n      setStyle(profile.settings?.cursor?.style as CursorStyle || 'default-op');\n      setLowPerformanceMode(profile.settings?.cursor?.lowPerf || false);\n    }\n  }, [profile]);\n  \n  const setCursorMode = useCallback((newMode: CursorMode, text: string | null = null) => {\n    if (typeof window === 'undefined') return;\n    document.body.classList.toggle('cursor-none', newMode !== 'default' && newMode !== 'text');\n    setMode(newMode);\n    setText(text);\n  }, []);\n\n  const setCursorStyle = useCallback(async (newStyle: CursorStyle) => {\n    setStyle(newStyle);\n    await updateProfileSettings({ \n        ...profile?.settings, \n        cursor: { ...profile?.settings?.cursor, style: newStyle } \n    });\n  }, [profile, updateProfileSettings]);\n\n  const enableLowPerfMode = useCallback(async (enabled: boolean) => {\n    setLowPerformanceMode(enabled);\n    await updateProfileSettings({ \n        ...profile?.settings, \n        cursor: { ...profile?.settings?.cursor, lowPerf: enabled } \n    });\n  }, [profile, updateProfileSettings]);\n\n  // Stubs for future implementation\n  const showTooltip = (text: string) => console.log('Show Tooltip:', text);\n  const hideTooltip = () => console.log('Hide Tooltip');\n  const registerDraggable = (el: Element) => console.log('Register Draggable:', el);\n  const unregisterDraggable = (el: Element) => console.log('Unregister Draggable:', el);\n\n  const contextValue = useMemo(() => ({\n    mode,\n    text,\n    style,\n    lowPerformanceMode,\n    setCursorMode,\n    setCursorStyle,\n    enableLowPerfMode,\n    showTooltip,\n    hideTooltip,\n    registerDraggable,\n    unregisterDraggable,\n  }), [mode, text, style, lowPerformanceMode, setCursorMode, setCursorStyle, enableLowPerfMode]);\n\n  return <CursorContext.Provider value={contextValue}>{children}</CursorContext.Provider>;\n};\n\nexport const useCursor = (): SmartCursorContextType => {\n  const context = useContext(CursorContext);\n  if (!context) {\n    throw new Error('useCursor must be used within a CursorProvider');\n  }\n  return context;\n};\n","path":null,"size_bytes":3635,"size_tokens":null},"src/lib/themes.ts":{"content":"\nimport { gamingThemes } from './gaming-themes';\n\nexport type Theme = {\n  id: string;\n  name: string;\n  colors: {\n    [key: string]: string;\n  };\n};\n\nconst defaultThemes: Theme[] = [\n  {\n    id: 'theme-azure',\n    name: 'Azure Matrix',\n    colors: {\n      background: '210 50% 8%',\n      foreground: '190 100% 95%',\n      card: '210 45% 12%',\n      'card-foreground': '190 100% 95%',\n      popover: '210 50% 5%',\n      'popover-foreground': '190 100% 95%',\n      primary: '190 100% 50%',\n      'primary-foreground': '190 100% 5%',\n      secondary: '200 100% 60%',\n      'secondary-foreground': '200 100% 98%',\n      muted: '210 30% 18%',\n      'muted-foreground': '210 30% 65%',\n      accent: '190 60% 35%',\n      'accent-foreground': '190 100% 95%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '190 100% 30%',\n      input: '210 45% 15%',\n      ring: '190 100% 60%',\n    },\n  },\n  {\n    id: 'theme-sunset',\n    name: 'Synthwave Sunset',\n    colors: {\n      background: '260 30% 8%',\n      foreground: '30 100% 95%',\n      card: '260 30% 12%',\n      'card-foreground': '30 100% 95%',\n      popover: '260 40% 5%',\n      'popover-foreground': '30 100% 95%',\n      primary: '330 100% 55%',\n      'primary-foreground': '330 100% 10%',\n      secondary: '30 100% 60%',\n      'secondary-foreground': '30 100% 5%',\n      muted: '260 20% 18%',\n      'muted-foreground': '260 20% 65%',\n      accent: '30 100% 40%',\n      'accent-foreground': '30 100% 95%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '330 100% 30%',\n      input: '260 30% 15%',\n      ring: '330 100% 65%',\n    },\n  },\n  {\n    id: 'theme-chrome',\n    name: 'Liquid Chrome',\n    colors: {\n      background: '0 0% 10%',\n      foreground: '0 0% 95%',\n      card: '0 0% 15%',\n      'card-foreground': '0 0% 95%',\n      popover: '0 0% 8%',\n      'popover-foreground': '0 0% 95%',\n      primary: '0 0% 70%',\n      'primary-foreground': '0 0% 10%',\n      secondary: '0 0% 50%',\n      'secondary-foreground': '0 0% 98%',\n      muted: '0 0% 20%',\n      'muted-foreground': '0 0% 60%',\n      accent: '0 0% 40%',\n      'accent-foreground': '0 0% 95%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '0 0% 30%',\n      input: '0 0% 18%',\n      ring: '0 0% 80%',\n    },\n  },\n  {\n    id: 'theme-violet',\n    name: 'Violet Overdrive',\n    colors: {\n      background: '270 40% 8%',\n      foreground: '280 100% 95%',\n      card: '270 35% 12%',\n      'card-foreground': '280 100% 95%',\n      popover: '270 40% 5%',\n      'popover-foreground': '280 100% 95%',\n      primary: '280 100% 60%',\n      'primary-foreground': '280 100% 5%',\n      secondary: '320 100% 65%',\n      'secondary-foreground': '320 100% 98%',\n      muted: '270 25% 18%',\n      'muted-foreground': '270 25% 65%',\n      accent: '280 70% 40%',\n      'accent-foreground': '280 100% 95%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '280 100% 35%',\n      input: '270 35% 15%',\n      ring: '280 100% 70%',\n    },\n  },\n  {\n    id: 'theme-glitch',\n    name: 'Glitch Runner',\n    colors: {\n      background: '120 30% 5%',\n      foreground: '120 100% 90%',\n      card: '120 25% 10%',\n      'card-foreground': '120 100% 90%',\n      popover: '120 30% 3%',\n      'popover-foreground': '120 100% 90%',\n      primary: '120 100% 50%',\n      'primary-foreground': '120 100% 5%',\n      secondary: '0 100% 50%',\n      'secondary-foreground': '0 0% 98%',\n      muted: '120 20% 15%',\n      'muted-foreground': '120 20% 60%',\n      accent: '120 60% 30%',\n      'accent-foreground': '120 100% 90%',\n      destructive: '0 100% 50%',\n      'destructive-foreground': '0 0% 98%',\n      border: '120 100% 25%',\n      input: '120 25% 12%',\n      ring: '120 100% 60%',\n    },\n  },\n  {\n    id: 'theme-samurai',\n    name: 'Cyber Samurai',\n    colors: {\n      background: '0 20% 8%',\n      foreground: '0 10% 90%',\n      card: '0 20% 12%',\n      'card-foreground': '0 10% 90%',\n      popover: '0 20% 5%',\n      'popover-foreground': '0 10% 90%',\n      primary: '0 70% 50%',\n      'primary-foreground': '0 0% 100%',\n      secondary: '0 0% 50%',\n      'secondary-foreground': '0 0% 100%',\n      muted: '0 15% 18%',\n      'muted-foreground': '0 10% 60%',\n      accent: '0 70% 30%',\n      'accent-foreground': '0 10% 90%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '0 50% 25%',\n      input: '0 20% 15%',\n      ring: '0 70% 60%',\n    },\n  },\n  {\n    id: 'theme-cascade',\n    name: 'Code Cascade',\n    colors: {\n      background: '0 0% 0%',\n      foreground: '120 100% 70%',\n      card: '0 0% 5%',\n      'card-foreground': '120 100% 70%',\n      popover: '0 0% 2%',\n      'popover-foreground': '120 100% 70%',\n      primary: '120 100% 40%',\n      'primary-foreground': '0 0% 0%',\n      secondary: '120 100% 30%',\n      'secondary-foreground': '0 0% 100%',\n      muted: '0 0% 10%',\n      'muted-foreground': '120 50% 50%',\n      accent: '120 100% 20%',\n      'accent-foreground': '120 100% 70%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '120 100% 20%',\n      input: '0 0% 8%',\n      ring: '120 100% 50%',\n    },\n  },\n  {\n    id: 'cyber-default',\n    name: 'Cyber Default',\n    colors: {\n      background: '220 40% 5%',\n      foreground: '180 100% 95%',\n      card: '220 30% 10%',\n      'card-foreground': '180 100% 95%',\n      popover: '220 40% 2%',\n      'popover-foreground': '180 100% 95%',\n      primary: '180 100% 50%',\n      'primary-foreground': '180 100% 5%',\n      secondary: '280 100% 60%',\n      'secondary-foreground': '280 100% 98%',\n      muted: '200 20% 15%',\n      'muted-foreground': '200 20% 65%',\n      accent: '180 50% 30%',\n      'accent-foreground': '180 100% 95%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '180 100% 25%',\n      input: '220 30% 12%',\n      ring: '180 100% 60%',\n    },\n  },\n  {\n    id: 'amoled-noir',\n    name: 'AMOLED Noir',\n    colors: {\n      background: '0 0% 0%',\n      foreground: '0 0% 80%',\n      card: '0 0% 5%',\n      'card-foreground': '0 0% 80%',\n      popover: '0 0% 2%',\n      'popover-foreground': '0 0% 80%',\n      primary: '0 100% 50%', // Bright Red\n      'primary-foreground': '0 0% 100%',\n      secondary: '210 100% 50%', // Bright Blue\n      'secondary-foreground': '0 0% 100%',\n      muted: '0 0% 10%',\n      'muted-foreground': '0 0% 50%',\n      accent: '0 100% 25%',\n      'accent-foreground': '0 0% 98%',\n      destructive: '0 84.2% 60.2%',\n      'destructive-foreground': '0 0% 98%',\n      border: '0 100% 20%',\n      input: '0 0% 8%',\n      ring: '0 100% 70%',\n    },\n  },\n\n  {\n    id: 'soft-gradient',\n    name: 'Soft Gradient',\n    colors: {\n      background: '220 20% 95%',\n      foreground: '220 20% 10%',\n      card: '220 20% 100%',\n      'card-foreground': '220 20% 10%',\n      popover: '220 20% 98%',\n      'popover-foreground': '220 20% 10%',\n      primary: '250 80% 60%', // Soft Purple\n      'primary-foreground': '250 80% 98%',\n      secondary: '180 70% 55%', // Soft Teal\n      'secondary-foreground': '180 70% 5%',\n      muted: '220 20% 90%',\n      'muted-foreground': '220 10% 40%',\n      accent: '250 80% 92%',\n      'accent-foreground': '250 80% 15%',\n      destructive: '0 80% 60%',\n      'destructive-foreground': '0 0% 98%',\n      border: '220 20% 85%',\n      input: '220 20% 93%',\n      ring: '250 80% 70%',\n    },\n  },\n  {\n    id: 'mecha-pilot',\n    name: 'Mecha Pilot',\n    colors: {\n      background: '210 15% 15%',\n      foreground: '210 10% 90%',\n      card: '210 15% 20%',\n      'card-foreground': '210 10% 90%',\n      popover: '210 15% 10%',\n      'popover-foreground': '210 10% 90%',\n      primary: '45 100% 50%', // Cockpit Yellow\n      'primary-foreground': '45 100% 5%',\n      secondary: '0 80% 55%', // Warning Red\n      'secondary-foreground': '0 0% 100%',\n      muted: '210 15% 25%',\n      'muted-foreground': '210 10% 60%',\n      accent: '45 100% 25%',\n      'accent-foreground': '45 100% 95%',\n      destructive: '0 80% 55%',\n      'destructive-foreground': '0 0% 100%',\n      border: '210 15% 30%',\n      input: '210 15% 18%',\n      ring: '45 100% 60%',\n    },\n  },\n];\n\nexport const themes: Theme[] = [...defaultThemes, ...gamingThemes];\n","path":null,"size_bytes":8360,"size_tokens":null},"src/hooks/use-webrtc.ts":{"content":"'use client';\n\nimport { useState, useRef, useCallback, useEffect, useMemo } from 'react';\nimport { useCallSounds } from './use-call-sounds';\nimport { useToast } from './use-toast';\nimport { UserProfile, useUser } from './use-user';\nimport { PublicUser } from './use-connections';\nimport { createCallSession } from '@/ai/flows/create-call-session-flow';\nimport { collection, doc, onSnapshot, addDoc, serverTimestamp, setDoc, deleteDoc, updateDoc, Timestamp } from 'firebase/firestore';\nimport { useFirestore } from '@/firebase/provider';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { useAuth } from '@/firebase/provider';\n\n\nexport type CallStatus = 'idle' | 'calling' | 'ringing' | 'connected' | 'ended' | 'declined';\n\ninterface SignalingDoc {\n    type: 'offer' | 'answer' | 'ice-candidate';\n    senderId: string;\n    payload: any;\n    timestamp: any;\n}\n\nexport const useWebRTC = (currentUser: UserProfile | null) => {\n  const firestore = useFirestore();\n  const auth = useAuth();\n  const [callStatus, setCallStatus] = useState<CallStatus>('idle');\n  const [localStream, setLocalStream] = useState<MediaStream | null>(null);\n  const [remoteStream, setRemoteStream] = useState<MediaStream | null>(null);\n  const [isAudioEnabled, setIsAudioEnabled] = useState(true);\n  const [isVideoEnabled, setIsVideoEnabled] = useState(true);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [callDuration, setCallDuration] = useState(0);\n  \n  const [incomingCall, setIncomingCall] = useState<{\n    fromUserId: string;\n    fromUserName: string;\n    sessionId: string;\n  } | null>(null);\n  \n  const [activeCall, setActiveCall] = useState<{\n    withUser: PublicUser;\n    sessionId: string;\n    isInitiator: boolean;\n  } | null>(null);\n\n  const peerConnectionRef = useRef<RTCPeerConnection | null>(null);\n  const ringtoneIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const callTimerRef = useRef<NodeJS.Timeout | null>(null);\n\n  const { playRingtone, playCallEndedSound, stopRingtone } = useCallSounds();\n  const { toast } = useToast();\n\n  const signalingCollectionRef = useMemo(() => {\n    if (!firestore || !currentUser || !activeCall) return null;\n    return collection(firestore, 'users', currentUser.id, 'signaling', activeCall.withUser.id, 'messages');\n  }, [firestore, currentUser, activeCall]);\n\n  const remoteSignalingCollectionRef = useMemo(() => {\n    if (!firestore || !currentUser || !activeCall) return null;\n    return collection(firestore, 'users', activeCall.withUser.id, 'signaling', currentUser.id, 'messages');\n  }, [firestore, currentUser, activeCall]);\n\n  const cleanupCall = useCallback((status: CallStatus = 'idle') => {\n    console.log('Cleaning up call...');\n    if (ringtoneIntervalRef.current) {\n      stopRingtone(ringtoneIntervalRef.current);\n      ringtoneIntervalRef.current = null;\n    }\n    if (callTimerRef.current) {\n      clearInterval(callTimerRef.current);\n      callTimerRef.current = null;\n    }\n    if (localStream) {\n      localStream.getTracks().forEach(track => track.stop());\n    }\n    if (peerConnectionRef.current) {\n      peerConnectionRef.current.close();\n      peerConnectionRef.current = null;\n    }\n    setLocalStream(null);\n    setRemoteStream(null);\n    setCallDuration(0);\n    setIncomingCall(null);\n    setActiveCall(null);\n    setIsScreenSharing(false);\n    setCallStatus(status);\n    setTimeout(() => {\n      if (status !== 'ringing') {\n        setCallStatus('idle');\n      }\n    }, 2000);\n  }, [localStream, stopRingtone]);\n\n  const endCall = useCallback(async () => {\n    playCallEndedSound();\n    if (activeCall && firestore && currentUser) {\n      try {\n        await setDoc(doc(firestore, 'users', activeCall.withUser.id, 'signaling', currentUser.id), {\n            type: 'end-call'\n        }, { merge: true });\n      } catch (e) {\n          console.error(\"Error sending end-call signal:\", e);\n      }\n    }\n    cleanupCall('ended');\n  }, [activeCall, currentUser, firestore, cleanupCall, playCallEndedSound]);\n\n  // Listen for incoming signaling documents\n  useEffect(() => {\n    if (!firestore || !currentUser) return;\n    const userSignalingRef = doc(firestore, 'users', currentUser.id);\n    \n    // This is a simplified listener. A more robust solution might use a subcollection.\n    const unsubscribe = onSnapshot(collection(firestore, userSignalingRef.path, 'signaling'), (snapshot) => {\n        snapshot.docChanges().forEach((change) => {\n            if (change.type === 'added' || change.type === 'modified') {\n                const data = change.doc.data();\n                const fromUserId = change.doc.id;\n                console.log(`Received signal from ${fromUserId}:`, data.type);\n\n                if (data.type === 'offer' && callStatus === 'idle') {\n                    setIncomingCall({\n                        fromUserId: fromUserId,\n                        fromUserName: data.fromUserName || 'Unknown Caller',\n                        sessionId: data.sessionId,\n                    });\n                    setCallStatus('ringing');\n                    const intervalId = playRingtone();\n                    ringtoneIntervalRef.current = intervalId;\n                }\n                 if (data.type === 'end-call' && activeCall?.withUser.id === fromUserId) {\n                     toast({ title: 'Call Ended' });\n                     cleanupCall('ended');\n                 }\n            }\n        });\n    });\n\n    return () => unsubscribe();\n}, [firestore, currentUser, callStatus, activeCall, cleanupCall, playRingtone, toast]);\n\n\n// Listen for messages within an active call\nuseEffect(() => {\n  if (!signalingCollectionRef || !peerConnectionRef.current || !currentUser) return;\n  \n  const pc = peerConnectionRef.current;\n\n  const unsubscribe = onSnapshot(signalingCollectionRef, async (snapshot) => {\n    for (const change of snapshot.docChanges()) {\n      if (change.type === 'added') {\n        const data = change.doc.data() as SignalingDoc;\n        console.log(\"Received signaling message:\", data.type);\n        if (data.senderId === currentUser?.id) continue;\n\n        try {\n            if (data.type === 'answer') {\n              if (pc.signalingState !== 'have-local-offer') {\n                  console.warn('Received answer but not in have-local-offer state. Ignoring.');\n                  continue;\n              }\n              await pc.setRemoteDescription(new RTCSessionDescription(data.payload));\n              console.log(\"Set remote description (answer) successfully.\");\n          } else if (data.type === 'offer') {\n              if (pc.signalingState !== 'stable') {\n                console.warn('Received offer but not in stable state. Ignoring renegotiation for now.');\n                continue;\n              }\n              await pc.setRemoteDescription(new RTCSessionDescription(data.payload));\n              const answer = await pc.createAnswer();\n              await pc.setLocalDescription(answer);\n              await addDoc(remoteSignalingCollectionRef!, {\n                  type: 'answer',\n                  payload: answer,\n                  senderId: currentUser?.id,\n                  timestamp: serverTimestamp(),\n              });\n              console.log(\"Responded to re-offer.\");\n          } else if (data.type === 'ice-candidate') {\n              await pc.addIceCandidate(new RTCIceCandidate(data.payload));\n          }\n        } catch (error) {\n            console.error(\"Error processing signaling message:\", error);\n        }\n      }\n    }\n  });\n\n  return () => unsubscribe();\n}, [signalingCollectionRef, remoteSignalingCollectionRef, currentUser]);\n\n\n  const initializePeerConnection = useCallback(async (toUser: PublicUser) => {\n    if (!currentUser || !firestore) throw new Error(\"Current user not found\");\n\n    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\n    setLocalStream(stream);\n    setIsVideoEnabled(true);\n    setIsAudioEnabled(true);\n    \n    // In a real app, get STUN/TURN servers from a service. For now, using public Google STUN.\n    const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });\n    peerConnectionRef.current = pc;\n\n    stream.getTracks().forEach(track => pc.addTrack(track, stream));\n\n    pc.ontrack = (event) => {\n      setRemoteStream(event.streams[0]);\n    };\n\n    pc.onicecandidate = (event) => {\n      if (event.candidate && remoteSignalingCollectionRef && firestore && currentUser) {\n        addDoc(remoteSignalingCollectionRef, {\n            type: 'ice-candidate',\n            payload: event.candidate,\n            senderId: currentUser.id,\n            timestamp: serverTimestamp(),\n        }).catch(e => console.error(\"Error sending ICE candidate:\", e));\n      }\n    };\n\n    pc.onconnectionstatechange = () => {\n      const state = pc.connectionState;\n      if (state === 'connected') {\n        setCallStatus('connected');\n        if (ringtoneIntervalRef.current) { stopRingtone(ringtoneIntervalRef.current); ringtoneIntervalRef.current = null; }\n        // Start call timer\n        if (callTimerRef.current) clearInterval(callTimerRef.current);\n        setCallDuration(0);\n        callTimerRef.current = setInterval(() => setCallDuration(prev => prev + 1), 1000);\n      } else if (state === 'disconnected' || state === 'closed' || state === 'failed') {\n        endCall();\n      }\n    };\n    return pc;\n  }, [currentUser, remoteSignalingCollectionRef, stopRingtone, endCall, firestore]);\n\n\n  const startCall = useCallback(async (toUser: PublicUser) => {\n    if (!currentUser || !firestore) return;\n    try {\n        setCallStatus('calling');\n        const sessionId = `call_${Date.now()}`;\n        setActiveCall({ withUser: toUser, sessionId, isInitiator: true });\n\n        const pc = await initializePeerConnection(toUser);\n        const offer = await pc.createOffer();\n        await pc.setLocalDescription(offer);\n\n        // This is the initial offer to the other user\n        const remoteSignalingDoc = doc(firestore, 'users', toUser.id, 'signaling', currentUser.id);\n        await setDoc(remoteSignalingDoc, {\n            type: 'offer',\n            fromUserId: currentUser.id,\n            fromUserName: currentUser.displayName,\n            sessionId: sessionId,\n        });\n\n        // Also post the offer to their signaling subcollection\n         await addDoc(collection(firestore, remoteSignalingDoc.path, 'messages'), {\n            type: 'offer',\n            payload: offer,\n            senderId: currentUser.id,\n            timestamp: serverTimestamp(),\n         });\n    } catch (error: any) {\n        console.error('Start call failed:', error);\n        toast({ variant: 'destructive', title: 'Call Failed', description: error.message });\n        cleanupCall('ended');\n    }\n  }, [currentUser, firestore, initializePeerConnection, toast, cleanupCall]);\n\n\n  const acceptCall = useCallback(async () => {\n    if (!incomingCall || !currentUser || !firestore) return;\n    if (ringtoneIntervalRef.current) { stopRingtone(ringtoneIntervalRef.current); ringtoneIntervalRef.current = null; }\n\n    const fromUser: PublicUser = {\n        id: incomingCall.fromUserId,\n        displayName: incomingCall.fromUserName,\n        username: incomingCall.fromUserName,\n        photoURL: '',\n        email: '',\n        createdAt: Timestamp.now(),\n        xp: 0,\n        level: 1,\n        badgesUnlocked: [],\n        status: 'offline',\n        lastSeen: Timestamp.now(),\n        bio: '',\n        inventory: [],\n        messagesSent: 0,\n        notesCreated: 0,\n        filesUploaded: 0,\n        friends: 0,\n    };\n    \n    try {\n        setActiveCall({ withUser: fromUser, sessionId: incomingCall.sessionId, isInitiator: false });\n        const pc = await initializePeerConnection(fromUser);\n\n        // Set up listener for messages from the caller\n        const remoteMessagesRef = collection(firestore, 'users', currentUser.id, 'signaling', fromUser.id, 'messages');\n        onSnapshot(remoteMessagesRef, async (snapshot) => {\n          for (const change of snapshot.docChanges()) {\n              if (change.type === 'added') {\n                  const data = change.doc.data() as SignalingDoc;\n                  if (data.senderId === fromUser.id) {\n                      if (data.type === 'offer') {\n                          await pc.setRemoteDescription(new RTCSessionDescription(data.payload));\n                          const answer = await pc.createAnswer();\n                          await pc.setLocalDescription(answer);\n\n                          // Send answer back\n                          const localMessagesRef = collection(firestore, 'users', fromUser.id, 'signaling', currentUser.id, 'messages');\n                          await addDoc(localMessagesRef, {\n                              type: 'answer',\n                              payload: answer,\n                              senderId: currentUser.id,\n                              timestamp: serverTimestamp()\n                          });\n                      } else if (data.type === 'ice-candidate') {\n                           await pc.addIceCandidate(new RTCIceCandidate(data.payload));\n                      }\n                  }\n              }\n          }\n        });\n\n        setIncomingCall(null);\n    } catch (error: any) {\n        console.error(\"Failed to accept call:\", error);\n        toast({ variant: 'destructive', title: 'Call Failed', description: error.message });\n        cleanupCall('ended');\n    }\n  }, [incomingCall, currentUser, firestore, initializePeerConnection, stopRingtone, toast, cleanupCall]);\n\n  const declineCall = useCallback(async () => {\n    if (!incomingCall || !currentUser || !firestore) return;\n    playCallEndedSound();\n     try {\n        await setDoc(doc(firestore, 'users', incomingCall.fromUserId, 'signaling', currentUser.id), {\n            type: 'reject-call'\n        }, { merge: true });\n      } catch (e) {\n          console.error(\"Error sending reject-call signal:\", e);\n      }\n    cleanupCall('declined');\n  }, [incomingCall, currentUser, firestore, playCallEndedSound, cleanupCall]);\n\n\n  const startCallTimer = useCallback(() => {\n    if (callTimerRef.current) clearInterval(callTimerRef.current);\n    setCallDuration(0);\n    callTimerRef.current = setInterval(() => setCallDuration(prev => prev + 1), 1000);\n  }, []);\n\n  const formatCallDuration = (seconds: number) => `${Math.floor(seconds / 60).toString().padStart(2, '0')}:${(seconds % 60).toString().padStart(2, '0')}`;\n  \n  const toggleAudio = useCallback(() => localStream?.getAudioTracks().forEach(track => { track.enabled = !track.enabled; setIsAudioEnabled(track.enabled); }), [localStream]);\n  const toggleVideo = useCallback(() => localStream?.getVideoTracks().forEach(track => { track.enabled = !track.enabled; setIsVideoEnabled(track.enabled); }), [localStream]);\n  const startScreenShare = useCallback(async () => {\n    if (!peerConnectionRef.current || !localStream) return;\n    const sender = peerConnectionRef.current.getSenders().find(s => s.track?.kind === 'video');\n    if (!sender) return;\n\n    if (isScreenSharing) {\n      const newStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\n      const newVideoTrack = newStream.getVideoTracks()[0];\n      await sender.replaceTrack(newVideoTrack);\n      localStream.getTracks().forEach(track => track.stop());\n      setLocalStream(newStream);\n      setIsScreenSharing(false);\n    } else {\n      const displayStream = await navigator.mediaDevices.getDisplayMedia({ video: true });\n      const screenTrack = displayStream.getVideoTracks()[0];\n      await sender.replaceTrack(screenTrack);\n      setLocalStream(displayStream);\n      setIsScreenSharing(true);\n      screenTrack.onended = () => startScreenShare(); // Revert to camera on stop\n    }\n  }, [isScreenSharing, localStream]);\n\n  return {\n    callStatus, localStream, remoteStream, isAudioEnabled, isVideoEnabled, isScreenSharing,\n    callDuration: formatCallDuration(callDuration), incomingCall, activeCall,\n    startCall, acceptCall, declineCall, endCall, toggleAudio, toggleVideo, startScreenShare\n  };\n};\n","path":null,"size_bytes":16154,"size_tokens":null},"src/lib/tab-card-enhancer.ts":{"content":"'use client';\n\nclass TabCardEnhancer {\n  private styleElement: HTMLStyleElement | null = null;\n  private colorInterval: NodeJS.Timeout | null = null;\n\n  constructor() {\n    if (typeof window !== 'undefined') {\n      this.injectStyles();\n    }\n  }\n\n  private injectStyles() {\n    this.styleElement = document.createElement('style');\n    this.styleElement.id = 'tab-card-enhancer';\n    document.head.appendChild(this.styleElement);\n  }\n\n  // Change entire tab card color\n  setColor(color: string, textColor: string = '#ffffff') {\n    this.setTabColor(color, textColor);\n  }\n\n  setTabColor(color: string, textColor: string = '#ffffff') {\n    if (!this.styleElement) return;\n    \n    this.styleElement.textContent = `\n      /* Chrome/Edge Tab Styling */\n      :root {\n        --tab-bg-color: ${color};\n        --tab-text-color: ${textColor};\n      }\n      \n\n      \n      /* Meta theme color for mobile browsers */\n      meta[name=\"theme-color\"] {\n        content: ${color} !important;\n      }\n      \n\n      \n      /* Scrollbar styling to match */\n      ::-webkit-scrollbar {\n        width: 8px;\n      }\n      ::-webkit-scrollbar-track {\n        background: ${color}20;\n      }\n      ::-webkit-scrollbar-thumb {\n        background: ${color};\n        border-radius: 4px;\n      }\n    `;\n    \n    // Update theme-color meta tag\n    this.updateThemeColor(color);\n  }\n\n  private updateThemeColor(color: string) {\n    let themeColorMeta = document.querySelector('meta[name=\"theme-color\"]') as HTMLMetaElement;\n    if (!themeColorMeta) {\n      themeColorMeta = document.createElement('meta');\n      themeColorMeta.name = 'theme-color';\n      document.head.appendChild(themeColorMeta);\n    }\n    themeColorMeta.content = color;\n  }\n\n  // Animated color cycling for full tab\n  startColorCycle(colors: string[] = ['#ff0080', '#0080ff', '#80ff00', '#ff8000', '#8000ff']) {\n    if (this.colorInterval) clearInterval(this.colorInterval);\n    \n    let colorIndex = 0;\n    this.colorInterval = setInterval(() => {\n      this.setTabColor(colors[colorIndex]);\n      colorIndex = (colorIndex + 1) % colors.length;\n    }, 1000);\n  }\n\n  // Pulsing effect\n  startPulse(baseColor: string = '#00ffff') {\n    if (this.colorInterval) clearInterval(this.colorInterval);\n    \n    let intensity = 0;\n    this.colorInterval = setInterval(() => {\n      const alpha = (Math.sin(intensity) + 1) / 2;\n      const brightness = 0.5 + alpha * 0.5;\n      \n      if (!this.styleElement) return;\n      \n      this.styleElement.textContent = `\n\n      `;\n      \n      this.updateThemeColor(`${baseColor}${Math.floor(alpha * 255).toString(16).padStart(2, '0')}`);\n      intensity += 0.2;\n    }, 100);\n  }\n\n  // Rainbow effect\n  startRainbow() {\n    if (this.colorInterval) clearInterval(this.colorInterval);\n    \n    let hue = 0;\n    this.colorInterval = setInterval(() => {\n      const color = `hsl(${hue}, 70%, 50%)`;\n      this.setTabColor(color);\n      hue = (hue + 10) % 360;\n    }, 100);\n  }\n\n  // Glitch effect\n  startGlitch() {\n    if (this.colorInterval) clearInterval(this.colorInterval);\n    \n    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];\n    this.colorInterval = setInterval(() => {\n      const randomColor = colors[Math.floor(Math.random() * colors.length)];\n      this.setTabColor(randomColor);\n    }, 150);\n    \n    // Stop glitch after 3 seconds\n    setTimeout(() => {\n      this.stopEffects();\n      this.setTabColor('#00ffff');\n    }, 3000);\n  }\n\n  // Activity-based colors\n  setActivity(type: 'loading' | 'error' | 'success' | 'warning') {\n    const configs = {\n      loading: '#ffd700',\n      error: '#ff4757', \n      success: '#2ed573',\n      warning: '#ffa502'\n    };\n    \n    this.setTabColor(configs[type]);\n    \n    // Auto-reset after 3 seconds\n    setTimeout(() => {\n      this.setTabColor('#00ffff');\n    }, 3000);\n  }\n\n  // Stop all effects\n  stopEffects() {\n    if (this.colorInterval) {\n      clearInterval(this.colorInterval);\n      this.colorInterval = null;\n    }\n    if (this.styleElement) {\n      this.styleElement.textContent = '';\n    }\n  }\n\n  // Reset to default\n  reset() {\n    this.stopEffects();\n    if (this.styleElement) {\n      this.styleElement.textContent = '';\n    }\n    this.updateThemeColor('#000000');\n  }\n\n  // Notification flash\n  flashNotification(count: number = 1) {\n    let flashes = 0;\n    const flashInterval = setInterval(() => {\n      if (flashes % 2 === 0) {\n        this.setTabColor('#ff0066');\n      } else {\n        this.setTabColor('#000000');\n      }\n      flashes++;\n      \n      if (flashes >= count * 2) {\n        clearInterval(flashInterval);\n        this.setTabColor('#00ffff');\n      }\n    }, 300);\n  }\n}\n\nexport const tabCardEnhancer = new TabCardEnhancer();","path":null,"size_bytes":4726,"size_tokens":null},"src/app/store/page.tsx":{"content":"'use client';\nimport { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ArrowRight, ShoppingBag, Package, Star, Loader2, Check, X } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { cn } from \"@/lib/utils\";\nimport { storeCategories, storeItems, StoreItem } from \"@/lib/store-items\";\nimport { useUser } from \"@/hooks/use-user\";\nimport { useFirestore } from '@/firebase/provider';\nimport { doc, updateDoc, arrayUnion, getDoc } from 'firebase/firestore';\nimport { useToast } from '@/hooks/use-toast';\nimport Image from 'next/image';\n\ninterface PurchaseState {\n  [itemId: string]: boolean;\n}\n\nconst rarityColors = {\n  'Common': 'bg-gray-500',\n  'Rare': 'bg-blue-500',\n  'Epic': 'bg-purple-500',\n  'Cyber Rare': 'bg-cyan-500',\n  'Legendary': 'bg-yellow-500',\n  'Mythic': 'bg-red-500'\n};\n\nexport default function StorePage() {\n    return (\n        <div className=\"flex flex-col items-center justify-center h-[70vh] space-y-6\">\n            <ShoppingBag className=\"w-24 h-24 text-primary animate-pulse\" />\n            <h1 className=\"text-4xl font-headline text-glow\">Coming Soon</h1>\n            <p className=\"text-muted-foreground text-center max-w-md\">\n                The AetherStore is currently under construction. Check back soon for exclusive items, themes, and upgrades!\n            </p>\n        </div>\n    );\n}\n\nfunction StorePageOld() {\n    const { profile, user, updateProfile } = useUser();\n    const firestore = useFirestore();\n    const { toast } = useToast();\n    const [selectedItems, setSelectedItems] = useState<string[]>([]);\n    const [purchasing, setPurchasing] = useState<PurchaseState>({});\n    const [inventory, setInventory] = useState<string[]>([]);\n    const [activeTab, setActiveTab] = useState('browse');\n\n    useEffect(() => {\n        if (profile?.inventory) {\n            setInventory(profile.inventory);\n        }\n    }, [profile]);\n\n    const handleItemSelect = (itemId: string) => {\n        setSelectedItems(prev => \n            prev.includes(itemId) \n                ? prev.filter(id => id !== itemId)\n                : [...prev, itemId]\n        );\n    };\n\n    const handlePurchase = async (item: StoreItem) => {\n        if (!user || !firestore || !profile) return;\n        \n        if (profile.xp < item.price) {\n            toast({ variant: 'destructive', title: 'Insufficient XP', description: `You need ${item.price} XP to purchase this item.` });\n            return;\n        }\n\n        if (inventory.includes(item.id)) {\n            toast({ variant: 'destructive', title: 'Already Owned', description: 'You already own this item.' });\n            return;\n        }\n\n        setPurchasing(prev => ({ ...prev, [item.id]: true }));\n        \n        try {\n            const userRef = doc(firestore, 'users', user.uid);\n            await updateDoc(userRef, {\n                xp: profile.xp - item.price,\n                inventory: arrayUnion(item.id)\n            });\n            \n            await updateProfile({ \n                xp: profile.xp - item.price,\n                inventory: [...inventory, item.id]\n            });\n            \n            setInventory(prev => [...prev, item.id]);\n            toast({ title: 'Purchase Successful!', description: `${item.name} has been added to your inventory.` });\n        } catch (error) {\n            console.error('Purchase failed:', error);\n            toast({ variant: 'destructive', title: 'Purchase Failed', description: 'Something went wrong. Please try again.' });\n        } finally {\n            setPurchasing(prev => ({ ...prev, [item.id]: false }));\n        }\n    };\n\n    const handleBulkPurchase = async () => {\n        if (!user || !firestore || !profile || selectedItems.length === 0) return;\n        \n        const itemsToPurchase = storeItems.filter(item => selectedItems.includes(item.id) && !inventory.includes(item.id));\n        const totalCost = itemsToPurchase.reduce((sum, item) => sum + item.price, 0);\n        \n        if (profile.xp < totalCost) {\n            toast({ variant: 'destructive', title: 'Insufficient XP', description: `You need ${totalCost} XP to purchase selected items.` });\n            return;\n        }\n\n        setPurchasing(prev => {\n            const newState = { ...prev };\n            selectedItems.forEach(id => newState[id] = true);\n            return newState;\n        });\n        \n        try {\n            const userRef = doc(firestore, 'users', user.uid);\n            const newInventory = [...inventory, ...itemsToPurchase.map(item => item.id)];\n            \n            await updateDoc(userRef, {\n                xp: profile.xp - totalCost,\n                inventory: newInventory\n            });\n            \n            await updateProfile({ \n                xp: profile.xp - totalCost,\n                inventory: newInventory\n            });\n            \n            setInventory(newInventory);\n            setSelectedItems([]);\n            toast({ title: 'Bulk Purchase Successful!', description: `${itemsToPurchase.length} items added to your inventory.` });\n        } catch (error) {\n            console.error('Bulk purchase failed:', error);\n            toast({ variant: 'destructive', title: 'Purchase Failed', description: 'Something went wrong. Please try again.' });\n        } finally {\n            setPurchasing({});\n        }\n    };\n\n    const ItemCard = ({ item }: { item: StoreItem }) => {\n        const isOwned = inventory.includes(item.id);\n        const isSelected = selectedItems.includes(item.id);\n        const isPurchasing = purchasing[item.id];\n        const canAfford = (profile?.xp ?? 0) >= item.price;\n\n        return (\n            <Card \n                className={cn(\n                    \"group cursor-pointer transition-all duration-200 hover:scale-105\",\n                    isSelected && \"ring-2 ring-primary\",\n                    isOwned && \"opacity-75 bg-green-500/10\"\n                )}\n                onClick={() => !isOwned && handleItemSelect(item.id)}\n            >\n                <CardHeader className=\"pb-2\">\n                    <div className=\"relative aspect-video rounded-lg overflow-hidden mb-2\">\n                        {item.imageUrl ? (\n                            <Image src={item.imageUrl} alt={item.name} fill sizes=\"(max-width: 768px) 50vw, (max-width: 1024px) 33vw, (max-width: 1280px) 25vw, 20vw\" className=\"object-cover\" />\n                        ) : (\n                            <div className=\"w-full h-full bg-muted flex items-center justify-center\">\n                                <item.icon className=\"w-12 h-12 text-muted-foreground\" />\n                            </div>\n                        )}\n                        {isOwned && (\n                            <div className=\"absolute top-2 right-2 bg-green-500 rounded-full p-1\">\n                                <Check className=\"w-4 h-4 text-white\" />\n                            </div>\n                        )}\n                        {isSelected && !isOwned && (\n                            <div className=\"absolute top-2 right-2 bg-primary rounded-full p-1\">\n                                <Star className=\"w-4 h-4 text-white\" />\n                            </div>\n                        )}\n                    </div>\n                    <div className=\"flex items-start justify-between\">\n                        <CardTitle className=\"text-lg font-headline\">{item.name}</CardTitle>\n                        <Badge className={cn(\"text-xs\", rarityColors[item.rarity])}>\n                            {item.rarity}\n                        </Badge>\n                    </div>\n                </CardHeader>\n                <CardContent>\n                    <p className=\"text-sm text-muted-foreground mb-4\">{item.description}</p>\n                    <div className=\"flex items-center justify-between\">\n                        <span className=\"text-lg font-bold text-primary\">{item.price} XP</span>\n                        <Button \n                            size=\"sm\" \n                            onClick={(e) => {\n                                e.stopPropagation();\n                                handlePurchase(item);\n                            }}\n                            disabled={isOwned || isPurchasing || !canAfford}\n                            className={cn(\n                                isOwned && \"bg-green-500 hover:bg-green-600\",\n                                !canAfford && !isOwned && \"opacity-50\"\n                            )}\n                        >\n                            {isPurchasing ? (\n                                <Loader2 className=\"w-4 h-4 animate-spin\" />\n                            ) : isOwned ? (\n                                <>Owned <Check className=\"w-4 h-4 ml-1\" /></>\n                            ) : !canAfford ? (\n                                <>Can't Afford <X className=\"w-4 h-4 ml-1\" /></>\n                            ) : (\n                                'Purchase'\n                            )}\n                        </Button>\n                    </div>\n                </CardContent>\n            </Card>\n        );\n    };\n\n    const selectedItemsData = storeItems.filter(item => selectedItems.includes(item.id) && !inventory.includes(item.id));\n    const totalCost = selectedItemsData.reduce((sum, item) => sum + item.price, 0);\n    const ownedItems = storeItems.filter(item => inventory.includes(item.id));\n\n    return (\n        <div className=\"space-y-8\">\n            <header className=\"flex items-center justify-between\">\n                <h1 className=\"text-3xl font-headline text-glow flex items-center gap-3\">\n                    <ShoppingBag /> AetherStore\n                </h1>\n                <div className=\"flex items-center gap-4\">\n                    <p className=\"text-lg text-primary font-bold\">XP: {profile?.xp ?? '...'}</p>\n                    <Badge variant=\"secondary\">\n                        <Package className=\"w-4 h-4 mr-1\" />\n                        {inventory.length} Items\n                    </Badge>\n                </div>\n            </header>\n\n            <Tabs value={activeTab} onValueChange={setActiveTab}>\n                <TabsList className=\"grid w-full grid-cols-3\">\n                    <TabsTrigger value=\"browse\">Browse Store</TabsTrigger>\n                    <TabsTrigger value=\"inventory\">My Inventory ({inventory.length})</TabsTrigger>\n                    <TabsTrigger value=\"categories\">Categories</TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"browse\" className=\"space-y-6\">\n                    {selectedItems.length > 0 && (\n                        <Card className=\"border-primary\">\n                            <CardHeader>\n                                <CardTitle className=\"flex items-center justify-between\">\n                                    <span>Selected Items ({selectedItemsData.length})</span>\n                                    <Button \n                                        onClick={() => setSelectedItems([])}\n                                        variant=\"ghost\" \n                                        size=\"sm\"\n                                    >\n                                        Clear All\n                                    </Button>\n                                </CardTitle>\n                            </CardHeader>\n                            <CardContent>\n                                <div className=\"flex items-center justify-between\">\n                                    <div>\n                                        <p className=\"text-sm text-muted-foreground\">\n                                            Total Cost: <span className=\"text-primary font-bold\">{totalCost} XP</span>\n                                        </p>\n                                        <p className=\"text-xs text-muted-foreground\">\n                                            After purchase: {(profile?.xp ?? 0) - totalCost} XP remaining\n                                        </p>\n                                    </div>\n                                    <Button \n                                        onClick={handleBulkPurchase}\n                                        disabled={selectedItemsData.length === 0 || (profile?.xp ?? 0) < totalCost || Object.values(purchasing).some(Boolean)}\n                                        className=\"cyber-button\"\n                                    >\n                                        {Object.values(purchasing).some(Boolean) ? (\n                                            <><Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> Purchasing...</>\n                                        ) : (\n                                            <>Purchase All ({selectedItemsData.length})</>\n                                        )}\n                                    </Button>\n                                </div>\n                            </CardContent>\n                        </Card>\n                    )}\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                        {storeItems.map((item) => (\n                            <ItemCard key={item.id} item={item} />\n                        ))}\n                    </div>\n                </TabsContent>\n\n                <TabsContent value=\"inventory\" className=\"space-y-6\">\n                    {ownedItems.length === 0 ? (\n                        <Card>\n                            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                                <Package className=\"w-16 h-16 text-muted-foreground mb-4\" />\n                                <h3 className=\"text-xl font-headline mb-2\">No Items Yet</h3>\n                                <p className=\"text-muted-foreground text-center mb-4\">\n                                    Your purchased items will appear here. Start shopping to build your collection!\n                                </p>\n                                <Button onClick={() => setActiveTab('browse')}>\n                                    Browse Store\n                                </Button>\n                            </CardContent>\n                        </Card>\n                    ) : (\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                            {ownedItems.map((item) => (\n                                <ItemCard key={item.id} item={item} />\n                            ))}\n                        </div>\n                    )}\n                </TabsContent>\n\n                <TabsContent value=\"categories\">\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                        {storeCategories.map((category) => {\n                            const categoryItems = storeItems.filter(item => item.category === category.id);\n                            const ownedInCategory = categoryItems.filter(item => inventory.includes(item.id)).length;\n                            \n                            return (\n                                <Card key={category.id} className=\"flex flex-col group overflow-hidden\">\n                                    <CardHeader className=\"flex-row items-start gap-4 pb-4\">\n                                        <div className={cn(\"w-12 h-12 flex items-center justify-center rounded-lg\", category.bgColor)}>\n                                            <category.icon className={cn(\"w-6 h-6\", category.color)} />\n                                        </div>\n                                        <div className=\"flex-1\">\n                                            <CardTitle className=\"text-xl font-headline\">{category.name}</CardTitle>\n                                            <Badge variant=\"outline\" className=\"mt-1\">\n                                                {ownedInCategory}/{categoryItems.length} owned\n                                            </Badge>\n                                        </div>\n                                    </CardHeader>\n                                    <CardContent className=\"flex-1 flex flex-col justify-between\">\n                                        <p className=\"text-sm text-muted-foreground mb-4\">{category.description}</p>\n                                        <Link href={`/store/${category.id}`} className=\"mt-auto\">\n                                            <Button className=\"w-full cyber-button\">\n                                                Browse Section <ArrowRight className=\"ml-2 h-4 w-4\" />\n                                            </Button>\n                                        </Link>\n                                    </CardContent>\n                                </Card>\n                            );\n                        })}\n                    </div>\n                </TabsContent>\n            </Tabs>\n        </div>\n    );\n}\n","path":null,"size_bytes":17129,"size_tokens":null},"src/app/settings/page.tsx":{"content":"\n'use client';\nimport { useState } from 'react';\nimport {\n  User,\n  ShieldCheck,\n  Palette,\n  MousePointer2,\n  Bell,\n  Keyboard,\n  Settings as SettingsIcon,\n  Code,\n} from 'lucide-react';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { useUser } from '@/hooks/use-user';\nimport { Skeleton } from '@/components/ui/skeleton';\n\n// Import setting panel components\nimport AccountSettings from '@/components/settings/account-settings';\nimport AppearanceSettings from '@/components/settings/appearance-settings';\nimport InterfaceSettings from '@/components/settings/interface-settings';\nimport NotificationSettings from '@/components/settings/notification-settings';\nimport KeybindSettings from '@/components/settings/keybind-settings';\nimport AppSettings from '@/components/settings/app-settings';\nimport DeveloperSettings from '@/components/settings/developer-settings';\n\nconst settingsNav = [\n  { id: 'account', label: 'My Account', icon: User, component: AccountSettings },\n  { id: 'appearance', label: 'Appearance', icon: Palette, component: AppearanceSettings },\n  { id: 'interface', label: 'Interface', icon: MousePointer2, component: InterfaceSettings },\n  { id: 'notifications', label: 'Notifications', icon: Bell, component: NotificationSettings },\n  { id: 'keybinds', label: 'Keybinds', icon: Keyboard, component: KeybindSettings },\n  { id: 'app-settings', label: 'App Settings', icon: SettingsIcon, component: AppSettings },\n  { id: 'developer', label: 'Developer', icon: Code, component: DeveloperSettings },\n];\n\nexport default function SettingsPage() {\n  const [activeTab, setActiveTab] = useState('account');\n  const { profile, loading } = useUser();\n\n  const ActiveComponent = settingsNav.find((item) => item.id === activeTab)?.component;\n\n  if (loading || !profile) {\n    return (\n        <div className=\"grid md:grid-cols-[240px_1fr] gap-8 h-full\">\n            <div className=\"hidden md:block\">\n                <Skeleton className=\"h-12 w-full\" />\n                <div className=\"mt-8 space-y-2\">\n                    {Array.from({ length: 7 }).map((_, i) => (\n                        <Skeleton key={i} className=\"h-10 w-full\" />\n                    ))}\n                </div>\n            </div>\n            <div>\n                <Skeleton className=\"h-full w-full\" />\n            </div>\n        </div>\n    );\n  }\n\n\n  return (\n    <div className=\"grid md:grid-cols-[240px_1fr] gap-x-12 h-full items-start\">\n      {/* Sidebar Navigation */}\n      <aside className=\"hidden md:block pr-4\">\n        <nav className=\"flex flex-col gap-1\">\n          {settingsNav.map((item) => (\n            <button\n              key={item.id}\n              onClick={() => setActiveTab(item.id)}\n              className={cn(\n                'flex items-center gap-3 px-4 py-2.5 text-left text-sm font-medium rounded-md transition-colors',\n                activeTab === item.id\n                  ? 'bg-primary/20 text-primary-foreground'\n                  : 'text-muted-foreground hover:bg-muted/50 hover:text-foreground'\n              )}\n            >\n              <item.icon className=\"w-5 h-5\" />\n              <span>{item.label}</span>\n            </button>\n          ))}\n        </nav>\n      </aside>\n\n      {/* Main Content */}\n      <main className=\"h-full overflow-y-auto custom-scroll\">\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={activeTab}\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            transition={{ duration: 0.2, ease: 'easeInOut' }}\n          >\n            {ActiveComponent && <ActiveComponent />}\n          </motion.div>\n        </AnimatePresence>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":3761,"size_tokens":null},"src/types/chat.ts":{"content":"import { Timestamp } from 'firebase/firestore';\nimport { PublicUser } from '@/hooks/use-connections';\n\nexport interface Contact {\n    id: string;\n    name: string;\n    avatar: string;\n    status: string;\n    type: 'user' | 'bot' | 'group';\n    members?: PublicUser[];\n}\n\nexport interface Message {\n  id: string;\n  senderId: string;\n  senderName: string;\n  senderAvatar: string;\n  content: string;\n  mediaUrl?: string;\n  mediaType?: string;\n  timestamp: Timestamp | null;\n  reactions?: { [key: string]: string[] }; // emoji -> userId[]\n  replyTo?: string; // messageId\n  replyContent?: string;\n  replySender?: string;\n  role?: 'user' | 'model';\n  status: 'sent' | 'delivered' | 'read';\n  participants: string[];\n  importantFor?: string[]; // userIds who marked this as important\n}\n\nexport const aetherBotContact: Contact = {\n    id: 'aether-bot',\n    name: 'Aether',\n    avatar: '',\n    status: 'Online',\n    type: 'bot',\n};","path":null,"size_bytes":923,"size_tokens":null},"src/components/layout/notification-panel.tsx":{"content":"\n'use client';\nimport { Button } from '@/components/ui/button';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetFooter } from '@/components/ui/sheet';\nimport { useNotifications, Notification } from '@/hooks/use-notifications';\nimport { ScrollArea } from '../ui/scroll-area';\nimport { cn } from '@/lib/utils';\nimport { Bell, CheckCheck, MessageSquare, FileUp } from 'lucide-react';\nimport { Skeleton } from '../ui/skeleton';\nimport { formatDistanceToNow } from 'date-fns';\n\nconst notificationIcons = {\n    new_message: <MessageSquare className=\"w-5 h-5 text-primary\" />,\n    file_upload: <FileUp className=\"w-5 h-5 text-green-500\" />,\n    task_reminder: <Bell className=\"w-5 h-5 text-yellow-500\" />,\n    system_alert: <Bell className=\"w-5 h-5 text-destructive\" />,\n    friend_request: <Bell className=\"w-5 h-5 text-secondary\" />,\n};\n\ninterface NotificationPanelProps {\n    isOpen: boolean;\n    onOpenChange: (isOpen: boolean) => void;\n}\n\nexport default function NotificationPanel({ isOpen, onOpenChange }: NotificationPanelProps) {\n    const { notifications, loading, markAsRead, markAllAsRead } = useNotifications();\n\n    const handleNotificationClick = (notification: Notification) => {\n        if (!notification.isRead) {\n            markAsRead(notification.id);\n        }\n        // Potentially navigate to notification.link if it exists\n        onOpenChange(false);\n    };\n\n    return (\n        <Sheet open={isOpen} onOpenChange={onOpenChange}>\n            <SheetContent className=\"flex flex-col p-0 glass-card\" side=\"right\">\n                <SheetHeader className=\"p-6 pb-4\">\n                    <SheetTitle className=\"flex items-center gap-3 font-headline text-2xl text-glow\">\n                        <Bell className=\"text-primary\" />\n                        Notifications\n                    </SheetTitle>\n                </SheetHeader>\n                <ScrollArea className=\"flex-1\">\n                    <div className=\"p-6 pt-0 space-y-4\">\n                        {loading ? (\n                            Array.from({ length: 5 }).map((_, i) => (\n                                <div key={i} className=\"flex items-center space-x-4\">\n                                    <Skeleton className=\"h-10 w-10 rounded-full\" />\n                                    <div className=\"space-y-2\">\n                                        <Skeleton className=\"h-4 w-[200px]\" />\n                                        <Skeleton className=\"h-4 w-[150px]\" />\n                                    </div>\n                                </div>\n                            ))\n                        ) : notifications.length === 0 ? (\n                             <div className=\"flex flex-col items-center justify-center text-center h-64 text-muted-foreground\">\n                                <Bell className=\"w-12 h-12 mb-4\" />\n                                <h3 className=\"text-lg font-headline\">No Notifications</h3>\n                                <p className=\"text-sm\">You're all caught up!</p>\n                            </div>\n                        ) : (\n                            notifications.map(notification => (\n                                <div\n                                    key={notification.id}\n                                    onClick={() => handleNotificationClick(notification)}\n                                    className={cn(\n                                        \"flex items-start gap-4 p-3 rounded-lg cursor-pointer transition-colors hover:bg-muted/50\",\n                                        !notification.isRead && \"bg-primary/10\"\n                                    )}\n                                >\n                                    <div className=\"w-10 h-10 flex-shrink-0 rounded-full flex items-center justify-center bg-muted\">\n                                        {notificationIcons[notification.type] || <Bell className=\"w-5 h-5 text-primary\" />}\n                                    </div>\n                                    <div className=\"flex-1\">\n                                        <p className=\"font-semibold\">{notification.title}</p>\n                                        <p className=\"text-sm text-muted-foreground\">{notification.description}</p>\n                                        <p className=\"text-xs text-muted-foreground/80 mt-1\">\n                                            {formatDistanceToNow(notification.createdAt.toDate(), { addSuffix: true })}\n                                        </p>\n                                    </div>\n                                    {!notification.isRead && (\n                                        <div className=\"w-2.5 h-2.5 rounded-full bg-primary neon-glow-primary mt-1 flex-shrink-0\" title=\"Unread\"></div>\n                                    )}\n                                </div>\n                            ))\n                        )}\n                    </div>\n                </ScrollArea>\n                <SheetFooter className=\"p-4 border-t bg-background/50 backdrop-blur-sm\">\n                    <Button onClick={markAllAsRead} className=\"w-full\" disabled={notifications.every(n => n.isRead)}>\n                        <CheckCheck className=\"mr-2 h-4 w-4\" />\n                        Mark all as read\n                    </Button>\n                </SheetFooter>\n            </SheetContent>\n        </Sheet>\n    );\n}\n\n    ","path":null,"size_bytes":5364,"size_tokens":null},"src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        Chevron: ({ orientation, ...props }) => (\n          orientation === 'left' ? \n            <ChevronLeft className=\"h-4 w-4\" /> : \n            <ChevronRight className=\"h-4 w-4\" />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2636,"size_tokens":null},"src/components/settings/animation-settings.tsx":{"content":"\n'use client';\nimport { useState } from 'react';\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from '../ui/button';\nimport { Check, Loader2 } from 'lucide-react';\nimport { useUser } from '@/hooks/use-user';\nimport { cn } from '@/lib/utils';\n\ntype AnimationLevel = 'none' | 'basic' | 'full';\n\nconst levels: { id: AnimationLevel; name: string; description: string }[] = [\n  { id: 'none', name: 'None', description: 'Disables all non-essential UI animations for maximum performance.' },\n  { id: 'basic', name: 'Basic', description: 'Enables simple fades and transitions. Recommended for most systems.' },\n  { id: 'full', name: 'Full', description: 'Enables all UI effects, including glows, particles, and complex animations.' },\n];\n\nexport default function AnimationSettings() {\n  const { profile, updateProfileSettings } = useUser();\n  const [selectedLevel, setSelectedLevel] = useState<AnimationLevel>(profile?.settings?.animations?.level || 'full');\n  const [isSaving, setIsSaving] = useState(false);\n\n  const handleSave = async () => {\n    setIsSaving(true);\n    await updateProfileSettings({\n        ...profile?.settings,\n        animations: {\n            level: selectedLevel\n        }\n    });\n    setIsSaving(false);\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <RadioGroup value={selectedLevel} onValueChange={(value: AnimationLevel) => setSelectedLevel(value)} className=\"space-y-4\">\n        {levels.map((level) => (\n          <Label \n            key={level.id}\n            htmlFor={level.id}\n            className={cn(\n                \"flex items-start gap-4 rounded-lg border p-4 cursor-pointer transition-all bg-background/30\",\n                selectedLevel === level.id && \"neon-border-primary\"\n            )}\n          >\n            <RadioGroupItem value={level.id} id={level.id} className=\"mt-1\"/>\n            <div className=\"flex flex-col gap-1\">\n              <span className=\"font-bold\">{level.name}</span>\n              <span className=\"font-normal text-muted-foreground text-sm\">{level.description}</span>\n            </div>\n          </Label>\n        ))}\n      </RadioGroup>\n       <Button onClick={handleSave} disabled={isSaving}>\n        {isSaving ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <Check className=\"mr-2 h-4 w-4\" />}\n        Save Animation Settings\n      </Button>\n    </div>\n  );\n}\n","path":null,"size_bytes":2426,"size_tokens":null},"src/firebase/index.ts":{"content":"'use client';\nimport { initializeApp, getApps, getApp, type FirebaseApp } from 'firebase/app';\nimport { getAuth, type Auth } from 'firebase/auth';\nimport {\n  getFirestore,\n  type Firestore\n} from 'firebase/firestore';\nimport { firebaseConfig } from './config';\n\n// ---\n// App\n// ---\n\nlet firebaseApp: FirebaseApp | undefined;\nlet authInstance: Auth | undefined;\nlet firestoreInstance: Firestore | undefined;\n\nfunction initializeFirebase(): { app: FirebaseApp, auth: Auth, firestore: Firestore } {\n  if (!firebaseApp) {\n    if (getApps().length === 0) {\n      firebaseApp = initializeApp(firebaseConfig);\n    } else {\n      firebaseApp = getApp();\n    }\n  }\n\n  if(!authInstance) {\n    authInstance = getAuth(firebaseApp);\n  }\n\n  if (!firestoreInstance) {\n    // Use regular getFirestore for faster initialization\n    firestoreInstance = getFirestore(firebaseApp);\n  }\n\n  return { app: firebaseApp, auth: authInstance, firestore: firestoreInstance };\n}\n\nconst { auth, firestore } = initializeFirebase();\n\nexport { initializeFirebase, auth, firestore };\n","path":null,"size_bytes":1051,"size_tokens":null},"src/components/calls/SenderPanel.tsx":{"content":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { Loader2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { useEffect, useState } from 'react';\n\ninterface SenderPanelProps {\n  callerName: string;\n  callerAvatar?: string;\n  onEndCall: () => void;\n}\n\nexport default function SenderPanel({ callerName, callerAvatar, onEndCall }: SenderPanelProps) {\n  const [status, setStatus] = useState<'calling' | 'ringing' | 'connecting'>('calling');\n\n  useEffect(() => {\n    const timer1 = setTimeout(() => setStatus('ringing'), 1000);\n    const timer2 = setTimeout(() => setStatus('connecting'), 3000);\n    return () => {\n      clearTimeout(timer1);\n      clearTimeout(timer2);\n    };\n  }, []);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.9 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.9 }}\n      className=\"fixed inset-0 z-[9999] bg-gradient-to-br from-background via-background/95 to-primary/5 backdrop-blur-xl flex items-center justify-center\"\n    >\n      <div className=\"glass-card p-12 rounded-3xl border-2 border-primary/20 shadow-2xl max-w-md w-full mx-4\">\n        <div className=\"flex flex-col items-center gap-6\">\n          <div className=\"relative\">\n            <Avatar className=\"w-32 h-32 border-4 border-primary/30 shadow-xl\">\n              <AvatarImage src={callerAvatar} />\n              <AvatarFallback className=\"text-5xl bg-primary/10\">{callerName[0]}</AvatarFallback>\n            </Avatar>\n            <motion.div\n              className=\"absolute inset-0 rounded-full border-4 border-primary\"\n              animate={{ scale: [1, 1.3, 1], opacity: [0.6, 0, 0.6] }}\n              transition={{ duration: 2, repeat: Infinity, ease: 'easeInOut' }}\n            />\n            <motion.div\n              className=\"absolute inset-0 rounded-full border-4 border-primary\"\n              animate={{ scale: [1, 1.3, 1], opacity: [0.4, 0, 0.4] }}\n              transition={{ duration: 2, repeat: Infinity, ease: 'easeInOut', delay: 0.5 }}\n            />\n          </div>\n\n          <div className=\"text-center space-y-2\">\n            <h2 className=\"text-3xl font-bold text-glow\">{callerName}</h2>\n            <motion.div\n              key={status}\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"flex items-center justify-center gap-2 text-lg\"\n            >\n              {status === 'connecting' && <Loader2 className=\"w-5 h-5 animate-spin text-primary\" />}\n              <p className=\"text-muted-foreground\">\n                {status === 'calling' && 'Calling...'}\n                {status === 'ringing' && 'Ringing...'}\n                {status === 'connecting' && 'Connecting...'}\n              </p>\n            </motion.div>\n          </div>\n\n          <Button\n            variant=\"destructive\"\n            size=\"lg\"\n            onClick={onEndCall}\n            className=\"w-16 h-16 rounded-full bg-red-500 hover:bg-red-600 shadow-lg hover:shadow-xl transition-all\"\n          />\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n","path":null,"size_bytes":3173,"size_tokens":null},"src/app/globals.css":{"content":"\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  :root {\n    --background: var(--theme-background);\n    --foreground: var(--theme-foreground);\n    --card: var(--theme-card);\n    --card-foreground: var(--theme-card-foreground);\n    --popover: var(--theme-popover);\n    --popover-foreground: var(--theme-popover-foreground);\n    --primary: var(--theme-primary);\n    --primary-foreground: var(--theme-primary-foreground);\n    --secondary: var(--theme-secondary);\n    --secondary-foreground: var(--theme-secondary-foreground);\n    --muted: var(--theme-muted);\n    --muted-foreground: var(--theme-muted-foreground);\n    --accent: var(--theme-accent);\n    --accent-foreground: var(--theme-accent-foreground);\n    --destructive: var(--theme-destructive);\n    --destructive-foreground: var(--theme-destructive-foreground);\n    --border: var(--theme-border);\n    --input: var(--theme-input);\n    --ring: var(--theme-ring);\n\n    --radius: 0.75rem;\n\n    --cursor-glow-color: hsl(var(--primary));\n    --cursor-glow-size: 20px;\n    --cursor-dot-size: 8px;\n    --cursor-trail-color: hsl(var(--primary) / 0.5);\n\n    /* Gaming Theme variables as fallbacks */\n    --gaming-background: hsl(var(--theme-background));\n    --gaming-background-secondary: hsl(var(--theme-card));\n    --gaming-background-tertiary: hsl(var(--theme-muted));\n    --gaming-foreground: hsl(var(--theme-foreground));\n    --gaming-muted-foreground: hsl(var(--theme-muted-foreground));\n    --gaming-border: hsl(var(--theme-border));\n    --gaming-primary: hsl(var(--theme-primary));\n    --gaming-primary-foreground: hsl(var(--theme-primary-foreground));\n  }\n\n  .theme-neon-gamer, .theme-galaxy-fade {\n     --gaming-background: hsl(var(--theme-background));\n    --gaming-background-secondary: hsl(var(--theme-card));\n    --gaming-background-tertiary: hsl(var(--theme-muted));\n    --gaming-foreground: hsl(var(--theme-foreground));\n    --gaming-muted-foreground: hsl(var(--theme-muted-foreground));\n    --gaming-border: hsl(var(--theme-border));\n    --gaming-primary: hsl(var(--theme-primary));\n    --gaming-primary-foreground: hsl(var(--theme-primary-foreground));\n  }\n}\n\n@layer base {\n  * {\n    @apply border-border;\n    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, box-shadow;\n    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n    transition-duration: 200ms;\n  }\n  body {\n    @apply bg-background text-foreground;\n    background: linear-gradient(to bottom, hsl(var(--background)), hsl(var(--background) / 0.9));\n    perspective: 1000px;\n  }\n  \n  .loading-active {\n    overflow: hidden !important;\n  }\n\n  body::before {\n    content: '';\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    background-image: \n      radial-gradient(hsl(var(--primary) / 0.05) 1px, transparent 1px),\n      radial-gradient(hsl(var(--secondary) / 0.05) 1px, transparent 1px);\n    background-size: 4rem 4rem;\n    background-position: 0 0, 2rem 2rem;\n    animation: pan-background 60s linear infinite;\n    z-index: -2;\n    transition: background-image 0.2s ease-in-out;\n  }\n  \n  body::after {\n    content: '';\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    background: repeating-linear-gradient(\n      0deg,\n      hsla(0,0%,4%,0) 0,\n      hsla(0,0%,4%,0.15) 50%,\n      hsla(0,0%,4%,0) 100%\n    );\n    background-size: auto 4px;\n    animation: scanline 8s linear infinite;\n    pointer-events: none;\n    z-index: -1;\n  }\n\n  body.cursor-none, .cursor-none {\n    cursor: none !important;\n  }\n}\n\n@layer utilities {\n  .text-glow {\n    @apply bg-gradient-to-r from-primary via-secondary to-primary bg-clip-text text-transparent;\n    text-shadow: 0 0 8px hsl(var(--primary) / 0.8), 0 0 15px hsl(var(--primary) / 0.6);\n    background-size: 200% auto;\n    animation: gradient-shift 5s ease infinite;\n  }\n\n  .neon-glow-primary {\n    box-shadow: 0 0 20px hsl(var(--primary) / 0.7);\n  }\n\n  .neon-border-primary {\n    border-color: hsl(var(--primary) / 0.7);\n    box-shadow: 0 0 8px hsl(var(--primary) / 0.4), inset 0 0 8px hsl(var(--primary) / 0.3);\n  }\n  \n  .neon-border-secondary {\n    border-color: hsl(var(--secondary) / 0.7);\n    box-shadow: 0 0 8px hsl(var(--secondary) / 0.4), inset 0 0 8px hsl(var(--secondary) / 0.3);\n  }\n\n  .glass-card {\n    @apply rounded-xl bg-card/60 backdrop-blur-sm border border-primary/20 transition-all duration-300;\n    box-shadow: 0 4px 12px hsl(var(--primary) / 0.05), inset 0 0 15px hsl(var(--card) / 0.5);\n  }\n  \n  .glass-card:hover {\n    @apply border-primary/40;\n    box-shadow: 0 8px 24px hsl(var(--primary) / 0.1), inset 0 0 20px hsl(var(--card) / 0.7);\n    transform: translateY(-2px);\n  }\n  \n  .enhanced-card {\n    @apply glass-card relative overflow-hidden;\n  }\n  \n  .enhanced-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 1px;\n    background: linear-gradient(90deg, transparent, hsl(var(--primary) / 0.6), transparent);\n    opacity: 0;\n    transition: opacity 0.3s;\n  }\n  \n  .enhanced-card:hover::before {\n    opacity: 1;\n  }\n  \n  .command-hub-item {\n    @apply relative w-24 flex items-center justify-start gap-2 p-2 text-sm text-left rounded-lg transition-colors focus:outline-none overflow-hidden bg-background/80 border border-border/50;\n  }\n\n  .command-hub-item:hover {\n     background-image: radial-gradient(circle at center, hsl(var(--primary) / 0.1), transparent 80%);\n  }\n\n  .cyber-button {\n    @apply relative overflow-hidden bg-primary/90 text-primary-foreground \n           px-6 py-2 font-bold\n           transition-all duration-300\n           border border-primary/50 rounded-lg\n           hover:bg-primary hover:shadow-[0_0_20px_hsl(var(--primary)/0.8)]\n           hover:scale-105 active:scale-95;\n  }\n  \n  .cyber-button::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: -100%;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(90deg, transparent, hsl(var(--primary) / 0.4), transparent);\n    transition: left 0.5s;\n  }\n  \n  .cyber-button:hover::before {\n    left: 100%;\n  }\n\n  .glitch-text {\n    animation: glitch 1.5s linear infinite;\n  }\n  \n  .no-scrollbar::-webkit-scrollbar {\n      display: none;\n  }\n\n  .no-scrollbar {\n      -ms-overflow-style: none;  /* IE and Edge */\n      scrollbar-width: none;  /* Firefox */\n  }\n\n  .prose {\n      @apply max-w-none;\n  }\n\n  .prose code {\n      @apply bg-muted/80 text-secondary rounded px-1.5 py-1 text-sm font-mono border border-border;\n  }\n\n  .prose pre {\n      @apply bg-muted/80 p-4 rounded-lg border border-border;\n  }\n\n  .prose ul {\n      @apply list-disc list-inside;\n  }\n  .prose ol {\n      @apply list-decimal list-inside;\n  }\n  .prose li {\n      @apply mb-2;\n  }\n  \n  .progress-indicator {\n    background-image: linear-gradient(\n      -45deg,\n      hsla(var(--primary), 0.8) 25%,\n      transparent 25%,\n      transparent 50%,\n      hsla(var(--primary), 0.8) 50%,\n      hsla(var(--primary), 0.8) 75%,\n      transparent 75%,\n      transparent\n    );\n    background-size: 20px 20px;\n    box-shadow: 0 0 8px hsl(var(--primary)), inset 0 0 5px hsl(var(--primary) / 0.5);\n    animation: progress-stripes 1s linear infinite;\n  }\n\n  .custom-scroll::-webkit-scrollbar {\n    width: 6px;\n  }\n  .custom-scroll::-webkit-scrollbar-thumb {\n    background: hsl(var(--primary));\n    border-radius: 10px;\n  }\n  .custom-scroll::-webkit-scrollbar-track {\n    background: transparent;\n  }\n  .custom-scroll {\n    scrollbar-width: thin;\n    scrollbar-color: hsl(var(--primary)) transparent;\n  }\n  \n  .call-pulse {\n    animation: call-pulse 2s infinite;\n  }\n  \n  .incoming-call-animation {\n    animation: incoming-call 1s ease-in-out infinite;\n  }\n  \n  .hover-lift {\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\n  }\n  \n  .hover-lift:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 10px 25px hsl(var(--primary) / 0.15);\n  }\n  \n  .responsive-text {\n    @apply text-sm md:text-base;\n  }\n  \n  .responsive-heading {\n    @apply text-lg md:text-xl lg:text-2xl;\n  }\n  \n  .responsive-padding {\n    @apply p-3 md:p-4 lg:p-6;\n  }\n  \n  .responsive-gap {\n    @apply gap-2 md:gap-4 lg:gap-6;\n  }\n  \n  .mobile-hidden {\n    @apply hidden md:block;\n  }\n  \n  .mobile-only {\n    @apply block md:hidden;\n  }\n\n  /* --- Smart Cursor System --- */\n  .cursor-wrapper {\n    will-change: transform;\n    transition: opacity 0.2s ease;\n  }\n  \n  .cursor-dot {\n    width: var(--cursor-dot-size);\n    height: var(--cursor-dot-size);\n    border-radius: 50%;\n    background-color: var(--cursor-glow-color);\n    box-shadow: 0 0 var(--cursor-glow-size) var(--cursor-glow-color);\n    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;\n    will-change: transform, opacity, background-color, box-shadow;\n  }\n\n  .cursor-icon, .cursor-trail {\n    position: absolute;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    opacity: 0;\n    transform: scale(0);\n    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.2s ease;\n    will-change: transform, opacity;\n  }\n\n  .cursor-label {\n    position: absolute;\n    top: -24px;\n    background-color: var(--cursor-glow-color);\n    color: hsl(var(--primary-foreground));\n    font-size: 10px;\n    font-weight: bold;\n    padding: 2px 6px;\n    border-radius: 4px;\n    opacity: 0;\n    transform: translateY(5px);\n    transition: transform 0.2s ease, opacity 0.2s ease;\n  }\n\n  .cursor-trail {\n    width: calc(var(--cursor-dot-size) * 3);\n    height: calc(var(--cursor-dot-size) * 3);\n    border-radius: 50%;\n    background-color: var(--cursor-trail-color);\n    filter: blur(8px);\n    transition: opacity 0.5s ease;\n    z-index: -1;\n  }\n\n  /* --- Cursor Style Variants --- */\n\n  /* 1. Default OP */\n  .cursor-style-default-op .cursor-trail { opacity: 0.5; transform: scale(1); }\n  \n  /* 2. Neon Glow */\n  .cursor-style-neon-glow { --cursor-glow-size: 30px; --cursor-trail-color: hsl(var(--primary) / 0.8); }\n  .cursor-style-neon-glow .cursor-trail { opacity: 0.8; transform: scale(1.2); }\n  \n  /* 3. Futuristic Trail */\n  .cursor-style-futuristic-trail .cursor-dot { transform: scale(0.8); }\n  .cursor-style-futuristic-trail .cursor-trail {\n    opacity: 1; transform: scale(0.5);\n    transition: opacity 0.3s, transform 0.3s;\n    background: radial-gradient(circle, var(--cursor-trail-color) 0%, transparent 70%);\n  }\n\n  /* 4. Spark & Halo */\n  .cursor-style-spark-halo { --cursor-glow-size: 25px; }\n  .cursor-style-spark-halo .cursor-dot:hover { transform: scale(1.2); }\n\n  /* 5. Editor/Wix Style */\n  .cursor-style-editor .cursor-dot { transition-duration: 0.12s; }\n  .cursor-style-editor.cursor-variant-link .cursor-dot { box-shadow: 0 2px 10px var(--cursor-glow-color); }\n  .cursor-style-editor.cursor-variant-text .cursor-dot { opacity: 0; }\n  .cursor-style-editor.cursor-variant-drag .cursor-icon { opacity: 1; transform: scale(1); background-color: var(--cursor-glow-color); border-radius: 50%; width: 32px; height: 32px; color: hsl(var(--primary-foreground)); }\n  .cursor-style-editor.cursor-variant-drag .cursor-label { opacity: 1; transform: translateY(0); }\n\n  /* 6. Minimal Glow Outline */\n  .cursor-style-minimal-glow .cursor-dot { background-color: transparent; border: 2px solid var(--cursor-glow-color); box-shadow: 0 0 10px transparent; }\n  .cursor-style-minimal-glow.cursor-variant-link .cursor-dot { box-shadow: 0 0 15px var(--cursor-glow-color); }\n\n  /* 7. Color Pulse */\n  .cursor-style-color-pulse .cursor-dot { animation: color-pulse-anim 4s linear infinite; }\n  .cursor-style-color-pulse .cursor-trail { opacity: 0.6; transform: scale(1); animation: color-pulse-anim 4s linear infinite; }\n\n  /* Low Performance Mode */\n  .low-perf-mode .cursor-trail, .low-perf-mode .cursor-spark, .low-perf-mode .cursor-ripple { display: none !important; }\n  .low-perf-mode .cursor-dot { box-shadow: none !important; }\n  .low-perf-mode * { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }\n\n\n  /* --- Mode Variants --- */\n  .cursor-variant-link .cursor-dot { transform: scale(1.5); }\n  .cursor-variant-text .cursor-wrapper { opacity: 0; } /* Hide custom cursor, show native I-beam */\n\n  /* --- Rarity Glows --- */\n  .cursor-rarity-Common { --cursor-glow-color: #9ca3af; } /* gray-400 */\n  .cursor-rarity-Rare { --cursor-glow-color: #60a5fa; } /* blue-400 */\n  .cursor-rarity-Cyber_Rare { --cursor-glow-color: #a78bfa; } /* purple-400 */\n  .cursor-rarity-Epic { --cursor-glow-color: #facc15; } /* yellow-400 */\n  .cursor-rarity-Legendary { --cursor-glow-color: #fb923c; } /* orange-400 */\n  .cursor-rarity-Mythic { --cursor-glow-color: #ef4444; } /* red-500 */\n\n\n  /* --- Click/Touch Effects --- */\n  .cursor-spark {\n    position: absolute;\n    width: 2px;\n    height: 30px;\n    background: linear-gradient(to bottom, transparent, var(--cursor-glow-color), transparent);\n    animation: spark-anim 0.3s ease-out forwards;\n    pointer-events: none;\n    transform-origin: center;\n  }\n\n  .cursor-ripple {\n    position: absolute;\n    border: 2px solid hsl(var(--primary) / 0.5);\n    border-radius: 50%;\n    animation: ripple-anim 0.5s ease-out forwards;\n    pointer-events: none;\n  }\n}\n\n@keyframes spark-anim {\n  0% { transform: scaleY(0) rotate(var(--angle)); opacity: 1; }\n  80% { transform: scaleY(1) rotate(var(--angle)); opacity: 1; }\n  100% { transform: scaleY(1) rotate(var(--angle)); opacity: 0; }\n}\n\n@keyframes ripple-anim {\n  0% { width: 0px; height: 0px; opacity: 1; }\n  100% { width: 50px; height: 50px; opacity: 0; }\n}\n\n@keyframes color-pulse-anim {\n  0%, 100% { background-color: hsl(var(--primary)); }\n  50% { background-color: hsl(var(--secondary)); }\n}\n\n@keyframes scanline {\n  0% { background-position: 0 0; }\n  100% { background-position: 0 100vh; }\n}\n\n@keyframes pan-background {\n    0% { background-position: 0% 0%, 2rem 2rem; }\n    100% { background-position: 100% 100%, calc(2rem + 100%) calc(2rem + 100%); }\n}\n\n@keyframes glitch {\n  0%, 100% {\n    text-shadow: 2px 2px 0 hsl(var(--secondary) / 0.7), -2px -2px 0 hsl(var(--primary) / 0.7);\n    transform: translate(0,0) skewX(0);\n  }\n  25% {\n     text-shadow: -2px 0px 0 hsl(var(--secondary) / 0.7), 2px 0px 0 hsl(var(--primary) / 0.7);\n     transform: translate(-1px, 1px) skewX(5deg);\n  }\n   50% {\n     text-shadow: 2px -2px 0 hsl(var(--secondary) / 0.7), -2px 2px 0 hsl(var(--primary) / 0.7);\n     transform: translate(1px, -1px) skewX(-5deg);\n  }\n  75% {\n     text-shadow: -2px 2px 0 hsl(var(--secondary) / 0.7), 2px -2px 0 hsl(var(--primary) / 0.7);\n     transform: translate(-1px, 1px) skewX(5deg);\n  }\n}\n\n@keyframes hologram-fade {\n    0% { opacity: 0.6; filter: blur(2px) drop-shadow(0 0 2px hsl(var(--secondary) / 0.5)); transform: scale(0.98); }\n    50% { opacity: 1; filter: blur(0) drop-shadow(0 0 10px hsl(var(--primary) / 0.7)); transform: scale(1.01); }\n    100% { opacity: 0.6; filter: blur(2px) drop-shadow(0 0 2px hsl(var(--secondary) / 0.5)); transform: scale(0.98);}\n}\n\n@keyframes progress-stripes {\n  from { background-position: 20px 0; }\n  to { background-position: 0 0; }\n}\n\n@keyframes gradient-shift {\n  0%, 100% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n}\n\n@keyframes pulse-glow {\n  from {\n    box-shadow: 0 0 30px 10px hsl(var(--primary) / 0.3);\n  }\n  to {\n    box-shadow: 0 0 40px 15px hsl(var(--primary) / 0.4);\n  }\n}\n\n@keyframes particle-glow {\n  0% {\n    transform: scale(0);\n    opacity: 1;\n  }\n  100% {\n    transform: scale(1.5);\n    opacity: 0;\n  }\n}\n\n@keyframes call-pulse {\n  0%, 100% {\n    transform: scale(1);\n    box-shadow: 0 0 0 0 hsl(var(--primary) / 0.7);\n  }\n  50% {\n    transform: scale(1.05);\n    box-shadow: 0 0 0 10px hsl(var(--primary) / 0);\n  }\n}\n\n@keyframes incoming-call {\n  0%, 100% {\n    transform: scale(1) rotate(0deg);\n  }\n  25% {\n    transform: scale(1.1) rotate(-5deg);\n  }\n  75% {\n    transform: scale(1.1) rotate(5deg);\n  }\n}\n\n.incoming-call-animation {\n  animation: incoming-call 1s ease-in-out infinite;\n}\n\n@keyframes jitter {\n  0%, 100% { transform: translate3d(0, 0, 0) rotate(0); }\n  25% { transform: translate3d(1px, -1px, 0) rotate(-0.5deg); }\n  50% { transform: translate3d(-1px, 1px, 0) rotate(0.5deg); }\n  75% { transform: translate3d(1px, 1px, 0) rotate(0.2deg); }\n}\n\n/* Performance Mode Tweaks */\n.perf-mode * {\n    animation-duration: 0.01ms !important;\n    animation-iteration-count: 1 !important;\n    transition-duration: 0.01ms !important;\n}\n\n/* Fast Navigation */\n.fast-nav * {\n    transition-duration: 0.1s !important;\n}\n\n.instant-load {\n    will-change: auto;\n    contain: layout style paint;\n}\n\n/* Mobile Optimizations */\n@media (max-width: 768px) {\n  .glass-card {\n    backdrop-filter: blur(8px);\n  }\n  \n  .text-glow {\n    text-shadow: 0 0 4px hsl(var(--primary) / 0.6);\n  }\n  \n  .cyber-button {\n    @apply px-4 py-2 text-sm;\n  }\n  \n  .neon-glow-primary {\n    box-shadow: 0 0 10px hsl(var(--primary) / 0.5);\n  }\n}\n\n@media (prefers-reduced-motion: reduce) {\n  *,\n  *::before,\n  *::after {\n    animation-duration: 0.01ms !important;\n    animation-iteration-count: 1 !important;\n    transition-duration: 0.01ms !important;\n    scroll-behavior: auto !important;\n  }\n  .cursor-wrapper, .cursor-dot, .cursor-icon, .cursor-spark, .cursor-ripple, .cursor-trail {\n    animation: none !important;\n    transition: none !important;\n  }\n}\n\n/* Page Load Optimization */\n.page-container {\n  contain: layout style;\n  will-change: auto;\n}\n\n.lazy-load {\n  content-visibility: auto;\n  contain-intrinsic-size: 200px;\n}\n\n    ","path":null,"size_bytes":17620,"size_tokens":null},"src/components/ui/alert-dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4434,"size_tokens":null},"src/components/ai-hub/assistant-tool.tsx":{"content":"'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Bot, Send, User } from \"lucide-react\";\nimport { runAssistantStream, AssistantInput } from '@/ai/flows/assistant-stream-flow';\nimport { cn } from '@/lib/utils';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useUser } from '@/hooks/use-user';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport Link from 'next/link';\nimport ReactMarkdown from 'react-markdown';\nimport { PlaceHolderImages } from '@/lib/placeholder-images';\n\ntype Message = {\n    role: 'user' | 'model';\n    content: string;\n};\n\nexport default function AssistantTool() {\n    const { user, profile } = useUser();\n    const [messages, setMessages] = useState<Message[]>([]);\n    const [input, setInput] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n    const scrollAreaRef = useRef<HTMLDivElement>(null);\n    const userAvatar = PlaceHolderImages.find(p => p.id === 'user-avatar-1');\n\n    useEffect(() => {\n        if (user) {\n            const saved = localStorage.getItem(`ai-hub-${user.uid}`);\n            if (saved) setMessages(JSON.parse(saved));\n        }\n    }, [user]);\n\n    const scrollToBottom = () => {\n        if (scrollAreaRef.current) {\n            scrollAreaRef.current.scrollTo({\n                top: scrollAreaRef.current.scrollHeight,\n                behavior: 'smooth',\n            });\n        }\n    };\n\n    useEffect(() => {\n        scrollToBottom();\n    }, [messages]);\n\n    const handleSendMessage = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!input.trim()) return;\n\n        const userMessage: Message = { role: 'user', content: input };\n        const newMessages: Message[] = [...messages, userMessage];\n        setMessages(newMessages);\n        if (user) localStorage.setItem(`ai-hub-${user.uid}`, JSON.stringify(newMessages));\n        setInput('');\n        setIsLoading(true);\n\n        try {\n            const assistantInput: AssistantInput = {\n                history: messages, // Send history up to the user's new message\n                prompt: input,\n            };\n            \n            const stream = await runAssistantStream(assistantInput);\n            let modelResponse = '';\n            \n            // Add a placeholder for the model's message\n            setMessages(prev => [...prev, { role: 'model', content: '' }]);\n\n            for await (const chunk of stream) {\n                modelResponse += chunk;\n                // Update the last message in the array with the new chunk\n                setMessages(prev => {\n                    const updated = [...prev];\n                    updated[updated.length - 1].content = modelResponse;\n                    if (user) localStorage.setItem(`ai-hub-${user.uid}`, JSON.stringify(updated));\n                    return updated;\n                });\n                scrollToBottom();\n            }\n\n        } catch (error) {\n            console.error(\"Error calling assistant:\", error);\n            const errorMessage: Message = { role: 'model', content: \"Apologies, Operator. I'm experiencing a connection issue with my core logic.\" };\n            setMessages(prev => [...prev, errorMessage]);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"flex flex-col border rounded-lg bg-background/30 h-[calc(100vh-20rem)]\">\n            <div className=\"flex-1 overflow-y-auto p-4\" ref={scrollAreaRef}>\n                <div className=\"space-y-6\">\n                    {messages.length === 0 && (\n                         <div className=\"flex items-start gap-4\">\n                            <div className=\"p-2 rounded-full bg-primary/20 border border-primary\">\n                                <Bot className=\"w-6 h-6 text-primary\"/>\n                            </div>\n                            <div className=\"prose prose-invert prose-p:text-foreground p-4 rounded-lg bg-muted/50 border border-border w-full\">\n                                <p className=\"font-semibold text-primary pb-1 not-prose\">Aether</p>\n                                <p>Greetings, Operator. I am Aether, your personal AI assistant. How may I augment your workflow today?</p>\n                            </div>\n                        </div>\n                    )}\n                    {messages.map((message, index) => (\n                        <div key={index} className={cn(\"flex items-start gap-4\", message.role === 'user' && \"justify-end\")}>\n                            {message.role === 'model' && (\n                                <div className=\"p-2 rounded-full bg-primary/20 border border-primary\">\n                                    <Bot className=\"w-6 h-6 text-primary\"/>\n                                </div>\n                            )}\n                            <div className={cn(\n                                \"prose prose-invert prose-p:text-foreground prose-headings:text-primary prose-strong:text-foreground prose-code:text-secondary p-4 rounded-lg border w-auto max-w-xl\",\n                                message.role === 'model' ? \"bg-muted/50 border-border\" : \"bg-green-500/10 border-green-500/50\"\n                            )}>\n                                <p className={cn(\"font-semibold pb-1 not-prose\", message.role === 'model' ? 'text-primary' : 'text-green-400')}>\n                                    {message.role === 'model' ? \"Aether\" : profile?.username || 'Operator'}\n                                </p>\n                                <ReactMarkdown>{message.content}</ReactMarkdown>\n                                {isLoading && message.role === 'model' && index === messages.length -1 && (\n                                     <span className=\"inline-block w-2.5 h-4 bg-primary animate-pulse ml-1\"></span>\n                                )}\n                            </div>\n                            {message.role === 'user' && (\n                                 <Link href=\"/profile\">\n                                    <Avatar className=\"h-10 w-10 border-2 border-green-500/50 cursor-pointer\">\n                                        <AvatarImage src={profile?.photoURL ?? userAvatar?.imageUrl} data-ai-hint={userAvatar?.imageHint} />\n                                        <AvatarFallback>{profile?.username?.[0] || 'U'}</AvatarFallback>\n                                    </Avatar>\n                                </Link>\n                            )}\n                        </div>\n                    ))}\n                    {isLoading && messages[messages.length-1]?.role !== 'model' && (\n                        <div className=\"flex items-start gap-4\">\n                            <div className=\"p-2 rounded-full bg-primary/20 border border-primary\">\n                                <Bot className=\"w-6 h-6 text-primary\"/>\n                            </div>\n                            <div className=\"p-4 rounded-lg bg-muted/50 border border-border flex items-center gap-2\">\n                                <span className=\"h-2 w-2 bg-primary/80 rounded-full animate-pulse\" style={{animationDelay: '0s'}}></span>\n                                <span className=\"h-2 w-2 bg-primary/80 rounded-full animate-pulse\" style={{animationDelay: '0.2s'}}></span>\n                                <span className=\"h-2 w-2 bg-primary/80 rounded-full animate-pulse\" style={{animationDelay: '0.4s'}}></span>\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n            <form onSubmit={handleSendMessage} className=\"relative p-4 border-t\">\n                <Input\n                    placeholder=\"Interface with Aether...\"\n                    className=\"pr-12 bg-input text-base h-12\"\n                    value={input}\n                    onChange={(e) => setInput(e.target.value)}\n                    disabled={isLoading}\n                />\n                <Button size=\"icon\" type=\"submit\" className=\"absolute right-2 top-2 h-8 w-8\" disabled={isLoading}>\n                    <Send className=\"h-4 w-4\" />\n                </Button>\n            </form>\n        </div>\n    );\n}\n","path":null,"size_bytes":8262,"size_tokens":null},"src/components/theme/theme-switcher.tsx":{"content":"'use client';\nimport { useTheme } from '@/components/providers/ThemeProvider';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { cn } from '@/lib/utils';\nimport { Check } from 'lucide-react';\n\nexport default function ThemeSettings() {\n  const { theme: activeTheme, setTheme, themes } = useTheme();\n\n  return (\n    <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n      {themes.map((theme) => (\n        <div key={theme.id} className=\"space-y-2\">\n          <Card\n            onClick={() => setTheme(theme.id)}\n            className={cn(\n              'cursor-pointer transition-all',\n              activeTheme === theme.id ? 'neon-border-primary' : 'hover:bg-muted/50'\n            )}\n          >\n            <CardContent className=\"p-0\">\n              <div className=\"flex -space-x-1 overflow-hidden rounded-t-md\">\n                <div className=\"flex-1 h-12 w-12\" style={{ backgroundColor: `hsl(${theme.colors.primary})` }} />\n                <div className=\"flex-1 h-12 w-12\" style={{ backgroundColor: `hsl(${theme.colors.secondary})` }} />\n                <div className=\"flex-1 h-12 w-12\" style={{ backgroundColor: `hsl(${theme.colors.accent})` }} />\n              </div>\n              <div className=\"h-12 rounded-b-md\" style={{ backgroundColor: `hsl(${theme.colors.background})` }} />\n            </CardContent>\n          </Card>\n          <div className=\"flex items-center justify-center gap-2\">\n            {activeTheme === theme.id && <Check className=\"w-4 h-4 text-primary\" />}\n            <p className=\"text-sm font-semibold text-center\">{theme.name}</p>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":1663,"size_tokens":null},"src/components/ui/carousel.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6224,"size_tokens":null},"src/app/store/[section]/page.tsx":{"content":"\n'use client';\nimport { useParams } from 'next/navigation';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { storeItems, storeCategories, StoreItem } from '@/lib/store-items';\nimport { CheckCircle, Loader2, ShoppingCart, Eye, Heart, BarChart, Wand2 } from 'lucide-react';\nimport Image from 'next/image';\nimport { useUser } from '@/hooks/use-user';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport Link from 'next/link';\nimport { useState } from 'react';\nimport { appEventEmitter } from '@/lib/event-emitter';\nimport { useCommandHub } from '@/hooks/use-command-hub';\n\nexport default function StoreSectionPage() {\n    const params = useParams();\n    const { section } = params;\n    const { profile, purchaseItem } = useUser();\n    const { toast } = useToast();\n    const [purchasingId, setPurchasingId] = useState<string | null>(null);\n    const { openHub } = useCommandHub();\n\n    const category = storeCategories.find(cat => cat.id === section);\n    const items = storeItems.filter(item => item.category === section);\n\n    const handlePurchase = async (item: StoreItem) => {\n        if (!profile) return;\n        setPurchasingId(item.id);\n        try {\n            await purchaseItem(item);\n            toast({\n                title: 'Purchase Successful!',\n                description: `${item.name} has been added to your inventory.`,\n            });\n        } catch (error: any) {\n             toast({\n                variant: 'destructive',\n                title: 'Purchase Failed',\n                description: error.message,\n            });\n        } finally {\n            setPurchasingId(null);\n        }\n    };\n\n    const handleContextMenu = (e: React.MouseEvent, item: StoreItem) => {\n        e.preventDefault();\n        e.stopPropagation();\n        const owned = hasItem(item.id);\n        openHub(e, {\n            type: 'store-item',\n            data: item,\n            actions: [\n                {\n                    label: 'Buy with EXP',\n                    icon: 'ShoppingCart',\n                    onClick: () => handlePurchase(item),\n                    disabled: owned || (profile?.xp ?? 0) < item.price,\n                },\n                 { label: 'Preview', icon: 'Eye', onClick: () => {}, disabled: true },\n                 { label: 'Add to wishlist', icon: 'Heart', onClick: () => {} },\n                 { label: 'Compare stats', icon: 'BarChart', onClick: () => {}, disabled: true },\n                 { label: 'Skin preview', icon: 'Wand2', onClick: () => {}, disabled: true },\n            ],\n        });\n    };\n    \n    const hasItem = (itemId: string) => {\n        return profile?.inventory?.includes(itemId) ?? false;\n    }\n\n    if (!category) {\n        return <div className=\"text-center text-muted-foreground\">Store section not found.</div>;\n    }\n\n    return (\n        <div className=\"space-y-8\">\n            <header className=\"flex items-center justify-between\">\n                <div className='flex items-center gap-4'>\n                    <Link href=\"/store\"><Button variant=\"outline\" size=\"icon\" className=\"h-10 w-10\">&larr;</Button></Link>\n                     <h1 className=\"text-3xl font-headline text-glow flex items-center gap-3\">\n                        <category.icon className={cn(\"w-8 h-8\", category.color)}/>\n                        {category.name}\n                    </h1>\n                </div>\n                 <p className=\"text-lg text-primary font-bold\">Your XP: {profile?.xp ?? '...'}</p>\n            </header>\n            \n            <p className=\"text-muted-foreground max-w-2xl\">{category.description}</p>\n            \n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                {items.map(item => {\n                    const owned = hasItem(item.id);\n                    const isPurchasing = purchasingId === item.id;\n                    return (\n                    <Card key={item.id} className=\"flex flex-col group overflow-hidden\"\n                        onMouseEnter={() => appEventEmitter.emit('cursor:rarity-hover:start', item.rarity)}\n                        onMouseLeave={() => appEventEmitter.emit('cursor:rarity-hover:end')}\n                        onContextMenu={(e) => handleContextMenu(e, item)}\n                        data-command-hub-trigger\n                    >\n                        <CardHeader className=\"p-0\">\n                            <div className=\"aspect-video bg-muted/50 flex items-center justify-center relative overflow-hidden\">\n                                {item.imageUrl ? (\n                                     <Image src={item.imageUrl} alt={item.name} layout=\"fill\" className=\"object-cover\" />\n                                ) : (\n                                    <item.icon className=\"w-16 h-16 text-primary/50\" />\n                                )}\n                                {owned && (\n                                     <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\">\n                                        <div className=\"p-4 rounded-full bg-green-500/20 border-2 border-green-500\">\n                                            <CheckCircle className=\"w-12 h-12 text-green-400\" />\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n                        </CardHeader>\n                        <CardContent className=\"p-4 flex-1 flex flex-col\">\n                            <h3 className=\"font-headline text-xl text-glow\">{item.name}</h3>\n                            <p className=\"text-sm text-muted-foreground flex-1 my-2\">{item.description}</p>\n                             <div className=\"flex justify-between items-center mb-4\">\n                                <span className=\"text-xs font-bold uppercase tracking-wider text-muted-foreground\">Rarity</span>\n                                <span className={cn(\n                                    \"font-bold\",\n                                    item.rarity === 'Common' && 'text-gray-400',\n                                    item.rarity === 'Rare' && 'text-blue-400',\n                                    item.rarity === 'Cyber Rare' && 'text-purple-400',\n                                    item.rarity === 'Epic' && 'text-yellow-400',\n                                    item.rarity === 'Legendary' && 'text-orange-400',\n                                    item.rarity === 'Mythic' && 'text-red-500'\n                                )}>{item.rarity}</span>\n                            </div>\n                            <div className=\"flex items-center justify-between mt-auto\">\n                                <p className=\"text-lg font-bold text-primary\">{item.price} XP</p>\n                                <Button onClick={() => handlePurchase(item)} className=\"cyber-button\" disabled={owned || isPurchasing || !profile || profile.xp < item.price}>\n                                    {isPurchasing ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\"/> : owned ? <CheckCircle className=\"mr-2 h-4 w-4\"/> : <ShoppingCart className=\"mr-2 h-4 w-4\"/>}\n                                    {owned ? 'Owned' : isPurchasing ? 'Processing...' : 'Purchase'}\n                                </Button>\n                            </div>\n                        </CardContent>\n                    </Card>\n                    )\n                })}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":7586,"size_tokens":null},"src/app/notes/page.tsx":{"content":"\n'use client';\n\nimport { useState, useMemo, useEffect } from 'react';\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { FilePlus2, Search, Pin, Tag, Folder, Bold, Italic, Underline, List, PlusCircle, Trash2, Check, Loader2, BrainCircuit, Bot } from \"lucide-react\";\nimport { Badge } from '@/components/ui/badge';\nimport { cn } from '@/lib/utils';\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';\nimport { useNotes, Note } from '@/hooks/use-notes';\nimport { useToast } from '@/hooks/use-toast';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useUser } from '@/hooks/use-user';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { summarizeNotes } from '@/ai/flows/summarize-notes';\nimport { generateTasksFromNotes } from '@/ai/flows/generate-tasks-from-notes';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\n\n\nconst categories = ['All', 'Work', 'Personal', 'Projects', 'Ideas'];\n\nexport default function NotesPage() {\n  const { notes, loading, addNote, updateNote, deleteNote } = useNotes();\n  const { toast } = useToast();\n  const { incrementStat } = useUser();\n  const { openHub } = useCommandHub();\n  \n  const [selectedNote, setSelectedNote] = useState<Note | null>(null);\n  const [selectedNoteIds, setSelectedNoteIds] = useState<Set<string>>(new Set());\n  const [activeCategory, setActiveCategory] = useState('All');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [isSaving, setIsSaving] = useState(false);\n  const [isCreating, setIsCreating] = useState(false);\n  const [isAiActionLoading, setIsAiActionLoading] = useState(false);\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n  const [noteIdsToDelete, setNoteIdsToDelete] = useState<string[]>([]);\n\n\n  // When notes data changes, update the selected note if it's still in the list\n  useEffect(() => {\n    if (selectedNote) {\n      const updatedSelectedNote = notes.find(note => note.id === selectedNote.id);\n      if (!updatedSelectedNote) {\n        // The previously selected note was deleted\n        setSelectedNote(notes.length > 0 ? notes[0] : null);\n        setSelectedNoteIds(new Set());\n      } else {\n        setSelectedNote(updatedSelectedNote);\n      }\n    } else if (notes.length > 0) {\n      setSelectedNote(notes[0]);\n    } else {\n      setSelectedNote(null);\n    }\n  }, [notes]);\n\n\n  const filteredNotes = useMemo(() => {\n    return notes\n      .filter(note => activeCategory === 'All' || note.category === activeCategory)\n      .filter(note => note.title.toLowerCase().includes(searchTerm.toLowerCase()) || note.content.toLowerCase().includes(searchTerm.toLowerCase()));\n  }, [notes, activeCategory, searchTerm]);\n\n  const handleAddNewNote = async () => {\n    setIsCreating(true);\n    try {\n      const newNoteData = {\n        title: 'Untitled Note',\n        content: '',\n        category: 'Personal',\n        tags: [],\n        pinned: false,\n      };\n      const newNoteRef = await addNote(newNoteData);\n      await incrementStat('notesCreated', 1);\n\n      toast({ title: 'Note created', description: 'A new note has been added to your collection.'});\n      // The useEffect will handle selecting the new note once it appears in the `notes` list.\n    } catch (error) {\n      toast({ variant: 'destructive', title: 'Error', description: 'Could not create note.'});\n    } finally {\n        setIsCreating(false);\n    }\n  };\n\n  const handleUpdateNote = async (field: keyof Note, value: any) => {\n    if (!selectedNote) return;\n    \n    // Optimistic update\n    const updatedNote = { ...selectedNote, [field]: value };\n    setSelectedNote(updatedNote);\n    \n    setIsSaving(true);\n    try {\n      await updateNote(selectedNote.id, { [field]: value });\n      setTimeout(() => setIsSaving(false), 1000); // Show checkmark for a bit\n    } catch (error) {\n      // Revert on error\n      setSelectedNote(selectedNote);\n      toast({ variant: 'destructive', title: 'Error', description: 'Could not save note changes.'});\n      setIsSaving(false);\n    }\n  };\n\n const handleDeleteRequest = (ids: string[]) => {\n    setNoteIdsToDelete(ids);\n    setIsDeleteDialogOpen(true);\n  };\n\n  const handleDeleteConfirm = async () => {\n    if (noteIdsToDelete.length === 0) return;\n    \n    try {\n        await Promise.all(noteIdsToDelete.map(id => deleteNote(id)));\n        toast({ title: `${noteIdsToDelete.length} Note${noteIdsToDelete.length > 1 ? 's' : ''} deleted` });\n        setSelectedNoteIds(new Set());\n    } catch (error) {\n        toast({ variant: 'destructive', title: 'Error', description: 'Could not delete notes.' });\n    } finally {\n        setIsDeleteDialogOpen(false);\n        setNoteIdsToDelete([]);\n    }\n  };\n\n\n  const handleNoteClick = (note: Note, e: React.MouseEvent) => {\n    if (e.ctrlKey || e.metaKey) {\n        setSelectedNoteIds(prev => {\n            const newSet = new Set(prev);\n            if (newSet.has(note.id)) {\n                newSet.delete(note.id);\n            } else {\n                newSet.add(note.id);\n            }\n            return newSet;\n        });\n    } else {\n        setSelectedNote(note);\n        setSelectedNoteIds(new Set([note.id]));\n    }\n  };\n  \n  const handleAiSummarize = async () => {\n    const selectedNotes = notes.filter(n => selectedNoteIds.has(n.id));\n    if (selectedNotes.length === 0) return;\n\n    setIsAiActionLoading(true);\n    const combinedContent = selectedNotes.map(n => `Title: ${n.title}\\nContent: ${n.content}`).join('\\n\\n---\\n\\n');\n    \n    try {\n        const result = await summarizeNotes({ notes: combinedContent });\n        toast({\n            duration: 10000,\n            title: 'AI Summary Complete',\n            description: (\n                <div className=\"flex flex-col gap-2\">\n                    <p className=\"font-bold flex items-center gap-2\"><Bot size={16}/> Here is the summary of your selected notes:</p>\n                    <p className=\"text-sm\">{result.summary}</p>\n                </div>\n            )\n        });\n    } catch(e) {\n        toast({ variant: 'destructive', title: 'AI Error', description: 'Could not summarize notes.'});\n    } finally {\n        setIsAiActionLoading(false);\n    }\n  };\n  \n  const handleAiExtractTasks = async () => {\n    const selectedNotes = notes.filter(n => selectedNoteIds.has(n.id));\n    if (selectedNotes.length === 0) return;\n    setIsAiActionLoading(true);\n\n    const combinedContent = selectedNotes.map(n => `Title: ${n.title}\\nContent: ${n.content}`).join('\\n\\n---\\n\\n');\n\n    try {\n        const result = await generateTasksFromNotes({ notes: combinedContent });\n        toast({\n            duration: 10000,\n            title: 'AI Task Extraction Complete',\n            description: (\n                 <div className=\"flex flex-col gap-2\">\n                    <p className=\"font-bold flex items-center gap-2\"><Bot size={16}/> Suggested tasks from your notes:</p>\n                    <ul className=\"list-disc pl-4\">\n                        {result.tasks.map((task, i) => <li key={i}>{task}</li>)}\n                    </ul>\n                </div>\n            )\n        })\n    } catch (e) {\n        toast({ variant: 'destructive', title: 'AI Error', description: 'Could not extract tasks.'});\n    } finally {\n        setIsAiActionLoading(false);\n    }\n  };\n\n  const handleNoteContextMenu = (e: React.MouseEvent, note: Note) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const isMultiSelect = selectedNoteIds.size > 1 && selectedNoteIds.has(note.id);\n    \n    let actions = [];\n\n    if (isMultiSelect) {\n        actions = [\n             { label: `Summarize ${selectedNoteIds.size} notes`, icon: 'BrainCircuit', onClick: handleAiSummarize, disabled: isAiActionLoading },\n             { label: `Extract tasks from ${selectedNoteIds.size} notes`, icon: 'Bot', onClick: handleAiExtractTasks, disabled: isAiActionLoading },\n             { label: `Delete ${selectedNoteIds.size} notes`, icon: 'Trash2', onClick: () => handleDeleteRequest(Array.from(selectedNoteIds)), isDestructive: true },\n        ];\n    } else {\n        actions = [\n            { label: note.pinned ? 'Unpin Note' : 'Pin Note', icon: 'Pin', onClick: () => handleUpdateNote('pinned', !note.pinned) },\n            { label: 'Delete Note', icon: 'Trash2', onClick: () => handleDeleteRequest([note.id]), isDestructive: true },\n        ];\n    }\n\n    openHub(e, {\n      type: isMultiSelect ? 'note-multi-select' : 'note-item',\n      data: note,\n      actions: actions as any,\n    });\n  };\n\n\n  return (\n    <>\n      <div className=\"grid grid-cols-1 md:grid-cols-[300px_1fr] gap-6 h-[calc(100vh-10rem)]\">\n        {/* Sidebar with Categories and Notes List */}\n        <Card className=\"md:col-span-1 flex flex-col\">\n          <CardHeader className=\"flex-row items-center justify-between\">\n            <CardTitle>My Notes</CardTitle>\n            <Button size=\"icon\" variant=\"ghost\" onClick={handleAddNewNote} className=\"h-8 w-8\" disabled={isCreating}>\n              {isCreating ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : <PlusCircle className=\"w-5 h-5 text-primary\" />}\n            </Button>\n          </CardHeader>\n          <div className=\"px-4 pb-2\">\n              <div className=\"relative\">\n                  <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                  <Input \n                      placeholder=\"Search all notes...\" \n                      className=\"pl-8 bg-input\"\n                      value={searchTerm}\n                      onChange={(e) => setSearchTerm(e.target.value)}\n                  />\n              </div>\n          </div>\n          <Accordion type=\"single\" collapsible defaultValue=\"item-1\" className=\"px-4\">\n            <AccordionItem value=\"item-1\" className=\"border-b-0\">\n              <AccordionTrigger className=\"py-2 text-sm font-medium text-muted-foreground hover:no-underline\">\n                  <div className=\"flex items-center gap-2\">\n                      <Folder className=\"w-4 h-4\" />\n                      <span>Categories</span>\n                  </div>\n              </AccordionTrigger>\n              <AccordionContent className=\"pb-2\">\n                  <div className=\"flex flex-col gap-1\">\n                      {categories.map(category => (\n                          <Button\n                              key={category}\n                              variant={activeCategory === category ? 'secondary' : 'ghost'}\n                              className=\"w-full justify-start\"\n                              onClick={() => setActiveCategory(category)}\n                          >\n                              {category}\n                          </Button>\n                      ))}\n                  </div>\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n          <ScrollArea className=\"flex-1\">\n            <div className=\"p-4 pt-2 space-y-2\">\n            {loading ? (\n              <div className=\"space-y-2\">\n                <Skeleton className=\"h-16 w-full\" />\n                <Skeleton className=\"h-16 w-full\" />\n                <Skeleton className=\"h-16 w-full\" />\n              </div>\n            ) : filteredNotes.map((note) => (\n              <div \n                key={note.id}\n                className={cn(\n                  \"p-3 rounded-md border-l-4 cursor-pointer transition-all\",\n                  selectedNoteIds.has(note.id) ? 'bg-primary/20 neon-border-primary' : 'border-transparent hover:bg-muted/50',\n                )}\n                onClick={(e) => handleNoteClick(note, e)}\n                onContextMenu={(e) => handleNoteContextMenu(e, note)}\n                data-command-hub-trigger\n              >\n                <div className=\"flex justify-between items-center\">\n                  <h4 className=\"font-semibold truncate pr-2\">{note.title}</h4>\n                  {note.pinned && <Pin className=\"w-4 h-4 text-primary shrink-0\" />}\n                </div>\n                <p className=\"text-sm text-muted-foreground truncate\">{note.content || \"No content\"}</p>\n              </div>\n            ))}\n            </div>\n          </ScrollArea>\n        </Card>\n\n        {/* Note Editor */}\n        <div className=\"md:col-span-1 flex flex-col gap-4\">\n          {selectedNote ? (\n              <Card className=\"flex-1 flex flex-col\">\n              <CardHeader className=\"pb-2\">\n                  <div className=\"flex items-center justify-between gap-4\">\n                      <Input \n                          key={selectedNote.id} // Re-renders the input on note change\n                          defaultValue={selectedNote.title}\n                          onBlur={(e) => handleUpdateNote('title', e.target.value)}\n                          className=\"text-2xl font-headline border-0 bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0 p-0 h-auto\"\n                          placeholder=\"Note Title\"\n                      />\n                      <div className=\"flex items-center gap-2\">\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={() => handleUpdateNote('pinned', !selectedNote.pinned)}>\n                              <Pin className={cn(\"h-4 w-4\", selectedNote.pinned && \"text-primary fill-primary\")} />\n                          </Button>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={() => handleDeleteRequest([selectedNote.id])}>\n                              <Trash2 className=\"h-4 w-4 text-destructive/80 hover:text-destructive\" />\n                          </Button>\n                          <Button size=\"sm\" className=\"cyber-button w-[90px]\" onClick={() => handleUpdateNote('content', selectedNote.content)}>\n                              {isSaving ? <Check className=\"h-4 w-4\" /> : 'Save'}\n                          </Button>\n                      </div>\n                  </div>\n                  <div className=\"flex items-center gap-2 pt-2\">\n                      <Tag className=\"w-4 h-4 text-muted-foreground\" />\n                      {selectedNote.tags.map(tag => (\n                          <Badge key={tag} variant=\"secondary\">{tag}</Badge>\n                      ))}\n                      {/* Add tag input here later */}\n                  </div>\n              </CardHeader>\n              <CardContent className=\"flex-1 flex flex-col gap-4 pt-2\">\n                  <div className=\"flex items-center gap-1 border rounded-md p-1 bg-input/50\">\n                      <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\"><Bold className=\"w-4 h-4\" /></Button>\n                      <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\"><Italic className=\"w-4 h-4\" /></Button>\n                      <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\"><Underline className=\"w-4 h-4\" /></Button>\n                      <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\"><List className=\"w-4 h-4\" /></Button>\n                  </div>\n                  <Textarea\n                  key={selectedNote.id} // Re-renders the textarea on note change\n                  defaultValue={selectedNote.content}\n                  onBlur={(e) => handleUpdateNote('content', e.target.value)}\n                  className=\"flex-1 resize-none bg-input/50 border-0 focus-visible:ring-0 focus-visible:ring-offset-0 text-base\"\n                  placeholder=\"Type your notes here...\"\n                  />\n              </CardContent>\n              </Card>\n          ) : (\n               <div className=\"flex-1 flex items-center justify-center glass-card\">\n                  <div className=\"text-center\">\n                      <p className=\"text-xl font-headline text-muted-foreground\">Select a note to view</p>\n                      <p className=\"text-sm text-muted-foreground/80 mt-2\">or create a new one to get started.</p>\n                      <Button onClick={handleAddNewNote} className=\"mt-4\" disabled={isCreating}>\n                         {isCreating ? <><Loader2 className=\"mr-2 h-4 w-4 animate-spin\"/>Creating...</> : <><PlusCircle className=\"mr-2 h-4 w-4\" />Create New Note</>}\n                      </Button>\n                  </div>\n              </div>\n          )}\n        </div>\n      </div>\n      <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This action cannot be undone. This will permanently delete {noteIdsToDelete.length > 1 ? `${noteIdsToDelete.length} notes` : 'this note'}.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDeleteConfirm}>Delete</AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","path":null,"size_bytes":17285,"size_tokens":null},"src/ai/flows/enhance-profile-flow.ts":{"content":"'use server';\n/**\n * @fileOverview An AI flow to enhance a user's profile by generating suggestions.\n *\n * - enhanceProfile - A function that generates a bio, interests, and an \"aura personality\".\n * - EnhanceProfileInput - The input type for the enhanceProfile function.\n * - EnhanceProfileOutput - The return type for the enhanceProfile function.\n */\n\nimport { ai } from '@/ai/genkit';\nimport { z } from 'genkit';\n\nconst EnhanceProfileInputSchema = z.object({\n  interests: z.string().describe('A few words or a sentence describing the user\\'s interests, hobbies, or personality.'),\n});\nexport type EnhanceProfileInput = z.infer<typeof EnhanceProfileInputSchema>;\n\nconst EnhanceProfileOutputSchema = z.object({\n  bio: z.string().describe('A generated bio (1-3 sentences) in a cyberpunk or futuristic style.'),\n  auraPersonality: z.string().describe('A single, evocative word representing the user\\'s \"aura\" or personality type (e.g., \"Strategist\", \"Explorer\", \"Dreamer\").'),\n  suggestedInterests: z.array(z.string()).describe('A list of 5-7 suggested interests or skills as short phrases or single words.'),\n  suggestedTheme: z.string().describe('A suggested theme name (e.g., \"Neon Noir\", \"Synthwave Sunset\", \"Glitch Runner\").'),\n});\nexport type EnhanceProfileOutput = z.infer<typeof EnhanceProfileOutputSchema>;\n\nexport async function enhanceProfile(input: EnhanceProfileInput): Promise<EnhanceProfileOutput> {\n  return enhanceProfileFlow(input);\n}\n\nconst enhanceProfileFlow = ai.defineFlow(\n  {\n    name: 'enhanceProfileFlow',\n    inputSchema: EnhanceProfileInputSchema,\n    outputSchema: EnhanceProfileOutputSchema,\n  },\n  async (input) => {\n    const result = await ai.generate({\n      model: 'googleai/gemini-2.0-flash',\n      prompt: `You are an AI Profile Enhancer for a cyberpunk-themed social platform called Aetherweave.\nYour task is to generate a cool, futuristic profile for a user based on their stated interests.\n\nUser Interests: ${input.interests}\n\nBased on these interests, generate the following in JSON format:\n1. bio: A short, edgy, and cool bio (1-3 sentences).\n2. auraPersonality: A single, impactful word that defines their persona (e.g., Nomad, Analyst, Ghost, Visionary).\n3. suggestedInterests: A list of 5-7 related skills or hobbies that fit the cyberpunk theme.\n4. suggestedTheme: A cool name for a color theme, like \"Arcade Glow\" or \"Data Stream\".\n\nReturn only valid JSON with these exact keys.`,\n      output: { schema: EnhanceProfileOutputSchema },\n    });\n    return result.output!;\n  }\n);\n","path":null,"size_bytes":2523,"size_tokens":null},"src/components/chat/CreateGroupModal.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { PublicUser } from '@/hooks/use-connections';\nimport { Users, X } from 'lucide-react';\n\ninterface CreateGroupModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  friends: PublicUser[];\n  onCreateGroup: (name: string, selectedMembers: PublicUser[]) => void;\n  loading?: boolean;\n}\n\nexport default function CreateGroupModal({ open, onOpenChange, friends, onCreateGroup, loading }: CreateGroupModalProps) {\n  const [groupName, setGroupName] = useState('');\n  const [selectedMembers, setSelectedMembers] = useState<PublicUser[]>([]);\n\n  const handleMemberToggle = (friend: PublicUser) => {\n    setSelectedMembers(prev => \n      prev.find(m => m.id === friend.id)\n        ? prev.filter(m => m.id !== friend.id)\n        : [...prev, friend]\n    );\n  };\n\n  const handleCreate = () => {\n    if (groupName.trim() && selectedMembers.length > 0) {\n      onCreateGroup(groupName.trim(), selectedMembers);\n      setGroupName('');\n      setSelectedMembers([]);\n    }\n  };\n\n  const handleClose = () => {\n    setGroupName('');\n    setSelectedMembers([]);\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            Create Group Chat\n          </DialogTitle>\n        </DialogHeader>\n        \n        <div className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"groupName\">Group Name</Label>\n            <Input\n              id=\"groupName\"\n              placeholder=\"Enter group name...\"\n              value={groupName}\n              onChange={(e) => setGroupName(e.target.value)}\n              className=\"mt-1\"\n            />\n          </div>\n\n          <div>\n            <Label>Select Members ({selectedMembers.length} selected)</Label>\n            <div className=\"mt-2 max-h-60 overflow-y-auto space-y-2\">\n              {friends.map((friend) => (\n                <div key={friend.id} className=\"flex items-center space-x-3 p-2 rounded-lg hover:bg-muted/50\">\n                  <Checkbox\n                    checked={selectedMembers.some(m => m.id === friend.id)}\n                    onCheckedChange={() => handleMemberToggle(friend)}\n                  />\n                  <Avatar className=\"h-8 w-8\">\n                    <AvatarImage src={friend.photoURL || undefined} />\n                    <AvatarFallback>{friend.displayName?.charAt(0) || '?'}</AvatarFallback>\n                  </Avatar>\n                  <span className=\"flex-1 text-sm\">{friend.displayName || 'Unknown'}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {selectedMembers.length > 0 && (\n            <div>\n              <Label>Selected Members</Label>\n              <div className=\"mt-2 flex flex-wrap gap-2\">\n                {selectedMembers.map((member) => (\n                  <div key={member.id} className=\"flex items-center gap-1 bg-primary/10 text-primary px-2 py-1 rounded-full text-xs\">\n                    <span>{member.displayName}</span>\n                    <button onClick={() => handleMemberToggle(member)}>\n                      <X className=\"w-3 h-3\" />\n                    </button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex justify-end gap-2 pt-4\">\n          <Button variant=\"outline\" onClick={handleClose}>\n            Cancel\n          </Button>\n          <Button \n            onClick={handleCreate} \n            disabled={!groupName.trim() || selectedMembers.length === 0 || loading}\n          >\n            {loading ? 'Creating...' : 'Create Group'}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":4216,"size_tokens":null},"src/hooks/use-sound-player.ts":{"content":"\n'use client';\nimport { useEffect, useRef, useCallback } from 'react';\nimport { appEventEmitter } from '@/lib/event-emitter';\n\ntype SoundType = 'hub-open' | 'hub-close' | 'click' | 'success' | 'error';\n\nexport function useSoundPlayer() {\n  const audioContextRef = useRef<AudioContext>();\n  const isInitialized = useRef(false);\n\n  const initAudioContext = useCallback(() => {\n    if (isInitialized.current || typeof window === 'undefined') return;\n    \n    try {\n      const context = new (window.AudioContext || (window as any).webkitAudioContext)();\n      audioContextRef.current = context;\n      isInitialized.current = true;\n      console.log('AudioContext initialized.');\n    } catch (e) {\n      console.error(\"Web Audio API is not supported in this browser.\", e);\n    }\n  }, []);\n\n  useEffect(() => {\n    // Add multiple event listeners to catch the first user interaction\n    window.addEventListener('click', initAudioContext, { once: true });\n    window.addEventListener('touchend', initAudioContext, { once: true });\n    \n    return () => {\n      window.removeEventListener('click', initAudioContext);\n      window.removeEventListener('touchend', initAudioContext);\n      if (audioContextRef.current && audioContextRef.current.state !== 'closed') {\n        audioContextRef.current.close();\n      }\n    }\n  }, [initAudioContext]);\n\n  const playSound = useCallback((type: SoundType) => {\n    if (!isInitialized.current) {\n      return; // Don't try to play sound if not initialized\n    }\n      \n    const audioContext = audioContextRef.current;\n    if (!audioContext || audioContext.state === 'closed') {\n      return;\n    }\n    \n    if (audioContext.state === 'suspended') {\n        audioContext.resume();\n    }\n\n    const oscillator = audioContext.createOscillator();\n    const gainNode = audioContext.createGain();\n    oscillator.connect(gainNode);\n    gainNode.connect(audioContext.destination);\n\n    gainNode.gain.setValueAtTime(0.05, audioContext.currentTime); // Reduced volume for all sounds\n\n    switch(type) {\n      case 'hub-open':\n        oscillator.type = 'sine';\n        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.4);\n        oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.4);\n        break;\n      case 'hub-close':\n        oscillator.type = 'sine';\n        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.2);\n        oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.2);\n        break;\n      case 'click':\n        oscillator.type = 'triangle';\n        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);\n        oscillator.frequency.setValueAtTime(1200, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.1);\n        break;\n      case 'success':\n        oscillator.type = 'sine';\n        gainNode.gain.setValueAtTime(0.08, audioContext.currentTime);\n        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5\n        gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.2);\n        setTimeout(() => {\n            if (audioContext.state === 'closed') return;\n            const osc2 = audioContext.createOscillator();\n            const gain2 = audioContext.createGain();\n            osc2.connect(gain2);\n            gain2.connect(audioContext.destination);\n            osc2.type = 'sine';\n            gain2.gain.setValueAtTime(0.08, audioContext.currentTime);\n            osc2.frequency.setValueAtTime(659.25, audioContext.currentTime); // E5\n            gain2.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.2);\n            osc2.start(audioContext.currentTime);\n            osc2.stop(audioContext.currentTime + 0.2);\n        }, 80);\n        break;\n      case 'error':\n        oscillator.type = 'square';\n        oscillator.frequency.setValueAtTime(150, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.3);\n        break;\n    }\n\n    oscillator.start(audioContext.currentTime);\n    oscillator.stop(audioContext.currentTime + 0.5);\n  }, [initAudioContext]);\n\n  useEffect(() => {\n    appEventEmitter.on('ui:sound', playSound);\n    return () => {\n      appEventEmitter.off('ui:sound', playSound);\n    }\n  }, [playSound]);\n}\n","path":null,"size_bytes":4546,"size_tokens":null},"backend/src/routes/upload.ts":{"content":"import { Router } from 'express';\nimport multer from 'multer';\nimport sharp from 'sharp';\nimport { getFirestore } from 'firebase-admin/firestore';\nimport { authenticateToken, AuthenticatedRequest } from '../middleware/auth';\n\nconst router = Router();\nconst upload = multer({ storage: multer.memoryStorage() });\n\nrouter.post('/avatar', authenticateToken, upload.single('avatar'), async (req: AuthenticatedRequest, res) => {\n  try {\n    console.log('Avatar upload request received');\n    console.log('User:', req.user);\n    console.log('File:', req.file ? 'File present' : 'No file');\n    \n    if (!req.file) {\n      return res.status(400).json({ error: 'No file uploaded' });\n    }\n\n    const userId = req.user!.uid;\n    const file = req.file;\n    \n    console.log('Processing file for user:', userId);\n    console.log('File type:', file.mimetype);\n    console.log('File size:', file.size);\n    \n    // Validate file type\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];\n    if (!allowedTypes.includes(file.mimetype)) {\n      return res.status(400).json({ error: `Unsupported file type: ${file.mimetype}. Allowed: JPG, PNG, GIF, WebP` });\n    }\n    \n    // Validate file size (5MB limit)\n    const maxSize = 5 * 1024 * 1024; // 5MB\n    if (file.size > maxSize) {\n      return res.status(400).json({ error: 'File too large. Maximum size is 5MB' });\n    }\n    \n    // Convert file to base64 data URL for now (simple solution)\n    const base64 = file.buffer.toString('base64');\n    const dataURL = `data:${file.mimetype};base64,${base64}`;\n\n    // Compress and resize image\n    const compressedBuffer = await sharp(file.buffer)\n      .resize(200, 200, { fit: 'cover' })\n      .jpeg({ quality: 80 })\n      .toBuffer();\n    \n    const compressedBase64 = compressedBuffer.toString('base64');\n    const compressedDataURL = `data:image/jpeg;base64,${compressedBase64}`;\n    \n    console.log('Image compressed, updating Firestore...');\n    \n    const db = getFirestore();\n    await db.collection('users').doc(userId).set(\n      { photoURL: compressedDataURL },\n      { merge: true }\n    );\n\n    console.log('Firestore update successful');\n    res.json({ downloadURL: compressedDataURL });\n  } catch (error) {\n    console.error('Avatar upload error:', error);\n    res.status(500).json({ error: error instanceof Error ? error.message : 'Internal server error' });\n  }\n});\n\nexport default router;","path":null,"size_bytes":2428,"size_tokens":null},"src/components/gaming/GamingSidebar.tsx":{"content":"\n'use client';\n\nimport React from 'react';\nimport { useRouter } from 'next/navigation';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport {\n  Mic,\n  Headphones,\n  Settings,\n  Hash,\n  Volume2,\n  Megaphone,\n  Rss,\n  PhoneOff,\n  User,\n  MessageCircle,\n  BellOff,\n  UserPlus,\n  Check,\n} from 'lucide-react';\nimport { useUser } from '@/hooks/use-user';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';\nimport { cn } from '@/lib/utils';\nimport { motion } from 'framer-motion';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useToast } from '@/hooks/use-toast';\n\nconst channels = [\n    { id: 'c1', name: '👋 welcome', category: 'INFO', type: 'text' },\n    { id: 'c2', name: '📢 announcements', category: 'INFO', type: 'announcement' },\n    { id: 'c3', name: '🚀 updates', category: 'INFO', type: 'feed' },\n    { id: 'c4', name: '# general', category: 'TEXT CHANNELS', type: 'text' },\n    { id: 'c5', name: '# off-topic', category: 'TEXT CHANNELS', type: 'text' },\n    { id: 'c6', name: '# showcase', category: 'TEXT CHANNELS', type: 'text' },\n    { id: 'c7', name: '🔊 Lobby', category: 'VOICE CHANNELS', type: 'voice' },\n    { id: 'c8', name: '🔊 Squad 1', category: 'VOICE CHANNELS', type: 'voice' },\n    { id: 'c9', name: '🔊 Music', category: 'VOICE CHANNELS', type: 'voice' },\n];\n\nconst getChannelIcon = (type: string) => {\n    switch(type) {\n        case 'text': return <Hash size={20} />;\n        case 'voice': return <Volume2 size={20} />;\n        case 'announcement': return <Megaphone size={20} />;\n        case 'feed': return <Rss size={20} />;\n        default: return <Hash size={20} />;\n    }\n}\n\nexport default function GamingSidebar() {\n  const { user, profile, updateStatus } = useUser();\n  const { openHub } = useCommandHub();\n  const { toast } = useToast();\n  const [activeChannel, setActiveChannel] = React.useState('c4');\n  const [activeVoiceChannel, setActiveVoiceChannel] = React.useState<string | null>(null);\n  const [isMuted, setIsMuted] = React.useState(false);\n  const [isDeafened, setIsDeafened] = React.useState(false);\n  const router = useRouter();\n\n  const handleVoiceChannelClick = (channelId: string) => {\n    setActiveVoiceChannel(prev => prev === channelId ? null : channelId);\n  }\n\n  const handleUserPanelContextMenu = (e: React.MouseEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      openHub(e, {\n          type: 'gaming-user-panel',\n          actions: [\n              { label: 'Online', icon: 'Circle', onClick: () => updateStatus('Online')},\n              { label: 'Away', icon: 'Clock', onClick: () => updateStatus('Away')},\n              { label: 'Do Not Disturb', icon: 'MinusCircle', onClick: () => updateStatus('Do Not Disturb')},\n              { label: 'Invisible', icon: 'CircleOff', onClick: () => updateStatus('Invisible')},\n          ]\n      })\n  }\n\n  const handleChannelContextMenu = (e: React.MouseEvent, channel: typeof channels[0]) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const isVoice = channel.type === 'voice';\n      \n      const textChannelActions = [\n        { label: 'Mark as Read', icon: 'Check' as const, onClick: () => toast({ title: `Channel \"${channel.name}\" marked as read.` }) },\n        { label: 'Mute Channel', icon: 'BellOff' as const, onClick: () => toast({ title: `Muted \"${channel.name}\"` }) },\n        { label: 'Invite Friends', icon: 'UserPlus' as const, onClick: () => {} },\n        { label: 'Channel Settings', icon: 'Settings' as const, onClick: () => {}, disabled: true },\n      ];\n\n      const voiceChannelActions = [\n         { label: 'Adjust Volume', icon: 'Volume2' as const, onClick: () => {} },\n         { label: 'Mute Channel', icon: 'BellOff' as const, onClick: () => toast({ title: `Muted \"${channel.name}\"` }) },\n         { label: 'Invite Friends', icon: 'UserPlus' as const, onClick: () => {} },\n         { label: 'Channel Settings', icon: 'Settings' as const, onClick: () => {}, disabled: true },\n      ]\n\n      openHub(e, {\n          type: 'gaming-channel',\n          data: channel,\n          actions: isVoice ? voiceChannelActions : textChannelActions,\n      })\n  }\n\n  const channelCategories = React.useMemo(() => {\n    return channels.reduce((acc, channel) => {\n        if(!acc[channel.category]) {\n            acc[channel.category] = [];\n        }\n        acc[channel.category].push(channel);\n        return acc;\n    }, {} as Record<string, typeof channels>);\n  }, []);\n\n  const currentVoiceChannel = activeVoiceChannel ? channels.find(c => c.id === activeVoiceChannel) : null;\n\n  return (\n    <div className=\"flex w-64 flex-col bg-muted/30 border-r-2 border-primary/20\">\n        <div className=\"flex h-16 items-center border-b-2 border-primary/20 px-4 shadow-md\">\n          <h1 className=\"text-lg font-bold font-headline text-glow\">Aetherweave Space</h1>\n        </div>\n        <ScrollArea className=\"flex-1 px-2 py-4 custom-scroll\">\n            <Accordion type=\"multiple\" defaultValue={['INFO', 'TEXT CHANNELS', 'VOICE CHANNELS']} className=\"w-full space-y-2\">\n                {Object.entries(channelCategories).map(([category, channels]) => (\n                    <AccordionItem key={category} value={category} className=\"border-none\">\n                         <AccordionTrigger className=\"px-2 py-1 text-xs font-bold uppercase text-muted-foreground hover:text-foreground hover:no-underline\">\n                             <span className=\"text-glow\">{category}</span>\n                         </AccordionTrigger>\n                         <AccordionContent className=\"pt-1\">\n                             <div className=\"space-y-1\">\n                                 {channels.map(channel => {\n                                     const isTextChannel = channel.type !== 'voice';\n                                     const isActive = isTextChannel ? channel.id === activeChannel : channel.id === activeVoiceChannel;\n\n                                     const handleClick = () => {\n                                        if (isTextChannel) {\n                                            setActiveChannel(channel.id)\n                                        } else {\n                                            handleVoiceChannelClick(channel.id);\n                                        }\n                                     };\n\n                                     return (\n                                        <div\n                                          key={channel.id}\n                                          className=\"group relative rounded-md\"\n                                          onClick={handleClick}\n                                          onContextMenu={(e) => handleChannelContextMenu(e, channel)}\n                                          data-command-hub-trigger\n                                        >\n                                            {isTextChannel && isActive && (\n                                                <motion.div\n                                                    layoutId=\"active-channel-indicator\"\n                                                    className=\"absolute -left-2 top-0 h-full w-1 rounded-r-full bg-primary\"\n                                                    initial={false}\n                                                    transition={{ type: 'spring', stiffness: 350, damping: 30 }}\n                                                />\n                                            )}\n                                            <div \n                                                className={cn(\n                                                    \"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 text-muted-foreground transition-all duration-150\",\n                                                    isTextChannel && (isActive ? \"bg-accent/70 text-foreground\" : \"hover:bg-accent/50 hover:text-foreground group-hover:translate-x-1\"),\n                                                    !isTextChannel && (isActive ? \"text-green-400\" : \"hover:bg-accent/50 hover:text-foreground\")\n                                                )}\n                                            >\n                                                {getChannelIcon(channel.type)}\n                                                <span className=\"font-semibold\">{channel.name}</span>\n                                            </div>\n                                        </div>\n                                     )\n                                 })}\n                             </div>\n                         </AccordionContent>\n                    </AccordionItem>\n                ))}\n            </Accordion>\n        </ScrollArea>\n        <div \n            className=\"flex h-auto flex-col bg-muted/40 p-3 border-t-2 border-primary/20\"\n            onContextMenu={handleUserPanelContextMenu}\n            data-command-hub-trigger\n        >\n          {currentVoiceChannel && (\n            <div className=\"mb-2 p-2 rounded-md bg-green-500/10 border border-green-500/30\">\n                <p className=\"text-sm font-bold text-green-400\">Voice Connected</p>\n                <div className=\"flex items-center justify-between\">\n                  <p className=\"text-xs text-muted-foreground\">{currentVoiceChannel.name}</p>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7 text-muted-foreground hover:text-destructive\" onClick={() => setActiveVoiceChannel(null)}>\n                    <PhoneOff size={16}/>\n                  </Button>\n                </div>\n            </div>\n          )}\n          <div className=\"flex items-center justify-between\">\n            <div className='flex items-center gap-2'>\n              <Avatar className=\"h-9 w-9\">\n                <AvatarImage src={profile?.photoURL || undefined} />\n                <AvatarFallback>{profile?.displayName?.charAt(0)}</AvatarFallback>\n              </Avatar>\n              <div>\n                <p className=\"text-sm font-semibold text-foreground\">{profile?.gaming?.username || profile?.displayName}</p>\n                <p className=\"text-xs text-muted-foreground\">{profile?.status || 'Online'}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center\">\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-foreground\" onClick={() => setIsMuted(!isMuted)}> \n                <Mic size={20} className={cn(isMuted && \"text-destructive\")} /> \n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-foreground\" onClick={() => setIsDeafened(!isDeafened)}> \n                <Headphones size={20} className={cn(isDeafened && \"text-destructive\")} /> \n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-foreground\" onClick={() => router.push('/settings')}> \n                <Settings size={20} /> \n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n  );\n}\n","path":null,"size_bytes":11226,"size_tokens":null},"src/hooks/use-enhanced-calls.ts":{"content":"'use client';\n\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport { useUser } from './use-user';\nimport { useToast } from './use-toast';\nimport { getSocket } from '@/lib/socket';\n\nexport type CallType = 'voice' | 'video';\nexport type CallStatus = 'idle' | 'calling' | 'ringing' | 'connected';\n\nexport interface IncomingCall {\n  callId: string;\n  fromUserId: string;\n  fromUserName: string;\n  fromUserAvatar?: string;\n  callType: CallType;\n  timestamp: number;\n}\n\nexport interface ActiveCall {\n  callId: string;\n  withUserId: string;\n  withUserName: string;\n  withUserAvatar?: string;\n  callType: CallType;\n  isInitiator: boolean;\n}\n\nexport const useEnhancedCalls = () => {\n  const { user, profile } = useUser();\n  const { toast } = useToast();\n  const socket = getSocket();\n\n  const [callStatus, setCallStatus] = useState<CallStatus>('idle');\n  const [incomingCall, setIncomingCall] = useState<IncomingCall | null>(null);\n  const [activeCall, setActiveCall] = useState<ActiveCall | null>(null);\n\n\n  const [localStream, setLocalStream] = useState<MediaStream | null>(null);\n  const [remoteStream, setRemoteStream] = useState<MediaStream | null>(null);\n  const [isAudioEnabled, setIsAudioEnabled] = useState(true);\n  const [isVideoEnabled, setIsVideoEnabled] = useState(true);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [callDuration, setCallDuration] = useState(0);\n\n  const peerConnectionRef = useRef<RTCPeerConnection | null>(null);\n  const callTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const ringtoneRef = useRef<HTMLAudioElement | null>(null);\n  const activeCallRef = useRef<ActiveCall | null>(null);\n\n  useEffect(() => {\n    activeCallRef.current = activeCall;\n  }, [activeCall]);\n\n  useEffect(() => {\n    if (!user) return;\n    \n    socket.connect();\n    socket.emit('user:register', user.uid);\n\n    socket.on('call:incoming', handleIncomingCall);\n    socket.on('call:answer', handleAnswer);\n    socket.on('call:ice-candidate', handleIceCandidate);\n    socket.on('call:ended', cleanup);\n    socket.on('call:declined', () => {\n      toast({ variant: 'destructive', title: 'Call Declined' });\n      cleanup();\n    });\n\n    return () => {\n      socket.off('call:incoming');\n      socket.off('call:answer');\n      socket.off('call:ice-candidate');\n      socket.off('call:ended');\n      socket.off('call:declined');\n      socket.disconnect();\n      stopRingtone();\n      if (callTimerRef.current) clearInterval(callTimerRef.current);\n      if (localStream) localStream.getTracks().forEach(t => t.stop());\n      if (peerConnectionRef.current) peerConnectionRef.current.close();\n    };\n  }, [user]);\n\n  const playRingtone = useCallback(() => {\n    try {\n      if (!ringtoneRef.current) {\n        ringtoneRef.current = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGe77OeeSwwPUKfj8LZjHAU5kdfy0HotBSJ1xe/glEILElyx6OyrWBUIQ5zd8sFuJAUuhM/y24k2CBdmvOznnUoMDlCn4/C2YxwFOZHX8tB6LQUidb/v4JRCCxJcr+jrq1gVCEOc3fLBbiQFLoTP8tuJNggXZrzs551KDA5Qp+PwtmMcBTmR1/LQei0FInW/7+CUQgsRXK/o66tYFQhDnN3ywW4kBS6Ez/LbiTYIF2a87OedSgwOUKfj8LZjHAU5kdfyz3otBSJ1v+/glEILEVyv6OurWBUIQ5zd8sFuJAUuhM/y24k2CBdmvOznnUoMDlCn4/C2YxwFOZHX8s96LQUidb/v4JRCCxFcr+jrq1gVCEOc3fLBbiQFLoTP8tuJNggXZrzs551KDA5Qp+PwtmMcBTmR1/LPei0FInW/7+CUQgsRXK/o66tYFQhDnN3ywW4kBS6Ez/LbiTYIF2a87OedSgwOUKfj8LZjHAU5kdfyz3otBSJ1v+/glEILEVyv6OurWBUIQ5zd8sFuJAUuhM/y24k2CBdmvOznnUoMDlCn4/C2YxwFOZHX8s96LQUidb/v4JRCCxFcr+jrq1gVCEOc3fLBbiQFLoTP8tuJNggXZrzs551KDA5Qp+PwtmMcBTmR1/LPei0FInW/7+CUQgsRXK/o66tYFQhDnN3ywW4kBS6Ez/LbiTYIF2a87OedSgwOUKfj8LZjHAU5kdfyz3otBSJ1v+/glEILEVyv6OurWBUIQ5zd8sFuJAUuhM/y24k2CBdmvOznnUoMDlCn4/C2YxwFOZHX8s96LQUidb/v4JRCCxFcr+jrq1gVCEOc3fLBbiQFLoTP8tuJNggXZrzs551KDA5Qp+PwtmMcBTmR1/LPei0FInW/7+CUQgsRXK/o66tYFQhDnN3ywW4kBS6Ez/LbiTYIF2a87OedSgwNU=');\n        ringtoneRef.current.loop = true;\n        ringtoneRef.current.volume = 0.5;\n      }\n      ringtoneRef.current.play().catch(() => {});\n    } catch {}\n  }, []);\n\n  const stopRingtone = useCallback(() => {\n    if (ringtoneRef.current) {\n      ringtoneRef.current.pause();\n      ringtoneRef.current.currentTime = 0;\n    }\n  }, []);\n\n  const startCallTimer = useCallback(() => {\n    if (callTimerRef.current) clearInterval(callTimerRef.current);\n    setCallDuration(0);\n    callTimerRef.current = setInterval(() => {\n      setCallDuration(prev => prev + 1);\n    }, 1000);\n  }, []);\n\n  const cleanup = useCallback(() => {\n    stopRingtone();\n    if (callTimerRef.current) clearInterval(callTimerRef.current);\n    if (localStream) localStream.getTracks().forEach(t => t.stop());\n    if (peerConnectionRef.current) peerConnectionRef.current.close();\n    \n    setLocalStream(null);\n    setRemoteStream(null);\n    setActiveCall(null);\n    setIncomingCall(null);\n    setCallDuration(0);\n    setCallStatus('idle');\n    peerConnectionRef.current = null;\n    callTimerRef.current = null;\n  }, [localStream, stopRingtone]);\n\n  const createPeerConnection = useCallback((remoteUserId: string) => {\n    const pc = new RTCPeerConnection({\n      iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]\n    });\n\n    pc.ontrack = (e) => setRemoteStream(e.streams[0]);\n    pc.onicecandidate = (e) => {\n      if (e.candidate) {\n        socket.emit('call:ice-candidate', {\n          to: remoteUserId,\n          candidate: e.candidate.toJSON()\n        });\n      }\n    };\n\n    return pc;\n  }, [socket]);\n\n  const handleIncomingCall = useCallback(({ from, offer, callType, fromName, fromAvatar }: any) => {\n    setIncomingCall({\n      callId: `${Date.now()}_${from}`,\n      fromUserId: from,\n      fromUserName: fromName,\n      fromUserAvatar: fromAvatar,\n      callType,\n      timestamp: Date.now()\n    });\n    setCallStatus('ringing');\n    playRingtone();\n    \n    peerConnectionRef.current = createPeerConnection(from);\n    peerConnectionRef.current.setRemoteDescription(new RTCSessionDescription(offer));\n  }, [playRingtone, createPeerConnection]);\n\n  const handleAnswer = useCallback(async ({ answer }: any) => {\n    if (peerConnectionRef.current && peerConnectionRef.current.signalingState === 'have-local-offer') {\n      await peerConnectionRef.current.setRemoteDescription(new RTCSessionDescription(answer));\n      stopRingtone();\n      setCallStatus('connected');\n      startCallTimer();\n    }\n  }, [startCallTimer, stopRingtone]);\n\n  const handleIceCandidate = useCallback(({ candidate }: any) => {\n    if (peerConnectionRef.current) {\n      peerConnectionRef.current.addIceCandidate(new RTCIceCandidate(candidate));\n    }\n  }, []);\n\n  const startCall = useCallback(async (\n    toUserId: string, \n    toUserName: string, \n    callType: CallType,\n    toUserAvatar?: string\n  ) => {\n    if (!user) return;\n\n    try {\n      const callId = `${Date.now()}_${user.uid}`;\n      setCallStatus('calling');\n      setActiveCall({\n        callId,\n        withUserId: toUserId,\n        withUserName: toUserName,\n        withUserAvatar: toUserAvatar,\n        callType,\n        isInitiator: true\n      });\n\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: callType === 'video'\n      });\n      setLocalStream(stream);\n\n      const pc = createPeerConnection(toUserId);\n      stream.getTracks().forEach(t => pc.addTrack(t, stream));\n      peerConnectionRef.current = pc;\n\n      const offer = await pc.createOffer();\n      await pc.setLocalDescription(offer);\n\n      socket.emit('call:offer', {\n        to: toUserId,\n        from: user.uid,\n        offer,\n        callType,\n        fromName: profile?.displayName || 'Unknown',\n        fromAvatar: profile?.photoURL\n      });\n    } catch (error: any) {\n      toast({ variant: 'destructive', title: 'Call Failed', description: error.message });\n      cleanup();\n    }\n  }, [user, profile, socket, createPeerConnection, toast, cleanup]);\n\n  const acceptCall = useCallback(async () => {\n    if (!incomingCall || !user) return;\n\n    stopRingtone();\n    const callData = { ...incomingCall };\n    setIncomingCall(null);\n    setActiveCall({\n      callId: callData.callId,\n      withUserId: callData.fromUserId,\n      withUserName: callData.fromUserName,\n      withUserAvatar: callData.fromUserAvatar,\n      callType: callData.callType,\n      isInitiator: false\n    });\n    setCallStatus('connected');\n    startCallTimer();\n\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: callData.callType === 'video'\n      });\n      setLocalStream(stream);\n\n      if (peerConnectionRef.current) {\n        stream.getTracks().forEach(t => peerConnectionRef.current!.addTrack(t, stream));\n        const answer = await peerConnectionRef.current.createAnswer();\n        await peerConnectionRef.current.setLocalDescription(answer);\n\n        socket.emit('call:answer', {\n          to: callData.fromUserId,\n          answer\n        });\n      }\n    } catch (error: any) {\n      toast({ variant: 'destructive', title: 'Call Failed', description: error.message });\n    }\n  }, [incomingCall, user, socket, stopRingtone, toast, startCallTimer]);\n\n  const declineCall = useCallback(() => {\n    if (!incomingCall) return;\n\n    stopRingtone();\n    socket.emit('call:decline', { to: incomingCall.fromUserId });\n    setIncomingCall(null);\n    setCallStatus('idle');\n  }, [incomingCall, socket, stopRingtone]);\n\n  const endCall = useCallback(() => {\n    if (activeCall) {\n      socket.emit('call:end', { to: activeCall.withUserId });\n    }\n    cleanup();\n  }, [activeCall, socket, cleanup]);\n\n  const toggleAudio = useCallback(() => {\n    if (localStream) {\n      localStream.getAudioTracks().forEach(track => {\n        track.enabled = !track.enabled;\n        setIsAudioEnabled(track.enabled);\n      });\n    }\n  }, [localStream]);\n\n  const toggleVideo = useCallback(() => {\n    if (localStream) {\n      localStream.getVideoTracks().forEach(track => {\n        track.enabled = !track.enabled;\n        setIsVideoEnabled(track.enabled);\n      });\n    }\n  }, [localStream]);\n\n  const toggleScreenShare = useCallback(async () => {\n    if (!peerConnectionRef.current || !activeCall) return;\n\n    try {\n      if (isScreenSharing) {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          audio: true,\n          video: activeCall.callType === 'video'\n        });\n        const videoTrack = stream.getVideoTracks()[0];\n        const sender = peerConnectionRef.current.getSenders().find(s => s.track?.kind === 'video');\n        if (sender && videoTrack) {\n          await sender.replaceTrack(videoTrack);\n        }\n        if (localStream) {\n          localStream.getVideoTracks().forEach(t => t.stop());\n        }\n        setLocalStream(stream);\n        setIsScreenSharing(false);\n      } else {\n        const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });\n        const screenTrack = screenStream.getVideoTracks()[0];\n        const sender = peerConnectionRef.current.getSenders().find(s => s.track?.kind === 'video');\n        if (sender) {\n          await sender.replaceTrack(screenTrack);\n        }\n        screenTrack.onended = () => toggleScreenShare();\n        setIsScreenSharing(true);\n      }\n    } catch (error: any) {\n      toast({ variant: 'destructive', title: 'Screen Share Failed', description: error.message });\n    }\n  }, [isScreenSharing, activeCall, localStream, toast]);\n\n  const formatCallDuration = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return {\n    callStatus,\n    incomingCall,\n    activeCall,\n    localStream,\n    remoteStream,\n    isAudioEnabled,\n    isVideoEnabled,\n    isScreenSharing,\n    isMinimized,\n    callDuration: formatCallDuration(callDuration),\n    startCall,\n    acceptCall,\n    declineCall,\n    endCall,\n    toggleAudio,\n    toggleVideo,\n    toggleScreenShare,\n    setIsMinimized\n  };\n};","path":null,"size_bytes":12112,"size_tokens":null},"src/hooks/use-toast.ts":{"content":"\"use client\"\n\n// Inspired by react-hot-toast library\nimport * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\nimport { appEventEmitter } from \"@/lib/event-emitter\"\n\nconst TOAST_LIMIT = 3\nconst TOAST_REMOVE_DELAY = 5000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n  \n  if (props.variant === 'destructive') {\n      appEventEmitter.emit('ui:sound', 'error');\n  } else {\n      appEventEmitter.emit('ui:sound', 'success');\n  }\n\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  // Automatically dismiss the toast after a delay\n  setTimeout(() => {\n    dismiss()\n  }, props.duration || TOAST_REMOVE_DELAY);\n\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":4291,"size_tokens":null},"src/components/chat/incoming-call-notification.tsx":{"content":"\n'use client';\n\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport { Card } from '@/components/ui/card';\nimport { PublicUser } from '@/hooks/use-connections';\nimport { Phone, PhoneOff, Video } from 'lucide-react';\nimport { useEffect, useRef } from 'react';\n\ninterface IncomingCallNotificationProps {\n  caller: PublicUser | undefined;\n  onAccept: () => void;\n  onReject: () => void;\n}\n\nexport default function IncomingCallNotification({\n  caller,\n  onAccept,\n  onReject,\n}: IncomingCallNotificationProps) {\n\n  return (\n    <div className=\"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50\">\n      <Card className=\"p-8 rounded-2xl w-full max-w-sm animate-in fade-in-50 zoom-in-95 glass-card text-center\">\n        <p className=\"text-muted-foreground font-semibold\">Incoming Call</p>\n        <Avatar className=\"w-24 h-24 mx-auto my-4 border-4 border-primary neon-glow-primary\">\n          <AvatarImage src={caller?.photoURL || undefined} />\n          <AvatarFallback className=\"text-3xl\">{caller?.displayName?.[0] || '?'}</AvatarFallback>\n        </Avatar>\n        <h2 className=\"text-2xl font-headline text-glow\">{caller?.displayName || 'Unknown Caller'}</h2>\n        <p className=\"text-muted-foreground\">is calling you...</p>\n        <div className=\"mt-8 flex justify-around\">\n          <div className=\"flex flex-col items-center gap-2\">\n            <Button size=\"icon\" className=\"w-16 h-16 rounded-full bg-destructive hover:bg-destructive/80\" onClick={onReject}>\n              <PhoneOff />\n            </Button>\n            <span className=\"text-sm\">Reject</span>\n          </div>\n          <div className=\"flex flex-col items-center gap-2\">\n            <Button size=\"icon\" className=\"w-16 h-16 rounded-full bg-green-500 hover:bg-green-600\" onClick={onAccept}>\n              <Phone />\n            </Button>\n            <span className=\"text-sm\">Accept</span>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":2035,"size_tokens":null},"backend/src/routes/index.ts":{"content":"import { Router } from 'express';\nimport userRoutes from './userRoutes';\nimport aiRoutes from './aiRoutes';\nimport testRoutes from './testRoutes';\nimport uploadRoutes from './upload';\nimport callRoutes from './calls';\n\nconst router = Router();\n\n// Health check endpoint\nrouter.get('/health', (req, res) => {\n  res.json({\n    status: 'OK',\n    timestamp: new Date().toISOString(),\n    uptime: process.uptime(),\n    environment: process.env.NODE_ENV || 'development',\n  });\n});\n\n// API routes\nrouter.use('/users', userRoutes);\nrouter.use('/ai', aiRoutes);\nrouter.use('/test', testRoutes);\nrouter.use('/upload', uploadRoutes);\nrouter.use('/calls', callRoutes);\n\nexport default router;","path":null,"size_bytes":681,"size_tokens":null},"src/hooks/use-user.ts":{"content":"\n'use client';\n\nimport { useEffect, useState, useCallback } from 'react';\nimport { onAuthStateChanged, type User } from 'firebase/auth';\nimport { useAuth, useFirestore } from '@/firebase/provider';\nimport { doc, onSnapshot, setDoc, serverTimestamp, DocumentData, Timestamp, updateDoc, increment, writeBatch, arrayUnion, runTransaction, collection, addDoc, arrayRemove, getDoc } from 'firebase/firestore';\nimport { useToast } from './use-toast';\nimport { Quest, dailyQuests, weeklyQuests, seasonalQuests } from '@/lib/quests';\nimport { StoreItem } from '@/lib/store-items';\nimport { isBefore, startOfDay, startOfWeek, startOfMonth } from 'date-fns';\nimport { appEventEmitter } from '@/lib/event-emitter';\nimport { themes } from '@/lib/themes';\nimport { achievements } from '@/lib/achievements';\n\n// Expanded settings structure\nexport interface UserSettings {\n    cursor?: {\n        style?: string;\n        lowPerf?: boolean;\n    };\n    sound?: {\n        masterVolume?: number;\n        uiVolume?: number;\n        notificationVolume?: number;\n        enableSounds?: boolean;\n    };\n    animations?: {\n        level?: 'none' | 'basic' | 'full';\n    };\n    developer?: {\n        enableDevTools?: boolean;\n    },\n    gaming?: {\n        performanceMode?: boolean;\n    }\n}\n\nexport interface GamingProfile {\n    username?: string;\n    status?: 'ONLINE' | 'IN_GAME' | 'AFK' | 'OFFLINE';\n    theme?: string;\n}\n\nexport interface UserProfile {\n    id: string;\n    username: string;\n    email?: string;\n    displayName?: string;\n    photoURL?: string;\n    bio?: string;\n    status?: string;\n    lastSeen?: Timestamp;\n    isAnonymous: boolean;\n    createdAt: Timestamp;\n    xp: number;\n    level: number;\n    trustScore?: number;\n    streak?: number;\n    socials?: {\n        github?: string;\n        twitter?: string;\n        linkedin?: string;\n    };\n    interests?: string[];\n    badgesUnlocked: string[];\n    questsCompleted: string[];\n    questResets: {\n        daily: Timestamp;\n        weekly: Timestamp;\n        seasonal: Timestamp;\n    };\n    theme?: string;\n    inventory: string[];\n    settings?: UserSettings;\n    gaming?: GamingProfile;\n    messagesSent: number;\n    notesCreated: number;\n    filesUploaded: number;\n    friends: number;\n    lastBonusClaim?: Timestamp;\n}\n\n\nexport function useUser() {\n  const auth = useAuth();\n  const firestore = useFirestore();\n  const { toast } = useToast();\n  const [user, setUser] = useState<User | null>(null);\n  const [profile, setProfile] = useState<UserProfile | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [authChecked, setAuthChecked] = useState(false);\n\n  const reloadUser = useCallback(async () => {\n    if (auth.currentUser) {\n      await auth.currentUser.reload();\n      setUser({ ...auth.currentUser });\n    }\n  }, [auth]);\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      setUser(user);\n      setAuthChecked(true);\n    });\n    \n    return () => unsubscribe();\n  }, [auth]);\n\n  const checkAchievements = useCallback((newProfileData: UserProfile) => {\n    if (!newProfileData || !user) return;\n  \n    const newlyUnlocked = achievements.filter(ach => {\n      if (newProfileData.badgesUnlocked?.includes(ach.id)) return false;\n      \n      switch (ach.id) {\n        case 'communicator-1': return newProfileData.messagesSent >= 1;\n        case 'communicator-2': return newProfileData.messagesSent >= 100;\n        case 'communicator-3': return newProfileData.messagesSent >= 1000;\n        case 'archivist-1': return newProfileData.notesCreated >= 1;\n        case 'archivist-2': return newProfileData.notesCreated >= 25;\n        case 'socialite-1': return newProfileData.friends >= 1;\n        case 'socialite-2': return newProfileData.friends >= 5;\n        case 'cloud-warrior-1': return newProfileData.filesUploaded >= 1;\n        case 'guardian': return (newProfileData.trustScore ?? 0) >= 75;\n        case 'overlord': return newProfileData.level >= 50;\n        default: return false;\n      }\n    });\n  \n    if (newlyUnlocked.length > 0) {\n      const userDocRef = doc(firestore, 'users', user.uid);\n      const batch = writeBatch(firestore);\n      \n      newlyUnlocked.forEach(ach => {\n        toast({\n          title: 'Achievement Unlocked!',\n          description: `You've earned the \"${ach.name}\" badge.`,\n        });\n        batch.update(userDocRef, { badgesUnlocked: arrayUnion(ach.id) });\n      });\n  \n      batch.commit().catch(e => console.error(\"Error committing achievement batch:\", e));\n    }\n  }, [toast, user, firestore]);\n\n  // Profile listener effect\n  useEffect(() => {\n    if (user && authChecked) {\n      setLoading(true);\n      const userDocRef = doc(firestore, 'users', user.uid);\n\n      const unsubscribeProfile = onSnapshot(userDocRef, \n        (docSnap) => {\n          if (docSnap.exists()) {\n            const newProfileData = { ...docSnap.data(), id: docSnap.id } as UserProfile;\n            setProfile(newProfileData);\n          } else {\n            setProfile(null);\n          }\n          setLoading(false);\n        }, \n        (error) => {\n          console.error(\"Error fetching user profile:\", error);\n          setLoading(false);\n        }\n      );\n      \n      return () => {\n        unsubscribeProfile();\n      };\n\n    } else if (!user && authChecked) {\n      setProfile(null);\n      setLoading(false);\n    }\n  }, [user, firestore, authChecked]);\n  \n  // Presence management effect - ISOLATED from profile listening\n  useEffect(() => {\n    if (user && authChecked) {\n      const userDocRef = doc(firestore, 'users', user.uid);\n\n      // Initial update\n      updateDoc(userDocRef, { lastSeen: serverTimestamp(), status: 'Online' }).catch(e => console.error(\"Initial presence update failed:\", e));\n      \n      // Periodic update\n      const presenceInterval = setInterval(() => {\n        if(document.visibilityState === 'visible') {\n            updateDoc(userDocRef, { lastSeen: serverTimestamp() }).catch(e => console.error(\"Periodic presence update failed:\", e));\n        }\n      }, 60 * 1000); // Update every minute\n\n      return () => clearInterval(presenceInterval);\n    }\n  }, [user, firestore, authChecked]);\n  \n  const incrementStat = useCallback(async (stat: keyof UserProfile, value: number) => {\n    if (!user || !firestore) return;\n    const userDocRef = doc(firestore, 'users', user.uid);\n    try {\n        await runTransaction(firestore, async (transaction) => {\n            const userDoc = await transaction.get(userDocRef);\n            if (!userDoc.exists()) {\n                throw \"User document does not exist!\";\n            }\n            const currentStatValue = userDoc.data()[stat] || 0;\n            transaction.update(userDocRef, { [stat]: currentStatValue + value });\n        });\n        \n        // Fetch the latest profile data AFTER the transaction to check achievements\n        const updatedDoc = await getDoc(userDocRef);\n        if (updatedDoc.exists()) {\n            checkAchievements(updatedDoc.data() as UserProfile);\n        }\n    } catch (e) {\n        console.error(\"Error incrementing stat:\", e);\n    }\n  }, [firestore, user, checkAchievements]);\n\n  const updateStatus = useCallback(async (status: string) => {\n    if (!user || !firestore) return;\n    const userDocRef = doc(firestore, 'users', user.uid);\n    await updateDoc(userDocRef, { status: status, lastSeen: serverTimestamp() });\n    toast({ title: 'Status Updated', description: `Your status has been set to ${status}.`})\n  }, [firestore, user, toast]);\n\n  const updateProfileSettings = useCallback(async (newSettings: Partial<UserSettings>) => {\n    if (!user || !firestore) {\n      toast({ variant: 'destructive', title: 'Error', description: 'Not authenticated.' });\n      return;\n    }\n    const userDocRef = doc(firestore, 'users', user.uid);\n    try {\n      await setDoc(userDocRef, { settings: newSettings }, { merge: true });\n      // Optimistically update local state\n      if (profile) {\n        setProfile({\n            ...profile,\n            settings: {\n                ...profile.settings,\n                ...newSettings\n            }\n        });\n      }\n      toast({ title: 'Settings Saved', description: 'Your preferences have been updated.' });\n    } catch (error: any) {\n      toast({ variant: 'destructive', title: 'Save Failed', description: error.message });\n    }\n  }, [user, firestore, toast, profile]);\n\n\n  const addXp = useCallback(async (amount: number) => {\n      if (!user || !firestore) return;\n      const userDocRef = doc(firestore, 'users', user.uid);\n      await updateDoc(userDocRef, { xp: increment(amount) });\n      appEventEmitter.emit('xp:earned');\n  }, [firestore, user]);\n\n const claimQuestReward = useCallback(async (quest: Quest) => {\n    if (!user || !profile || !firestore) {\n      toast({ variant: 'destructive', title: 'Authentication Error' });\n      return;\n    }\n    if (profile.questsCompleted?.includes(quest.id)) {\n        console.warn(\"Quest already claimed.\");\n        return;\n    }\n\n    const userDocRef = doc(firestore, 'users', user.uid);\n\n    try {\n        await runTransaction(firestore, async (transaction) => {\n            const userDoc = await transaction.get(userDocRef);\n            if (!userDoc.exists()) {\n                throw \"User document does not exist!\";\n            }\n\n            let currentXp = userDoc.data().xp || 0;\n            let currentLevel = userDoc.data().level || 1;\n            \n            // Add quest XP\n            currentXp += quest.xp;\n\n            // Check for level up\n            let xpForNextLevel = currentLevel * 1000 + 1000;\n            while (currentXp >= xpForNextLevel) {\n                currentXp -= xpForNextLevel;\n                currentLevel += 1;\n                xpForNextLevel = currentLevel * 1000 + 1000; // Calculate XP for the new level\n                toast({\n                    title: \"Level Up!\",\n                    description: `Congratulations, you've reached level ${currentLevel}!`\n                });\n            }\n\n            // Prepare update data\n            const updateData: any = {\n                xp: currentXp,\n                level: currentLevel,\n                questsCompleted: arrayUnion(quest.id),\n            };\n\n            if (quest.badgeReward) {\n                updateData.badgesUnlocked = arrayUnion(quest.badgeReward);\n            }\n\n            transaction.update(userDocRef, updateData);\n        });\n        appEventEmitter.emit('xp:earned');\n    } catch (error) {\n        console.error(\"Failed to claim quest reward:\", error);\n        toast({\n            variant: 'destructive',\n            title: 'Claim Failed',\n            description: 'Could not sync with server. Please try again.'\n        });\n    }\n}, [user, profile, firestore, toast]);\n  \n   const purchaseItem = useCallback(async (item: StoreItem) => {\n    if (!user || !profile || !firestore) throw new Error(\"User not authenticated.\");\n    if (profile.xp < item.price) throw new Error(\"Not enough XP.\");\n    if (profile.inventory?.includes(item.id)) throw new Error(\"Item already owned.\");\n\n    const userDocRef = doc(firestore, 'users', user.uid);\n    try {\n      await runTransaction(firestore, async (transaction) => {\n        const userDoc = await transaction.get(userDocRef);\n        if (!userDoc.exists()) throw \"User document does not exist!\";\n\n        const currentXp = userDoc.data().xp || 0;\n        if (currentXp < item.price) throw \"Not enough XP.\";\n\n        transaction.update(userDocRef, {\n          xp: increment(-item.price),\n          inventory: arrayUnion(item.id)\n        });\n      });\n\n      if (item.unlocksBadge) {\n         await updateDoc(userDocRef, {\n            badgesUnlocked: arrayUnion(item.unlocksBadge)\n        });\n      }\n      \n    } catch (e) {\n      console.error(\"Purchase transaction failed: \", e);\n      throw e;\n    }\n  }, [user, profile, firestore]);\n  \n  const checkAndResetQuests = useCallback(async () => {\n    if (!user || !profile || !firestore) return;\n    \n    const now = new Date();\n    const userDocRef = doc(firestore, 'users', user.uid);\n    const questResets = profile.questResets;\n    \n    // Use regular date-fns functions instead of UTC versions\n    const startOfToday = startOfDay(now);\n    const startOfThisWeek = startOfWeek(now, { weekStartsOn: 1 }); // Monday\n    const startOfThisMonth = startOfMonth(now);\n\n    const updates: any = {};\n    let questsToRemove: string[] = [];\n    \n    if (!questResets?.daily || isBefore(questResets.daily.toDate(), startOfToday)) {\n        updates['questResets.daily'] = serverTimestamp();\n        questsToRemove = [...questsToRemove, ...dailyQuests.map(q => q.id)];\n    }\n    \n    if (!questResets?.weekly || isBefore(questResets.weekly.toDate(), startOfThisWeek)) {\n        updates['questResets.weekly'] = serverTimestamp();\n        questsToRemove = [...questsToRemove, ...weeklyQuests.map(q => q.id)];\n    }\n    \n    if (!questResets?.seasonal || isBefore(questResets.seasonal.toDate(), startOfThisMonth)) {\n        updates['questResets.seasonal'] = serverTimestamp();\n        questsToRemove = [...questsToRemove, ...seasonalQuests.map(q => q.id)];\n    }\n\n    if (Object.keys(updates).length > 0) {\n        if (questsToRemove.length > 0) {\n            updates.questsCompleted = arrayRemove(...questsToRemove);\n        }\n        await updateDoc(userDocRef, updates);\n        toast({ title: 'Quests Reset', description: 'Your daily/weekly/seasonal quests have been reset.'});\n    }\n\n  }, [user, profile, firestore, toast]);\n\n  const setProfileCallback = useCallback((newProfile: UserProfile) => {\n    setProfile(newProfile);\n  }, []);\n\n  const updateProfile = useCallback(async (updates: Partial<UserProfile>) => {\n    if (!user || !firestore) return;\n    const userDocRef = doc(firestore, 'users', user.uid);\n    try {\n      await updateDoc(userDocRef, updates);\n      if (profile) {\n        setProfile({ ...profile, ...updates });\n      }\n    } catch (error) {\n      console.error('Profile update failed:', error);\n      throw error;\n    }\n  }, [user, firestore, profile]);\n\n  return { \n    user, \n    profile, \n    loading: loading || !authChecked,\n    reloadUser, \n    incrementStat, \n    updateStatus,\n    updateProfileSettings,\n    addXp, \n    claimQuestReward, \n    purchaseItem, \n    checkAndResetQuests, \n    setProfile: setProfileCallback,\n    updateProfile\n  };\n}\n","path":null,"size_bytes":14320,"size_tokens":null},"src/components/settings/theme-settings.tsx":{"content":"'use client';\nimport { useTheme } from '@/components/providers/ThemeProvider';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { cn } from '@/lib/utils';\nimport { Check, Lock, Loader2 } from 'lucide-react';\nimport { useUser } from '@/hooks/use-user';\nimport { useState } from 'react';\n\nexport default function ThemeSettings() {\n  const { theme: activeTheme, setTheme, themes } = useTheme();\n  const { profile } = useUser();\n  const inventory = profile?.inventory || [];\n  const [equipping, setEquipping] = useState<string | null>(null);\n\n  return (\n    <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n      {themes.map((theme) => {\n        const isDefault = ['cyber-default', 'amoled-noir', 'soft-gradient', 'mecha-pilot'].includes(theme.id);\n        const isOwned = isDefault || inventory.includes(theme.id);\n        const isLocked = !isOwned;\n        const isEquipping = equipping === theme.id;\n        \n        const handleEquip = async () => {\n          if (!isOwned) return;\n          console.log('Equipping item', theme.id);\n          setEquipping(theme.id);\n          await setTheme(theme.id);\n          setTimeout(() => setEquipping(null), 500);\n        };\n        \n        return (\n        <div key={theme.id} className=\"space-y-2\">\n          <Card\n            onClick={handleEquip}\n            className={cn(\n              'transition-all relative',\n              isOwned ? 'cursor-pointer' : 'cursor-not-allowed opacity-50',\n              activeTheme === theme.id ? 'neon-border-primary' : isOwned && 'hover:bg-muted/50'\n            )}\n          >\n            <CardContent className=\"p-0\">\n              {isEquipping && (\n                <div className=\"absolute inset-0 flex items-center justify-center bg-black/80 rounded-md z-20\">\n                  <Loader2 className=\"w-8 h-8 text-primary animate-spin\" />\n                </div>\n              )}\n              {isLocked && (\n                <div className=\"absolute inset-0 flex items-center justify-center bg-black/60 rounded-md z-10\">\n                  <Lock className=\"w-8 h-8 text-muted-foreground\" />\n                </div>\n              )}\n              <div className=\"flex -space-x-1 overflow-hidden rounded-t-md\">\n                <div className=\"flex-1 h-12 w-12\" style={{ backgroundColor: `hsl(${theme.colors.primary})` }} />\n                <div className=\"flex-1 h-12 w-12\" style={{ backgroundColor: `hsl(${theme.colors.secondary})` }} />\n                <div className=\"flex-1 h-12 w-12\" style={{ backgroundColor: `hsl(${theme.colors.accent})` }} />\n              </div>\n              <div className=\"h-12 rounded-b-md\" style={{ backgroundColor: `hsl(${theme.colors.background})` }} />\n            </CardContent>\n          </Card>\n          <div className=\"flex items-center justify-center gap-2\">\n            {activeTheme === theme.id && <Check className=\"w-4 h-4 text-primary\" />}\n            {isLocked && <Lock className=\"w-3 h-3 text-muted-foreground\" />}\n            <p className=\"text-sm font-semibold text-center\">{theme.name}</p>\n          </div>\n        </div>\n      )})}\n    </div>\n  );\n}\n","path":null,"size_bytes":3117,"size_tokens":null},"src/components/chat/MessageList.tsx":{"content":"\n'use client';\nimport { useRef, useEffect, memo, useCallback } from 'react';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { CardContent } from '@/components/ui/card';\nimport { Message, aetherBotContact } from '@/types/chat';\nimport { User } from 'firebase/auth';\nimport { motion } from 'framer-motion';\nimport { cn, copyToClipboard } from '@/lib/utils';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { Bot, Check, CheckCheck, SmilePlus, File as FileIcon, Download, Star } from 'lucide-react';\nimport { PublicUser } from '@/hooks/use-connections';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useToast } from '@/hooks/use-toast';\nimport { useUser } from '@/hooks/use-user';\nimport { useRouter } from 'next/navigation';\nimport { appEventEmitter } from '@/lib/event-emitter';\nimport { useFirestore } from '@/firebase/provider';\nimport { doc, updateDoc, arrayUnion, arrayRemove, deleteDoc } from 'firebase/firestore';\nimport { Popover, PopoverContent, PopoverTrigger } from '../ui/popover';\nimport { EMOJI_LIST } from '@/lib/data';\nimport Image from 'next/image';\nimport UserPopover from '../user/user-popover';\n\ninterface MessageListProps {\n    messages: Message[];\n    currentUser: User | null;\n    chatId: string | null;\n    connectedUsers: PublicUser[];\n}\n\nconst formatTime = (timestamp: any) => {\n    if (!timestamp) return '...';\n    try {\n      if (typeof timestamp.toDate === 'function') {\n          return timestamp.toDate().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n      }\n      return new Date(timestamp.seconds * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    } catch(e) {\n      return '...';\n    }\n};\n\nconst getMessageStatusIcon = (status: Message['status']) => {\n    switch (status) {\n        case 'read': return <CheckCheck className=\"w-4 h-4 text-blue-500\" />;\n        case 'delivered': return <CheckCheck className=\"w-4 h-4 text-muted-foreground\" />;\n        case 'sent': return <Check className=\"w-4 h-4 text-muted-foreground\" />;\n        default: return null;\n    }\n};\n\nconst MediaMessage = ({ mediaUrl, mediaType }: { mediaUrl: string, mediaType: string }) => {\n    if (mediaType.startsWith('image/')) {\n        return (\n            <div className=\"relative aspect-video max-w-sm rounded-lg overflow-hidden my-2 group\">\n                <Image src={mediaUrl} alt=\"Chat image\" layout=\"fill\" className=\"object-cover transition-transform duration-300 group-hover:scale-105\" />\n            </div>\n        );\n    }\n    if (mediaType.startsWith('video/')) {\n        return (\n            <div className=\"relative aspect-video max-w-sm rounded-lg overflow-hidden my-2\">\n                <video src={mediaUrl} controls className=\"w-full h-full\" />\n            </div>\n        );\n    }\n    return (\n        <a href={mediaUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"flex items-center gap-2 p-3 my-2 bg-black/20 rounded-lg hover:bg-black/30\">\n            <FileIcon className=\"w-6 h-6\" />\n            <span className=\"truncate\">Attached File</span>\n            <Download className=\"w-4 h-4 ml-auto\" />\n        </a>\n    )\n}\n\nconst MemoizedMessage = memo(({ msg, currentUser, handleMessageContextMenu, handleAvatarContextMenu, onReaction, connectedUsers }: { msg: Message, currentUser: User | null, handleMessageContextMenu: (e: React.MouseEvent, m: Message) => void, handleAvatarContextMenu: (e: React.MouseEvent, s: string) => void, onReaction: (messageId: string, emoji: string) => void, connectedUsers: PublicUser[] }) => {\n    const isOwnMessage = msg.senderId === currentUser?.uid;\n    const sender = connectedUsers.find(u => u.id === msg.senderId);\n\n    return (\n        <motion.div\n            key={msg.id}\n            className=\"group flex flex-col -mx-2 px-2 py-1 rounded-md hover:bg-muted/30\"\n            id={`msg-${msg.id}`}\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.3, ease: 'easeOut' }}\n            onContextMenu={(e) => handleMessageContextMenu(e, msg)}\n            data-command-hub-trigger\n        >\n            <div className={cn(\"flex items-start gap-3\", isOwnMessage ? 'justify-end' : 'justify-start')}>\n                {!isOwnMessage && (\n                    <div onContextMenu={(e) => handleAvatarContextMenu(e, msg.senderId)} data-command-hub-trigger>\n                         <UserPopover user={sender!}>\n                            <Avatar className=\"h-8 w-8 cursor-pointer\">\n                                {msg.senderId === aetherBotContact.id ? (\n                                    <div className=\"w-full h-full flex items-center justify-center bg-primary/10 rounded-full\"><Bot className=\"w-4 h-4 text-primary\" /></div>\n                                ) : (\n                                    <AvatarImage src={msg.senderAvatar || undefined} />\n                                )}\n                                <AvatarFallback>{msg.senderName?.charAt(0)}</AvatarFallback>\n                            </Avatar>\n                        </UserPopover>\n                    </div>\n                )}\n                <div className={cn(\"flex flex-col space-y-1 text-base max-w-md\", isOwnMessage && 'items-end')}>\n                     <div className=\"flex items-center gap-2\">\n                        {isOwnMessage && (\n                             <div className=\"flex items-center opacity-0 group-hover:opacity-100 transition-opacity\">\n                                <Popover>\n                                    <PopoverTrigger asChild>\n                                        <button className=\"p-1 rounded-full hover:bg-background/50\"><SmilePlus size={16} /></button>\n                                    </PopoverTrigger>\n                                    <PopoverContent className=\"w-auto p-1\">\n                                        <div className=\"flex gap-1\">\n                                            {EMOJI_LIST.slice(0, 5).map(emoji => (\n                                                <button key={emoji} onClick={() => onReaction(msg.id, emoji)} className=\"text-2xl p-1 rounded-md hover:bg-muted\">{emoji}</button>\n                                            ))}\n                                        </div>\n                                    </PopoverContent>\n                                </Popover>\n                             </div>\n                        )}\n                        <div className={cn(\"relative px-3 py-2 rounded-lg flex flex-col shadow-md transition-colors\",\n                            isOwnMessage ? 'bg-primary text-primary-foreground rounded-br-none' : 'bg-muted/80 rounded-bl-none'\n                        )}>\n                            {!isOwnMessage && (\n                                <UserPopover user={sender!}>\n                                    <p className=\"text-xs font-bold text-primary pb-1 cursor-pointer hover:underline\">{msg.senderName}</p>\n                                </UserPopover>\n                            )}\n                            {msg.replyTo && (\n                                <a href={`#msg-${msg.replyTo}`} className=\"block border-l-2 border-primary/50 pl-2 mb-2 text-xs opacity-80 hover:bg-black/10 rounded-r-sm\">\n                                    <p className=\"font-bold\">{msg.replySender}</p>\n                                    <p className=\"line-clamp-1\">{msg.replyContent}</p>\n                                </a>\n                            )}\n                            {msg.mediaUrl && msg.mediaType && <MediaMessage mediaUrl={msg.mediaUrl} mediaType={msg.mediaType} />}\n                            {msg.content && <p className=\"whitespace-pre-wrap\">{msg.content}</p>}\n                        </div>\n                         {!isOwnMessage && (\n                              <div className=\"flex items-center opacity-0 group-hover:opacity-100 transition-opacity\">\n                                <Popover>\n                                    <PopoverTrigger asChild>\n                                        <button className=\"p-1 rounded-full hover:bg-background/50\"><SmilePlus size={16} /></button>\n                                    </PopoverTrigger>\n                                    <PopoverContent className=\"w-auto p-1\">\n                                        <div className=\"flex gap-1\">\n                                            {EMOJI_LIST.slice(0, 5).map(emoji => (\n                                                <button key={emoji} onClick={() => onReaction(msg.id, emoji)} className=\"text-2xl p-1 rounded-md hover:bg-muted\">{emoji}</button>\n                                            ))}\n                                        </div>\n                                    </PopoverContent>\n                                </Popover>\n                             </div>\n                        )}\n                    </div>\n                    {msg.reactions && Object.keys(msg.reactions).length > 0 && (\n                        <div className=\"flex gap-1 pt-1\" style={{ marginLeft: isOwnMessage ? 'auto' : '0' }}>\n                            {Object.entries(msg.reactions).map(([emoji, userIds]) => (\n                                <TooltipProvider key={emoji}>\n                                    <Tooltip>\n                                        <TooltipTrigger asChild>\n                                             <button \n                                                onClick={() => onReaction(msg.id, emoji)}\n                                                className={cn(\n                                                    \"px-1.5 py-0.5 rounded-full text-xs flex items-center gap-1 transition-colors\",\n                                                    userIds.includes(currentUser?.uid ?? '') \n                                                        ? \"bg-primary/20 border border-primary/50\" \n                                                        : \"bg-muted/80 border border-transparent hover:border-primary/50\"\n                                                )}\n                                             >\n                                                <span>{emoji}</span>\n                                                <span>{userIds.length}</span>\n                                            </button>\n                                        </TooltipTrigger>\n                                        <TooltipContent className=\"text-xs p-1\">\n                                            {userIds.length} reaction{userIds.length > 1 ? 's' : ''}\n                                        </TooltipContent>\n                                    </Tooltip>\n                                </TooltipProvider>\n                            ))}\n                        </div>\n                    )}\n                    <div className=\"text-xs text-muted-foreground px-1 flex items-center gap-1\">\n                        <span>{formatTime(msg.timestamp)}</span>\n                        {msg.importantFor?.includes(currentUser?.uid ?? '') && (\n                            <Star className=\"w-3 h-3 text-yellow-500 fill-yellow-500\" />\n                        )}\n                        {isOwnMessage && getMessageStatusIcon(msg.status)}\n                    </div>\n                </div>\n            </div>\n        </motion.div>\n    );\n});\nMemoizedMessage.displayName = \"MemoizedMessage\";\n\nexport default function MessageList({ messages, currentUser, chatId, connectedUsers }: MessageListProps) {\n    const scrollAreaRef = useRef<HTMLDivElement>(null);\n    const { openHub } = useCommandHub();\n    const { toast } = useToast();\n    const { user, profile } = useUser();\n    const router = useRouter();\n    const firestore = useFirestore();\n\n\n    useEffect(() => {\n        if (scrollAreaRef.current) {\n            const scrollDiv = scrollAreaRef.current.querySelector('div[data-radix-scroll-area-viewport]');\n            if (scrollDiv) {\n                // Only autoscroll if user is near the bottom\n                const isScrolledToBottom = scrollDiv.scrollHeight - scrollDiv.clientHeight <= scrollDiv.scrollTop + 100;\n                if(isScrolledToBottom) {\n                    scrollDiv.scrollTo({ top: scrollDiv.scrollHeight, behavior: 'smooth' });\n                }\n            }\n        }\n    }, [messages]);\n    \n    const handleDeleteMessage = useCallback(async (messageId: string) => {\n        if (!chatId) return;\n        const messageRef = doc(firestore, 'chats', chatId, 'messages', messageId);\n        try {\n            await deleteDoc(messageRef);\n        } catch (error) {\n            console.error(\"Error deleting message:\", error);\n            toast({ variant: 'destructive', title: 'Error', description: 'Could not delete message.' });\n        }\n    }, [chatId, firestore, toast]);\n\n    const handleMarkImportant = useCallback(async (messageId: string) => {\n        if (!chatId || !currentUser?.uid) return;\n        const messageRef = doc(firestore, 'chats', chatId, 'messages', messageId);\n        const currentMessage = messages.find(m => m.id === messageId);\n        const isImportant = currentMessage?.importantFor?.includes(currentUser.uid) || false;\n        \n        try {\n            await updateDoc(messageRef, {\n                importantFor: isImportant \n                    ? arrayRemove(currentUser.uid)\n                    : arrayUnion(currentUser.uid)\n            });\n            toast({ \n                title: isImportant ? 'Removed from important' : 'Marked as important',\n                description: isImportant ? 'Message unmarked' : 'Message saved to important'\n            });\n        } catch (error) {\n            console.error('Error marking message as important:', error);\n            toast({ variant: 'destructive', title: 'Error', description: 'Could not update message.' });\n        }\n    }, [chatId, currentUser, firestore, messages, toast]);\n\n\n    const handleMessageContextMenu = (e: React.MouseEvent, message: Message) => {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        let messageActions: any[] = [\n            { label: 'Reply', icon: 'MessageSquareReply', onClick: () => appEventEmitter.emit('chat:reply-to', message) },\n            { label: 'Copy Text', icon: 'Copy', onClick: () => { copyToClipboard(message.content); toast({ title: 'Copied to clipboard' }); } },\n            { label: 'Forward', icon: 'ArrowRight', onClick: () => appEventEmitter.emit('chat:forward-message', message) },\n            { label: 'Translate', icon: 'Languages', onClick: () => toast({ title: 'Translation feature coming soon' }) },\n            { label: 'React', icon: 'SmilePlus', onClick: () => toast({ title: 'Use emoji button to react' }) },\n            { label: 'Mark Important', icon: 'Star', onClick: () => handleMarkImportant(message.id) },\n        ];\n\n        if (message.senderId === user?.uid) {\n            messageActions.push(\n                { label: 'Edit Message', icon: 'FilePenLine', onClick: () => toast({ title: 'Edit feature coming soon' }) },\n                { label: 'Delete Message', icon: 'Trash2', onClick: () => handleDeleteMessage(message.id) }\n            );\n        }\n        \n        openHub(e, {\n            type: 'chat-message',\n            data: message,\n            actions: messageActions,\n        });\n    };\n\n    const handleAvatarContextMenu = (e: React.MouseEvent, senderId: string) => {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        const targetUser = connectedUsers.find(u => u.id === senderId);\n        if (!targetUser || senderId === profile?.id) return;\n\n        openHub(e, {\n            type: 'user-contact',\n            data: targetUser,\n            actions: [\n                { label: 'Open Profile', icon: 'User', onClick: () => router.push(`/profile/${targetUser.id}`) },\n                { label: 'Send Message', icon: 'MessageSquare', onClick: () => router.push(`/chat?contactId=${targetUser.id}`) },\n                { label: 'Pin User', icon: 'Pin', onClick: () => appEventEmitter.emit('ui:pin-user', targetUser) },\n                { label: 'Block User', icon: 'UserX', onClick: () => console.log(\"blocking\"), isDestructive: true },\n            ]\n        });\n    };\n\n     const handleReaction = useCallback(async (messageId: string, emoji: string) => {\n        if (!chatId || !currentUser?.uid) return;\n\n        const messageRef = doc(firestore, 'chats', chatId, 'messages', messageId);\n        const currentMessage = messages.find(m => m.id === messageId);\n        const currentReactions = currentMessage?.reactions?.[emoji] || [];\n        const hasReacted = currentReactions.includes(currentUser.uid);\n\n        try {\n            await updateDoc(messageRef, {\n                [`reactions.${emoji}`]: hasReacted \n                    ? arrayRemove(currentUser.uid) \n                    : arrayUnion(currentUser.uid)\n            });\n        } catch(e) {\n            console.error(\"Failed to update reaction\", e);\n            toast({ variant: 'destructive', title: \"Reaction failed\" });\n        }\n    }, [chatId, currentUser, firestore, messages, toast]);\n\n\n    return (\n        <ScrollArea className=\"flex-1\" ref={scrollAreaRef}>\n            <CardContent className=\"p-4 space-y-1\">\n                <TooltipProvider>\n                    {messages.map((msg) => (\n                        <MemoizedMessage\n                            key={msg.id}\n                            msg={msg}\n                            currentUser={currentUser}\n                            handleMessageContextMenu={handleMessageContextMenu}\n                            handleAvatarContextMenu={handleAvatarContextMenu}\n                            onReaction={handleReaction}\n                            connectedUsers={connectedUsers}\n                        />\n                    ))}\n                </TooltipProvider>\n            </CardContent>\n        </ScrollArea>\n    );\n}\n","path":null,"size_bytes":17975,"size_tokens":null},"src/components/layout/header.tsx":{"content":"\n'use client';\nimport { useState } from 'react';\nimport { Bell, Search, Grid } from 'lucide-react';\nimport { usePathname } from 'next/navigation';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport UserNav from './user-nav';\nimport NotificationPanel from './notification-panel';\n\nimport { useNotifications } from '@/hooks/use-notifications';\nimport AetherLogo from '../aether-logo';\nimport { cn } from '@/lib/utils';\nimport GlitchText from '@/components/ui/glitch-text';\n\ninterface HeaderProps {\n  onNavToggle: () => void;\n  isNavOpen: boolean;\n}\n\nexport default function Header({ onNavToggle, isNavOpen }: HeaderProps) {\n  const pathname = usePathname();\n  const [isNotificationsOpen, setIsNotificationsOpen] = useState(false);\n  const { unreadCount } = useNotifications();\n\n  return (\n    <>\n      <div className=\"sticky top-0 z-30 bg-background/80 backdrop-blur-sm border-b-2 border-primary/20\">\n        <div className=\"bg-yellow-500/10 border-b border-yellow-500/30 px-3 py-1 text-center\">\n          <p className=\"text-xs md:text-sm font-mono text-yellow-400\">\n            <GlitchText>BETA VERSION</GlitchText> - IF YOU FIND ANY BUG THEN SEND TO WHATSAPP: 03122574283\n          </p>\n        </div>\n        <header className=\"flex h-14 md:h-16 shrink-0 items-center gap-2 md:gap-4 px-3 md:px-4 lg:px-8\" role=\"banner\">\n        <div className=\"flex items-center gap-2\">\n            <AetherLogo className=\"w-6 h-6 md:w-8 md:h-8 text-primary\" />\n             <h1 className=\"hidden lg:block text-lg xl:text-xl font-bold font-mono capitalize text-glow\">\n                {\"//\"} AETHERWEAVE\n            </h1>\n             <h1 className=\"hidden md:block lg:hidden text-sm font-bold font-mono capitalize text-glow\">\n                AETHER\n            </h1>\n        </div>\n\n        <div className=\"flex w-full items-center gap-2 md:gap-4 md:ml-auto lg:gap-4\">\n          <form className=\"ml-auto flex-1 sm:flex-initial\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-2.5 top-2.5 h-3 w-3 md:h-4 md:w-4 text-muted-foreground\" />\n              <Input\n                type=\"search\"\n                placeholder=\"SEARCH...\"\n                className=\"pl-7 md:pl-8 text-xs md:text-sm w-full sm:w-[200px] md:w-[180px] lg:w-[300px] bg-input font-mono h-8 md:h-10\"\n                aria-label=\"Search commands and features\"\n              />\n            </div>\n          </form>\n           <Button variant=\"ghost\" size=\"sm\" onClick={onNavToggle} className={cn(\"h-8 w-8 md:h-10 md:w-10\", isNavOpen && 'bg-accent')} data-onboarding-id=\"nav-orb-toggle\">\n            <Grid className=\"h-4 w-4 md:h-5 md:w-5 text-primary\" />\n            <span className=\"sr-only\">Toggle Navigation Hub</span>\n          </Button>\n\n          <Button variant=\"ghost\" size=\"sm\" className=\"relative h-8 w-8 md:h-10 md:w-10\" onClick={() => setIsNotificationsOpen(true)}>\n            <Bell className=\"h-4 w-4 md:h-5 md:w-5 text-primary\" />\n             {unreadCount > 0 && (\n              <span className=\"absolute -top-1 -right-1 flex h-4 w-4 md:h-5 md:w-5 items-center justify-center rounded-full bg-destructive text-xs font-bold text-destructive-foreground\">\n                {unreadCount > 99 ? '99+' : unreadCount}\n              </span>\n            )}\n            <span className=\"sr-only\">Toggle notifications</span>\n          </Button>\n          <UserNav />\n        </div>\n        </header>\n      </div>\n      <NotificationPanel isOpen={isNotificationsOpen} onOpenChange={setIsNotificationsOpen} />\n    </>\n  );\n}\n\n    ","path":null,"size_bytes":3566,"size_tokens":null},"src/components/ui/glitch-text.tsx":{"content":"'use client';\nimport { cn } from '@/lib/utils';\n\ninterface GlitchTextProps {\n  children: string;\n  className?: string;\n}\n\nexport default function GlitchText({ children, className }: GlitchTextProps) {\n  return (\n    <span className={cn(\"relative inline-block\", className)} data-text={children}>\n      <span className=\"glitch-text\">{children}</span>\n      <style jsx>{`\n        .glitch-text {\n          position: relative;\n          display: inline-block;\n          animation: glitch-skew 1s infinite linear alternate-reverse;\n        }\n        .glitch-text::before,\n        .glitch-text::after {\n          content: attr(data-text);\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n        }\n        .glitch-text::before {\n          left: 2px;\n          text-shadow: -2px 0 #ff00c1;\n          clip: rect(44px, 450px, 56px, 0);\n          animation: glitch-anim 5s infinite linear alternate-reverse;\n        }\n        .glitch-text::after {\n          left: -2px;\n          text-shadow: -2px 0 #00fff9, 2px 2px #ff00c1;\n          animation: glitch-anim2 1s infinite linear alternate-reverse;\n        }\n        @keyframes glitch-anim {\n          0% { clip: rect(31px, 9999px, 94px, 0); transform: skew(0.3deg); }\n          5% { clip: rect(70px, 9999px, 71px, 0); transform: skew(0.5deg); }\n          10% { clip: rect(60px, 9999px, 86px, 0); transform: skew(0.2deg); }\n          15% { clip: rect(89px, 9999px, 35px, 0); transform: skew(0.8deg); }\n          20% { clip: rect(15px, 9999px, 15px, 0); transform: skew(0.1deg); }\n          25% { clip: rect(54px, 9999px, 44px, 0); transform: skew(0.4deg); }\n          30% { clip: rect(26px, 9999px, 81px, 0); transform: skew(0.6deg); }\n          35% { clip: rect(99px, 9999px, 98px, 0); transform: skew(0.3deg); }\n          40% { clip: rect(65px, 9999px, 43px, 0); transform: skew(0.7deg); }\n          45% { clip: rect(11px, 9999px, 5px, 0); transform: skew(0.2deg); }\n          50% { clip: rect(76px, 9999px, 77px, 0); transform: skew(0.5deg); }\n          100% { clip: rect(31px, 9999px, 94px, 0); transform: skew(0.3deg); }\n        }\n        @keyframes glitch-anim2 {\n          0% { clip: rect(65px, 9999px, 119px, 0); transform: skew(0.5deg); }\n          5% { clip: rect(52px, 9999px, 74px, 0); transform: skew(0.3deg); }\n          10% { clip: rect(79px, 9999px, 85px, 0); transform: skew(0.7deg); }\n          15% { clip: rect(12px, 9999px, 94px, 0); transform: skew(0.2deg); }\n          20% { clip: rect(63px, 9999px, 29px, 0); transform: skew(0.6deg); }\n          25% { clip: rect(41px, 9999px, 82px, 0); transform: skew(0.4deg); }\n          30% { clip: rect(3px, 9999px, 8px, 0); transform: skew(0.8deg); }\n          35% { clip: rect(86px, 9999px, 73px, 0); transform: skew(0.1deg); }\n          40% { clip: rect(25px, 9999px, 50px, 0); transform: skew(0.5deg); }\n          45% { clip: rect(97px, 9999px, 16px, 0); transform: skew(0.3deg); }\n          50% { clip: rect(44px, 9999px, 61px, 0); transform: skew(0.7deg); }\n          100% { clip: rect(65px, 9999px, 119px, 0); transform: skew(0.5deg); }\n        }\n        @keyframes glitch-skew {\n          0% { transform: skew(0deg); }\n          10% { transform: skew(-1deg); }\n          20% { transform: skew(1deg); }\n          30% { transform: skew(-2deg); }\n          40% { transform: skew(2deg); }\n          50% { transform: skew(-1deg); }\n          60% { transform: skew(1deg); }\n          70% { transform: skew(0deg); }\n          80% { transform: skew(-1deg); }\n          90% { transform: skew(1deg); }\n          100% { transform: skew(0deg); }\n        }\n      `}</style>\n    </span>\n  );\n}\n","path":null,"size_bytes":3652,"size_tokens":null},"backend/api/index.ts":{"content":"import app from '../src/server';\n\nexport default app;\n","path":null,"size_bytes":54,"size_tokens":null},"src/hooks/use-call-sounds.ts":{"content":"'use client';\n\n// hooks/use-call-sounds.ts\nexport const useCallSounds = () => {\n  const playRingtone = () => {\n    // Create ringtone using Web Audio API\n    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    const oscillator = audioContext.createOscillator();\n    const gainNode = audioContext.createGain();\n    \n    oscillator.connect(gainNode);\n    gainNode.connect(audioContext.destination);\n    \n    oscillator.type = 'sine';\n    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);\n    oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.5);\n    \n    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);\n    \n    oscillator.start();\n    oscillator.stop(audioContext.currentTime + 1);\n    \n    // Loop every 2 seconds\n    return setInterval(() => {\n      const newOscillator = audioContext.createOscillator();\n      const newGainNode = audioContext.createGain();\n      \n      newOscillator.connect(newGainNode);\n      newGainNode.connect(audioContext.destination);\n      \n      newOscillator.type = 'sine';\n      newOscillator.frequency.setValueAtTime(800, audioContext.currentTime);\n      newOscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.5);\n      \n      newGainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n      newGainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);\n      \n      newOscillator.start();\n      newOscillator.stop(audioContext.currentTime + 1);\n    }, 2000);\n  };\n\n  const playCallEndedSound = () => {\n    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    const oscillator = audioContext.createOscillator();\n    const gainNode = audioContext.createGain();\n    \n    oscillator.connect(gainNode);\n    gainNode.connect(audioContext.destination);\n    \n    oscillator.type = 'sine';\n    oscillator.frequency.setValueAtTime(600, audioContext.currentTime);\n    oscillator.frequency.setValueAtTime(400, audioContext.currentTime + 0.2);\n    oscillator.frequency.setValueAtTime(300, audioContext.currentTime + 0.4);\n    \n    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);\n    \n    oscillator.start();\n    oscillator.stop(audioContext.currentTime + 0.6);\n  };\n\n  const stopRingtone = (intervalId: NodeJS.Timeout) => {\n    clearInterval(intervalId);\n  };\n\n  return {\n    playRingtone,\n    playCallEndedSound,\n    stopRingtone\n  };\n};\n","path":null,"size_bytes":2617,"size_tokens":null},"src/components/settings/interface-settings.tsx":{"content":"\n'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { useUser } from '@/hooks/use-user';\nimport { useCursor, CursorStyle } from '@/hooks/use-cursor';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Button } from '@/components/ui/button';\nimport { Check, Loader2 } from 'lucide-react';\nimport { useState } from 'react';\nimport { cn } from '@/lib/utils';\nimport AnimationSettings from './animation-settings';\n\nconst cursorStyles: { id: CursorStyle; name: string; description: string }[] = [\n  { id: 'default-op', name: 'Default OP', description: 'Standard pointer with a soft neon glow and trail.' },\n  { id: 'neon-glow', name: 'Neon Glow', description: 'Bright neon outline and a strong trailing streak.' },\n  { id: 'futuristic-trail', name: 'Futuristic Trail', description: 'A sleek comet-like trail follows the pointer.' },\n  { id: 'spark-halo', name: 'Spark & Halo', description: 'A halo around the pointer with sparks on click.' },\n  { id: 'editor', name: 'Editor Style', description: 'Context-aware cursor for text, drag, and resize.' },\n  { id: 'minimal-glow', name: 'Minimal Glow', description: 'A thin, performant outline that glows on hover.' },\n  { id: 'color-pulse', name: 'Color Pulse', description: 'Pulses between primary and secondary colors.' },\n];\n\nfunction CursorSettings() {\n  const { profile, updateProfileSettings } = useUser();\n  const { setCursorStyle, enableLowPerfMode } = useCursor();\n  \n  const [selectedStyle, setSelectedStyle] = useState<CursorStyle>(profile?.settings?.cursor?.style as CursorStyle || 'default-op');\n  const [isLowPerf, setIsLowPerf] = useState(profile?.settings?.cursor?.lowPerf || false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  const handleSave = async () => {\n    setIsSaving(true);\n    await updateProfileSettings({\n      ...profile?.settings,\n      cursor: {\n        style: selectedStyle,\n        lowPerf: isLowPerf,\n      }\n    });\n    // Apply changes immediately for visual feedback\n    setCursorStyle(selectedStyle);\n    enableLowPerfMode(isLowPerf);\n    setIsSaving(false);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n        {cursorStyles.map((style) => (\n          <Card\n            key={style.id}\n            onClick={() => setSelectedStyle(style.id)}\n            className={cn(\n              'cursor-pointer transition-all',\n              selectedStyle === style.id ? 'neon-border-primary' : 'hover:bg-muted/50'\n            )}\n          >\n            <CardContent className=\"p-4 text-center space-y-2\">\n              <div className=\"w-full aspect-square bg-muted rounded-md flex items-center justify-center\">\n                 <div className={cn(\"relative w-8 h-8\", `cursor-style-${style.id}`)}>\n                    <div className=\"cursor-dot !bg-white\" style={{'--cursor-glow-color': 'white', '--cursor-trail-color': 'rgba(255,255,255,0.5)'} as React.CSSProperties}></div>\n                    <div className=\"cursor-trail !opacity-50\" style={{'--cursor-trail-color': 'rgba(255,255,255,0.5)'} as React.CSSProperties}></div>\n                </div>\n              </div>\n              <p className=\"text-sm font-semibold\">{style.name}</p>\n              {selectedStyle === style.id && <Check className=\"w-4 h-4 mx-auto text-primary\" />}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n      <div className=\"flex items-center justify-between rounded-lg border p-4 bg-background/50\">\n        <div>\n          <Label htmlFor=\"low-perf-mode\">Low-Performance Mode</Label>\n          <p className=\"text-sm text-muted-foreground\">\n            Disables complex animations like trails and sparks for smoother operation.\n          </p>\n        </div>\n        <Switch\n          id=\"low-perf-mode\"\n          checked={isLowPerf}\n          onCheckedChange={setIsLowPerf}\n        />\n      </div>\n      <Button onClick={handleSave} disabled={isSaving}>\n        {isSaving ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <Check className=\"mr-2 h-4 w-4\" />}\n        Save Interface Settings\n      </Button>\n    </div>\n  );\n}\n\n\nexport default function InterfaceSettings() {\n  return (\n    <div className=\"space-y-8\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Cursor Customization</CardTitle>\n          <CardDescription>Select your preferred cursor style for navigating the Aetherweave network.</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <CursorSettings />\n        </CardContent>\n      </Card>\n      <Card>\n        <CardHeader>\n          <CardTitle>Animation Settings</CardTitle>\n          <CardDescription>Adjust the level of UI animations to match your performance needs.</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <AnimationSettings />\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n    ","path":null,"size_bytes":4951,"size_tokens":null},"src/app/tasks/page.tsx":{"content":"'use client';\n\nimport { useState } from 'react';\nimport KanbanBoard from \"@/components/tasks/kanban-board\";\nimport { Button } from \"@/components/ui/button\";\nimport { PlusCircle } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ntype Task = {\n  id: string;\n  content: string;\n  priority: 'Low' | 'Medium' | 'High';\n  status: 'todo' | 'in-progress' | 'done';\n};\n\nexport default function TasksPage() {\n  const [open, setOpen] = useState(false);\n  const [taskName, setTaskName] = useState('');\n  const [priority, setPriority] = useState<'Low' | 'Medium' | 'High'>('Medium');\n  const [tasks, setTasks] = useState<Task[]>([]);\n\n  const handleAddTask = () => {\n    const newTask: Task = {\n      id: Date.now().toString(),\n      content: taskName,\n      priority,\n      status: 'todo'\n    };\n    setTasks([...tasks, newTask]);\n    setOpen(false);\n    setTaskName('');\n    setPriority('Medium');\n  };\n\n  const handleUpdateTaskStatus = (taskId: string, newStatus: 'todo' | 'in-progress' | 'done') => {\n    setTasks(tasks.map(task => task.id === taskId ? { ...task, status: newStatus } : task));\n  };\n\n  return (\n    <div className=\"flex flex-col gap-6 h-full\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-3xl font-headline text-glow\">Taskboard</h1>\n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button>\n              <PlusCircle className=\"mr-2 h-4 w-4\" />\n              Add Task\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Add New Task</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"task-name\">Task Name</Label>\n                <Input\n                  id=\"task-name\"\n                  placeholder=\"Enter task name...\"\n                  value={taskName}\n                  onChange={(e) => setTaskName(e.target.value)}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"priority\">Priority</Label>\n                <Select value={priority} onValueChange={(value) => setPriority(value as 'Low' | 'Medium' | 'High')}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Low\">Low</SelectItem>\n                    <SelectItem value=\"Medium\">Medium</SelectItem>\n                    <SelectItem value=\"High\">High</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <Button onClick={handleAddTask} className=\"w-full\" disabled={!taskName.trim()}>\n                Add Task\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n      <KanbanBoard tasks={tasks} onUpdateTaskStatus={handleUpdateTaskStatus} />\n    </div>\n  );\n}\n","path":null,"size_bytes":3268,"size_tokens":null},"src/components/dashboard/weather-widget.tsx":{"content":"'use client';\nimport { useState, useEffect } from 'react';\nimport { Sun, Cloud, CloudRain, CloudDrizzle, CloudLightning, CloudSnow, Wind, Loader2, Moon, MapPin, AlertTriangle } from 'lucide-react';\nimport { fetchWeatherApi } from 'openmeteo';\n\ninterface WeatherData {\n  location: string;\n  temperature: string;\n  condition: string;\n  wind: string;\n  timeOfDay: 'day' | 'night';\n}\n\nconst getWeatherIcon = (code: number, isDay: boolean) => {\n    switch (code) {\n        case 0: // Clear sky\n            return isDay ? <Sun className=\"w-12 h-12 text-yellow-400\" /> : <Moon className=\"w-12 h-12 text-blue-300\" />;\n        case 1: // Mainly clear\n        case 2: // partly cloudy\n        case 3: // overcast\n            return <Cloud className=\"w-12 h-12 text-muted-foreground\" />;\n        case 45: // Fog\n        case 48: // depositing rime fog\n            return <Cloud className=\"w-12 h-12 text-gray-400\" />;\n        case 51: // Drizzle: Light\n        case 53: // Drizzle: moderate\n        case 55: // Drizzle: dense intensity\n            return <CloudDrizzle className=\"w-12 h-12 text-blue-400\" />;\n        case 61: // Rain: Slight\n        case 63: // Rain: moderate\n        case 65: // Rain: heavy intensity\n            return <CloudRain className=\"w-12 h-12 text-blue-500\" />;\n        case 71: // Snow fall: Slight\n        case 73: // Snow fall: moderate\n        case 75: // Snow fall: heavy intensity\n            return <CloudSnow className=\"w-12 h-12 text-white\" />;\n        case 95: // Thunderstorm: Slight or moderate\n        case 96: // Thunderstorm with slight hail\n        case 99: // Thunderstorm with heavy hail\n            return <CloudLightning className=\"w-12 h-12 text-yellow-500\" />;\n        default:\n            return <Sun className=\"w-12 h-12 text-yellow-400\" />;\n    }\n};\n\nconst getWeatherInfoText = (code: number) => {\n    switch (code) {\n        case 0: return \"Atmosphere clear. Optimal visibility.\";\n        case 1: case 2: case 3: return \"Cloud cover detected. Visibility may be reduced.\";\n        case 45: case 48: return \"Fog detected. Low visibility warning.\";\n        case 51: case 53: case 55: return \"Drizzle reported. Light precipitation.\";\n        case 61: case 63: case 65: return \"Precipitation warning. Acid rain possible.\";\n        case 71: case 73: case 75: return \"Freezing temperatures detected. Thermal gear recommended.\";\n        case 95: case 96: case 99: return \"Ionospheric disturbance. Electrical storm in progress.\";\n        default: return \"Weather data nominal.\";\n    }\n}\n\n\nexport default function WeatherWidget() {\n  const [weather, setWeather] = useState<WeatherData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const getPosition = (): Promise<GeolocationPosition> => {\n        return new Promise((resolve, reject) => {\n            navigator.geolocation.getCurrentPosition(resolve, reject);\n        });\n    }\n\n    const fetchWeatherData = async () => {\n        if (!navigator.geolocation) {\n            setError(\"Geolocation is not supported by your browser.\");\n            setLoading(false);\n            return;\n        }\n\n        try {\n            const position = await getPosition();\n            const { latitude, longitude } = position.coords;\n\n            const params = {\n                latitude,\n                longitude,\n                current: [\"temperature_2m\", \"is_day\", \"weather_code\", \"wind_speed_10m\"],\n                hourly: \"temperature_2m\",\n                timezone: \"auto\"\n            };\n            const url = \"https://api.open-meteo.com/v1/forecast\";\n            const responses = await fetchWeatherApi(url, params);\n            const response = responses[0];\n            \n            const current = response.current()!;\n\n            const temp = Math.round(current.variables(0)!.value());\n            const isDay = current.variables(1)!.value() === 1;\n            const weatherCode = current.variables(2)!.value();\n            const windSpeed = Math.round(current.variables(3)!.value());\n\n            setWeather({\n                location: 'Your Location',\n                temperature: `${temp}°C`,\n                condition: getWeatherInfoText(weatherCode),\n                wind: `${windSpeed} km/h`,\n                timeOfDay: isDay ? 'day' : 'night',\n            });\n            setError(null);\n\n        } catch (err: any) {\n            console.error(err);\n            if(err.code === 1) { // User denied Geolocation\n                 setError(\"Location access denied. Displaying default weather.\");\n                 setWeather({\n                    location: 'Night City',\n                    temperature: '24°C',\n                    condition: 'Clear',\n                    wind: '12 km/h',\n                    timeOfDay: 'night',\n                 });\n            } else {\n                 setError(\"Could not fetch weather data.\");\n            }\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    fetchWeatherData();\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n        <Loader2 className=\"w-8 h-8 animate-spin\" />\n        <p className=\"ml-2\">Acquiring weather data...</p>\n      </div>\n    );\n  }\n  \n  if (!weather) return (\n     <div className=\"flex flex-col items-center justify-center h-full text-destructive\">\n        <AlertTriangle className=\"w-8 h-8\" />\n        <p className=\"ml-2 mt-2 font-semibold\">{error || \"Failed to load weather.\"}</p>\n      </div>\n  );\n\n\n  const weatherCode = isNaN(parseInt(weather.condition.split(' ')[0], 10)) ? 0 : parseInt(weather.condition.split(' ')[0], 10);\n  const isDay = weather.timeOfDay === 'day';\n  const locationText = weather.location;\n\n  return (\n    <div className=\"flex flex-col justify-between h-full\" data-onboarding-id=\"weather-widget\">\n        <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n                {getWeatherIcon(weatherCode, isDay)}\n                <div>\n                <p className=\"text-3xl font-bold\">{weather.temperature}</p>\n                <p className=\"flex items-center gap-1 text-muted-foreground\">\n                    <MapPin className=\"w-4 h-4\"/>\n                    {locationText}\n                </p>\n                </div>\n            </div>\n            <div className=\"text-right\">\n                <p className=\"flex items-center justify-end gap-1 text-sm text-muted-foreground\">\n                <Wind className=\"w-4 h-4\" />\n                {weather.wind}\n                </p>\n            </div>\n        </div>\n        <div className=\"mt-4 text-center border-t-2 border-primary/20 pt-4\">\n             <p className=\"text-sm text-primary font-mono tracking-widest uppercase\">\n                {weather.timeOfDay} - {weather.condition}\n             </p>\n        </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6911,"size_tokens":null},"src/components/auth/anonymous-login.tsx":{"content":"'use client';\nimport { signInAnonymously } from 'firebase/auth';\nimport { useAuth } from '@/firebase/provider';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { useRouter } from 'next/navigation';\n\nexport function AnonymousLogin() {\n  const auth = useAuth();\n  const { toast } = useToast();\n  const router = useRouter();\n\n  const handleAnonymousLogin = async () => {\n    try {\n      await signInAnonymously(auth);\n      toast({\n        title: 'Anonymous Access Granted',\n        description: 'Entering as guest operator...',\n      });\n      router.push('/dashboard');\n    } catch (error) {\n      toast({\n        variant: 'destructive',\n        title: 'Access Denied',\n        description: 'Anonymous login failed.',\n      });\n    }\n  };\n\n  return (\n    <Button \n      onClick={handleAnonymousLogin}\n      variant=\"outline\" \n      className=\"w-full\"\n    >\n      Enter as Guest Operator\n    </Button>\n  );\n}","path":null,"size_bytes":960,"size_tokens":null},"src/components/providers/ThemeProvider.tsx":{"content":"\n'use client';\n\nimport React, { createContext, useContext, useEffect, useState, useCallback, useMemo } from 'react';\nimport { themes, Theme } from '@/lib/themes';\nimport { useUser } from '@/hooks/use-user';\nimport { useFirestore } from '@/firebase/provider';\nimport { doc, setDoc } from 'firebase/firestore';\nimport { usePathname } from 'next/navigation';\n\ninterface ThemeProviderContextType {\n  theme: string;\n  setTheme: (theme: string) => void;\n  themes: Theme[];\n}\n\nconst ThemeContext = createContext<ThemeProviderContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  const { profile } = useUser();\n  const firestore = useFirestore();\n  const pathname = usePathname();\n  const [activeTheme, setActiveTheme] = useState('cyber-default');\n  const [isMounted, setIsMounted] = useState(false);\n  \n  const isGamingRoute = pathname.startsWith('/gaming');\n\n  // Effect to set theme from user profile on load\n  useEffect(() => {\n    if (isGamingRoute) {\n        setActiveTheme(profile?.gaming?.theme || 'neon-gamer');\n    } else if (profile?.theme) {\n        setActiveTheme(profile.theme);\n    }\n    setIsMounted(true);\n  }, [profile, isGamingRoute]);\n\n  // Effect to apply the active theme to the document\n  useEffect(() => {\n    const root = document.documentElement;\n    const selectedTheme = themes.find(t => t.id === activeTheme);\n    console.log('Applying theme:', activeTheme, selectedTheme);\n    if (selectedTheme) {\n      document.body.className = `theme-${selectedTheme.id}`;\n      for (const [key, value] of Object.entries(selectedTheme.colors)) {\n        root.style.setProperty(`--${key}`, value);\n      }\n    }\n  }, [activeTheme]);\n\n  const handleSetTheme = useCallback(async (themeId: string) => {\n    console.log('Setting theme to:', themeId);\n    setActiveTheme(themeId);\n    if (profile && firestore) {\n      try {\n        const userDocRef = doc(firestore, 'users', profile.id);\n        const fieldToUpdate = isGamingRoute ? { 'gaming.theme': themeId } : { theme: themeId };\n        await setDoc(userDocRef, fieldToUpdate, { merge: true });\n        console.log('Theme saved to Firestore');\n      } catch (error) {\n        console.error(\"Failed to save theme preference:\", error);\n      }\n    }\n  }, [profile, firestore, isGamingRoute]);\n\n  const contextValue = useMemo(() => ({\n    theme: activeTheme,\n    setTheme: handleSetTheme,\n    themes,\n  }), [activeTheme, handleSetTheme]);\n\n  return (\n    <ThemeContext.Provider value={contextValue}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n};\n","path":null,"size_bytes":2773,"size_tokens":null},"src/components/ui/button.tsx":{"content":"'use client';\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { useCursor } from \"@/hooks/use-cursor\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, onMouseEnter, onMouseLeave, ...props }, ref) => {\n    const { setCursorMode } = useCursor();\n    const Comp = asChild ? Slot : \"button\"\n    \n    const handleMouseEnter = React.useCallback((e: React.MouseEvent<HTMLButtonElement>) => {\n        setCursorMode('link');\n        onMouseEnter?.(e);\n    }, [setCursorMode, onMouseEnter]);\n\n    const handleMouseLeave = React.useCallback((e: React.MouseEvent<HTMLButtonElement>) => {\n        setCursorMode('default');\n        onMouseLeave?.(e);\n    }, [setCursorMode, onMouseLeave]);\n\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2438,"size_tokens":null},"src/components/examples/context-menu-examples.tsx":{"content":"'use client';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n\nexport default function ContextMenuExamples() {\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Context Menu Examples</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          \n          {/* Text with context menu */}\n          <div>\n            <h3 className=\"font-semibold mb-2\">Text Selection</h3>\n            <p \n              className=\"p-2 border rounded\"\n              data-context-type=\"text\"\n            >\n              Right-click this text or select some text and right-click to see text options.\n            </p>\n          </div>\n\n          {/* Image with context menu */}\n          <div>\n            <h3 className=\"font-semibold mb-2\">Image</h3>\n            <img \n              src=\"https://via.placeholder.com/200x150\" \n              alt=\"Example\"\n              className=\"border rounded cursor-pointer\"\n              data-context-type=\"image\"\n              data-context-data={JSON.stringify({\n                download: () => console.log('Download image')\n              })}\n            />\n          </div>\n\n          {/* Link with context menu */}\n          <div>\n            <h3 className=\"font-semibold mb-2\">Link</h3>\n            <a \n              href=\"https://example.com\"\n              className=\"text-primary underline\"\n              data-context-type=\"link\"\n              data-context-data={JSON.stringify({\n                url: 'https://example.com'\n              })}\n            >\n              Right-click this link\n            </a>\n          </div>\n\n          {/* User avatar with context menu */}\n          <div>\n            <h3 className=\"font-semibold mb-2\">User Avatar</h3>\n            <Avatar \n              className=\"cursor-pointer\"\n              data-context-type=\"user\"\n              data-context-data={JSON.stringify({\n                viewProfile: () => console.log('View profile'),\n                sendMessage: () => console.log('Send message'),\n                addFriend: () => console.log('Add friend'),\n                blockUser: () => console.log('Block user'),\n                isFriend: false\n              })}\n            >\n              <AvatarImage src=\"https://via.placeholder.com/40\" />\n              <AvatarFallback>JD</AvatarFallback>\n            </Avatar>\n          </div>\n\n          {/* Message with context menu */}\n          <div>\n            <h3 className=\"font-semibold mb-2\">Message</h3>\n            <div \n              className=\"p-3 bg-muted rounded cursor-pointer\"\n              data-context-type=\"message\"\n              data-context-data={JSON.stringify({\n                text: 'This is a sample message',\n                reply: () => console.log('Reply to message'),\n                edit: () => console.log('Edit message'),\n                delete: () => console.log('Delete message'),\n                canEdit: true,\n                canDelete: true\n              })}\n            >\n              This is a sample message. Right-click for options.\n            </div>\n          </div>\n\n          {/* File with context menu */}\n          <div>\n            <h3 className=\"font-semibold mb-2\">File</h3>\n            <div \n              className=\"p-3 border rounded cursor-pointer flex items-center gap-2\"\n              data-context-type=\"file\"\n              data-context-data={JSON.stringify({\n                download: () => console.log('Download file'),\n                share: () => console.log('Share file'),\n                rename: () => console.log('Rename file'),\n                delete: () => console.log('Delete file'),\n                properties: () => console.log('File properties')\n              })}\n            >\n              📄 document.pdf\n            </div>\n          </div>\n\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","path":null,"size_bytes":3956,"size_tokens":null},"src/components/layout/tutorial-popup.tsx":{"content":"\n'use client';\nimport { motion } from 'framer-motion';\nimport * as Lucide from 'lucide-react';\nimport { useMemo } from 'react';\n\ninterface TutorialPopupProps {\n  x: number;\n  y: number;\n  content: {\n    title: string;\n    description: string;\n    icon: keyof typeof Lucide;\n  };\n}\n\nexport default function TutorialPopup({ x, y, content }: TutorialPopupProps) {\n  const Icon = useMemo(() => (Lucide[content.icon] as any) || Lucide.Info, [content.icon]) as React.ComponentType<{ className?: string }>;\n\n  return (\n    <motion.div\n      drag\n      dragMomentum={false}\n      initial={{ opacity: 0, scale: 0.8, x, y }}\n      animate={{ opacity: 1, scale: 1, transition: { type: 'spring', stiffness: 260, damping: 20 } }}\n      exit={{ opacity: 0, scale: 0.8, transition: { duration: 0.3 } }}\n      className=\"absolute p-4 w-[220px] h-[100px] glass-card neon-border-primary cursor-grab active:cursor-grabbing\"\n      style={{\n        boxShadow: '0 0 20px hsl(var(--primary) / 0.5)',\n      }}\n    >\n      <div className=\"flex items-start gap-3\">\n        <Icon className=\"w-5 h-5 text-primary flex-shrink-0 mt-0.5\" />\n        <div>\n          <h4 className=\"font-bold text-sm\">{content.title}</h4>\n          <p className=\"text-xs text-muted-foreground\">{content.description}</p>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n","path":null,"size_bytes":1323,"size_tokens":null},"src/components/settings/notification-settings.tsx":{"content":"\n'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\n\nexport default function NotificationSettings() {\n    // In a real app, this state would come from a context or hook\n    const notificationSettings = {\n        newMessages: true,\n        friendRequests: true,\n        systemAlerts: false,\n    };\n\n    return (\n        <Card>\n            <CardHeader>\n                <CardTitle>Notifications</CardTitle>\n                <CardDescription>Manage how you receive notifications across the platform.</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n                <div className=\"flex items-center justify-between p-4 rounded-lg border bg-background/30\">\n                    <Label htmlFor=\"new-messages\" className=\"flex flex-col gap-1 cursor-pointer\">\n                        <span>New Messages</span>\n                        <span className=\"font-normal text-muted-foreground text-sm\">Receive notifications for new chat messages.</span>\n                    </Label>\n                    <Switch id=\"new-messages\" checked={notificationSettings.newMessages} />\n                </div>\n                <div className=\"flex items-center justify-between p-4 rounded-lg border bg-background/30\">\n                    <Label htmlFor=\"friend-requests\" className=\"flex flex-col gap-1 cursor-pointer\">\n                        <span>Friend Requests</span>\n                        <span className=\"font-normal text-muted-foreground text-sm\">Get notified about new connection requests.</span>\n                    </Label>\n                    <Switch id=\"friend-requests\" checked={notificationSettings.friendRequests} />\n                </div>\n                <div className=\"flex items-center justify-between p-4 rounded-lg border bg-background/30\">\n                    <Label htmlFor=\"system-alerts\" className=\"flex flex-col gap-1 cursor-pointer\">\n                        <span>System Alerts & News</span>\n                        <span className=\"font-normal text-muted-foreground text-sm\">Receive important system-wide alerts and breaking news.</span>\n                    </Label>\n                    <Switch id=\"system-alerts\" checked={notificationSettings.systemAlerts} />\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n","path":null,"size_bytes":2435,"size_tokens":null},"src/lib/achievements.ts":{"content":"\nimport { MessageSquare, StickyNote, Award, Star, Shield, Users, FileUp, type LucideIcon } from 'lucide-react';\n\nexport type Rarity = \"Common\" | \"Rare\" | \"Epic\" | \"Legendary\" | \"Mythical\";\n\nexport interface Achievement {\n  id: string;\n  name: string;\n  description: string;\n  rarity: Rarity;\n  icon: LucideIcon;\n  level: number;\n}\n\n\nexport const achievements: Achievement[] = [\n    {\n        id: 'pioneer',\n        name: 'Pioneer',\n        description: 'Joined the Aetherweave platform during its initial phase. A true trailblazer.',\n        rarity: 'Epic',\n        icon: Star,\n        level: 1,\n    },\n    {\n        id: 'archivist-1',\n        name: 'Archivist I',\n        description: 'Created your first note in the NoteForge.',\n        rarity: 'Common',\n        icon: StickyNote,\n        level: 2,\n    },\n     {\n        id: 'archivist-2',\n        name: 'Archivist II',\n        description: 'Created 25 notes.',\n        rarity: 'Rare',\n        icon: StickyNote,\n        level: 10,\n    },\n    {\n        id: 'communicator-1',\n        name: 'Communicator I',\n        description: 'Sent your first message in Aether Chat.',\n        rarity: 'Common',\n        icon: MessageSquare,\n        level: 1,\n    },\n    {\n        id: 'communicator-2',\n        name: 'Communicator II',\n        description: 'Sent 100 messages.',\n        rarity: 'Rare',\n        icon: MessageSquare,\n        level: 5,\n    },\n    {\n        id: 'communicator-3',\n        name: 'Communicator III',\n        description: 'Sent 1000 messages.',\n        rarity: 'Epic',\n        icon: MessageSquare,\n        level: 15,\n    },\n    {\n        id: 'socialite-1',\n        name: 'Socialite I',\n        description: 'Made your first connection.',\n        rarity: 'Common',\n        icon: Users,\n        level: 4,\n    },\n    {\n        id: 'socialite-2',\n        name: 'Socialite II',\n        description: 'Made 5 connections.',\n        rarity: 'Rare',\n        icon: Users,\n        level: 15,\n    },\n    {\n        id: 'cloud-warrior-1',\n        name: 'Cloud Warrior',\n        description: 'Uploaded your first file to CloudDrive.',\n        rarity: 'Common',\n        icon: FileUp,\n        level: 5,\n    },\n    {\n        id: 'guardian',\n        name: 'Guardian',\n        description: 'Achieved a trust level of 75.',\n        rarity: 'Epic',\n        icon: Shield,\n        level: 25,\n    },\n    {\n        id: 'overlord',\n        name: 'Overlord',\n        description: 'Reached Level 50.',\n        rarity: 'Legendary',\n        icon: Award,\n        level: 50,\n    },\n];\n\n","path":null,"size_bytes":2514,"size_tokens":null},"src/app/gaming/components/GamingChatArea.tsx":{"content":"\n'use client';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport {\n  PlusCircle,\n  Gift,\n  FileArchive,\n  Smile,\n  Send,\n  Loader2,\n  Copy,\n  Trash2,\n  MessageSquareReply,\n} from 'lucide-react';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { useUser, UserProfile } from '@/hooks/use-user';\nimport { useState, useEffect, useRef, useMemo } from 'react';\nimport { cn } from '@/lib/utils';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useToast } from '@/hooks/use-toast';\nimport { useConnections, PublicUser } from '@/hooks/use-connections';\nimport UserPopover from '@/components/user/user-popover';\n\ninterface Message {\n    id: number;\n    userId: string;\n    content: string;\n    timestamp: string;\n    sender: {\n        username: string;\n        avatar?: string;\n    }\n}\n\nexport default function GamingChatArea() {\n    const { user, profile } = useUser();\n    const { users } = useConnections();\n    const [messages, setMessages] = useState<Message[]>([]);\n    const [input, setInput] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n    const scrollAreaRef = useRef<HTMLDivElement>(null);\n    const { openHub } = useCommandHub();\n    const { toast } = useToast();\n\n    const messageUsers = useMemo(() => {\n        const userMap = new Map<string, PublicUser>();\n        users.forEach(u => userMap.set(u.id, u));\n        if (profile && user) {\n            userMap.set(user.uid, profile as PublicUser);\n        }\n        return userMap;\n    }, [users, profile, user]);\n\n    const scrollToBottom = () => {\n        if (scrollAreaRef.current) {\n            const viewport = scrollAreaRef.current.querySelector('[data-radix-scroll-area-viewport]');\n            if (viewport) {\n                viewport.scrollTo({ top: viewport.scrollHeight, behavior: 'smooth' });\n            }\n        }\n    };\n\n    useEffect(() => {\n        scrollToBottom();\n    }, [messages]);\n\n    const handleDeleteMessage = (messageId: number) => {\n        setMessages(prev => prev.filter(m => m.id !== messageId));\n        toast({ title: \"Message Deleted\" });\n    }\n\n    const handleMessageContextMenu = (e: React.MouseEvent, message: Message) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        openHub(e, {\n            type: 'gaming-chat-message',\n            data: message,\n            actions: [\n                { label: 'Reply', icon: 'MessageSquareReply', onClick: () => {} },\n                { label: 'Copy Text', icon: 'Copy', onClick: () => {\n                    navigator.clipboard.writeText(message.content);\n                    toast({ title: \"Copied!\" });\n                }},\n                { label: 'Add Reaction', icon: 'Smile', onClick: () => {} },\n                ...(message.userId === user?.uid ? [{\n                    label: 'Delete Message',\n                    icon: 'Trash2' as const,\n                    onClick: () => handleDeleteMessage(message.id),\n                }] : []),\n            ]\n        })\n    }\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!input.trim() || !user) return;\n        \n        setIsLoading(true);\n\n        const newMessage: Message = {\n            id: Date.now(),\n            userId: user.uid,\n            content: input,\n            timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),\n            sender: {\n                username: profile?.gaming?.username || profile?.displayName || 'Operator',\n                avatar: profile?.photoURL,\n            }\n        };\n\n        // Simulate network delay\n        setTimeout(() => {\n            setMessages(prev => [...prev, newMessage]);\n            setInput('');\n            setIsLoading(false);\n        }, 500);\n    };\n\n    return (\n        <div className=\"flex flex-1 flex-col bg-muted/50 border rounded-lg\">\n            <ScrollArea className=\"flex-1 custom-scroll\" ref={scrollAreaRef}>\n                 <div className=\"p-6 space-y-6\">\n                    <AnimatePresence>\n                        {messages.map(msg => {\n                             const isOwnMessage = msg.userId === user?.uid;\n                             const senderProfile = messageUsers.get(msg.userId);\n\n                            return (\n                            <motion.div \n                                key={msg.id} \n                                className={cn(\"group flex items-start gap-4\", isOwnMessage && \"justify-end\")}\n                                initial={{ opacity: 0, y: 10 }}\n                                animate={{ opacity: 1, y: 0 }}\n                                exit={{ opacity: 0, y: -10 }}\n                                layout\n                                onContextMenu={(e) => handleMessageContextMenu(e, msg)}\n                                data-command-hub-trigger\n                            >\n                                {!isOwnMessage && senderProfile && (\n                                    <UserPopover user={senderProfile}>\n                                        <Avatar className=\"h-10 w-10 cursor-pointer\">\n                                            <AvatarImage src={msg.sender.avatar} />\n                                            <AvatarFallback>{msg.sender.username?.charAt(0)}</AvatarFallback>\n                                        </Avatar>\n                                    </UserPopover>\n                                )}\n                                <div className={cn(\"flex flex-col\", isOwnMessage && \"items-end\")}>\n                                    <div className=\"flex items-baseline gap-2\">\n                                        {!isOwnMessage && senderProfile ? (\n                                            <UserPopover user={senderProfile}>\n                                                <p className=\"font-bold text-primary cursor-pointer hover:underline\">{msg.sender.username}</p>\n                                            </UserPopover>\n                                        ) : !isOwnMessage && <p className=\"font-bold text-primary\">{msg.sender.username}</p>}\n                                        <p className=\"text-xs text-muted-foreground\">{msg.timestamp}</p>\n                                    </div>\n                                    <div className={cn(\n                                        \"p-3 rounded-lg max-w-md\",\n                                        isOwnMessage ? \"bg-primary text-primary-foreground\" : \"bg-background\"\n                                    )}>\n                                        <p>{msg.content}</p>\n                                    </div>\n                                </div>\n                                 {isOwnMessage && senderProfile && (\n                                     <UserPopover user={senderProfile}>\n                                        <Avatar className=\"h-10 w-10 cursor-pointer\">\n                                            <AvatarImage src={msg.sender.avatar} />\n                                            <AvatarFallback>{msg.sender.username?.charAt(0)}</AvatarFallback>\n                                        </Avatar>\n                                     </UserPopover>\n                                )}\n                            </motion.div>\n                        )})}\n                    </AnimatePresence>\n                 </div>\n            </ScrollArea>\n            <div className=\"p-4 border-t\">\n                 <form className=\"relative\" onSubmit={handleSubmit}>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"absolute left-3 top-1/2 -translate-y-1/2 h-8 w-8 text-muted-foreground hover:text-foreground\">\n                        <PlusCircle />\n                    </Button>\n                    <Input\n                        placeholder=\"Message #general\"\n                        className=\"bg-input pl-12 pr-24 text-base\"\n                        value={input}\n                        onChange={(e) => setInput(e.target.value)}\n                        disabled={isLoading}\n                    />\n                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1\">\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-foreground\"><Smile /></Button>\n                         <Button size=\"icon\" type=\"submit\" className=\"ml-2 w-8 h-8\" disabled={isLoading || !input.trim()}>\n                            {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Send className=\"w-4 h-4\" />}\n                        </Button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":8817,"size_tokens":null},"src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1198,"size_tokens":null},"src/app/earnings/page.tsx":{"content":"\n'use client';\nimport { useState, useMemo, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Award, CalendarCheck, Check, DollarSign, Gift, Hexagon, TrendingUp, Zap, ShieldCheck, UploadCloud, Palette, Lock, RefreshCw, Loader2, Target, Star, Clock, Users, MessageSquare, FileText, Phone } from \"lucide-react\";\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { achievements, Achievement } from '@/lib/achievements';\nimport { useUser } from '@/hooks/use-user';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { dailyQuests, weeklyQuests, seasonalQuests, Quest } from '@/lib/quests';\nimport CountdownTimer from '@/components/dashboard/countdown-timer';\nimport { useFirestore } from '@/firebase/provider';\nimport { doc, updateDoc, increment } from 'firebase/firestore';\n\nconst levelRewards = [\n    { level: 1, reward: \"Base Access\", icon: ShieldCheck },\n    { level: 5, reward: \"File Uploads (10MB)\", icon: UploadCloud },\n    { level: 10, reward: \"New Theme 'Sunset'\", icon: Palette },\n    { level: 15, reward: \"Epic 'Vanguard' Badge\", icon: Award },\n    { level: 20, reward: \"File Uploads (50MB)\", icon: UploadCloud },\n];\n\nexport default function EarningsPage() {\n    const { toast } = useToast();\n    const { user, profile, loading, setProfile, claimQuestReward, checkAndResetQuests, addXp } = useUser();\n    const firestore = useFirestore();\n    const [claimingRewards, setClaimingRewards] = useState<{[key: string]: boolean}>({});\n    const [refreshing, setRefreshing] = useState(false);\n    const [selectedAchievement, setSelectedAchievement] = useState<Achievement | null>(null);\n    const [claimingBonus, setClaimingBonus] = useState(false);\n\n    const [nextResets, setNextResets] = useState<{daily: Date, weekly: Date, seasonal: Date}>({\n        daily: new Date(),\n        weekly: new Date(),\n        seasonal: new Date(),\n    });\n\n    useEffect(() => {\n        if (profile) {\n            checkAndResetQuests();\n        }\n    }, [profile, checkAndResetQuests]);\n    \n    useEffect(() => {\n        const now = new Date();\n        const dailyReset = new Date(now);\n        dailyReset.setUTCHours(24, 0, 0, 0);\n\n        const weeklyReset = new Date(now);\n        const dayOfWeek = weeklyReset.getUTCDay(); // 0 = Sunday\n        const daysUntilMonday = (8 - dayOfWeek) % 7;\n        weeklyReset.setUTCDate(weeklyReset.getUTCDate() + daysUntilMonday);\n        weeklyReset.setUTCHours(0, 0, 0, 0);\n\n        const seasonalReset = new Date(now.getUTCFullYear(), now.getUTCMonth() + 1, 1);\n        \n        setNextResets({ daily: dailyReset, weekly: weeklyReset, seasonal: seasonalReset });\n\n    }, [profile?.questResets]);\n\n    const xpForNextLevel = profile ? profile.level * 1000 + 1000 : 1000;\n    const xpPercentage = profile ? (profile.xp / xpForNextLevel) * 100 : 0;\n    \n    const isAchievementUnlocked = (achievementId: string) => {\n        return profile?.badgesUnlocked.includes(achievementId) ?? false;\n    };\n    \n    const canUnlockBadge = (badgeLevel: number) => {\n        return (profile?.level ?? 0) >= badgeLevel;\n    }\n\n    const getQuestProgress = (quest: Quest, profile: any) => {\n        if (!profile) return { completed: false, claimed: false, progress: '...' };\n    \n        const claimed = profile.questsCompleted?.includes(quest.id) ?? false;\n        \n        let isCompleted = false;\n        let progressText = '';\n        \n        switch (quest.id) {\n            case 'daily-login-1':\n                isCompleted = true; \n                progressText = '1 / 1';\n                break;\n            case 'daily-msg-1':\n                isCompleted = (profile.messagesSent ?? 0) >= 10;\n                progressText = `${Math.min(profile.messagesSent ?? 0, 10)} / 10`;\n                break;\n             case 'daily-note-1':\n                isCompleted = (profile.notesCreated ?? 0) >= 1;\n                progressText = `${Math.min(profile.notesCreated ?? 0, 1)} / 1`;\n                break;\n            case 'weekly-friends-1':\n                isCompleted = (profile.friends ?? 0) >= 3;\n                progressText = `${Math.min(profile.friends ?? 0, 3)} / 3`;\n                break;\n            case 'seasonal-lvl-1':\n                isCompleted = profile.level >= 10;\n                progressText = `${Math.min(profile.level, 10)} / 10`;\n                break;\n            // Default for quests that are simple \"do it once\" or not tracked via simple stats\n            case 'daily-react-1':\n            case 'weekly-msg-1':\n            case 'weekly-files-1':\n            case 'weekly-call-1':\n            case 'seasonal-tasks-1':\n            case 'seasonal-badges-1':\n                isCompleted = claimed; // For now, if we can't track progress, completion is just if it's been claimed.\n                progressText = claimed ? 'Complete' : '0 / 1';\n                break;\n            default:\n                isCompleted = claimed;\n                progressText = claimed ? 'Complete' : '...';\n        }\n    \n        return { completed: isCompleted, claimed, progress: progressText };\n    };\n\n    const hasClaimableRewards = (quests: Quest[], profile: any): boolean => {\n        if (!profile) return false;\n        return quests.some(quest => {\n            const { completed, claimed } = getQuestProgress(quest, profile);\n            return completed && !claimed;\n        });\n    };\n\n    const handleClaimReward = async (quest: Quest) => {\n        if (profile?.questsCompleted?.includes(quest.id)) {\n            toast({\n              title: \"Already Claimed\",\n              description: \"You have already claimed the reward for this quest.\",\n            });\n            return;\n        }\n        \n        setClaimingRewards(prev => ({ ...prev, [quest.id]: true }));\n        \n        try {\n            await claimQuestReward(quest);\n            toast({\n                title: 'Reward Claimed!',\n                description: `You earned ${quest.xp} XP${quest.badgeReward ? ' and a new badge!' : '.'}`\n            });\n        } catch (error) {\n            toast({\n                variant: 'destructive',\n                title: 'Claim Failed',\n                description: 'Something went wrong. Please try again.'\n            });\n        } finally {\n            setClaimingRewards(prev => ({ ...prev, [quest.id]: false }));\n        }\n    };\n\n    const handleClaimAllRewards = async (quests: Quest[]) => {\n        if (!profile) return;\n        \n        const claimableQuests = quests.filter(quest => {\n            const { completed, claimed } = getQuestProgress(quest, profile);\n            return completed && !claimed;\n        });\n        \n        if (claimableQuests.length === 0) {\n            toast({ title: 'No Rewards', description: 'No claimable rewards available.' });\n            return;\n        }\n        \n        setClaimingRewards(prev => {\n            const newState = { ...prev };\n            claimableQuests.forEach(quest => newState[quest.id] = true);\n            return newState;\n        });\n        \n        try {\n            for (const quest of claimableQuests) {\n                await claimQuestReward(quest);\n            }\n            \n            const totalXP = claimableQuests.reduce((sum, quest) => sum + quest.xp, 0);\n            toast({\n                title: 'All Rewards Claimed!',\n                description: `You earned ${totalXP} XP from ${claimableQuests.length} quests!`\n            });\n        } catch (error) {\n            toast({\n                variant: 'destructive',\n                title: 'Claim Failed',\n                description: 'Some rewards could not be claimed. Please try again.'\n            });\n        } finally {\n            setClaimingRewards({});\n        }\n    };\n\n    const handleRefreshQuests = async () => {\n        setRefreshing(true);\n        try {\n            await checkAndResetQuests();\n            toast({ title: 'Quests Refreshed', description: 'Quest progress has been updated.' });\n        } catch (error) {\n            toast({ variant: 'destructive', title: 'Refresh Failed', description: 'Could not refresh quests.' });\n        } finally {\n            setRefreshing(false);\n        }\n    };\n\n    const canClaimDailyBonus = () => {\n        if (!profile?.lastBonusClaim) return true;\n        const lastClaim = profile.lastBonusClaim.toDate();\n        const today = new Date();\n        return lastClaim.toDateString() !== today.toDateString();\n    };\n\n    const handleDailyBonus = async () => {\n        if (!user || !firestore || !canClaimDailyBonus()) {\n            toast({ title: 'Already Claimed', description: 'Daily bonus already claimed today.' });\n            return;\n        }\n        \n        setClaimingBonus(true);\n        const bonusXP = 100;\n        \n        try {\n            const userRef = doc(firestore, 'users', user.uid);\n            await updateDoc(userRef, {\n                xp: increment(bonusXP),\n                lastBonusClaim: new Date()\n            });\n            \n            toast({\n                title: 'Daily Bonus Claimed!',\n                description: `You earned ${bonusXP} bonus XP!`\n            });\n        } catch (error) {\n            toast({ variant: 'destructive', title: 'Bonus Failed', description: 'Could not claim daily bonus.' });\n        } finally {\n            setClaimingBonus(false);\n        }\n    };\n\n    const sortedAchievements = useMemo(() => {\n        return [...achievements].sort((a, b) => a.level - b.level);\n    }, []);\n\n    const renderQuestList = (quests: Quest[], type: 'daily' | 'weekly' | 'seasonal') => {\n        return (\n            <div className=\"space-y-3\">\n                <div className='text-right'>\n                    <CountdownTimer expiryTimestamp={nextResets[type]} />\n                </div>\n                <div className=\"flex justify-between items-center mb-4\">\n                    <h3 className=\"text-lg font-semibold capitalize\">{type} Quests</h3>\n                    <div className=\"flex gap-2\">\n                        <Button \n                            variant=\"outline\" \n                            size=\"sm\" \n                            onClick={handleRefreshQuests}\n                            disabled={refreshing}\n                        >\n                            {refreshing ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <RefreshCw className=\"w-4 h-4\" />}\n                        </Button>\n                        <Button \n                            size=\"sm\" \n                            onClick={() => handleClaimAllRewards(quests)}\n                            disabled={!hasClaimableRewards(quests, profile) || Object.values(claimingRewards).some(Boolean)}\n                        >\n                            {Object.values(claimingRewards).some(Boolean) ? (\n                                <><Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> Claiming...</>\n                            ) : (\n                                'Claim All'\n                            )}\n                        </Button>\n                    </div>\n                </div>\n                {quests.map((quest) => {\n                    if (!profile) return null;\n                    const { completed, claimed, progress } = getQuestProgress(quest, profile);\n                    const canClaim = completed && !claimed;\n                    const isClaiming = claimingRewards[quest.id];\n                    \n                    const getQuestIcon = () => {\n                        if (quest.id.includes('msg')) return MessageSquare;\n                        if (quest.id.includes('note')) return FileText;\n                        if (quest.id.includes('friends')) return Users;\n                        if (quest.id.includes('call')) return Phone;\n                        if (quest.id.includes('login')) return CalendarCheck;\n                        return Target;\n                    };\n                    \n                    const QuestIcon = getQuestIcon();\n                    \n                    return (\n                         <div key={quest.id} className={cn(\n                             \"flex items-center justify-between p-4 rounded-lg transition-all border\", \n                             completed ? \"bg-green-500/10 border-green-500/50\" : \"bg-muted/50 border-border\",\n                             canClaim && \"ring-2 ring-primary/50\"\n                         )}>\n                            <div className=\"flex items-center gap-3\">\n                                <div className={cn(\n                                    \"p-2 rounded-full\",\n                                    completed ? \"bg-green-500/20\" : \"bg-muted\"\n                                )}>\n                                    <QuestIcon className={cn(\n                                        \"w-5 h-5\",\n                                        completed ? \"text-green-500\" : \"text-muted-foreground\"\n                                    )} />\n                                </div>\n                                <div>\n                                    <p className=\"font-semibold\">{quest.text}</p>\n                                    <p className=\"text-sm text-muted-foreground\">{quest.description}</p>\n                                    {!completed && (\n                                        <div className=\"flex items-center gap-2 mt-1\">\n                                            <Progress value={(parseInt(progress.split('/')[0]) / parseInt(progress.split('/')[1])) * 100} className=\"w-20 h-2\" />\n                                            <span className=\"text-xs text-muted-foreground font-mono\">{progress}</span>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                            <div className=\"flex items-center gap-3 flex-shrink-0\">\n                                <Badge variant=\"secondary\" className=\"text-sm font-bold\">\n                                    <Star className=\"w-3 h-3 mr-1\" />\n                                    {quest.xp} XP\n                                </Badge>\n                                {completed && claimed && (\n                                    <Badge variant=\"outline\" className=\"text-green-600\">\n                                        <Check className=\"w-3 h-3 mr-1\" />\n                                        Claimed\n                                    </Badge>\n                                )}\n                                {canClaim && (\n                                    <Button \n                                        size=\"sm\" \n                                        onClick={() => handleClaimReward(quest)}\n                                        disabled={isClaiming}\n                                        className=\"cyber-button\"\n                                    >\n                                        {isClaiming ? (\n                                            <><Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> Claiming...</>\n                                        ) : (\n                                            <>Claim <Gift className=\"w-4 h-4 ml-1\" /></>\n                                        )}\n                                    </Button>\n                                )}\n                            </div>\n                        </div>\n                    )\n                })}\n            </div>\n        );\n    };\n\n\n    if (loading) {\n        return (\n            <div className=\"space-y-8\">\n                <header className=\"flex items-center justify-between\">\n                     <h1 className=\"text-3xl font-headline text-glow\">Rewards & Earnings</h1>\n                </header>\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                    <div className=\"lg:col-span-2 space-y-6\">\n                        <Skeleton className=\"h-40\" />\n                        <Skeleton className=\"h-64\" />\n                    </div>\n                    <div className=\"space-y-6\">\n                         <Skeleton className=\"h-40\" />\n                         <Skeleton className=\"h-40\" />\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"space-y-8\">\n            <header className=\"flex items-center justify-between gap-4\">\n                 <h1 className=\"text-3xl font-headline text-glow\">Rewards Hub</h1>\n                 <div className=\"flex items-center gap-2\">\n                    <Button \n                        variant=\"outline\" \n                        onClick={handleDailyBonus}\n                        disabled={!canClaimDailyBonus() || claimingBonus}\n                    >\n                        {claimingBonus ? (\n                            <><Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> Claiming...</>\n                        ) : !canClaimDailyBonus() ? (\n                            <><Check className=\"mr-2 h-4 w-4\" /> Claimed Today</>\n                        ) : (\n                            <><Gift className=\"mr-2 h-4 w-4\" /> Daily Bonus</>\n                        )}\n                    </Button>\n                    <Button variant=\"outline\" onClick={() => {}}>\n                        <TrendingUp className=\"mr-2 h-4 w-4\" />\n                        Analytics\n                    </Button>\n                 </div>\n            </header>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                <div className=\"lg:col-span-3 space-y-6\">\n                    <Card>\n                         <CardHeader>\n                            <CardTitle className=\"flex items-center gap-2\"><Zap className=\"text-primary\"/> Level & XP</CardTitle>\n                             <CardDescription>Complete tasks and engage with the community to level up and unlock rewards.</CardDescription>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                            <div className=\"flex justify-between items-end\">\n                                <div>\n                                    <p className=\"text-3xl font-bold text-primary\">Level {profile?.level ?? 1}</p>\n                                    <p className=\"text-sm text-muted-foreground\">Total XP Earned: {((profile?.level ?? 1) - 1) * 1000 + (profile?.xp ?? 0)}</p>\n                                </div>\n                                <div className=\"text-right\">\n                                    <p className=\"text-lg font-bold\">{profile?.xp ?? 0} / {xpForNextLevel} XP</p>\n                                    <p className=\"text-xs text-muted-foreground\">{xpForNextLevel - (profile?.xp ?? 0)} XP to next level</p>\n                                </div>\n                            </div>\n                            <TooltipProvider>\n                                <Tooltip>\n                                    <TooltipTrigger className=\"w-full\">\n                                        <Progress value={xpPercentage} className=\"h-4\" />\n                                    </TooltipTrigger>\n                                    <TooltipContent>\n                                        <p>{xpPercentage.toFixed(0)}% to next level</p>\n                                    </TooltipContent>\n                                </Tooltip>\n                            </TooltipProvider>\n                        </CardContent>\n                    </Card>\n\n                    <Card>\n                         <Tabs defaultValue=\"daily\">\n                            <CardHeader>\n                                <TabsList className=\"grid w-full grid-cols-3\">\n                                    <TabsTrigger value=\"daily\" className=\"relative\">\n                                        Daily\n                                        {hasClaimableRewards(dailyQuests, profile) && <span className=\"absolute top-1 right-1 w-2 h-2 rounded-full bg-primary neon-glow-primary\"></span>}\n                                    </TabsTrigger>\n                                    <TabsTrigger value=\"weekly\" className=\"relative\">\n                                        Weekly\n                                        {hasClaimableRewards(weeklyQuests, profile) && <span className=\"absolute top-1 right-1 w-2 h-2 rounded-full bg-primary neon-glow-primary\"></span>}\n                                    </TabsTrigger>\n                                    <TabsTrigger value=\"seasonal\" className=\"relative\">\n                                        Seasonal\n                                        {hasClaimableRewards(seasonalQuests, profile) && <span className=\"absolute top-1 right-1 w-2 h-2 rounded-full bg-primary neon-glow-primary\"></span>}\n                                    </TabsTrigger>\n                                </TabsList>\n                            </CardHeader>\n                            <CardContent>\n                                <TabsContent value=\"daily\">\n                                    {renderQuestList(dailyQuests, 'daily')}\n                                </TabsContent>\n                                <TabsContent value=\"weekly\">\n                                    {renderQuestList(weeklyQuests, 'weekly')}\n                                </TabsContent>\n                                <TabsContent value=\"seasonal\">\n                                    {renderQuestList(seasonalQuests, 'seasonal')}\n                                </TabsContent>\n                            </CardContent>\n                        </Tabs>\n                    </Card>\n                    \n                </div>\n            </div>\n            \n             <Card>\n                <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\"><Award className=\"text-primary\"/> Achievements & Badges</CardTitle>\n                    <CardDescription>Unlock badges by completing achievements across the platform.</CardDescription>\n                </CardHeader>\n                    <CardContent className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n                    {sortedAchievements.map(ach => {\n                        const unlocked = isAchievementUnlocked(ach.id);\n                        const canBeUnlocked = canUnlockBadge(ach.level);\n                        return (\n                            <TooltipProvider key={ach.id}>\n                                <Tooltip>\n                                    <TooltipTrigger>\n                                        <div className={cn(\n                                            \"aspect-square flex flex-col items-center justify-center text-center p-4 rounded-lg border-2 transition-all\",\n                                            unlocked ? \"bg-secondary/20 border-secondary neon-border-secondary cursor-pointer\" : \n                                            canBeUnlocked ? \"bg-muted/50 border-border\" :\n                                            \"bg-muted/20 border-border/50 filter grayscale opacity-60\"\n                                        )}>\n                                            <div className=\"relative\">\n                                                <Hexagon className={cn(\"w-16 h-16\", unlocked ? \"text-secondary\" : \"text-muted-foreground\")} fill=\"currentColor\" fillOpacity={0.1}/>\n                                                <ach.icon className={cn(\"w-8 h-8 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2\", unlocked ? \"text-secondary-foreground\" : \"text-muted-foreground\")}/>\n                                                {!unlocked && !canBeUnlocked && <Lock className=\"w-5 h-5 absolute bottom-1 right-1 text-muted-foreground\" />}\n                                            </div>\n                                            <p className={cn(\"mt-2 font-semibold\", unlocked ? \"text-secondary-foreground\" : \"text-muted-foreground\")}>{ach.name}</p>\n                                        </div>\n                                    </TooltipTrigger>\n                                    <TooltipContent side=\"bottom\" className=\"max-w-xs\">\n                                        <p className=\"font-bold text-base\">{ach.name}</p>\n                                        <p>{ach.description}</p>\n                                        {unlocked ? (\n                                            <p className=\"text-green-400 font-bold mt-1\">Unlocked!</p>\n                                        ) : canBeUnlocked ? (\n                                            <p className=\"text-yellow-400 font-bold mt-1\">Locked (Requirement not met)</p>\n                                        ) : (\n                                            <p className=\"text-red-400 font-bold mt-1\">Locked (Requires Level {ach.level})</p>\n                                        )}\n                                    </TooltipContent>\n                                </Tooltip>\n                            </TooltipProvider>\n                        )\n                    })}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":25351,"size_tokens":null},"src/middleware.ts":{"content":"\nimport { NextResponse, type NextRequest } from 'next/server';\n\nconst protectedRoutes = ['/apps', '/chat', '/notes', '/tasks', '/files', '/ai-hub', '/contacts', '/earnings', '/profile', '/inventory', '/store', '/assistant' ];\nconst publicRoutes = ['/login', '/signup', '/forgot-password'];\n\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  // Let static files and API routes pass through\n  if (pathname.startsWith('/_next/') || pathname.startsWith('/api/') || pathname.includes('.')) {\n    return NextResponse.next();\n  }\n  \n  // This is a simplified check. In a real-world scenario with server-side rendering,\n  // you would verify a session cookie here. Since this app uses client-side auth state,\n  // the middleware's main job is just to distinguish between public and protected URL patterns\n  // and let the client-side logic in AppLayout handle the final redirection after Firebase auth initializes.\n\n  // If trying to access a protected route without being \"logged in\" (from the server's perspective),\n  // redirect to login. The client-side will then take over.\n  if (protectedRoutes.some(path => pathname.startsWith(path))) {\n    // Let the client-side checks in AppLayout handle the final auth state\n    return NextResponse.next();\n  }\n  \n  // Allow access to public routes\n  if (publicRoutes.some(path => pathname.startsWith(path))) {\n    return NextResponse.next();\n  }\n\n  // For the root path, let the client-side logic in `page.tsx` handle the redirect.\n  if (pathname === '/') {\n    return NextResponse.next();\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\n    // Match all request paths except for the ones starting with:\n    // - _next/static (static files)\n    // - _next/image (image optimization files)\n    // - favicon.ico (favicon file)\n    '/((?!api|_next/static|_next/image|favicon.ico).*)',\n  ],\n};\n","path":null,"size_bytes":1904,"size_tokens":null},"src/ai/genkit.ts":{"content":"\nimport { genkit } from 'genkit';\nimport { googleAI } from '@genkit-ai/google-genai';\n\nexport const ai = genkit({\n  plugins: [\n    googleAI({\n      apiKey: process.env.GOOGLE_AI_API_KEY, \n    }),\n  ],\n});\n","path":null,"size_bytes":205,"size_tokens":null},"SETUP.md":{"content":"# 🚀 AetherDash Setup Guide\n\n## Quick Setup (5 minutes)\n\n### 1. Install Dependencies\n```bash\n# Windows\nstart-dev.bat\n\n# Mac/Linux\nchmod +x start-dev.sh\n./start-dev.sh\n```\n\n### 2. Configure Environment Variables\n\n**Frontend (.env):**\n```env\nNEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyDQXx_TQylXDvIKHf-ud_7T8RbRdTC91ng\nNEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=studio-4634736248-c0b42.firebaseapp.com\nNEXT_PUBLIC_FIREBASE_PROJECT_ID=studio-4634736248-c0b42\nNEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=studio-4634736248-c0b42.appspot.com\nNEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=185134863770\nNEXT_PUBLIC_FIREBASE_APP_ID=1:185134863770:web:4af101ef873aed44105623\nNEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-S33W1P5G5D\nNEXT_PUBLIC_API_URL=http://localhost:5000/api\n```\n\n**Backend (backend/.env):**\n```env\nFIREBASE_PROJECT_ID=studio-4634736248-c0b42\nPORT=5000\nNODE_ENV=development\nCORS_ORIGIN=http://localhost:3000\n```\n\n### 3. Firebase Service Account Setup ✅\n\n**Already configured!** Your Firebase service account credentials have been automatically set up in `backend/.env`.\n\nIf you need to update them later:\n1. Go to [Firebase Console](https://console.firebase.google.com/)\n2. Select your project: `studio-4634736248-c0b42`\n3. Go to Project Settings > Service Accounts\n4. Generate a new private key if needed\n\n### 4. Start Development\n\n```bash\nnpm run dev\n```\n\n**Servers will start on:**\n- Frontend: http://localhost:3000\n- Backend: http://localhost:5000\n\n## 🔧 Manual Setup\n\n### Install Dependencies Separately\n```bash\n# Frontend\nnpm install\n\n# Backend\ncd backend\nnpm install\ncd ..\n```\n\n### Start Servers Individually\n```bash\n# Terminal 1 - Frontend\nnpm run dev:frontend\n\n# Terminal 2 - Backend  \nnpm run dev:backend\n```\n\n## 🧪 Test the Setup\n\n1. **Frontend Test:** Visit http://localhost:3000\n2. **Backend Test:** Visit http://localhost:5000/api/health\n3. **Database Test:** Try logging in/signing up\n\n## 🚨 Troubleshooting\n\n### Common Issues\n\n**Port Already in Use:**\n```bash\n# Kill processes on ports\nnpx kill-port 3000 5000\n```\n\n**Firebase Connection Issues:**\n- Check your `.env` files\n- Verify Firebase project ID\n- Ensure service account has proper permissions\n\n**Module Not Found:**\n```bash\n# Clear cache and reinstall\nrm -rf node_modules package-lock.json\nrm -rf backend/node_modules backend/package-lock.json\nnpm run install:all\n```\n\n### Environment Check\n```bash\n# Check Node.js version (should be 18+)\nnode --version\n\n# Check npm version\nnpm --version\n\n# Verify Firebase CLI (optional)\nfirebase --version\n```\n\n## 📱 Next Steps\n\n1. **Customize Themes:** Edit `src/lib/themes.ts`\n2. **Add Features:** Check `DEV_README.md` for architecture\n3. **Deploy:** Follow deployment guides in main README\n4. **Configure AI:** Add Google AI API key for AI features\n\n## 🆘 Need Help?\n\n- Check the main [README.md](./README.md)\n- Review [DEV_README.md](./DEV_README.md) for detailed docs\n- Open an issue on GitHub","path":null,"size_bytes":2892,"size_tokens":null},"src/lib/tutorial-content.ts":{"content":"\nimport * as Lucide from 'lucide-react';\n\nexport type TutorialContent = {\n  [pageId: string]: {\n    title: string;\n    description: string;\n    icon: keyof typeof Lucide;\n  }[];\n};\n\nexport const tutorialContent: TutorialContent = {\n  'auth-check': [\n    {\n      title: 'Verifying Credentials',\n      description: 'Checking your operator ID against the Aetherweave mainframe.',\n      icon: 'ShieldCheck',\n    },\n  ],\n  dashboard: [\n    {\n      title: 'Navigation Hub',\n      description: 'Click the central orb or the grid icon to access all system modules.',\n      icon: 'Orbit',\n    },\n    {\n      title: 'Weather Module',\n      description: 'Real-time atmospheric data from your physical location.',\n      icon: 'CloudSun',\n    },\n    {\n      title: 'Session Tracker',\n      description: 'Monitors your active connection time to the Aetherweave network.',\n      icon: 'Timer',\n    },\n  ],\n  chat: [\n    {\n      title: 'Contact List',\n      description: 'All your connections are listed here. Click one to start a conversation.',\n      icon: 'Users',\n    },\n    {\n      title: 'Aether Assistant',\n      description: 'Your personal AI. Ask it anything, from coding help to world history.',\n      icon: 'Bot',\n    },\n    {\n      title: 'Call Functions',\n      description: 'Initiate secure, end-to-end encrypted voice or video calls.',\n      icon: 'Phone',\n    },\n  ],\n  news: [\n    {\n      title: 'Category Tabs',\n      description: 'Filter the global news feed by category.',\n      icon: 'Filter',\n    },\n    {\n      title: 'Infinite Scroll',\n      description: 'Scroll down to seamlessly load more articles.',\n      icon: 'ArrowDown',\n    },\n  ],\n};\n","path":null,"size_bytes":1652,"size_tokens":null},"src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item.dataKey || item.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10479,"size_tokens":null},"src/components/ui/radio-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1481,"size_tokens":null},"public/sounds/generate-sounds.js":{"content":"// Simple sound generation for tutorial popups\n// Run this in browser console to generate audio files\n\nfunction generateTutorialSounds() {\n  const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n  \n  // Tutorial popup sound - cyberpunk beep\n  function createPopupSound() {\n    const duration = 0.3;\n    const sampleRate = audioContext.sampleRate;\n    const buffer = audioContext.createBuffer(1, duration * sampleRate, sampleRate);\n    const data = buffer.getChannelData(0);\n    \n    for (let i = 0; i < buffer.length; i++) {\n      const t = i / sampleRate;\n      // Cyberpunk-style beep with frequency sweep\n      const freq1 = 800 + Math.sin(t * 20) * 200;\n      const freq2 = 1200;\n      const envelope = Math.exp(-t * 8);\n      data[i] = (Math.sin(t * freq1 * Math.PI * 2) * 0.3 + Math.sin(t * freq2 * Math.PI * 2) * 0.2) * envelope;\n    }\n    \n    return buffer;\n  }\n  \n  // Tutorial next sound - soft click\n  function createNextSound() {\n    const duration = 0.15;\n    const sampleRate = audioContext.sampleRate;\n    const buffer = audioContext.createBuffer(1, duration * sampleRate, sampleRate);\n    const data = buffer.getChannelData(0);\n    \n    for (let i = 0; i < buffer.length; i++) {\n      const t = i / sampleRate;\n      const freq = 600;\n      const envelope = Math.exp(-t * 15);\n      data[i] = Math.sin(t * freq * Math.PI * 2) * envelope * 0.2;\n    }\n    \n    return buffer;\n  }\n  \n  console.log('Tutorial sounds generated! Use Web Audio API to play them.');\n  console.log('Popup sound duration: 0.3s, Next sound duration: 0.15s');\n}\n\n// Call this function in browser console\ngenerateTutorialSounds();","path":null,"size_bytes":1642,"size_tokens":null},"src/hooks/use-app-stats.ts":{"content":"\n'use client';\nimport { useState, useEffect, useCallback, useMemo } from 'react';\nimport {\n  collection,\n  query,\n  onSnapshot,\n  doc,\n  setDoc,\n  increment,\n  runTransaction\n} from 'firebase/firestore';\nimport { useFirestore } from '@/firebase/provider';\nimport { useAuth } from '@/firebase/provider';\n\nexport interface AppStat {\n  appId: string;\n  viewCount: number;\n}\n\nexport function useAppStats() {\n  const firestore = useFirestore();\n  const auth = useAuth();\n  const [appStats, setAppStats] = useState<AppStat[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!firestore) {\n      setAppStats([]);\n      setLoading(false);\n      return;\n    }\n    setLoading(true);\n    const appStatsCollectionRef = collection(firestore, 'app-stats');\n    const unsubscribe = onSnapshot(appStatsCollectionRef, (snapshot) => {\n      const statsData = snapshot.docs.map(doc => ({\n        appId: doc.id,\n        ...doc.data()\n      } as AppStat));\n      setAppStats(statsData);\n      setLoading(false);\n    }, (error) => {\n      console.error(\"Error fetching app stats:\", error);\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, [firestore]);\n  \n  const incrementViewCount = useCallback(async (appId: string) => {\n    if (!firestore || !auth.currentUser) {\n        console.error(\"Firestore or user not available for incrementing view count.\");\n        return;\n    }\n    \n    const statRef = doc(firestore, 'app-stats', appId);\n\n    try {\n        await runTransaction(firestore, async (transaction) => {\n            const statDoc = await transaction.get(statRef);\n            if (!statDoc.exists()) {\n                transaction.set(statRef, { appId: appId, viewCount: 1 });\n            } else {\n                const newViewCount = (statDoc.data().viewCount || 0) + 1;\n                transaction.update(statRef, { viewCount: newViewCount });\n            }\n        });\n    } catch (error) {\n        console.error(\"Transaction failed: \", error);\n    }\n}, [firestore, auth]);\n\n\n  return { appStats, loading, incrementViewCount };\n}\n","path":null,"size_bytes":2072,"size_tokens":null},"src/hooks/use-storage.ts":{"content":"\n'use client';\n\nimport { useState, useEffect, useMemo, useCallback } from 'react';\nimport {\n  getStorage,\n  ref,\n  uploadBytesResumable,\n  uploadBytes,\n  listAll,\n  getDownloadURL as getFbDownloadURL,\n  deleteObject,\n  getMetadata,\n  uploadString,\n  type StorageReference,\n  UploadTask,\n} from 'firebase/storage';\nimport { useFirebaseApp } from '@/firebase/provider';\nimport { useUser } from '@/hooks/use-user';\nimport { useToast } from './use-toast';\nimport { useNotifications } from './use-notifications';\n\nexport interface StoredFile {\n  name: string;\n  fullPath: string;\n  isFolder: boolean;\n  size: string;\n  type: string;\n  createdAt: string;\n}\n\nfunction formatBytes(bytes: number, decimals = 2) {\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\n\nexport function useStorage() {\n  const app = useFirebaseApp();\n  const { user } = useUser();\n  const { toast } = useToast();\n  const { addNotification } = useNotifications();\n  const storage = useMemo(() => getStorage(app), [app]);\n  \n  const [files, setFiles] = useState<StoredFile[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchFiles = useCallback(async (currentRef: StorageReference) => {\n    setLoading(true);\n    try {\n        const result = await listAll(currentRef);\n        \n        const folders = result.prefixes.map((folderRef) => ({\n            name: folderRef.name,\n            fullPath: folderRef.fullPath,\n            isFolder: true,\n            size: '',\n            type: 'folder',\n            createdAt: '', // Folder metadata is not directly available\n        }));\n\n        const filesData = await Promise.all(\n            result.items.map(async (itemRef) => {\n                const metadata = await getMetadata(itemRef);\n                return {\n                    name: metadata.name,\n                    fullPath: metadata.fullPath,\n                    isFolder: false,\n                    size: formatBytes(metadata.size),\n                    type: metadata.contentType || 'unknown',\n                    createdAt: metadata.timeCreated,\n                };\n            })\n        );\n        \n        setFiles([...folders, ...filesData]);\n    } catch (error: any) {\n        console.error(\"Error listing files:\", error);\n        toast({\n            variant: 'destructive',\n            title: 'Error fetching files',\n            description: error.message,\n        });\n    } finally {\n        setLoading(false);\n    }\n  }, [toast]);\n\n\n  const uploadFile = async (file: File, fullPath: string): Promise<string> => {\n    if (!user) throw new Error('User not authenticated.');\n    \n    const fileRef = ref(storage, fullPath);\n    const uploadResult = await uploadBytes(fileRef, file);\n    await addNotification({\n      type: 'file_upload',\n      title: 'File Uploaded',\n      description: `Successfully uploaded ${file.name}.`,\n      link: '/files'\n    });\n    // Return the download URL after upload\n    return await getFbDownloadURL(uploadResult.ref);\n  };\n  \n  const uploadChatMedia = (file: File, path: string): UploadTask => {\n    if (!user) throw new Error('User not authenticated.');\n    const mediaRef = ref(storage, path);\n    return uploadBytesResumable(mediaRef, file);\n  };\n  \n  const createFolder = async (folderName: string, currentPath: string) => {\n      const path = currentPath ? `${currentPath}/${folderName}` : folderName;\n      const folderRef = ref(storage, `${user?.uid}/${path}/.placeholder`);\n      await uploadString(folderRef, '');\n      // This function no longer re-fetches, the component should do it.\n  }\n\n  const deleteFile = async (fullPath: string) => {\n    const fileRef = ref(storage, fullPath);\n    await deleteObject(fileRef);\n    // This function no longer re-fetches, the component should do it.\n  };\n\n\n  const downloadFileUrl = async (fullPath: string, fileName: string) => {\n      try {\n        const url = await getFbDownloadURL(ref(storage, fullPath));\n\n        const a = document.createElement('a');\n        a.href = url;\n        a.target = '_blank';\n        a.download = fileName; \n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n\n      } catch (error: any) {\n          console.error(\"Error getting download URL: \", error);\n           toast({\n                variant: 'destructive',\n                title: 'Download Failed',\n                description: \"Could not get file URL. Check storage rules and CORS configuration.\"\n            });\n      }\n  };\n\n\n  return { files, loading, uploadFile, deleteFile, downloadFileUrl, createFolder, fetchFiles, uploadChatMedia };\n}\n","path":null,"size_bytes":4790,"size_tokens":null},"src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"src/firebase/error-emitter.ts":{"content":"'use client';\n\nimport { EventEmitter } from 'events';\nimport { FirestorePermissionError } from './errors';\n\ntype Events = {\n  'permission-error': (error: FirestorePermissionError) => void;\n};\n\nclass TypedEventEmitter extends EventEmitter {\n  on(event: string, listener: (...args: any[]) => void): this {\n    return super.on(event, listener);\n  }\n  emit(event: string, ...args: any[]): boolean {\n    return super.emit(event, ...args);\n  }\n}\n\nexport const errorEmitter = new TypedEventEmitter();\n","path":null,"size_bytes":494,"size_tokens":null},"src/components/settings/cursor-settings.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { useCursor, CursorStyle } from '@/hooks/use-cursor';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Check, Loader2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\n\nconst cursorStyles: { id: CursorStyle; name: string; description: string }[] = [\n  { id: 'default-op', name: 'Default OP', description: 'Standard pointer with a soft neon glow and trail.' },\n  { id: 'neon-glow', name: 'Neon Glow', description: 'Bright neon outline and a strong trailing streak.' },\n  { id: 'futuristic-trail', name: 'Futuristic Trail', description: 'A sleek comet-like trail follows the pointer.' },\n  { id: 'spark-halo', name: 'Spark & Halo', description: 'A halo around the pointer with sparks on click.' },\n  { id: 'editor', name: 'Editor Style', description: 'Context-aware cursor for text, drag, and resize.' },\n  { id: 'minimal-glow', name: 'Minimal Glow', description: 'A thin, performant outline that glows on hover.' },\n  { id: 'color-pulse', name: 'Color Pulse', description: 'Pulses between primary and secondary colors.' },\n];\n\nexport default function CursorSettings() {\n  const { style: currentStyle, lowPerformanceMode, setCursorStyle, enableLowPerfMode } = useCursor();\n  const [selectedStyle, setSelectedStyle] = useState<CursorStyle>(currentStyle);\n  const [isLowPerf, setIsLowPerf] = useState(lowPerformanceMode);\n  const [isSaving, setIsSaving] = useState(false);\n  const { toast } = useToast();\n\n  const handleSave = async () => {\n    setIsSaving(true);\n    try {\n      await Promise.all([\n        setCursorStyle(selectedStyle),\n        enableLowPerfMode(isLowPerf)\n      ]);\n      toast({\n        title: 'Settings Saved',\n        description: 'Your interface settings have been updated.',\n      });\n    } catch (error) {\n      toast({\n        variant: 'destructive',\n        title: 'Save Failed',\n        description: 'Could not save your cursor settings.',\n      });\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n        {cursorStyles.map((style) => (\n          <Card\n            key={style.id}\n            onClick={() => setSelectedStyle(style.id)}\n            className={cn(\n              'cursor-pointer transition-all',\n              selectedStyle === style.id ? 'neon-border-primary' : 'hover:bg-muted/50'\n            )}\n          >\n            <CardContent className=\"p-4 text-center space-y-2\">\n              <div className=\"w-full aspect-square bg-muted rounded-md flex items-center justify-center\">\n                 <div className={cn(\"relative w-8 h-8\", `cursor-style-${style.id}`)}>\n                    <div className=\"cursor-dot !bg-white\" style={{'--cursor-glow-color': 'white', '--cursor-trail-color': 'rgba(255,255,255,0.5)'} as React.CSSProperties}></div>\n                    <div className=\"cursor-trail !opacity-50\" style={{'--cursor-trail-color': 'rgba(255,255,255,0.5)'} as React.CSSProperties}></div>\n                </div>\n              </div>\n              <p className=\"text-sm font-semibold\">{style.name}</p>\n              {selectedStyle === style.id && <Check className=\"w-4 h-4 mx-auto text-primary\" />}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n      <div className=\"flex items-center justify-between rounded-lg border p-4 bg-background/50\">\n        <div>\n          <Label htmlFor=\"low-perf-mode\">Low-Performance Mode</Label>\n          <p className=\"text-sm text-muted-foreground\">\n            Disables complex animations like trails and sparks for smoother operation.\n          </p>\n        </div>\n        <Switch\n          id=\"low-perf-mode\"\n          checked={isLowPerf}\n          onCheckedChange={setIsLowPerf}\n        />\n      </div>\n      <Button onClick={handleSave} disabled={isSaving}>\n        {isSaving ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <Check className=\"mr-2 h-4 w-4\" />}\n        Save Interface Settings\n      </Button>\n    </div>\n  );\n}\n","path":null,"size_bytes":4232,"size_tokens":null},"src/components/ui/switch.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1153,"size_tokens":null},"src/components/tab-enhancer/TabController.tsx":{"content":"'use client';\n\nimport { useTabEnhancer } from '@/hooks/use-tab-enhancer';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { \n  Bell, \n  Palette, \n  Zap, \n  AlertTriangle, \n  CheckCircle, \n  XCircle,\n  MousePointer,\n  Type,\n  Sparkles\n} from 'lucide-react';\n\nexport default function TabController() {\n  const {\n    showNotification,\n    clearNotifications,\n    setActivity,\n    startColorCycle,\n    simulateHover,\n    setCustomTitle,\n    notificationCount,\n  } = useTabEnhancer();\n\n  return (\n    <Card className=\"w-full max-w-2xl mx-auto glass-card\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2 text-glow\">\n          <Sparkles className=\"w-5 h-5 text-primary\" />\n          Tab Enhancement Control Panel\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        \n        {/* Notifications */}\n        <div className=\"space-y-3\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <Bell className=\"w-4 h-4\" />\n            Notifications\n            {notificationCount > 0 && (\n              <Badge variant=\"destructive\">{notificationCount}</Badge>\n            )}\n          </h3>\n          <div className=\"flex gap-2 flex-wrap\">\n            <Button onClick={() => showNotification(1)} size=\"sm\" variant=\"outline\">\n              Add Notification\n            </Button>\n            <Button onClick={() => showNotification(5)} size=\"sm\" variant=\"outline\">\n              Add 5 Notifications\n            </Button>\n            <Button onClick={clearNotifications} size=\"sm\" variant=\"destructive\">\n              Clear All\n            </Button>\n          </div>\n        </div>\n\n        {/* Activity States */}\n        <div className=\"space-y-3\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <Zap className=\"w-4 h-4\" />\n            Activity States\n          </h3>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n            <Button \n              onClick={() => setActivity('loading')} \n              size=\"sm\" \n              variant=\"outline\"\n              className=\"flex items-center gap-1\"\n            >\n              <Zap className=\"w-3 h-3\" />\n              Loading\n            </Button>\n            <Button \n              onClick={() => setActivity('success')} \n              size=\"sm\" \n              variant=\"outline\"\n              className=\"flex items-center gap-1\"\n            >\n              <CheckCircle className=\"w-3 h-3\" />\n              Success\n            </Button>\n            <Button \n              onClick={() => setActivity('error')} \n              size=\"sm\" \n              variant=\"outline\"\n              className=\"flex items-center gap-1\"\n            >\n              <XCircle className=\"w-3 h-3\" />\n              Error\n            </Button>\n            <Button \n              onClick={() => setActivity('warning')} \n              size=\"sm\" \n              variant=\"outline\"\n              className=\"flex items-center gap-1\"\n            >\n              <AlertTriangle className=\"w-3 h-3\" />\n              Warning\n            </Button>\n          </div>\n        </div>\n\n        {/* Visual Effects */}\n        <div className=\"space-y-3\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <Palette className=\"w-4 h-4\" />\n            Visual Effects\n          </h3>\n          <div className=\"flex gap-2 flex-wrap\">\n            <Button onClick={startColorCycle} size=\"sm\" variant=\"outline\">\n              Color Cycle\n            </Button>\n            <Button onClick={simulateHover} size=\"sm\" variant=\"outline\">\n              <MousePointer className=\"w-3 h-3 mr-1\" />\n              Hover Effect\n            </Button>\n          </div>\n        </div>\n\n        {/* Title Effects */}\n        <div className=\"space-y-3\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <Type className=\"w-4 h-4\" />\n            Title Effects\n          </h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\n            <Button \n              onClick={() => setCustomTitle('◆ TYPING EFFECT ◆', 'typing')} \n              size=\"sm\" \n              variant=\"outline\"\n            >\n              Typewriter\n            </Button>\n            <Button \n              onClick={() => setCustomTitle('◆ GLITCH MODE ◆', 'glitch')} \n              size=\"sm\" \n              variant=\"outline\"\n            >\n              Glitch\n            </Button>\n            <Button \n              onClick={() => setCustomTitle('◆ PULSE ACTIVE ◆', 'pulse')} \n              size=\"sm\" \n              variant=\"outline\"\n            >\n              Pulse\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"text-sm text-muted-foreground bg-muted/20 p-3 rounded-lg\">\n          <p className=\"font-semibold mb-1\">🚀 Features Active:</p>\n          <ul className=\"list-disc list-inside space-y-1 text-xs\">\n            <li>Dynamic favicon generation with Canvas API</li>\n            <li>Real-time title animations and effects</li>\n            <li>Tab visibility detection and reactions</li>\n            <li>Notification badges and blinking alerts</li>\n            <li>Color cycling and breathing animations</li>\n            <li>Activity state indicators</li>\n          </ul>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":5487,"size_tokens":null},"src/components/ui/slider.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1091,"size_tokens":null},"src/app/contacts/page.tsx":{"content":"\n'use client';\nimport React, { useState, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Users, Search, UserPlus, UserCheck, Clock, UserX, Loader2 } from \"lucide-react\";\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { useConnections, Connection, PublicUser } from '@/hooks/use-connections';\nimport { useUser } from '@/hooks/use-user';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport UserQuickView from '@/components/user/user-quick-view';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useRouter } from 'next/navigation';\nimport { appEventEmitter } from '@/lib/event-emitter';\n\n\nexport default function ContactsPage() {\n  const { user } = useUser();\n  const {\n    connections,\n    users,\n    loading,\n    findUserByUsername,\n    sendFriendRequest,\n    acceptFriendRequest,\n    removeConnection,\n    blockUser\n  } = useConnections();\n  const { toast } = useToast();\n  const { openHub } = useCommandHub();\n  const router = useRouter();\n\n  const [usernameSearch, setUsernameSearch] = useState('');\n  const [isSearching, setIsSearching] = useState(false);\n  const [foundUser, setFoundUser] = useState<PublicUser | null>(null);\n\n  const handleSearch = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!usernameSearch.trim()) return;\n\n    setIsSearching(true);\n    setFoundUser(null);\n\n    const targetUser = await findUserByUsername(usernameSearch);\n\n    if (targetUser) {\n      setFoundUser(targetUser);\n    } else {\n      toast({\n        variant: 'destructive',\n        title: 'User not found',\n        description: `No operator with the username \"${usernameSearch}\" exists.`,\n      });\n    }\n    setIsSearching(false);\n  };\n\n  const getConnectionStatus = (targetUser: PublicUser): { status: Connection['status'] | 'not_connected' | 'self'; connectionId?: string } => {\n    if (targetUser.id === user?.uid) return { status: 'self' };\n    const connection = connections.find(c => c.id === targetUser.id);\n    if (connection) return { status: connection.status, connectionId: connection.id };\n    return { status: 'not_connected' };\n  };\n  \n  const handleFoundUserClick = (e: React.MouseEvent, targetUser: PublicUser) => {\n    e.preventDefault();\n    e.stopPropagation();\n    openHub(e, {\n        type: 'user-contact',\n        data: targetUser,\n        actions: [\n            { label: 'View Profile', icon: 'User', onClick: () => appEventEmitter.emit('ui:show-user-profile', targetUser.id) },\n            { label: 'Add Friend', icon: 'UserPlus', onClick: () => {\n                sendFriendRequest(targetUser.id);\n                toast({ title: 'Friend Request Sent', description: `Your request has been sent to ${targetUser.username}`});\n            }, disabled: getConnectionStatus(targetUser).status !== 'not_connected' },\n            { label: 'Block User', icon: 'UserX', onClick: () => {\n                blockUser(targetUser.id);\n                toast({ variant: 'destructive', title: 'User Blocked', description: `You have blocked ${targetUser.username}.` });\n            }, isDestructive: true },\n        ]\n    });\n  }\n\n  const renderActionButton = (targetUser: PublicUser) => {\n    const { status } = getConnectionStatus(targetUser);\n\n    switch (status) {\n      case 'friends':\n        return <Badge variant=\"secondary\">Friends</Badge>;\n      case 'pending':\n        return <Button variant=\"secondary\" size=\"sm\" disabled>Pending</Button>;\n      case 'blocked':\n        return <Badge variant=\"destructive\">Blocked</Badge>;\n      case 'not_connected':\n        return <Button size=\"sm\" onClick={async () => {\n            await sendFriendRequest(targetUser.id);\n            toast({ title: 'Friend Request Sent', description: `Your request has been sent to ${targetUser.username}`});\n        }}><UserPlus className=\"mr-2 h-4 w-4\" />Add Friend</Button>;\n      case 'self':\n        return <Badge>You</Badge>;\n      default:\n        return null;\n    }\n  };\n  \n  const pendingRequests = connections.filter(c => c.status === 'pending' && c.requestedBy !== user?.uid);\n  const friends = connections.filter(c => c.status === 'friends');\n  const blocked = connections.filter(c => c.status === 'blocked');\n\n  const renderConnectionList = (list: (Connection & {user: PublicUser | undefined})[], emptyMessage: string) => {\n    if (loading) {\n      return Array.from({length: 3}).map((_, i) => (\n        <div key={i} className=\"flex items-center space-x-4 p-2\">\n            <Skeleton className=\"h-12 w-12 rounded-full\" />\n            <div className=\"space-y-2\">\n                <Skeleton className=\"h-4 w-[150px]\" />\n                <Skeleton className=\"h-4 w-[100px]\" />\n            </div>\n        </div>\n      ))\n    }\n    \n    if (list.length === 0) {\n      return <p className=\"text-muted-foreground text-center p-8\">{emptyMessage}</p>;\n    }\n    \n    return list.map(({ id, user: connectedUser, status, requestedBy }) => {\n      if (!connectedUser) return null;\n      return (\n        <div key={id} className=\"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50\" data-command-hub-trigger>\n          <div className=\"flex items-center gap-4\">\n            <UserQuickView user={connectedUser}>\n              <Avatar \n                className=\"h-12 w-12 cursor-pointer\"\n                onContextMenu={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  openHub(e, {\n                    type: 'user',\n                    data: {\n                      viewProfile: () => router.push(`/profile/${connectedUser.id}`),\n                      sendMessage: () => router.push(`/chat?contactId=${connectedUser.id}`),\n                      voiceCall: () => console.log('Voice call', connectedUser.displayName),\n                      videoCall: () => console.log('Video call', connectedUser.displayName),\n                      addFriend: () => console.log('Add friend', connectedUser.displayName),\n                      createGroup: () => console.log('Create group with', connectedUser.displayName),\n                      muteUser: () => console.log('Mute', connectedUser.displayName),\n                      pinChat: () => console.log('Pin chat', connectedUser.displayName),\n                      blockUser: () => blockUser(connectedUser.id),\n                      reportUser: () => console.log('Report', connectedUser.displayName),\n                      isFriend: status === 'friends'\n                    }\n                  });\n                }}\n              >\n                <AvatarImage src={connectedUser.photoURL || undefined} />\n                <AvatarFallback>{connectedUser.displayName?.[0] || connectedUser.email?.[0]}</AvatarFallback>\n              </Avatar>\n            </UserQuickView>\n            <div>\n              <p className=\"font-semibold\">{connectedUser.displayName || 'Unknown User'}</p>\n              <p className=\"text-sm text-muted-foreground\">@{connectedUser.username}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {status === 'pending' && requestedBy !== user?.uid && (\n              <>\n                 <Button size=\"sm\" variant=\"outline\" onClick={() => acceptFriendRequest(id)}>Accept</Button>\n                 <Button size=\"sm\" variant=\"destructive\" onClick={() => removeConnection(id)}>Decline</Button>\n              </>\n            )}\n            {status === 'friends' && (\n               <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild><Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8\" onClick={() => removeConnection(id)}><UserX className=\"h-4 w-4\"/></Button></TooltipTrigger>\n                    <TooltipContent><p>Unfriend</p></TooltipContent>\n                  </Tooltip>\n                   <Tooltip>\n                    <TooltipTrigger asChild><Button variant=\"destructive\" size=\"icon\" className=\"h-8 w-8\" onClick={() => blockUser(id)}><UserX className=\"h-4 w-4\"/></Button></TooltipTrigger>\n                    <TooltipContent><p>Block</p></TooltipContent>\n                  </Tooltip>\n               </TooltipProvider>\n            )}\n             {status === 'blocked' && (\n                <Button size=\"sm\" variant=\"ghost\" onClick={() => removeConnection(id)}>Unblock</Button>\n            )}\n          </div>\n        </div>\n      );\n    });\n  };\n  \n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-10rem)]\">\n      <Card className=\"lg:col-span-2 flex flex-col\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\"><Users /> Connections</CardTitle>\n        </CardHeader>\n        <CardContent className=\"flex-1 flex flex-col\">\n          <Tabs defaultValue=\"friends\" className=\"flex-1 flex flex-col\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n              <TabsTrigger value=\"friends\">Friends ({friends.length})</TabsTrigger>\n              <TabsTrigger value=\"pending\">Pending ({pendingRequests.length})</TabsTrigger>\n              <TabsTrigger value=\"blocked\">Blocked ({blocked.length})</TabsTrigger>\n            </TabsList>\n            <TabsContent value=\"friends\" className=\"flex-1 overflow-y-auto\">\n              {renderConnectionList(friends.map(c => ({...c, user: users.find(u => u.id === c.id)})), \"You haven't added any friends yet.\")}\n            </TabsContent>\n            <TabsContent value=\"pending\" className=\"flex-1 overflow-y-auto\">\n              {renderConnectionList(pendingRequests.map(c => ({...c, user: users.find(u => u.id === c.id)})), \"No pending friend requests.\")}\n            </TabsContent>\n            <TabsContent value=\"blocked\" className=\"flex-1 overflow-y-auto\">\n               {renderConnectionList(blocked.map(c => ({...c, user: users.find(u => u.id === c.id)})), \"No blocked users.\")}\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n      \n      <Card className=\"flex flex-col\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\"><Search /> Find Operators</CardTitle>\n        </CardHeader>\n        <CardContent className=\"flex-1 flex flex-col gap-4\">\n          <form onSubmit={handleSearch} className=\"flex gap-2\">\n            <Input \n              placeholder=\"Search by username...\"\n              value={usernameSearch}\n              onChange={(e) => setUsernameSearch(e.target.value)}\n              disabled={isSearching}\n            />\n            <Button type=\"submit\" disabled={isSearching || !usernameSearch.trim()}>\n              {isSearching ? <Loader2 className=\"animate-spin\" /> : <Search />}\n            </Button>\n          </form>\n          <div className=\"flex-1 overflow-y-auto space-y-2\">\n            {isSearching && <p className=\"text-muted-foreground text-center p-4\">Searching the matrix...</p>}\n            {foundUser && (\n              <div \n                className=\"flex items-center justify-between p-2 rounded-lg bg-muted/50\"\n                onContextMenu={(e) => handleFoundUserClick(e, foundUser)}\n                data-command-hub-trigger\n              >\n                <div className=\"flex items-center gap-3\">\n                  <UserQuickView user={foundUser}>\n                    <Avatar>\n                      <AvatarImage src={foundUser.photoURL || undefined} />\n                      <AvatarFallback>{foundUser.displayName?.[0] || foundUser.email?.[0]}</AvatarFallback>\n                    </Avatar>\n                  </UserQuickView>\n                  <div>\n                    <p className=\"font-semibold\">{foundUser.displayName || 'Unknown User'}</p>\n                    <p className=\"text-sm text-muted-foreground\">@{foundUser.username}</p>\n                  </div>\n                </div>\n                {renderActionButton(foundUser)}\n              </div>\n            )}\n            {!isSearching && !foundUser && (\n                <p className=\"text-muted-foreground text-center p-4\">Enter a username to find an operator.</p>\n             )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":12448,"size_tokens":null},"backend/src/middleware/rateLimiter.ts":{"content":"import { RateLimiterMemory } from 'rate-limiter-flexible';\nimport { Request, Response, NextFunction } from 'express';\n\n// General API rate limiter\nconst rateLimiter = new RateLimiterMemory({\n  keyGenerator: (req: Request) => req.ip,\n  points: 100, // Number of requests\n  duration: 60, // Per 60 seconds\n});\n\n// AI endpoints rate limiter (more restrictive)\nconst aiRateLimiter = new RateLimiterMemory({\n  keyGenerator: (req: Request) => req.ip,\n  points: 10, // Number of requests\n  duration: 60, // Per 60 seconds\n});\n\nexport const rateLimitMiddleware = async (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    await rateLimiter.consume(req.ip);\n    next();\n  } catch (rejRes) {\n    res.status(429).json({\n      error: 'Too many requests',\n      retryAfter: Math.round(rejRes.msBeforeNext / 1000) || 1,\n    });\n  }\n};\n\nexport const aiRateLimitMiddleware = async (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    await aiRateLimiter.consume(req.ip);\n    next();\n  } catch (rejRes) {\n    res.status(429).json({\n      error: 'Too many AI requests',\n      retryAfter: Math.round(rejRes.msBeforeNext / 1000) || 1,\n    });\n  }\n};","path":null,"size_bytes":1173,"size_tokens":null},"src/app/chat/page.tsx":{"content":"\n'use client';\nimport React, { useState, useEffect, useMemo, useCallback, Suspense } from 'react';\nimport { useSearchParams } from 'next/navigation';\nimport dynamic from 'next/dynamic';\nimport { Card, CardContent, CardHeader } from '@/components/ui/card';\nimport { Loader2 } from 'lucide-react';\nimport { useUser, UserProfile } from '@/hooks/use-user';\nimport {\n  collection,\n  query,\n  orderBy,\n  onSnapshot,\n  addDoc,\n  serverTimestamp,\n  doc,\n  getDoc,\n  setDoc,\n  Timestamp,\n  updateDoc,\n} from 'firebase/firestore';\nimport { useFirestore, useAuth } from '@/firebase/provider';\nimport { useConnections, PublicUser } from '@/hooks/use-connections';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { useWebRTC } from '@/hooks/use-webrtc';\nimport ChatHeader from '@/components/chat/ChatHeader';\nimport MessageList from '@/components/chat/MessageList';\nimport MessageInput from '@/components/chat/MessageInput';\nimport ContactList from '@/components/chat/ContactList';\nimport ContactDetails from '@/components/chat/ContactDetails';\nimport CreateGroupModal from '@/components/chat/CreateGroupModal';\nimport GroupSettingsModal from '@/components/chat/GroupSettingsModal';\nimport { appEventEmitter } from '@/lib/event-emitter';\nimport { useRouter } from 'next/navigation';\nimport { getDerivedStatus } from '@/lib/chat-utils';\nimport { Contact, Message, aetherBotContact } from '@/types/chat';\n\n\nconst VideoCallView = dynamic(() => import('@/components/chat/video-call-view'), { ssr: false });\nconst IncomingCallNotification = dynamic(() => import('@/components/chat/incoming-call-notification'), { ssr: false });\n\n\n\n\nfunction ChatPageContent() {\n  const auth = useAuth();\n  const firestore = useFirestore();\n  const router = useRouter();\n  const { user, profile, loading: userLoading, incrementStat } = useUser();\n  const { connections: userConnections, users: connectedUsers, loading: connectionsLoading } = useConnections();\n  const currentUser = useMemo(() => profile ? { ...profile } : null, [profile]);\n  const {\n    callStatus,\n    localStream,\n    remoteStream,\n    isAudioEnabled,\n    isVideoEnabled,\n    callDuration,\n    isScreenSharing,\n    activeCall,\n    incomingCall,\n    startCall,\n    acceptCall,\n    declineCall,\n    endCall,\n    toggleAudio,\n    toggleVideo,\n    startScreenShare\n  } = useWebRTC(currentUser);\n\n  \n  const [messages, setMessages] = useState<Message[]>([]);\n  const [contacts, setContacts] = useState<Contact[]>([]);\n  const [pinnedUsers, setPinnedUsers] = useState<Contact[]>([]);\n  const [selectedContact, setSelectedContact] = useState<Contact | null>(null);\n  const [chatId, setChatId] = useState<string | null>('aether-bot');\n  const searchParams = useSearchParams();\n  const [isClient, setIsClient] = useState(false);\n  const [replyToMessage, setReplyToMessage] = useState<Message | null>(null);\n  const [forwardingMessage, setForwardingMessage] = useState<Message | null>(null);\n  const [showCreateGroup, setShowCreateGroup] = useState(false);\n  const [groupCreating, setGroupCreating] = useState(false);\n  const [showGroupSettings, setShowGroupSettings] = useState(false);\n  const [selectedGroupForSettings, setSelectedGroupForSettings] = useState<Contact | null>(null);\n\n  const handleLeaveGroup = useCallback(async (group: Contact) => {\n    if (!user || !firestore) return;\n    if (window.confirm(`Are you sure you want to leave ${group.name}?`)) {\n      try {\n        const groupRef = doc(firestore, 'chats', group.id);\n        const groupDoc = await getDoc(groupRef);\n        if (groupDoc.exists()) {\n          const data = groupDoc.data();\n          const updatedParticipants = { ...data.participants };\n          delete updatedParticipants[user.uid];\n          const updatedMembers = (data.members || []).filter((id: string) => id !== user.uid);\n          \n          await updateDoc(groupRef, {\n            participants: updatedParticipants,\n            members: updatedMembers\n          });\n          \n          setContacts(prev => prev.filter(c => c.id !== group.id));\n          if (selectedContact?.id === group.id) {\n            setSelectedContact(null);\n          }\n        }\n      } catch (error) {\n        console.error('Error leaving group:', error);\n      }\n    }\n  }, [user, firestore, selectedContact]);\n\n  const handleDeleteGroup = useCallback(async (group: Contact) => {\n    if (!user || !firestore) return;\n    if (window.confirm(`Are you sure you want to delete ${group.name}? This cannot be undone.`)) {\n      try {\n        const groupRef = doc(firestore, 'chats', group.id);\n        await updateDoc(groupRef, {\n          deleted: true,\n          deletedAt: serverTimestamp()\n        });\n        \n        setContacts(prev => prev.filter(c => c.id !== group.id));\n        if (selectedContact?.id === group.id) {\n          setSelectedContact(null);\n        }\n      } catch (error) {\n        console.error('Error deleting group:', error);\n      }\n    }\n  }, [user, firestore, selectedContact]);\n\n  useEffect(() => {\n    setIsClient(true);\n    const handlePinUser = (userToPin: PublicUser) => {\n        const contactToPin = connectedUsers.find(u => u.id === userToPin.id);\n        if (contactToPin) {\n             setPinnedUsers(prev => {\n                if (prev.find(p => p.id === contactToPin.id)) return prev;\n                const contact: Contact = {\n                  id: contactToPin.id,\n                  name: contactToPin.displayName || 'Unknown',\n                  avatar: contactToPin.photoURL || '',\n                  status: getDerivedStatus(contactToPin).label,\n                  type: 'user'\n                };\n                return [...prev, contact];\n             });\n        }\n    };\n    \n    const handleShowUserProfile = (userId: string) => {\n        router.push(`/profile/${userId}`);\n    }\n\n    const handleReplyTo = (message: Message) => {\n      setReplyToMessage(message);\n    }\n\n    const handleForwardMessage = (message: Message) => {\n      setForwardingMessage(message);\n    }\n\n    const handleGroupInfo = (group: Contact) => {\n      setSelectedGroupForSettings(group);\n      setShowGroupSettings(true);\n    }\n\n    const handleEditGroup = (group: Contact) => {\n      setSelectedGroupForSettings(group);\n      setShowGroupSettings(true);\n    }\n    \n    appEventEmitter.on('ui:pin-user', handlePinUser as (...args: unknown[]) => void);\n    appEventEmitter.on('ui:show-user-profile', handleShowUserProfile as (...args: unknown[]) => void);\n    appEventEmitter.on('chat:reply-to', handleReplyTo as (...args: unknown[]) => void);\n    appEventEmitter.on('chat:forward-message', handleForwardMessage as (...args: unknown[]) => void);\n    appEventEmitter.on('group:show-info', handleGroupInfo as (...args: unknown[]) => void);\n    appEventEmitter.on('group:edit', handleEditGroup as (...args: unknown[]) => void);\n    appEventEmitter.on('group:leave', handleLeaveGroup as (...args: unknown[]) => void);\n    appEventEmitter.on('group:delete', handleDeleteGroup as (...args: unknown[]) => void);\n\n    return () => {\n        appEventEmitter.off('ui:pin-user', handlePinUser as (...args: unknown[]) => void);\n        appEventEmitter.off('ui:show-user-profile', handleShowUserProfile as (...args: unknown[]) => void);\n        appEventEmitter.off('chat:reply-to', handleReplyTo as (...args: unknown[]) => void);\n        appEventEmitter.off('chat:forward-message', handleForwardMessage as (...args: unknown[]) => void);\n        appEventEmitter.off('group:show-info', handleGroupInfo as (...args: unknown[]) => void);\n        appEventEmitter.off('group:edit', handleEditGroup as (...args: unknown[]) => void);\n        appEventEmitter.off('group:leave', handleLeaveGroup as (...args: unknown[]) => void);\n        appEventEmitter.off('group:delete', handleDeleteGroup as (...args: unknown[]) => void);\n    };\n  }, [connectedUsers, router, handleLeaveGroup, handleDeleteGroup]);\n\n  const pageLoading = userLoading || connectionsLoading;\n\n  const handleSelectContact = useCallback((contact: Contact | null) => {\n    setSelectedContact(contact);\n    setReplyToMessage(null); // Clear reply when changing chats\n    setForwardingMessage(null); // Clear forward when changing chats\n  }, []);\n\n\n  // Populate contacts from connections hook\n  useEffect(() => {\n    if (pageLoading || !user || !firestore) return;\n    \n    const friendContacts: Contact[] = userConnections\n      .filter(c => c.status === 'friends')\n      .map(conn => connectedUsers.find(u => u.id === conn.id))\n      .filter((u): u is PublicUser => !!u)\n      .map(u => ({\n          id: u.id,\n          name: u.displayName || 'Unknown',\n          avatar: u.photoURL || '',\n          status: getDerivedStatus(u).label,\n          type: 'user'\n      }));\n      \n    // Fetch user's groups from Firestore\n    const fetchGroups = async () => {\n      try {\n        const chatsQuery = query(\n          collection(firestore, 'chats'),\n          orderBy('createdAt', 'desc')\n        );\n        \n        const unsubscribe = onSnapshot(chatsQuery, async (snapshot) => {\n          const groupContacts: Contact[] = [];\n          \n          for (const doc of snapshot.docs) {\n            const data = doc.data();\n            if (data.isGroup && data.participants && data.participants[user.uid]) {\n              // Get member details\n              const memberIds = data.members || Object.keys(data.participants);\n              const members: PublicUser[] = [];\n              \n              for (const memberId of memberIds) {\n                const memberUser = connectedUsers.find(u => u.id === memberId);\n                if (memberUser) {\n                  members.push(memberUser);\n                }\n              }\n              \n              groupContacts.push({\n                id: doc.id,\n                name: data.name || 'Unnamed Group',\n                avatar: data.avatar || '',\n                status: `${memberIds.length} members`,\n                type: 'group',\n                members\n              });\n            }\n          }\n          \n          const allContacts = [...friendContacts, ...groupContacts];\n          setContacts(allContacts);\n        });\n        \n        return unsubscribe;\n      } catch (error) {\n        console.error('Error fetching groups:', error);\n        const allContacts = [...friendContacts];\n        setContacts(allContacts);\n      }\n    };\n    \n    fetchGroups();\n\n    const contactId = searchParams.get('contactId');\n    if (contactId && !selectedContact) {\n        // Wait for contacts to be populated before selecting\n        setTimeout(() => {\n          setContacts(current => {\n            const contactToSelect = current.find(c => c.id === contactId);\n            if (contactToSelect) {\n              setSelectedContact(contactToSelect);\n            }\n            return current;\n          });\n        }, 100);\n    }\n    \n  }, [userConnections, connectedUsers, pageLoading, searchParams, selectedContact, user, firestore]);\n\n\n  // Determine chat ID based on selected contact\n  useEffect(() => {\n    if (pageLoading || !user || !selectedContact || !firestore) return;\n\n    const getOrCreateChat = async () => {\n      if (selectedContact.id === 'aether-bot') {\n        setMessages([]); // Clear messages for the bot\n        setChatId('aether-bot');\n        \n        // Ensure aether-bot chat document exists\n        const botChatRef = doc(firestore, 'chats', 'aether-bot');\n        try {\n          const botChatSnap = await getDoc(botChatRef);\n          if (!botChatSnap.exists()) {\n            await setDoc(botChatRef, {\n              participants: [user.uid, 'aether-bot'],\n              isGroup: false,\n              createdAt: serverTimestamp(),\n            });\n          }\n        } catch (error) {\n          console.error(\"Error creating aether-bot chat:\", error);\n        }\n        return;\n      }\n      \n      if (selectedContact.type === 'group') {\n        setChatId(selectedContact.id);\n        return;\n      }\n\n      // For one-on-one chats, create a consistent chat ID\n      const oneOnOneChatId = [user.uid, selectedContact.id].sort().join('_');\n      const chatRef = doc(firestore, 'chats', oneOnOneChatId);\n      \n      try {\n        const chatSnap = await getDoc(chatRef);\n        if (!chatSnap.exists()) {\n          // Create the chat document if it doesn't exist\n          const participantsMap: { [key: string]: boolean } = {};\n          participantsMap[user.uid] = true;\n          participantsMap[selectedContact.id] = true;\n          \n          const chatData = {\n            participants: participantsMap,\n            isGroup: false,\n            createdAt: serverTimestamp(),\n          };\n\n          await setDoc(chatRef, chatData);\n        }\n      } catch (error) {\n        console.error(\"Error ensuring chat document exists:\", error);\n      }\n\n      setChatId(oneOnOneChatId);\n    };\n\n    getOrCreateChat();\n\n  }, [user, pageLoading, selectedContact, firestore]);\n  \n  // Listen for messages in the selected chat\n  useEffect(() => {\n    if (!chatId || !firestore || pageLoading || !auth.currentUser) {\n        if (chatId === 'aether-bot' && user) {\n            const saved = localStorage.getItem(`aether-bot-${user.uid}`);\n            setMessages(saved ? JSON.parse(saved) : []);\n        } else {\n            setMessages([]);\n        }\n        return;\n    }\n    \n    if (selectedContact?.type === 'bot') {\n        if (user) {\n            const saved = localStorage.getItem(`aether-bot-${user.uid}`);\n            setMessages(saved ? JSON.parse(saved) : []);\n        }\n        return;\n    }\n\n    const messagesCollection = collection(firestore, 'chats', chatId, 'messages');\n    const q = query(messagesCollection, orderBy('timestamp', 'asc'));\n    \n    const unsubscribe = onSnapshot(q, async (querySnapshot) => {\n      appEventEmitter.emit('ui:sound', 'success'); // Play sound on new message\n      const msgs: Message[] = [];\n      const userCache: Record<string, { displayName: string, photoURL: string }> = {};\n\n      for (const docSnap of querySnapshot.docs) {\n          const data = docSnap.data();\n          const senderId = data.senderId;\n\n          if (!userCache[senderId]) {\n              const userDoc = await getDoc(doc(firestore, 'users', senderId));\n              const senderData = userDoc.data();\n              userCache[senderId] = {\n                  displayName: senderData?.displayName || 'Unknown User',\n                  photoURL: senderData?.photoURL || ''\n              };\n          }\n          \n          const sender = userCache[senderId];\n\n          msgs.push({\n             id: docSnap.id,\n             ...data,\n             senderName: sender.displayName,\n             senderAvatar: sender.photoURL,\n          } as Message)\n      }\n      setMessages(msgs);\n    }, (error) => {\n        console.error('Error fetching messages:', error);\n    });\n\n    return () => unsubscribe();\n  }, [chatId, firestore, selectedContact, auth, pageLoading]);\n\n  const handleCreateGroup = useCallback(async (groupName: string, selectedMembers: PublicUser[]) => {\n    if (!user || !firestore) return;\n    \n    setGroupCreating(true);\n    try {\n      // Create group document\n      const groupId = `group_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      const groupRef = doc(firestore, 'chats', groupId);\n      \n      const participantsMap: { [key: string]: boolean } = {};\n      participantsMap[user.uid] = true;\n      selectedMembers.forEach(member => {\n        participantsMap[member.id] = true;\n      });\n      \n      await setDoc(groupRef, {\n        name: groupName,\n        participants: participantsMap,\n        isGroup: true,\n        createdAt: serverTimestamp(),\n        createdBy: user.uid,\n        members: [user.uid, ...selectedMembers.map(m => m.id)],\n        avatar: '',\n        admins: [user.uid] // Creator is admin\n      });\n      \n      // Create new group contact\n      const newGroupContact: Contact = {\n        id: groupId,\n        name: groupName,\n        avatar: '',\n        status: `${selectedMembers.length + 1} members`,\n        type: 'group',\n        members: [currentUser as PublicUser, ...selectedMembers]\n      };\n      \n      setContacts(prev => [...prev, newGroupContact]);\n      setSelectedContact(newGroupContact);\n      setShowCreateGroup(false);\n      \n    } catch (error) {\n      console.error('Error creating group:', error);\n    } finally {\n      setGroupCreating(false);\n    }\n  }, [user, firestore, currentUser]);\n\n  const handleUpdateGroup = useCallback(async (groupId: string, updates: { name?: string; avatar?: string }) => {\n    if (!user || !firestore) return;\n    \n    try {\n      const groupRef = doc(firestore, 'chats', groupId);\n      await updateDoc(groupRef, {\n        ...updates,\n        updatedAt: serverTimestamp(),\n        updatedBy: user.uid\n      });\n      \n      // Update local contacts\n      setContacts(prev => prev.map(contact => \n        contact.id === groupId \n          ? { ...contact, ...updates }\n          : contact\n      ));\n      \n      // Update selected contact if it's the same group\n      if (selectedContact?.id === groupId) {\n        setSelectedContact(prev => prev ? { ...prev, ...updates } : null);\n      }\n      \n    } catch (error) {\n      console.error('Error updating group:', error);\n    }\n  }, [user, firestore, selectedContact]);\n\n  const handleRemoveMember = useCallback(async (groupId: string, memberId: string) => {\n    if (!user || !firestore) return;\n    \n    try {\n      const groupRef = doc(firestore, 'chats', groupId);\n      const groupDoc = await getDoc(groupRef);\n      \n      if (groupDoc.exists()) {\n        const data = groupDoc.data();\n        const updatedParticipants = { ...data.participants };\n        delete updatedParticipants[memberId];\n        const updatedMembers = (data.members || []).filter((id: string) => id !== memberId);\n        \n        await updateDoc(groupRef, {\n          participants: updatedParticipants,\n          members: updatedMembers\n        });\n        \n        // Update local contacts\n        setContacts(prev => prev.map(contact => \n          contact.id === groupId \n            ? { \n                ...contact, \n                members: contact.members?.filter(m => m.id !== memberId),\n                status: `${updatedMembers.length} members`\n              }\n            : contact\n        ));\n      }\n    } catch (error) {\n      console.error('Error removing member:', error);\n    }\n  }, [user, firestore]);\n\n  const handleStartCall = useCallback((type: 'video' | 'voice') => {\n        if (!selectedContact || selectedContact.type !== 'user' || !user) return;\n        const targetUser = connectedUsers.find(u => u.id === selectedContact.id);\n        if (targetUser) {\n            startCall(targetUser);\n        }\n    }, [selectedContact, startCall, connectedUsers, user]);\n\n\n  const incomingCallUser = useMemo(() => {\n        if (!incomingCall) return undefined;\n        return connectedUsers.find(u => u.id === incomingCall.fromUserId);\n  }, [incomingCall, connectedUsers]);\n\n  return (\n    <>\n      <div className=\"grid grid-cols-1 lg:grid-cols-[280px_1fr_280px] xl:grid-cols-[300px_1fr_300px] gap-x-2 md:gap-x-4 h-full\">\n        <ContactList\n            contacts={contacts}\n            pinnedContacts={pinnedUsers}\n            selectedContact={selectedContact}\n            onSelectContact={handleSelectContact}\n            loading={pageLoading}\n            isClient={isClient}\n            onCreateGroup={() => setShowCreateGroup(true)}\n            connectedUsers={connectedUsers}\n        />\n\n        <div className=\"flex flex-col h-full lg:col-start-2 min-h-0\">\n          {pageLoading ? (\n             <div className=\"flex-1 flex flex-col gap-4\">\n                <Card className=\"flex flex-col min-h-0 h-full\">\n                    <CardHeader><div className=\"h-10 w-full bg-muted animate-pulse rounded-md\" /></CardHeader>\n                    <CardContent className=\"flex-1 flex items-center justify-center\">\n                        <Loader2 className=\"w-12 h-12 animate-spin text-primary\" />\n                    </CardContent>\n                </Card>\n             </div>\n          ) : (\n          <Card className=\"flex-1 flex flex-col min-h-0 mx-1 lg:mx-0\">\n            <ChatHeader \n                contact={selectedContact}\n                onStartCall={handleStartCall}\n                connectedUsers={connectedUsers}\n                isClient={isClient}\n            />\n            <div className=\"flex flex-col flex-grow min-h-0 border-t\">\n                <MessageList\n                    messages={messages}\n                    chatId={chatId}\n                    currentUser={user}\n                    connectedUsers={connectedUsers}\n                />\n                <MessageInput\n                    chatId={chatId}\n                    selectedContact={selectedContact}\n                    messages={messages}\n                    setMessages={setMessages}\n                    replyingTo={replyToMessage}\n                    setReplyingTo={setReplyToMessage}\n                    forwardingMessage={forwardingMessage}\n                    setForwardingMessage={setForwardingMessage}\n                />\n            </div>\n          </Card>\n          )}\n        </div>\n        \n       <ContactDetails contact={selectedContact} connectedUsers={connectedUsers} isClient={isClient} />\n\n      </div>\n\n      {callStatus !== 'idle' && callStatus !== 'ended' && callStatus !== 'declined' && (\n        <VideoCallView\n          state={callStatus}\n          localStream={localStream}\n          remoteStream={remoteStream}\n          onHangup={endCall}\n          onToggleAudio={toggleAudio}\n          onToggleVideo={toggleVideo}\n          isAudioEnabled={isAudioEnabled}\n          isVideoEnabled={isVideoEnabled}\n          duration={callDuration}\n          peer={activeCall?.withUser}\n          status={callStatus}\n          onScreenShare={startScreenShare}\n          isScreenSharing={isScreenSharing}\n        />\n      )}\n      {callStatus === 'ringing' && incomingCall && (\n        <IncomingCallNotification\n          caller={connectedUsers.find(u => u.id === incomingCall.fromUserId)}\n          onAccept={acceptCall}\n          onReject={declineCall}\n        />\n      )}\n      \n      <CreateGroupModal\n        open={showCreateGroup}\n        onOpenChange={setShowCreateGroup}\n        friends={userConnections\n          .filter(c => c.status === 'friends')\n          .map(conn => connectedUsers.find(u => u.id === conn.id))\n          .filter((u): u is PublicUser => !!u)\n        }\n        onCreateGroup={handleCreateGroup}\n        loading={groupCreating}\n      />\n      \n      <GroupSettingsModal\n        open={showGroupSettings}\n        onOpenChange={setShowGroupSettings}\n        group={selectedGroupForSettings}\n        onUpdateGroup={handleUpdateGroup}\n        onRemoveMember={handleRemoveMember}\n        onLeaveGroup={handleLeaveGroup}\n        onDeleteGroup={handleDeleteGroup}\n        currentUserId={user?.uid || ''}\n      />\n    </>\n  );\n}\n\n\nfunction ChatPageWrapper() {\n  return (\n    <Suspense fallback={<div className=\"flex items-center justify-center h-full\"><Loader2 className=\"animate-spin text-primary w-12 h-12\"/></div>}>\n      <ChatPageContent />\n    </Suspense>\n  )\n}\n\nexport default function ChatPage() {\n    return (\n      <div className=\"h-full\">\n          <ChatPageWrapper />\n      </div>\n    )\n  }\n\n    ","path":null,"size_bytes":23340,"size_tokens":null},"src/components/news/NewsArticleCard.tsx":{"content":"\n// src/components/news/NewsArticleCard.tsx\n'use client';\nimport { memo, useMemo } from 'react';\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';\nimport { motion } from 'framer-motion';\nimport Image from 'next/image';\nimport { formatDistanceToNowStrict } from 'date-fns';\nimport { Globe, Newspaper } from 'lucide-react';\nimport { Article } from '@/app/news/page';\n\ninterface NewsArticleCardProps {\n  article: Article;\n}\n\nexport const NewsArticleCard = memo(({ article }: NewsArticleCardProps) => {\n  const publishedTime = useMemo(() => {\n    try {\n      return formatDistanceToNowStrict(new Date(article.publishedAt), { addSuffix: true });\n    } catch {\n      return 'a while ago';\n    }\n  }, [article.publishedAt]);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3 }}\n    >\n      <a href={article.url} target=\"_blank\" rel=\"noopener noreferrer\">\n        <Card className=\"flex flex-col h-full group overflow-hidden glass-card hover:neon-border-primary transition-all\">\n          <CardHeader className=\"p-0\">\n            <div className=\"aspect-video bg-muted/50 flex items-center justify-center relative overflow-hidden\">\n              {article.urlToImage ? (\n                <Image\n                  src={article.urlToImage}\n                  alt={article.title}\n                  layout=\"fill\"\n                  className=\"object-cover group-hover:scale-105 transition-transform duration-300\"\n                />\n              ) : (\n                <Newspaper className=\"w-16 h-16 text-muted-foreground\" />\n              )}\n            </div>\n          </CardHeader>\n          <CardContent className=\"p-4 flex-1\">\n            <CardTitle className=\"text-base font-bold line-clamp-2 leading-snug\">{article.title}</CardTitle>\n            <p className=\"text-sm text-muted-foreground line-clamp-3 mt-2\">{article.description}</p>\n          </CardContent>\n          <CardFooter className=\"p-4 pt-0 text-xs text-muted-foreground flex items-center justify-between\">\n            <div className=\"flex items-center gap-2 truncate\">\n              <Globe className=\"w-4 h-4\" />\n              <span className=\"truncate\">{article.source.name}</span>\n            </div>\n            <span>{publishedTime}</span>\n          </CardFooter>\n        </Card>\n      </a>\n    </motion.div>\n  );\n});\n\nNewsArticleCard.displayName = 'NewsArticleCard';\n","path":null,"size_bytes":2453,"size_tokens":null},"src/components/aether-logo.tsx":{"content":"import { cn } from \"@/lib/utils\";\nimport type { SVGProps } from \"react\";\n\nexport default function AetherLogo(props: SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      className={cn(\"aether-logo\", props.className)}\n      {...props}\n    >\n      <defs>\n        <filter id=\"neon-glow-filter\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n          <feGaussianBlur stdDeviation=\"0.8\" result=\"coloredBlur\" />\n          <feMerge>\n            <feMergeNode in=\"coloredBlur\" />\n            <feMergeNode in=\"SourceGraphic\" />\n          </feMerge>\n        </filter>\n      </defs>\n      <g style={{ filter: \"url(#neon-glow-filter)\" }}>\n        <path d=\"M12 2L2 7l10 5 10-5-10-5z\" />\n        <path d=\"M2 17l10 5 10-5\" />\n        <path d=\"M2 12l10 5 10-5\" />\n      </g>\n    </svg>\n  );\n}\n","path":null,"size_bytes":967,"size_tokens":null},"docs/blueprint.md":{"content":"# **App Name**: AetherDash\n\n## Core Features:\n\n- Real-time Chat: Direct messaging and group chats with real-time updates using WebSockets.\n- Notes Manager: Rich text editor for creating and managing notes.\n- To-Do Taskboard: Kanban-style task management board for organizing tasks.\n- File Storage: Upload, preview, and delete files.\n- AI Assistant: Context-aware AI assistant powered by LLM with memory tool for improved support.\n- Theme Customization: User controls for customizing the dashboard theme, including a neon intensity slider.\n- Activity Feed: Aggregated activity feed for staying up-to-date on all app modules.\n\n## Style Guidelines:\n\n- Primary color: Neon Cyan (#00FFFF) for a vibrant, futuristic look.\n- Background color: Dark charcoal gray (#1A1A1A) to provide contrast and a cyberpunk aesthetic (desaturated neon cyan).\n- Accent color: Electric Purple (#BF00FF) for highlights and interactive elements, creating contrast.\n- Body and headline font: 'Space Grotesk', a sans-serif with a computerized, techy feel. Use 'Inter' for longer text passages.\n- Code font: 'Source Code Pro' for displaying code snippets.\n- Use neon-style icons to match the cyberpunk aesthetic.\n- Glassmorphism effects with frosted glass backgrounds for panels.\n- Subtle animations such as neon glows, hover pulse effects, and animated cyber lines.","path":null,"size_bytes":1336,"size_tokens":null},"src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8505,"size_tokens":null},"src/ai/flows/generate-image-flow.ts":{"content":"'use server';\n\nimport { z } from 'zod';\n\nconst GenerateImageInputSchema = z.object({\n  prompt: z.string().describe('A detailed text prompt to generate an image from.'),\n});\nexport type GenerateImageInput = z.infer<typeof GenerateImageInputSchema>;\n\nconst GenerateImageOutputSchema = z.object({\n  imageUrl: z.string().describe('The data URI of the generated image.'),\n});\nexport type GenerateImageOutput = z.infer<typeof GenerateImageOutputSchema>;\n\nexport async function generateImage(input: GenerateImageInput): Promise<GenerateImageOutput> {\n  throw new Error('Image generation is currently unavailable. This feature requires additional API setup.');\n}\n","path":null,"size_bytes":655,"size_tokens":null},"src/components/calls/CallActionButtons.tsx":{"content":"'use client';\n\nimport { Phone, Video } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useCall } from '@/contexts/CallContext';\n\ninterface CallActionButtonsProps {\n  userId: string;\n  userName: string;\n  userAvatar?: string;\n  disabled?: boolean;\n}\n\nexport default function CallActionButtons({ userId, userName, userAvatar, disabled }: CallActionButtonsProps) {\n  const { startCall } = useCall();\n\n  return (\n    <>\n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        className=\"h-8 w-8 md:h-10 md:w-10\"\n        onClick={() => startCall(userId, userName, 'voice', userAvatar)}\n        disabled={disabled}\n        title=\"Voice Call\"\n      >\n        <Phone className=\"w-4 h-4 md:w-5 md:h-5\" />\n      </Button>\n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        className=\"h-8 w-8 md:h-10 md:w-10\"\n        onClick={() => startCall(userId, userName, 'video', userAvatar)}\n        disabled={disabled}\n        title=\"Video Call\"\n      >\n        <Video className=\"w-4 h-4 md:w-5 md:h-5\" />\n      </Button>\n    </>\n  );\n}\n","path":null,"size_bytes":1070,"size_tokens":null},"src/components/dashboard/countdown-timer.tsx":{"content":"\n'use client';\n\nimport { useState, useEffect } from 'react';\n\nconst calculateTimeLeft = (expiryTimestamp: Date) => {\n    const difference = +expiryTimestamp - +new Date();\n    let timeLeft = {\n        days: 0,\n        hours: 0,\n        minutes: 0,\n        seconds: 0\n    };\n\n    if (difference > 0) {\n        timeLeft = {\n            days: Math.floor(difference / (1000 * 60 * 60 * 24)),\n            hours: Math.floor((difference / (1000 * 60 * 60)) % 24),\n            minutes: Math.floor((difference / 1000 / 60) % 60),\n            seconds: Math.floor((difference / 1000) % 60)\n        };\n    }\n    \n    return timeLeft;\n}\n\ninterface CountdownTimerProps {\n    expiryTimestamp: Date;\n}\n\nexport default function CountdownTimer({ expiryTimestamp }: CountdownTimerProps) {\n    const [timeLeft, setTimeLeft] = useState(calculateTimeLeft(expiryTimestamp));\n\n    useEffect(() => {\n        const timer = setTimeout(() => {\n            setTimeLeft(calculateTimeLeft(expiryTimestamp));\n        }, 1000);\n\n        return () => clearTimeout(timer);\n    });\n\n    const timerComponents = Object.entries(timeLeft).map(([interval, value]) => {\n        if(value === 0 && interval !== 'seconds' && timeLeft.days === 0 && (interval !== 'minutes' || timeLeft.hours === 0)) return null;\n\n        return (\n            <span key={interval} className=\"tabular-nums\">\n                {String(value).padStart(2, '0')}{interval[0]}\n            </span>\n        );\n    }).filter(Boolean);\n\n    return (\n        <div className=\"font-mono text-sm text-muted-foreground space-x-1\">\n            <span>Resets in:</span>\n            {timerComponents.length ? timerComponents : <span>Time's up!</span>}\n        </div>\n    );\n}\n","path":null,"size_bytes":1692,"size_tokens":null},"src/components/dashboard/widget.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { cn } from '@/lib/utils';\nimport type { LucideIcon } from 'lucide-react';\n\nexport type WidgetProps = {\n  id?: string;\n  title: string;\n  icon: LucideIcon;\n  children: React.ReactNode;\n  className?: string;\n  onboardingId?: string;\n};\n\nexport function Widget({ title, icon: Icon, children, className, onboardingId }: WidgetProps) {\n  return (\n    <Card \n        className={cn(\n            'glass-card flex flex-col', \n            className\n        )}\n        data-onboarding-id={onboardingId}\n    >\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2 font-headline text-lg text-glow\">\n          <Icon className=\"text-primary w-5 h-5\" />\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent \n        className=\"flex-1 flex flex-col\"\n      >\n        {children}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":933,"size_tokens":null},"src/components/gaming/GamingMemberList.tsx":{"content":"\n'use client';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { cn } from '@/lib/utils';\nimport { Crown, Sword, User } from 'lucide-react';\nimport React from 'react';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useRouter } from 'next/navigation';\nimport { useToast } from '@/hooks/use-toast';\nimport { useUser, UserProfile } from '@/hooks/use-user';\nimport { useConnections, PublicUser } from '@/hooks/use-connections';\nimport UserPopover from '@/components/user/user-popover';\n\nconst MemberItem = ({ member, isOnline, isOwner }: { member: PublicUser, isOnline: boolean, isOwner?: boolean }) => {\n    const { openHub } = useCommandHub();\n    const router = useRouter();\n    const { toast } = useToast();\n    const { sendFriendRequest, connections } = useConnections();\n    const { user: currentUser } = useUser();\n    const [isSpeaking, setIsSpeaking] = React.useState(false);\n    \n    // This is mock data, replace with real gaming status\n    const gamingStatus = {\n        isInGame: Math.random() > 0.7,\n        game: 'Cyberpunk 2077',\n        status: 'Online',\n    };\n    const isInGame = gamingStatus.isInGame;\n\n    const isFriend = connections.some(c => c.id === member.id && c.status === 'friends');\n    const isPending = connections.some(c => c.id === member.id && c.status === 'pending');\n    const isSelf = currentUser?.uid === member.id;\n\n    React.useEffect(() => {\n        if(isOnline && Math.random() > 0.8) {\n            const interval = setInterval(() => {\n                setIsSpeaking(prev => !prev);\n            }, 2000 + Math.random() * 3000);\n            return () => clearInterval(interval);\n        }\n    }, [isOnline]);\n\n    const handleContextMenu = (e: React.MouseEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (isSelf) return;\n\n        openHub(e, {\n            type: 'gaming-member',\n            data: member,\n            actions: [\n                { label: 'View Profile', icon: 'User', onClick: () => router.push(`/profile/${member.id}`) },\n                { label: 'Mention', icon: 'AtSign', onClick: () => toast({ title: `Mentioned ${member.displayName}` }) },\n                { label: 'Message', icon: 'MessageSquare', onClick: () => router.push(`/chat?contactId=${member.id}`) },\n                { label: 'Add Friend', icon: 'UserPlus', onClick: () => sendFriendRequest(member.id), disabled: isFriend || isPending },\n                { label: 'Set Volume', icon: 'Volume2', onClick: () => {}, disabled: !isOnline },\n                { label: 'Kick', icon: 'LogOut', onClick: () => {}, disabled: true },\n                { label: 'Ban', icon: 'Gavel', onClick: () => {}, isDestructive: true, disabled: true },\n            ]\n        })\n    }\n\n    return (\n        <UserPopover user={member}>\n            <div \n                className=\"flex items-center gap-3 p-1 rounded-md hover:bg-accent/50 cursor-pointer group\"\n                onContextMenu={handleContextMenu}\n                data-command-hub-trigger\n            >\n                <div className=\"relative\">\n                    <Avatar className={cn(\"h-10 w-10 transition-all\", isSpeaking && \"border-2 border-green-400 shadow-[0_0_15px_rgba(74,222,128,0.7)]\")}>\n                        <AvatarImage src={member.photoURL || undefined} className={cn(!isOnline && 'filter grayscale')}/>\n                        <AvatarFallback>{member.displayName?.charAt(0)}</AvatarFallback>\n                    </Avatar>\n                    {isOnline && (\n                        <div className={cn(\n                            \"absolute -bottom-0.5 -right-0.5 h-4 w-4 rounded-full border-2 border-gaming-background\",\n                            isInGame ? 'bg-purple-500' : 'bg-green-500'\n                        )}>\n                        {isInGame && <div className=\"absolute inset-0.5 rounded-full bg-purple-500 animate-pulse\"></div>}\n                        </div>\n                    )}\n                </div>\n                <div className=\"flex-1 overflow-hidden\">\n                    <p className={cn('font-semibold truncate flex items-center gap-1.5', isOwner && 'text-amber-400')}>\n                        {isOwner && <Crown size={14} />}\n                        {member.displayName}\n                    </p>\n                    <div className=\"text-xs text-gaming-muted-foreground truncate flex items-center gap-1.5\">\n                    {isOnline && isInGame ? (\n                        <>\n                            <Sword size={12} className=\"text-purple-400\" />\n                            <span>{gamingStatus.game}</span>\n                        </>\n                    ) : (\n                        <span>{isOnline ? gamingStatus.status : 'Offline'}</span>\n                    )}\n                    </div>\n                </div>\n            </div>\n        </UserPopover>\n    )\n};\n\ninterface GamingMemberListProps {\n    activeSpaceId: string | null;\n}\n\nexport default function GamingMemberList({ activeSpaceId }: GamingMemberListProps) {\n    const { user, profile } = useUser();\n    const { users: connectedUsers, connections } = useConnections();\n\n    const { owner, onlineMembers, offlineMembers } = React.useMemo(() => {\n        const ownerUsername = \"mubah3r\"; \n        let owner: PublicUser | null = null;\n        \n        const allMembers = connections\n            .filter(c => c.status === 'friends')\n            .map(c => connectedUsers.find(u => u.id === c.id))\n            .filter((u): u is PublicUser => !!u);\n            \n        if (profile) {\n            allMembers.unshift(profile as PublicUser);\n        }\n\n        const uniqueMembers = Array.from(new Map(allMembers.map(item => [item.id, item])).values());\n        \n        const online: PublicUser[] = [];\n        \n        const isAetherweaveHQ = activeSpaceId === 'aetherweave-hq';\n\n        uniqueMembers.forEach(member => {\n            if (isAetherweaveHQ && member.username?.toLowerCase() === ownerUsername) {\n                owner = member;\n            } else {\n                online.push(member);\n            }\n        });\n        \n        return {\n            owner,\n            onlineMembers: online,\n            offlineMembers: [] \n        };\n\n    }, [profile, connections, connectedUsers, activeSpaceId]);\n\n    const memberGroups: { [key: string]: PublicUser[] } = {};\n\n    if (owner) {\n        memberGroups['OWNER'] = [owner];\n    }\n    if (onlineMembers.length > 0) {\n        memberGroups['ONLINE'] = onlineMembers;\n    }\n    if (offlineMembers.length > 0) {\n        memberGroups['OFFLINE'] = offlineMembers;\n    }\n\n    const totalOnline = (owner ? 1 : 0) + onlineMembers.length;\n\n    return (\n        <div className=\"hidden w-64 flex-col bg-gaming-background-secondary/60 backdrop-blur-sm lg:flex\">\n             <header className=\"flex h-16 shrink-0 items-center border-b border-gaming-border px-4 shadow-md\">\n                <h2 className=\"text-lg font-bold text-gaming-foreground\">Members - {totalOnline} Online</h2>\n             </header>\n            <ScrollArea className=\"flex-1 p-3 custom-scroll\">\n                 {totalOnline === 0 && offlineMembers.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center h-full text-center text-muted-foreground\">\n                        <User className=\"w-12 h-12 mb-4\" />\n                        <h3 className=\"font-headline text-lg\">No Members</h3>\n                        <p className=\"text-sm\">This space is currently empty.</p>\n                    </div>\n                ) : (\n                    <div className=\"space-y-6\">\n                        {Object.entries(memberGroups).map(([group, members]) => (\n                            members.length > 0 && <div key={group}>\n                                <h3 className=\"mb-2 text-sm font-bold uppercase text-gaming-muted-foreground\">{group}</h3>\n                                <div className=\"space-y-3\">\n                                    {members.map(member => (\n                                        <MemberItem \n                                            key={member.id} \n                                            member={member} \n                                            isOnline={group !== 'OFFLINE'}\n                                            isOwner={group === 'OWNER'}\n                                        />\n                                    ))}\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </ScrollArea>\n        </div>\n    );\n}\n\n    ","path":null,"size_bytes":8634,"size_tokens":null},"src/components/gaming/GamingNavbar.tsx":{"content":"'use client';\nimport React from 'react';\nimport { Bell, Search, Compass, Plus, Users, VolumeX, Edit, LogOut, Check, Settings, FolderPlus, Hash } from 'lucide-react';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { cn } from '@/lib/utils';\nimport AetherLogo from '@/components/aether-logo';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useToast } from '@/hooks/use-toast';\nimport { useUser } from '@/hooks/use-user';\n\nconst spaces: { id: string, name: string, img?: string, icon?: React.ComponentType<any>, mentions?: number, hasUnread?: boolean }[] = [\n    { id: 'aetherweave-hq', name: 'Aetherweave HQ', icon: AetherLogo, mentions: 3, hasUnread: true },\n];\n\nconst toolIcons = [\n  { id: 'add', name: 'Add a Space', icon: Plus, action: 'create-join-space' },\n  { id: 'explore', name: 'Explore Spaces', icon: Compass },\n];\n\ninterface GamingNavbarProps {\n    activeSpace: string | null;\n    setActiveSpace: (id: string | null) => void;\n}\n\nexport default function GamingNavbar({ activeSpace, setActiveSpace }: GamingNavbarProps) {\n    const { openHub, openModal } = useCommandHub();\n    const { toast } = useToast();\n    const { profile } = useUser();\n\n    const handleSpaceContextMenu = (e: React.MouseEvent, space: typeof spaces[0]) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const isOwner = profile?.username === 'mubah3r' && space.id === 'aetherweave-hq';\n\n      let actions: any[] = [\n          { label: 'Invite People', icon: 'Users', onClick: () => openModal('invite-people', space) },\n          { label: 'Mark As Read', icon: 'Check', onClick: () => toast({title: `${space.name} marked as read.`}) },\n          { label: 'Mute Space', icon: 'VolumeX', onClick: () => toast({title: `Muted ${space.name}`, description: \"You will no longer receive notifications from this space.\"}) },\n          { label: 'Edit Space Profile', icon: 'Edit', onClick: () => toast({title: 'Per-Space Profile Updated', description: \"Your identity for this space has been changed.\"}) },\n      ];\n\n      if (isOwner) {\n        actions.push(\n          { label: 'Create Category', icon: 'FolderPlus', onClick: () => toast({title: 'Category created.'}) },\n          { label: 'Create Channel', icon: 'Hash', onClick: () => toast({title: 'Channel created.'}) },\n          { label: 'Space Settings', icon: 'Settings', onClick: () => openModal('space-settings', space) }\n        );\n      }\n\n      actions.push({ label: 'Leave Space', icon: 'LogOut', onClick: () => {}, isDestructive: true });\n\n      openHub(e, {\n        type: 'space-context',\n        data: space,\n        actions: actions\n      })\n    }\n    \n     const handleToolClick = (tool: typeof toolIcons[0]) => {\n        if (tool.action) {\n            openModal(tool.action as any);\n        } else {\n            toast({ title: 'Coming Soon!', description: `${tool.name} functionality is under development.`});\n        }\n    };\n\n\n  return (\n    <header className=\"flex h-16 shrink-0 items-center gap-6 border-b-2 border-primary/20 bg-background/80 px-6 backdrop-blur-sm shadow-md\">\n      {/* Space List */}\n      <nav className=\"flex items-center gap-3\">\n        <TooltipProvider>\n            {spaces.map((space) => (\n                 <Tooltip key={space.id}>\n                    <TooltipTrigger asChild>\n                         <button\n                            onClick={() => setActiveSpace(space.id)}\n                            onContextMenu={(e) => handleSpaceContextMenu(e, space)}\n                            data-command-hub-trigger\n                            className=\"group relative h-12 w-12 rounded-full flex items-center justify-center bg-muted/50 transition-all duration-200 hover:scale-110 hover:shadow-lg focus:outline-none\"\n                         >\n                            {space.img ? (\n                              <img src={space.img} alt={space.name} className=\"h-full w-full object-cover rounded-full transition-all duration-200 group-hover:rounded-xl\" />\n                            ) : space.icon ? (\n                               <div className={cn(\"flex h-full w-full items-center justify-center rounded-full transition-all duration-200 group-hover:rounded-xl\", activeSpace === space.id ? \"bg-primary/20\" : \"\")}>\n                                <space.icon className=\"h-8 w-8 text-primary\" />\n                               </div>\n                            ) : null}\n                            \n                            {/* Notification Badges */}\n                            {space.mentions && space.mentions > 0 && (\n                              <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-destructive text-destructive-foreground rounded-full flex items-center justify-center text-xs font-bold\">\n                                {space.mentions}\n                              </div>\n                            )}\n                            {space.hasUnread && !space.mentions && (\n                               <div className=\"absolute top-0 right-0 w-3 h-3 bg-primary rounded-full border-2 border-background\"></div>\n                            )}\n\n\n                            {activeSpace === space.id && (\n                                <motion.div\n                                    layoutId=\"active-space-underline\"\n                                    className=\"absolute -bottom-2 h-1 w-10 rounded-full bg-primary neon-glow-primary\"\n                                    transition={{ type: 'spring', stiffness: 350, damping: 30 }}\n                                />\n                            )}\n                         </button>\n                    </TooltipTrigger>\n                    <TooltipContent side=\"bottom\"><p>{space.name}</p></TooltipContent>\n                 </Tooltip>\n            ))}\n             <div className=\"h-8 w-px bg-border mx-2\"></div>\n              {toolIcons.map((tool) => (\n                 <Tooltip key={tool.id}>\n                    <TooltipTrigger asChild>\n                         <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleToolClick(tool)}\n                            className=\"h-12 w-12 rounded-full flex items-center justify-center bg-muted/50 text-muted-foreground transition-all duration-200 hover:scale-110 hover:text-primary hover:bg-muted\"\n                         >\n                            <tool.icon className=\"h-6 w-6\"/>\n                         </Button>\n                    </TooltipTrigger>\n                    <TooltipContent side=\"bottom\"><p>{tool.name}</p></TooltipContent>\n                 </Tooltip>\n            ))}\n        </TooltipProvider>\n      </nav>\n\n      <div className=\"ml-auto flex items-center gap-2\">\n        <div className=\"relative hidden md:block\">\n          <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search\"\n            className=\"w-48 bg-input pl-8\"\n          />\n        </div>\n         <Button variant=\"ghost\" size=\"icon\" className=\"relative h-10 w-10 text-muted-foreground hover:text-foreground\">\n            <Bell />\n        </Button>\n      </div>\n    </header>\n  );\n}\n","path":null,"size_bytes":7382,"size_tokens":null},"src/components/ai-hub/image-editor-tool.tsx":{"content":"'use client';\nimport { useState, useRef } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { generateImageFromImage, GenerateImageFromImageInput } from '@/ai/flows/generate-image-from-image-flow';\nimport Image from 'next/image';\nimport { Loader2, Wand2, ImageIcon, UploadCloud } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\n\nexport default function ImageEditorTool() {\n    const [prompt, setPrompt] = useState('');\n    const [baseImage, setBaseImage] = useState<string | null>(null);\n    const [generatedImageUrl, setGeneratedImageUrl] = useState<string | null>(null);\n    const [isLoading, setIsLoading] = useState(false);\n    const [dragging, setDragging] = useState(false);\n    const fileInputRef = useRef<HTMLInputElement>(null);\n    const { toast } = useToast();\n\n    const handleFileChange = (file: File | null) => {\n        if (!file) return;\n\n        if (!file.type.startsWith('image/')) {\n            toast({\n                variant: 'destructive',\n                title: 'Invalid File Type',\n                description: 'Please upload an image file.',\n            });\n            return;\n        }\n\n        const reader = new FileReader();\n        reader.onload = (e) => {\n            setBaseImage(e.target?.result as string);\n            setGeneratedImageUrl(null); // Clear previous result when new image is uploaded\n        };\n        reader.readAsDataURL(file);\n    };\n\n    const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        setDragging(true);\n    };\n\n    const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        setDragging(false);\n    };\n\n    const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        setDragging(false);\n        const file = e.dataTransfer.files?.[0] || null;\n        handleFileChange(file);\n    };\n\n    const handleGenerate = async () => {\n        if (!prompt.trim()) {\n            toast({ variant: 'destructive', title: 'Prompt is empty', description: 'Please enter a prompt to edit the image.' });\n            return;\n        }\n        if (!baseImage) {\n            toast({ variant: 'destructive', title: 'No image selected', description: 'Please upload a base image to edit.' });\n            return;\n        }\n\n        setIsLoading(true);\n        setGeneratedImageUrl(null);\n\n        try {\n            const input: GenerateImageFromImageInput = { prompt, baseImage };\n            const result = await generateImageFromImage(input);\n            setGeneratedImageUrl(result.imageUrl);\n        } catch (error) {\n            console.error('Image editing failed:', error);\n            toast({ variant: 'destructive', title: 'Editing Failed', description: 'Could not edit image. Please try again.' });\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"flex flex-col h-full border rounded-lg bg-background/30 p-4 gap-4\">\n            <div className=\"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {/* Base Image */}\n                <div\n                    className={cn(\"flex flex-col gap-2 transition-all\", dragging && \"neon-border-primary\")}\n                    onDragOver={handleDragOver}\n                    onDragLeave={handleDragLeave}\n                    onDrop={handleDrop}\n                >\n                    <label className=\"text-sm font-medium text-muted-foreground\">Base Image</label>\n                    <div className=\"flex-1 flex items-center justify-center bg-muted/30 rounded-lg border-2 border-dashed border-border overflow-hidden relative\">\n                        {baseImage ? (\n                            <Image src={baseImage} alt=\"Base image\" layout=\"fill\" className=\"object-contain\" />\n                        ) : (\n                            <div className=\"text-center text-muted-foreground p-8 cursor-pointer\" onClick={() => fileInputRef.current?.click()}>\n                                <UploadCloud className=\"w-16 h-16 mx-auto mb-4\" />\n                                <h3 className=\"font-headline text-xl\">Upload Image</h3>\n                                <p>Click or drag & drop an image to edit.</p>\n                            </div>\n                        )}\n                         {dragging && (\n                            <div className=\"absolute inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-10 pointer-events-none rounded-lg\">\n                                <div className=\"text-center p-8 border-2 border-dashed border-primary rounded-lg\">\n                                <UploadCloud className=\"w-16 h-16 text-primary mx-auto animate-pulse\" />\n                                <p className=\"mt-4 text-xl font-headline text-glow\">Drop Image Here</p>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                    <input\n                        type=\"file\"\n                        ref={fileInputRef}\n                        onChange={(e) => handleFileChange(e.target.files?.[0] || null)}\n                        accept=\"image/*\"\n                        className=\"hidden\"\n                    />\n                     <Button variant=\"outline\" onClick={() => fileInputRef.current?.click()}>\n                        <UploadCloud className=\"mr-2 h-4 w-4\" />\n                        Choose File\n                    </Button>\n                </div>\n                {/* Generated Image */}\n                <div className=\"flex flex-col gap-2\">\n                    <label className=\"text-sm font-medium text-muted-foreground\">Generated Image</label>\n                    <div className=\"flex-1 flex items-center justify-center bg-muted/30 rounded-lg border-2 border-dashed border-border overflow-hidden\">\n                        {isLoading && (\n                            <div className=\"flex flex-col items-center gap-4 text-primary\">\n                                <Loader2 className=\"w-12 h-12 animate-spin\" />\n                                <p className=\"font-headline text-glow\">Rendering modifications...</p>\n                            </div>\n                        )}\n                        {!isLoading && generatedImageUrl && (\n                            <Image src={generatedImageUrl} alt={prompt} layout=\"fill\" className=\"object-contain\" />\n                        )}\n                        {!isLoading && !generatedImageUrl && (\n                            <div className=\"text-center text-muted-foreground p-8\">\n                                <ImageIcon className=\"w-16 h-16 mx-auto mb-4\" />\n                                <h3 className=\"font-headline text-xl\">Output Canvas</h3>\n                                <p>Your edited image will appear here.</p>\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </div>\n            <div className=\"flex flex-col gap-2\">\n                <Input\n                    placeholder=\"Enter an editing prompt... (e.g., 'add a futuristic neon frame', 'turn this into a cyberpunk character')\"\n                    value={prompt}\n                    onChange={(e) => setPrompt(e.target.value)}\n                    className=\"bg-input text-base h-12\"\n                    disabled={isLoading}\n                />\n                <Button onClick={handleGenerate} disabled={isLoading || !baseImage} className=\"w-full cyber-button h-12 text-lg\">\n                    {isLoading ? (\n                        <>\n                            <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                            Generating...\n                        </>\n                    ) : (\n                        <>\n                            <Wand2 className=\"mr-2 h-5 w-5\" />\n                            Apply AI Edit\n                        </>\n                    )}\n                </Button>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":8071,"size_tokens":null},"src/hooks/use-audio-level.ts":{"content":"\n'use client';\n\nimport { useState, useEffect, useRef } from 'react';\n\nexport function useAudioLevel(stream: MediaStream | null): number {\n  const [audioLevel, setAudioLevel] = useState(0);\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const analyserRef = useRef<AnalyserNode | null>(null);\n  const dataArrayRef = useRef<Uint8Array | null>(null);\n  const animationFrameIdRef = useRef<number | null>(null);\n  const sourceRef = useRef<MediaStreamAudioSourceNode | null>(null);\n\n  useEffect(() => {\n    if (!stream) {\n      setAudioLevel(0);\n      return;\n    }\n\n    if (!audioContextRef.current) {\n        try {\n            audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n        } catch (e) {\n            console.error(\"Web Audio API is not supported in this browser.\", e);\n            return;\n        }\n    }\n    const audioContext = audioContextRef.current;\n\n    if (!analyserRef.current) {\n      analyserRef.current = audioContext.createAnalyser();\n      analyserRef.current.fftSize = 256;\n    }\n    const analyser = analyserRef.current;\n\n    if (!dataArrayRef.current) {\n      const bufferLength = analyser.frequencyBinCount;\n      dataArrayRef.current = new Uint8Array(bufferLength);\n    }\n    const dataArray = dataArrayRef.current;\n    \n    // Disconnect previous source if it exists\n    if (sourceRef.current) {\n        sourceRef.current.disconnect();\n    }\n\n    try {\n        sourceRef.current = audioContext.createMediaStreamSource(stream);\n        sourceRef.current.connect(analyser);\n    } catch (e) {\n        console.error(\"Error connecting media stream source:\", e);\n        return;\n    }\n    \n\n    const getAudioLevel = () => {\n      analyser.getByteFrequencyData(dataArray);\n      let sum = 0;\n      for (let i = 0; i < dataArray.length; i++) {\n        sum += dataArray[i];\n      }\n      const average = sum / dataArray.length;\n      setAudioLevel(average / 128); // Normalize to 0-2 range\n\n      animationFrameIdRef.current = requestAnimationFrame(getAudioLevel);\n    };\n\n    getAudioLevel();\n\n    return () => {\n      if (animationFrameIdRef.current) {\n        cancelAnimationFrame(animationFrameIdRef.current);\n      }\n      if (sourceRef.current) {\n        sourceRef.current.disconnect();\n        sourceRef.current = null;\n      }\n    };\n  }, [stream]);\n\n  return audioLevel;\n}\n","path":null,"size_bytes":2358,"size_tokens":null},"src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"src/components/ui/input.tsx":{"content":"import * as React from \"react\"\nimport { useCursor } from \"@/hooks/use-cursor\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, onMouseEnter, onMouseLeave, ...props }, ref) => {\n    const { setCursorMode } = useCursor();\n    \n    const handleMouseEnter = React.useCallback((e: React.MouseEvent<HTMLInputElement>) => {\n        setCursorMode('text');\n        onMouseEnter?.(e);\n    }, [setCursorMode, onMouseEnter]);\n\n    const handleMouseLeave = React.useCallback((e: React.MouseEvent<HTMLInputElement>) => {\n        setCursorMode('default');\n        onMouseLeave?.(e);\n    }, [setCursorMode, onMouseLeave]);\n\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":1409,"size_tokens":null},"src/components/dashboard/clock.tsx":{"content":"\n'use client';\n\nimport { useState, useEffect, useRef } from 'react';\n\nexport default function ClockWidget() {\n  const [time, setTime] = useState<Date | null>(null);\n  const animationFrameId = useRef<number>();\n\n  useEffect(() => {\n    const updateClock = () => {\n      setTime(new Date());\n      animationFrameId.current = requestAnimationFrame(updateClock);\n    };\n\n    // Start the animation frame loop\n    animationFrameId.current = requestAnimationFrame(updateClock);\n\n    // Clean up the animation frame when the component unmounts\n    return () => {\n      if (animationFrameId.current) {\n        cancelAnimationFrame(animationFrameId.current);\n      }\n    };\n  }, []); // The empty dependency array ensures this effect runs only once on mount\n\n  const formatDate = (date: Date) => {\n    return date.toLocaleDateString('en-US', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n    });\n  };\n\n  const seconds = time ? time.getSeconds() : 0;\n  const minutes = time ? time.getMinutes() : 0;\n  const hours = time ? time.getHours() : 0;\n\n  const secondHandRotation = seconds * 6;\n  const minuteHandRotation = minutes * 6 + seconds / 10;\n  const hourHandRotation = hours * 30 + minutes / 2;\n\n  // On the server, and during the initial client render before the effect runs,\n  // this loading state will be shown, preventing the mismatch.\n  if (time === null) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-full text-center\">\n        <p className=\"text-5xl font-code font-bold text-glow tracking-widest\">\n          --:--:-- --\n        </p>\n        <p className=\"text-sm text-muted-foreground mt-2\">Loading Chronometer...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col items-center justify-center h-full text-center gap-4\">\n        <div className=\"relative w-48 h-48 border-4 border-primary rounded-full flex items-center justify-center bg-background/50 neon-glow-primary\">\n            {/* Clock Face Markings */}\n            {[...Array(12)].map((_, i) => (\n                <div key={i} className=\"absolute w-full h-full\" style={{ transform: `rotate(${i * 30}deg)`}}>\n                    <div className=\"absolute top-1 left-1/2 -ml-[1px] h-2 w-[2px] bg-primary/50\"></div>\n                </div>\n            ))}\n            {/* Hour Hand */}\n            <div className=\"absolute w-1 h-16 bg-primary rounded-t-full origin-bottom\" style={{ transform: `rotate(${hourHandRotation}deg)`, top: '2rem' }}></div>\n             {/* Minute Hand */}\n            <div className=\"absolute w-0.5 h-20 bg-primary rounded-t-full origin-bottom\" style={{ transform: `rotate(${minuteHandRotation}deg)`, top: '1rem' }}></div>\n             {/* Second Hand */}\n            <div className=\"absolute w-0.5 h-20 bg-destructive rounded-t-full origin-bottom\" style={{ transform: `rotate(${secondHandRotation}deg)`, top: '1rem' }}></div>\n            {/* Center dot */}\n            <div className=\"absolute w-3 h-3 bg-foreground rounded-full border-2 border-background\"></div>\n        </div>\n        <p className=\"text-lg text-muted-foreground mt-2\">{formatDate(time)}</p>\n    </div>\n  );\n}\n","path":null,"size_bytes":3158,"size_tokens":null},"src/lib/event-emitter.ts":{"content":"\nimport { EventEmitter } from 'events';\n\nexport type Rarity = 'Common' | 'Rare' | 'Epic' | 'Cyber Rare' | 'Legendary' | 'Mythic';\n\nexport const appEventEmitter = new EventEmitter();\n","path":null,"size_bytes":182,"size_tokens":null},"src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\nimport { useCursor } from \"@/hooks/use-cursor\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, onMouseEnter, onMouseLeave, ...props }, ref) => {\n    const { setCursorMode } = useCursor();\n\n    const handleMouseEnter = React.useCallback((e: React.MouseEvent<HTMLTextAreaElement>) => {\n        setCursorMode('text');\n        onMouseEnter?.(e);\n    }, [setCursorMode, onMouseEnter]);\n\n    const handleMouseLeave = React.useCallback((e: React.MouseEvent<HTMLTextAreaElement>) => {\n        setCursorMode('default');\n        onMouseLeave?.(e);\n    }, [setCursorMode, onMouseLeave]);\n\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":1359,"size_tokens":null},"src/lib/data.ts":{"content":"import { PlaceHolderImages } from \"./placeholder-images\";\n\nexport const mockTasks = [\n    { id: 1, title: 'Infiltrate Arasaka Tower', status: 'in-progress', priority: 'High', dueDate: 'Tomorrow' },\n    { id: 2, title: 'Debug cyberdeck firmware', status: 'backlog', priority: 'Medium', dueDate: 'Next Week' },\n    { id: 3, title: 'Meet with Netrunner informant', status: 'done', priority: 'High', dueDate: 'Yesterday' },\n    { id: 4, title: 'Upgrade optical implants', status: 'backlog', priority: 'Low', dueDate: 'In 2 weeks' },\n  ];\n  \n  export const mockNotes = [\n    { id: 1, title: 'Night City Market Passcodes', content: 'Mainframe access: 7-3-4-5-1. Black market vendor: \"Chrome Tiger\". Mention my name.' },\n    { id: 2, title: 'Thoughts on AI sentience', content: 'Are they just complex algorithms, or is there a ghost in the machine? The Turing test seems outdated...' },\n    { id: 3, title: 'Cyberware Wishlist', content: 'Sandevistan Mk.5, Projectile Launch System, Gorilla Arms.' },\n  ];\n  \n  const users = {\n    '1': { name: 'Jaina', avatar: PlaceHolderImages.find(p => p.id === 'user-avatar-2')?.imageUrl ?? '' },\n    '2': { name: 'Kael', avatar: PlaceHolderImages.find(p => p.id === 'user-avatar-3')?.imageUrl ?? '' },\n    '3': { name: 'Sylvanas', avatar: PlaceHolderImages.find(p => p.id === 'user-avatar-4')?.imageUrl ?? '' },\n  }\n  \n  export const mockActivity = [\n    { id: 1, user: users['1'], action: 'sent a message in #general', type: 'chat', timestamp: '5 minutes ago' },\n    { id: 2, user: users['2'], action: 'completed task \"Decrypt Militech datashard\"', type: 'task', timestamp: '1 hour ago' },\n    { id: 3, user: users['3'], action: 'created a new note \"Safehouse Locations\"', type: 'note', timestamp: '3 hours ago' },\n    { id: 4, user: users['1'], action: 'added you as a contact', type: 'contact', timestamp: '1 day ago' },\n  ];\n  \n  export const mockKanbanData = {\n    columns: [\n      {\n        id: 'backlog',\n        title: 'Backlog',\n        tasks: [\n          { id: 'task-2', content: 'Debug cyberdeck firmware', priority: 'Medium' },\n          { id: 'task-4', content: 'Upgrade optical implants', priority: 'Low' },\n          { id: 'task-5', content: 'Source black-market ICE breaker', priority: 'High' },\n        ],\n      },\n      {\n        id: 'in-progress',\n        title: 'In Progress',\n        tasks: [\n          { id: 'task-1', content: 'Infiltrate Arasaka Tower', priority: 'High' },\n        ],\n      },\n      {\n        id: 'done',\n        title: 'Done',\n        tasks: [\n          { id: 'task-3', content: 'Meet with Netrunner informant', priority: 'High' },\n        ],\n      },\n    ],\n  };\n\nexport const EMOJI_LIST = ['👍', '❤️', '😂', '😮', '😢', '😠', '🔥', '✅', '🎉'];\n  \n","path":null,"size_bytes":2741,"size_tokens":null},"src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1159,"size_tokens":null},"src/components/dashboard/calendar-widget.tsx":{"content":"\n'use client';\nimport { Calendar as CalendarIcon, Clock } from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\n\nconst mockEvents = [\n  {\n    id: 1,\n    title: 'Cyberware Maintenance',\n    time: '14:00',\n    color: 'bg-secondary',\n  },\n  {\n    id: 2,\n    title: 'Team Sync: Project Overdrive',\n    time: '16:00',\n    color: 'bg-primary',\n  },\n  {\n    id: 3,\n    title: 'Meet with Fixer \"Whispers\"',\n    time: '19:30',\n    color: 'bg-destructive',\n  },\n];\n\nexport default function CalendarWidget() {\n  return (\n    <ScrollArea className=\"h-48\">\n        <div className=\"space-y-4\">\n        {mockEvents.map((event) => (\n            <div key={event.id} className=\"flex items-center gap-3\">\n            <div className={`w-1.5 h-10 rounded-full ${event.color}`}></div>\n            <div>\n                <p className=\"font-medium\">{event.title}</p>\n                <p className=\"text-sm text-muted-foreground flex items-center gap-1.5\">\n                    <Clock className=\"w-3 h-3\" />\n                    {event.time}\n                </p>\n            </div>\n            </div>\n        ))}\n        </div>\n    </ScrollArea>\n  );\n}\n","path":null,"size_bytes":1196,"size_tokens":null},"src/app/assistant/page.tsx":{"content":"'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { BrainCircuit } from \"lucide-react\";\nimport AssistantTool from '@/components/ai-hub/assistant-tool';\n\nexport default function AssistantPage() {\n  \n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-10rem)]\">\n        {/* Main Chat Window */}\n        <div className=\"lg:col-span-2 flex flex-col h-full\">\n            <AssistantTool />\n        </div>\n\n        {/* Right Sidebar */}\n        <div className=\"hidden lg:flex lg:col-span-1 flex-col gap-6\">\n            <Card>\n                 <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2 font-headline text-glow\">\n                      <BrainCircuit className=\"w-6 h-6 text-primary\"/>\n                      AI Context\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                   <p className=\"text-sm text-muted-foreground\">The AI Assistant has been moved to the new <a href=\"/ai-hub\" className=\"text-primary underline\">AI Hub</a>.</p>\n                   <p className=\"text-sm text-muted-foreground\">This page is now a minimal interface. For image generation and other tools, please visit the hub.</p>\n                </CardContent>\n            </Card>\n        </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1419,"size_tokens":null},"src/components/chat/ContactList.tsx":{"content":"\n'use client';\nimport { useState, useMemo, memo } from 'react';\nimport { Card, CardHeader, CardContent } from '@/components/ui/card';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Input } from '@/components/ui/input';\nimport { Search, Bot, Pin, Plus, Users, MessageSquarePlus, Info, Edit, UserPlus, LogOut, Trash2 } from 'lucide-react';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Contact } from '@/types/chat';\nimport { getDerivedStatus } from '@/lib/chat-utils';\nimport { cn } from '@/lib/utils';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport {\n  Tooltip,\n  TooltipProvider,\n  TooltipTrigger,\n  TooltipContent,\n} from \"@/components/ui/tooltip\";\nimport { PublicUser } from '@/hooks/use-connections';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport { useRouter } from 'next/navigation';\nimport { appEventEmitter } from '@/lib/event-emitter';\nimport ContactSelector from './ContactSelector';\n\ninterface ContactListProps {\n    contacts: Contact[];\n    pinnedContacts: Contact[];\n    selectedContact: Contact | null;\n    onSelectContact: (contact: Contact) => void;\n    loading: boolean;\n    isClient: boolean;\n    onCreateGroup: () => void;\n    connectedUsers: PublicUser[];\n}\n\nconst ContactItem = memo(({ contact, selectedContact, onSelectContact, isClient, onContextMenu, openHub, router, connectedUsers }: {\n    contact: Contact;\n    selectedContact: Contact | null;\n    onSelectContact: (contact: Contact) => void;\n    isClient: boolean;\n    onContextMenu: (e: React.MouseEvent, contact: Contact) => void;\n    openHub: (event: React.MouseEvent, context: { type: string; actions?: any[]; data?: any }) => void;\n    router: any;\n    connectedUsers: PublicUser[];\n}) => {\n    if (!contact || !contact.name) {\n      return null;\n    }\n\n    const realTimeUser = contact.type === 'user' ? connectedUsers.find(u => u.id === contact.id) : null;\n    const derivedStatus = realTimeUser ? getDerivedStatus(realTimeUser) : { label: contact.status || '...', color: 'bg-gray-500', isOnline: false };\n    \n    const initial = (contact.name ?? '?').charAt(0).toUpperCase();\n\n    return (\n        <div\n            className={cn(\n                \"flex items-center gap-3 p-2 rounded-md hover:bg-muted/50 cursor-pointer transition-colors\",\n                selectedContact?.id === contact.id ? 'bg-primary/20 neon-border-primary' : ''\n            )}\n            onClick={() => onSelectContact(contact)}\n            onContextMenu={(e) => onContextMenu(e, contact)}\n            data-command-hub-trigger\n        >\n            <div \n                className=\"relative\"\n                onContextMenu={(e) => {\n                    if (contact.type === 'user') {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        openHub(e, {\n                            type: 'user',\n                            data: {\n                                viewProfile: () => router.push(`/profile/${contact.id}`),\n                                sendMessage: () => router.push(`/chat?contactId=${contact.id}`),\n                                voiceCall: () => console.log('Voice call', contact.name),\n                                videoCall: () => console.log('Video call', contact.name),\n                                addFriend: () => console.log('Add friend', contact.name),\n                                createGroup: () => console.log('Create group with', contact.name),\n                                muteUser: () => console.log('Mute', contact.name),\n                                pinChat: () => console.log('Pin chat', contact.name),\n                                blockUser: () => console.log('Block', contact.name),\n                                reportUser: () => console.log('Report', contact.name),\n                                isFriend: true\n                            }\n                        });\n                    }\n                }}\n            >\n                <Avatar className=\"h-12 w-12 border-2 border-transparent\">\n                    {contact.type === 'bot' ? (\n                        <div className=\"w-full h-full flex items-center justify-center bg-primary/20 rounded-full\">\n                            <Bot className=\"w-6 h-6 text-primary\" />\n                        </div>\n                    ) : contact.type === 'group' ? (\n                        contact.avatar ? (\n                            <AvatarImage src={contact.avatar} />\n                        ) : (\n                            <div className=\"w-full h-full flex items-center justify-center bg-blue-500/20 rounded-full\">\n                                <Users className=\"w-6 h-6 text-blue-500\" />\n                            </div>\n                        )\n                    ) : (\n                        <AvatarImage src={realTimeUser?.photoURL || contact.avatar || undefined} />\n                    )}\n                    <AvatarFallback>{initial}</AvatarFallback>\n                </Avatar>\n                {contact.type === 'user' && (\n                    <TooltipProvider>\n                        <Tooltip>\n                            <TooltipTrigger asChild>\n                                <div className={cn(\"absolute bottom-0 right-0 w-3.5 h-3.5 rounded-full border-2 border-background\", derivedStatus.color)}></div>\n                            </TooltipTrigger>\n                            <TooltipContent><p>{derivedStatus.label}</p></TooltipContent>\n                        </Tooltip>\n                    </TooltipProvider>\n                )}\n            </div>\n            <div className=\"flex-1\">\n                <p className=\"font-semibold text-base\">{realTimeUser?.displayName || contact.name}</p>\n                <p className=\"text-sm text-muted-foreground line-clamp-1\">\n                    {contact.type === 'bot' ? \"AI Assistant\" : \n                     contact.type === 'group' ? contact.status :\n                     derivedStatus.label}\n                </p>\n            </div>\n        </div>\n    )\n});\nContactItem.displayName = 'ContactItem';\n\nexport default function ContactList({ contacts, pinnedContacts, selectedContact, onSelectContact, loading, isClient, onCreateGroup, connectedUsers }: ContactListProps) {\n    const [searchTerm, setSearchTerm] = useState('');\n    const [showContactSelector, setShowContactSelector] = useState(false);\n    const { openHub, setTargetElement } = useCommandHub();\n    const router = useRouter();\n\n    const filteredContacts = useMemo(() => {\n        if (!searchTerm) return contacts;\n        return contacts.filter(contact =>\n            contact.name.toLowerCase().includes(searchTerm.toLowerCase())\n        );\n    }, [contacts, searchTerm]);\n    \n    const handleContactContextMenu = (e: React.MouseEvent, contact: Contact) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setTargetElement(e.currentTarget as HTMLElement);\n        \n        const isPinned = pinnedContacts.some(p => p.id === contact.id);\n\n        let actions = [];\n        if (contact.type === 'user') {\n            const publicUser = connectedUsers.find(u => u.id === contact.id);\n            actions.push(\n                { label: 'View Profile', icon: 'User' as const, onClick: () => router.push(`/profile/${contact.id}`) },\n                { label: 'Send Message', icon: 'MessageSquare' as const, onClick: () => router.push(`/chat?contactId=${contact.id}`) },\n                { label: isPinned ? 'Unpin User' : 'Pin User', icon: 'Pin' as const, onClick: () => publicUser && appEventEmitter.emit('ui:pin-user', publicUser) },\n            );\n        } else if (contact.type === 'group') {\n            actions.push(\n                { label: 'Group Info', icon: 'Info' as const, onClick: () => appEventEmitter.emit('group:show-info', contact) },\n                { label: 'Edit Group', icon: 'Edit' as const, onClick: () => appEventEmitter.emit('group:edit', contact) },\n                { label: 'Add Members', icon: 'UserPlus' as const, onClick: () => appEventEmitter.emit('group:add-members', contact) },\n                { label: isPinned ? 'Unpin Group' : 'Pin Group', icon: 'Pin' as const, onClick: () => {} },\n                { label: 'Leave Group', icon: 'LogOut' as const, onClick: () => appEventEmitter.emit('group:leave', contact) },\n                { label: 'Delete Group', icon: 'Trash2' as const, onClick: () => appEventEmitter.emit('group:delete', contact) },\n            );\n        } else {\n             actions.push(\n                { label: 'View Bot Info', icon: 'Bot' as const, onClick: () => {} },\n             );\n        }\n\n        openHub(e, {\n            type: contact.type === 'group' ? 'group-contact' : 'user-contact',\n            data: contact,\n            actions: actions,\n        });\n    };\n\n    return (\n        <Card className=\"hidden lg:flex lg:flex-col h-full\">\n            <CardHeader>\n                <div className=\"space-y-3\">\n                    <div className=\"flex gap-2\">\n                        <button\n                            onClick={onCreateGroup}\n                            className=\"flex-1 flex items-center justify-center gap-2 p-2 bg-primary/10 hover:bg-primary/20 rounded-lg transition-colors text-sm font-medium\"\n                        >\n                            <Users className=\"w-4 h-4\" />\n                            New Group\n                        </button>\n                        <button\n                            onClick={() => setShowContactSelector(true)}\n                            className=\"flex-1 flex items-center justify-center gap-2 p-2 bg-secondary/10 hover:bg-secondary/20 rounded-lg transition-colors text-sm font-medium\"\n                        >\n                            <MessageSquarePlus className=\"w-4 h-4\" />\n                            Contact List\n                        </button>\n                    </div>\n                    <div className=\"relative\">\n                        <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                            placeholder=\"Search connections...\"\n                            className=\"pl-8 bg-input\"\n                            value={searchTerm}\n                            onChange={e => setSearchTerm(e.target.value)}\n                        />\n                    </div>\n                </div>\n            </CardHeader>\n            <CardContent className=\"flex-1 p-0 flex flex-col min-h-0\">\n                <ScrollArea className=\"h-full\">\n                    <div className=\"p-4 pt-0 space-y-1\">\n                        {loading ? (\n                            Array.from({ length: 3 }).map((_, i) => (\n                                <div key={i} className=\"flex items-center space-x-4 p-2\">\n                                    <Skeleton className=\"h-12 w-12 rounded-full\" />\n                                    <div className=\"space-y-2\">\n                                        <Skeleton className=\"h-4 w-[150px]\" />\n                                        <Skeleton className=\"h-4 w-[100px]\" />\n                                    </div>\n                                </div>\n                            ))\n                        ) : (\n                            <>\n                                {pinnedContacts.length > 0 && (\n                                    <div className=\"mb-4\">\n                                        <h3 className=\"text-xs font-semibold uppercase text-muted-foreground px-2 py-1 flex items-center gap-2\"><Pin className=\"w-3 h-3\"/> Pinned</h3>\n                                        {pinnedContacts.filter(Boolean).map(contact => (\n                                             <ContactItem key={`pinned-${contact.id}`} contact={contact} selectedContact={selectedContact} onSelectContact={onSelectContact} isClient={isClient} onContextMenu={handleContactContextMenu} openHub={openHub} router={router} connectedUsers={connectedUsers} />\n                                        ))}\n                                    </div>\n                                )}\n                                {filteredContacts.filter(c => c && c.id).map((contact) => (\n                                   <ContactItem key={contact.id} contact={contact} selectedContact={selectedContact} onSelectContact={onSelectContact} isClient={isClient} onContextMenu={handleContactContextMenu} openHub={openHub} router={router} connectedUsers={connectedUsers} />\n                                ))}\n                            </>\n                        )}\n                    </div>\n                </ScrollArea>\n            </CardContent>\n            <ContactSelector\n                open={showContactSelector}\n                onOpenChange={setShowContactSelector}\n                contacts={contacts}\n                onSelectContact={onSelectContact}\n            />\n        </Card>\n    );\n}\n","path":null,"size_bytes":12880,"size_tokens":null},"backend/src/routes/calls.ts":{"content":"import { Router } from 'express';\nimport { authenticateToken } from '../middleware/auth';\nimport { WebRTCService } from '../services/webrtcService';\n\nconst router = Router();\nconst webrtcService = new WebRTCService();\n\nrouter.post('/offer', authenticateToken, async (req, res) => {\n  try {\n    const { callId, offer } = req.body;\n    await webrtcService.createOffer(callId, offer);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post('/answer', authenticateToken, async (req, res) => {\n  try {\n    const { callId, answer } = req.body;\n    await webrtcService.createAnswer(callId, answer);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post('/candidate', authenticateToken, async (req, res) => {\n  try {\n    const { callId, candidate } = req.body;\n    await webrtcService.addIceCandidate(callId, candidate);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get('/offer/:callId', authenticateToken, async (req, res) => {\n  try {\n    const offer = await webrtcService.getOffer(req.params.callId);\n    res.json({ offer });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get('/answer/:callId', authenticateToken, async (req, res) => {\n  try {\n    const answer = await webrtcService.getAnswer(req.params.callId);\n    res.json({ answer });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nexport default router;","path":null,"size_bytes":1623,"size_tokens":null},"src/components/ai-hub/profile-enhancer-tool.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { enhanceProfile, EnhanceProfileInput, EnhanceProfileOutput } from '@/ai/flows/enhance-profile-flow';\nimport { Loader2, Sparkles, User, Lightbulb, Palette } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { Card, CardContent, CardHeader, CardTitle } from '../ui/card';\nimport { Badge } from '../ui/badge';\n\nexport default function ProfileEnhancerTool() {\n    const [interests, setInterests] = useState('');\n    const [result, setResult] = useState<EnhanceProfileOutput | null>(null);\n    const [isLoading, setIsLoading] = useState(false);\n    const { toast } = useToast();\n\n    const handleGenerate = async () => {\n        if (!interests.trim()) {\n            toast({\n                variant: 'destructive',\n                title: 'Input is empty',\n                description: 'Please enter some interests to generate a profile.',\n            });\n            return;\n        }\n        setIsLoading(true);\n        setResult(null);\n        try {\n            const input: EnhanceProfileInput = { interests };\n            const response = await enhanceProfile(input);\n            setResult(response);\n        } catch (error) {\n            console.error('Profile enhancement failed:', error);\n            toast({\n                variant: 'destructive',\n                title: 'Generation Failed',\n                description: 'Could not enhance profile. Please try again.',\n            });\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"flex flex-col h-full border rounded-lg bg-background/30 p-4 gap-4\">\n            <div className=\"flex-1 flex flex-col items-center justify-center bg-muted/30 rounded-lg border-2 border-dashed border-border overflow-auto p-6\">\n                {isLoading && (\n                    <div className=\"flex flex-col items-center gap-4 text-primary\">\n                        <Loader2 className=\"w-12 h-12 animate-spin\" />\n                        <p className=\"font-headline text-glow\">Analyzing personality matrix...</p>\n                    </div>\n                )}\n                {!isLoading && result && (\n                    <div className=\"w-full space-y-6 animate-in fade-in-50\">\n                        <Card className=\"glass-card\">\n                            <CardHeader>\n                                <CardTitle className=\"flex items-center gap-2\"><User className=\"text-primary\"/> Suggested Bio</CardTitle>\n                            </CardHeader>\n                            <CardContent>\n                                <p className=\"text-lg\">{result.bio}</p>\n                            </CardContent>\n                        </Card>\n                         <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <Card className=\"glass-card\">\n                                <CardHeader>\n                                    <CardTitle className=\"flex items-center gap-2\"><Sparkles className=\"text-primary\"/> Aura</CardTitle>\n                                </CardHeader>\n                                <CardContent>\n                                    <Badge variant=\"secondary\" className=\"text-2xl font-bold tracking-widest uppercase bg-secondary/20 border-2 border-secondary neon-border-secondary\">{result.auraPersonality}</Badge>\n                                </CardContent>\n                            </Card>\n                             <Card className=\"glass-card\">\n                                <CardHeader>\n                                    <CardTitle className=\"flex items-center gap-2\"><Palette className=\"text-primary\"/> Theme</CardTitle>\n                                </CardHeader>\n                                <CardContent>\n                                    <p className=\"text-xl font-bold text-glow\">{result.suggestedTheme}</p>\n                                </CardContent>\n                            </Card>\n                        </div>\n                        <Card className=\"glass-card\">\n                            <CardHeader>\n                                <CardTitle className=\"flex items-center gap-2\"><Lightbulb className=\"text-primary\"/> Suggested Interests</CardTitle>\n                            </CardHeader>\n                            <CardContent className=\"flex flex-wrap gap-2\">\n                                {result.suggestedInterests.map(interest => (\n                                    <Badge key={interest} variant=\"outline\">{interest}</Badge>\n                                ))}\n                            </CardContent>\n                        </Card>\n                    </div>\n                )}\n                {!isLoading && !result && (\n                     <div className=\"text-center text-muted-foreground p-8\">\n                        <Sparkles className=\"w-16 h-16 mx-auto mb-4\" />\n                        <h3 className=\"font-headline text-xl\">AI Profile Enhancer</h3>\n                        <p>Enter a few interests below and let the AI craft a unique cyberpunk identity for you.</p>\n                    </div>\n                )}\n            </div>\n            <div className=\"flex flex-col gap-2\">\n                <Input\n                    placeholder=\"Describe your interests... (e.g., 'hacking, synth music, classic anime')\"\n                    value={interests}\n                    onChange={(e) => setInterests(e.target.value)}\n                    className=\"bg-input text-base h-12\"\n                    disabled={isLoading}\n                />\n                <Button onClick={handleGenerate} disabled={isLoading} className=\"w-full cyber-button h-12 text-lg\">\n                    {isLoading ? (\n                        <>\n                            <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                            Generating...\n                        </>\n                    ) : (\n                        <>\n                            <Sparkles className=\"mr-2 h-5 w-5\" />\n                            Enhance Profile\n                        </>\n                    )}\n                </Button>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":6241,"size_tokens":null},"src/components/user/user-popover.tsx":{"content":"\n'use client';\n\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport { PublicUser, useConnections, Connection } from '@/hooks/use-connections';\nimport { useUser, UserProfile } from '@/hooks/use-user';\nimport {\n  MessageSquare,\n  User,\n  UserPlus,\n  Loader2,\n  Users,\n  MoreHorizontal,\n  UserCheck,\n  Clock,\n  UserX,\n} from 'lucide-react';\nimport Link from 'next/link';\nimport { cn } from '@/lib/utils';\nimport { Skeleton } from '../ui/skeleton';\nimport { doc, onSnapshot } from 'firebase/firestore';\nimport { useFirestore } from '@/firebase/provider';\nimport React, { useState, useMemo, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\n\n\ninterface UserPopoverProps {\n  user: PublicUser;\n  children: React.ReactNode;\n}\n\nexport default function UserPopover({ user: targetUser, children }: UserPopoverProps) {\n  const { user: currentUser } = useUser();\n  const { connections, sendFriendRequest, acceptFriendRequest, removeConnection, loading: connectionsLoading } = useConnections();\n  const { toast } = useToast();\n  const router = useRouter();\n  const [actionLoading, setActionLoading] = useState(false);\n\n  const connectionStatus = useMemo(() => {\n    if (!currentUser || !targetUser || currentUser.uid === targetUser.id) return 'self';\n    const connection = connections.find(c => c.id === targetUser.id);\n    if (!connection) return 'not_connected';\n    return connection.status;\n  }, [connections, currentUser, targetUser]);\n\n  const handleSendRequest = async () => {\n      if (!targetUser) return;\n      setActionLoading(true);\n      try {\n          await sendFriendRequest(targetUser.id);\n          toast({ title: 'Success', description: 'Friend request sent.'});\n      } catch (error: any) {\n          toast({ variant: 'destructive', title: 'Error', description: error.message });\n      } finally {\n          setActionLoading(false);\n      }\n  }\n\n  const renderConnectionButton = () => {\n    if (connectionsLoading) return <Skeleton className=\"h-9 w-24\" />;\n\n    const connection = connections.find(c => c.id === targetUser?.id);\n\n    switch (connectionStatus) {\n        case 'friends':\n            return <Button size=\"sm\" variant=\"secondary\" disabled><UserCheck className=\"mr-2 h-4 w-4\"/> Friends</Button>;\n        case 'pending':\n             return <Button size=\"sm\" variant=\"secondary\" disabled><Clock className=\"mr-2 h-4 w-4\"/> Pending</Button>;\n        case 'not_connected':\n            return <Button size=\"sm\" onClick={handleSendRequest} disabled={actionLoading}>\n                    {actionLoading ? <Loader2 className=\"animate-spin mr-2 h-4 w-4\"/> : <UserPlus className=\"mr-2 h-4 w-4\"/>}\n                    Add Friend\n                </Button>;\n        case 'self':\n            return null;\n        default:\n            return null;\n    }\n  }\n  \n  if (!targetUser || currentUser?.uid === targetUser.id) return <>{children}</>;\n\n  return (\n    <Popover>\n       <PopoverTrigger asChild onClick={(e) => e.stopPropagation()}>\n          {children}\n       </PopoverTrigger>\n      <PopoverContent className=\"w-80 border-primary/20 p-0\" onClick={(e) => e.stopPropagation()}>\n        <div className=\"p-4\">\n          <div className=\"flex items-center gap-4\">\n            <Avatar className=\"w-16 h-16 border-2 border-primary\">\n              <AvatarImage src={targetUser.photoURL || undefined} />\n              <AvatarFallback>{targetUser.displayName?.[0] || '?'}</AvatarFallback>\n            </Avatar>\n            <div className=\"space-y-1\">\n              <h3 className=\"text-xl font-bold font-headline text-glow\">\n                {targetUser.displayName}\n              </h3>\n              <p className=\"text-sm text-muted-foreground\">@{targetUser.username}</p>\n            </div>\n          </div>\n          <div className=\"mt-4 text-xs space-y-1 text-muted-foreground\">\n             <p className=\"flex items-center gap-2\"><Users className=\"w-4 h-4\"/> N/A Mutual Friends</p>\n             <p className=\"flex items-center gap-2\"><Users className=\"w-4 h-4\"/> N/A Mutual Spaces</p>\n          </div>\n        </div>\n\n        <div className=\"border-t border-border p-2 flex items-center gap-2\">\n             <Button className=\"flex-1\" size=\"sm\" asChild>\n                <Link href={`/chat?contactId=${targetUser.id}`}>\n                    <MessageSquare className=\"mr-2 h-4 w-4\"/> Message\n                </Link>\n            </Button>\n            {renderConnectionButton()}\n             <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                        <MoreHorizontal className=\"h-4 w-4\"/>\n                    </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\">\n                    <DropdownMenuItem onClick={() => router.push(`/profile/${targetUser.id}`)}>View Full Profile</DropdownMenuItem>\n                    <DropdownMenuItem disabled>Invite to Space</DropdownMenuItem>\n                    <DropdownMenuItem className=\"text-destructive focus:text-destructive focus:bg-destructive/10\" disabled>Block User</DropdownMenuItem>\n                </DropdownMenuContent>\n            </DropdownMenu>\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}\n","path":null,"size_bytes":5572,"size_tokens":null},"src/components/layout/loader.tsx":{"content":"\n'use client';\nimport { useEffect, useState, useRef, useMemo } from 'react';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { useLoading } from '@/hooks/use-loading';\nimport LoadingBar from './loading-bar';\nimport TutorialPopup from './tutorial-popup';\nimport { tutorialContent } from '@/lib/tutorial-content';\nimport { appEventEmitter } from '@/lib/event-emitter';\n\ninterface PopupState {\n  id: number;\n  content: { title: string; description: string; icon: any };\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nconst POPUP_WIDTH = 220;\nconst POPUP_HEIGHT = 100;\nconst PADDING = 20;\n\nexport default function Loader() {\n  const { isLoading, progress, tutorialPageId } = useLoading();\n  const [popups, setPopups] = useState<PopupState[]>([]);\n  const popupIntervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  const tutorialSteps = useMemo(() => {\n    return tutorialPageId ? tutorialContent[tutorialPageId] : [];\n  }, [tutorialPageId]);\n\n  const doesCollide = (newPopup: Omit<PopupState, 'id' | 'content'>, existingPopups: PopupState[]) => {\n    for (const p of existingPopups) {\n      if (\n        newPopup.x < p.x + p.width &&\n        newPopup.x + newPopup.width > p.x &&\n        newPopup.y < p.y + p.height &&\n        newPopup.y + newPopup.height > p.y\n      ) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  useEffect(() => {\n    if (isLoading && tutorialSteps.length > 0) {\n      let stepIndex = 0;\n\n      const spawnPopup = () => {\n        if (stepIndex >= tutorialSteps.length) {\n          if (popupIntervalRef.current) clearInterval(popupIntervalRef.current);\n          return;\n        }\n\n        const content = tutorialSteps[stepIndex];\n        let newPopup: Omit<PopupState, 'id' | 'content'>;\n        let attempts = 0;\n\n        do {\n          newPopup = {\n            x: PADDING + Math.random() * (window.innerWidth - POPUP_WIDTH - PADDING * 2),\n            y: PADDING + Math.random() * (window.innerHeight - POPUP_HEIGHT - PADDING * 2),\n            width: POPUP_WIDTH + 2 * PADDING,\n            height: POPUP_HEIGHT + 2 * PADDING,\n          };\n          attempts++;\n        } while (doesCollide(newPopup, popups) && attempts < 50);\n\n        setPopups(prev => [...prev, { ...newPopup, id: Date.now(), content }]);\n        appEventEmitter.emit('ui:sound', 'success');\n\n        stepIndex++;\n      };\n\n      spawnPopup();\n      popupIntervalRef.current = setInterval(spawnPopup, 700);\n\n    } else if (!isLoading) {\n      if (popupIntervalRef.current) clearInterval(popupIntervalRef.current);\n      setPopups([]);\n    }\n\n    return () => {\n      if (popupIntervalRef.current) clearInterval(popupIntervalRef.current);\n    };\n  }, [isLoading, tutorialSteps]); // Removed popups from dependencies\n\n  return (\n    <AnimatePresence>\n      {isLoading && (\n        <motion.div\n          className=\"fixed inset-0 z-[100] flex items-center justify-center bg-background pointer-events-none\"\n          initial={{ opacity: 1 }}\n          exit={{ opacity: 0, transition: { duration: 0.5 } }}\n        >\n          <div className=\"absolute top-0 left-0 w-full h-full\">\n            <AnimatePresence>\n              {popups.map(popup => (\n                <TutorialPopup key={popup.id} {...popup} />\n              ))}\n            </AnimatePresence>\n          </div>\n          \n          <LoadingBar progress={progress} />\n          \n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":3431,"size_tokens":null},"src/hooks/use-loading.ts":{"content":"\n'use client';\n\nimport { createContext, useContext } from 'react';\n\nexport type TutorialPageId = 'auth-check' | 'dashboard' | 'chat' | 'news';\n\nexport interface LoadingContextType {\n    isLoading: boolean;\n    progress: number;\n    tutorialPageId: TutorialPageId | null;\n    startPageLoad: (pageId: TutorialPageId) => void;\n    finishPageLoad: (path: string) => void;\n}\n\nexport const LoadingContext = createContext<LoadingContextType | undefined>(undefined);\n\nexport const useLoading = () => {\n    const context = useContext(LoadingContext);\n    if (!context) {\n        throw new Error('useLoading must be used within a LoadingProvider');\n    }\n    return context;\n};\n","path":null,"size_bytes":668,"size_tokens":null},"src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7433,"size_tokens":null},"src/app/gaming/layout.tsx":{"content":"\n'use client';\nimport React from 'react';\nimport GamingSidebar from './components/GamingSidebar';\nimport GamingNavbar from './components/GamingNavbar';\nimport { useUser } from '@/hooks/use-user';\nimport { cn } from '@/lib/utils';\nimport { useTheme } from '@/components/providers/ThemeProvider';\n\nexport default function GamingLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const { profile } = useUser();\n  const [isPerfMode, setIsPerfMode] = React.useState(false);\n  const [activeSpace, setActiveSpace] = React.useState<string | null>('aetherweave-hq');\n\n  React.useEffect(() => {\n    if (profile?.settings?.gaming?.performanceMode) {\n      setIsPerfMode(profile.settings.gaming.performanceMode);\n    }\n  }, [profile]);\n  \n  React.useEffect(() => {\n    const root = document.documentElement;\n    if (!root) return;\n\n    if (isPerfMode) {\n        root.classList.add('perf-mode');\n    } else {\n        root.classList.remove('perf-mode');\n    }\n  }, [isPerfMode]);\n\n  const childrenWithProps = React.Children.map(children, child => {\n    if (React.isValidElement(child)) {\n      return React.cloneElement(child, { activeSpace } as any);\n    }\n    return child;\n  });\n\n  return (\n    <div className={cn(\"flex flex-col h-screen bg-background text-foreground\")}>\n      <GamingNavbar activeSpace={activeSpace} setActiveSpace={setActiveSpace} />\n      <main className=\"flex flex-1 overflow-hidden\">\n        <GamingSidebar />\n        {childrenWithProps}\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":1492,"size_tokens":null},"src/ai/flows/generate-image-from-image-flow.ts":{"content":"'use server';\n/**\n * @fileOverview Generates an image from a base image and a text prompt using Genkit.\n *\n * - generateImageFromImage - A function that generates an image from a base image and a text prompt.\n * - GenerateImageFromImageInput - The input type for the function.\n * - GenerateImageFromImageOutput - The return type for the function.\n */\n\nimport { ai } from '@/ai/genkit';\nimport { z } from 'genkit';\n\nconst GenerateImageFromImageInputSchema = z.object({\n  prompt: z.string().describe('A detailed text prompt describing the desired modifications to the image.'),\n  baseImage: z.string().describe(\"The base image to modify, as a data URI that must include a MIME type and use Base64 encoding. Expected format: 'data:<mimetype>;base64,<encoded_data>'.\"),\n});\nexport type GenerateImageFromImageInput = z.infer<typeof GenerateImageFromImageInputSchema>;\n\nconst GenerateImageFromImageOutputSchema = z.object({\n  imageUrl: z.string().describe('The data URI of the generated image.'),\n});\nexport type GenerateImageFromImageOutput = z.infer<typeof GenerateImageFromImageOutputSchema>;\n\nexport async function generateImageFromImage(input: GenerateImageFromImageInput): Promise<GenerateImageFromImageOutput> {\n  return generateImageFromImageFlow(input);\n}\n\nconst generateImageFromImageFlow = ai.defineFlow(\n  {\n    name: 'generateImageFromImageFlow',\n    inputSchema: GenerateImageFromImageInputSchema,\n    outputSchema: GenerateImageFromImageOutputSchema,\n  },\n  async ({ prompt, baseImage }) => {\n    const { media } = await ai.generate({\n      model: 'googleai/gemini-2.5-flash-image-preview',\n      prompt: [\n        { media: { url: baseImage } },\n        { text: prompt },\n      ],\n      config: {\n        // IMPORTANT: You must specify both TEXT and IMAGE as response modalities for this model.\n        responseModalities: ['TEXT', 'IMAGE'],\n      },\n    });\n\n    if (!media || !media.url) {\n      throw new Error('Image generation failed to return a URL.');\n    }\n\n    return {\n      imageUrl: media.url,\n    };\n  }\n);\n","path":null,"size_bytes":2029,"size_tokens":null},"src/hooks/use-tab-card.ts":{"content":"'use client';\n\nimport { useEffect } from 'react';\nimport { tabCardEnhancer } from '@/lib/tab-card-enhancer';\n\nexport function useTabCard() {\n  useEffect(() => {\n    // Initialize with cyberpunk blue\n    tabCardEnhancer.setTabColor('#00ffff');\n    \n    return () => {\n      tabCardEnhancer.reset();\n    };\n  }, []);\n\n  const setColor = (color: string, textColor?: string) => {\n    tabCardEnhancer.setTabColor(color, textColor);\n  };\n\n  const startColorCycle = (colors?: string[]) => {\n    tabCardEnhancer.startColorCycle(colors);\n  };\n\n  const startPulse = (baseColor?: string) => {\n    tabCardEnhancer.startPulse(baseColor);\n  };\n\n  const startRainbow = () => {\n    tabCardEnhancer.startRainbow();\n  };\n\n  const startGlitch = () => {\n    tabCardEnhancer.startGlitch();\n  };\n\n  const setActivity = (type: 'loading' | 'error' | 'success' | 'warning') => {\n    tabCardEnhancer.setActivity(type);\n  };\n\n  const flashNotification = (count?: number) => {\n    tabCardEnhancer.flashNotification(count);\n  };\n\n  const stopEffects = () => {\n    tabCardEnhancer.stopEffects();\n  };\n\n  const reset = () => {\n    tabCardEnhancer.reset();\n  };\n\n  return {\n    setColor,\n    startColorCycle,\n    startPulse,\n    startRainbow,\n    startGlitch,\n    setActivity,\n    flashNotification,\n    stopEffects,\n    reset,\n  };\n}","path":null,"size_bytes":1302,"size_tokens":null},"src/hooks/use-notes.ts":{"content":"\n'use client';\n\nimport { useState, useEffect, useMemo, useCallback } from 'react';\nimport {\n  collection,\n  query,\n  where,\n  onSnapshot,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  doc,\n  serverTimestamp,\n  orderBy,\n  Timestamp,\n  writeBatch,\n} from 'firebase/firestore';\nimport { useFirestore } from '@/firebase/provider';\nimport { useUser } from '@/hooks/use-user';\n\nexport interface Note {\n  id: string;\n  title: string;\n  content: string;\n  category: string;\n  tags: string[];\n  pinned: boolean;\n  userId: string;\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n}\n\nexport function useNotes() {\n  const firestore = useFirestore();\n  const { user, incrementStat } = useUser();\n  const [notes, setNotes] = useState<Note[]>([]);\n  const [loading, setLoading] = useState(true);\n\n\n  const notesCollection = useMemo(() => {\n    if (!firestore) return null;\n    return collection(firestore, 'notes');\n  }, [firestore]);\n\n  useEffect(() => {\n    if (!user || !notesCollection) {\n      setNotes([]);\n      setLoading(false);\n      return;\n    };\n\n    setLoading(true);\n    const q = query(\n      notesCollection, \n      where('userId', '==', user.uid)\n    );\n\n    const unsubscribe = onSnapshot(q, (querySnapshot) => {\n      const notesData: Note[] = [];\n      querySnapshot.forEach((doc) => {\n        notesData.push({ id: doc.id, ...doc.data() } as Note);\n      });\n      // Perform sorting on the client-side\n      notesData.sort((a, b) => {\n        // Pinned notes first\n        if (a.pinned && !b.pinned) return -1;\n        if (!a.pinned && b.pinned) return 1;\n        // Then sort by updatedAt descending\n        if (b.updatedAt && a.updatedAt) {\n          return b.updatedAt.toMillis() - a.updatedAt.toMillis();\n        }\n        return 0;\n      });\n      setNotes(notesData);\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [user, notesCollection]);\n\n  const addNote = async (noteData: Omit<Note, 'id' | 'userId' | 'createdAt' | 'updatedAt'>) => {\n    if (!user || !notesCollection) throw new Error('User not logged in or firestore not available');\n    \n    await incrementStat('notesCreated', 1);\n\n    const docRef = await addDoc(notesCollection, {\n      ...noteData,\n      userId: user.uid,\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp(),\n    });\n    return docRef;\n  };\n\n  const updateNote = async (noteId: string, noteData: Partial<Omit<Note, 'id' | 'userId' | 'createdAt'>>) => {\n    if (!firestore) throw new Error('Firestore not available');\n    const noteRef = doc(firestore, 'notes', noteId);\n    await updateDoc(noteRef, {\n        ...noteData,\n        updatedAt: serverTimestamp(),\n    });\n  };\n\n  const deleteNote = async (noteId: string) => {\n    if (!firestore) throw new Error('Firestore not available');\n    const noteRef = doc(firestore, 'notes', noteId);\n    await deleteDoc(noteRef);\n  };\n  \n  const bulkDeleteNotes = async (noteIds: string[]) => {\n    if (!firestore) throw new Error(\"Firestore not available\");\n    const batch = writeBatch(firestore);\n    noteIds.forEach(id => {\n      const noteRef = doc(firestore, 'notes', id);\n      batch.delete(noteRef);\n    });\n    await batch.commit();\n  }\n\n  return { notes, loading, addNote, updateNote, deleteNote, bulkDeleteNotes };\n}\n","path":null,"size_bytes":3243,"size_tokens":null},"backend/src/controllers/userController.ts":{"content":"import { Request, Response } from 'express';\nimport { db } from '../config/firebase';\nimport { AuthenticatedRequest } from '../middleware/auth';\nimport { z } from 'zod';\n\nconst updateProfileSchema = z.object({\n  displayName: z.string().min(1).max(50).optional(),\n  bio: z.string().max(500).optional(),\n  theme: z.string().optional(),\n  preferences: z.object({\n    notifications: z.boolean().optional(),\n    darkMode: z.boolean().optional(),\n    language: z.string().optional(),\n  }).optional(),\n});\n\nexport const getUserProfile = async (req: AuthenticatedRequest, res: Response) => {\n  try {\n    const { uid } = req.user!;\n    const userDoc = await db.collection('users').doc(uid).get();\n    \n    if (!userDoc.exists) {\n      return res.status(404).json({ error: 'User not found' });\n    }\n\n    const userData = userDoc.data();\n    res.json({\n      uid,\n      ...userData,\n      createdAt: userData?.createdAt?.toDate(),\n      updatedAt: userData?.updatedAt?.toDate(),\n    });\n  } catch (error) {\n    console.error('Error fetching user profile:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n};\n\nexport const updateUserProfile = async (req: AuthenticatedRequest, res: Response) => {\n  try {\n    const { uid } = req.user!;\n    const validatedData = updateProfileSchema.parse(req.body);\n\n    await db.collection('users').doc(uid).update({\n      ...validatedData,\n      updatedAt: new Date(),\n    });\n\n    res.json({ message: 'Profile updated successfully' });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return res.status(400).json({ error: 'Invalid data', details: error.errors });\n    }\n    console.error('Error updating user profile:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n};\n\nexport const getUserStats = async (req: AuthenticatedRequest, res: Response) => {\n  try {\n    const { uid } = req.user!;\n    \n    // Get user's notes count\n    const notesSnapshot = await db.collection('notes').where('userId', '==', uid).get();\n    const notesCount = notesSnapshot.size;\n\n    // Get user's connections count\n    const connectionsSnapshot = await db.collection('connections').where('userId', '==', uid).get();\n    const connectionsCount = connectionsSnapshot.size;\n\n    // Get user's tasks count\n    const tasksSnapshot = await db.collection('tasks').where('userId', '==', uid).get();\n    const tasksCount = tasksSnapshot.size;\n\n    res.json({\n      notesCount,\n      connectionsCount,\n      tasksCount,\n      lastActive: new Date(),\n    });\n  } catch (error) {\n    console.error('Error fetching user stats:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n};","path":null,"size_bytes":2667,"size_tokens":null},"src/app/page.tsx":{"content":"'use client';\n\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useUser } from '@/hooks/use-user';\nimport { Loader2 } from 'lucide-react';\n\nexport default function RootPage() {\n  const router = useRouter();\n  const { user, loading } = useUser();\n\n  useEffect(() => {\n    if (!loading) {\n      if (user) {\n        router.replace('/apps');\n      } else {\n        router.replace('/login');\n      }\n    }\n  }, [user, loading, router]);\n\n  return (\n    <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-background\">\n      <div className=\"flex flex-col items-center gap-2\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        <p className=\"text-sm text-primary\">Loading...</p>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":788,"size_tokens":null},"DEPLOYMENT.md":{"content":"# Vercel Deployment Guide\n\n## Frontend Deployment\n\n### 1. Push to GitHub\n```bash\ngit init\ngit add .\ngit commit -m \"Initial commit\"\ngit remote add origin <your-github-repo-url>\ngit push -u origin main\n```\n\n### 2. Deploy Frontend on Vercel\n1. Go to [vercel.com](https://vercel.com)\n2. Click \"Add New Project\"\n3. Import your GitHub repository\n4. Configure:\n   - **Framework Preset**: Next.js\n   - **Root Directory**: `./`\n   - **Build Command**: `npm run build:frontend`\n   - **Output Directory**: `.next`\n\n### 3. Add Environment Variables (Frontend)\nIn Vercel Dashboard → Settings → Environment Variables:\n```\nNEXT_PUBLIC_FIREBASE_API_KEY=your_api_key\nNEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_domain\nNEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id\nNEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_bucket\nNEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_sender_id\nNEXT_PUBLIC_FIREBASE_APP_ID=your_app_id\nNEXT_PUBLIC_API_URL=https://your-backend.vercel.app/api\nGOOGLE_AI_API_KEY=your_google_ai_key\n```\n\n### 4. Deploy\nClick \"Deploy\" - Your frontend will be live at `https://your-app.vercel.app`\n\n---\n\n## Backend Deployment\n\n### 1. Create Separate Backend Repository\n```bash\ncd backend\ngit init\ngit add .\ngit commit -m \"Backend initial commit\"\ngit remote add origin <your-backend-repo-url>\ngit push -u origin main\n```\n\n### 2. Deploy Backend on Vercel\n1. Go to [vercel.com](https://vercel.com)\n2. Click \"Add New Project\"\n3. Import your backend GitHub repository\n4. Configure:\n   - **Framework Preset**: Other\n   - **Root Directory**: `./`\n   - **Build Command**: `npm run build`\n\n### 3. Add Environment Variables (Backend)\nIn Vercel Dashboard → Settings → Environment Variables:\n```\nFIREBASE_PROJECT_ID=your_project_id\nFIREBASE_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\\n\"\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxx@your-project.iam.gserviceaccount.com\nPORT=4000\nCORS_ORIGIN=https://your-frontend.vercel.app\nGOOGLE_AI_API_KEY=your_google_ai_key\nNODE_ENV=production\n```\n\n### 4. Deploy\nClick \"Deploy\" - Your backend will be live at `https://your-backend.vercel.app`\n\n---\n\n## Update Frontend API URL\n\nAfter backend deployment, update frontend environment variable:\n```\nNEXT_PUBLIC_API_URL=https://your-backend.vercel.app/api\n```\n\nRedeploy frontend for changes to take effect.\n\n---\n\n## Important Notes\n\n1. **Socket.io Limitation**: Vercel serverless functions don't support WebSocket connections. For real-time features (calls, chat), consider:\n   - Using Vercel's Edge Functions\n   - Deploying backend to Railway/Render/Heroku\n   - Using Firebase Realtime Database for signaling\n\n2. **Cold Starts**: Serverless functions may have cold start delays\n\n3. **Custom Domain**: Add custom domain in Vercel Dashboard → Settings → Domains\n\n4. **Automatic Deployments**: Every push to main branch auto-deploys\n\n---\n\n## Alternative: Deploy Backend to Railway\n\nFor better WebSocket support:\n\n1. Go to [railway.app](https://railway.app)\n2. Click \"New Project\" → \"Deploy from GitHub\"\n3. Select backend repository\n4. Add environment variables\n5. Deploy\n\nRailway URL: `https://your-app.railway.app`\n\n---\n\n## Testing\n\nAfter deployment:\n1. Visit frontend URL\n2. Test login/signup\n3. Test AI features\n4. Test real-time features\n5. Check browser console for errors\n\n---\n\n## Troubleshooting\n\n- **Build Fails**: Check build logs in Vercel dashboard\n- **API Errors**: Verify environment variables\n- **CORS Issues**: Update CORS_ORIGIN in backend\n- **Firebase Errors**: Check Firebase credentials\n","path":null,"size_bytes":3495,"size_tokens":null},"src/app/profile/[userId]/page.tsx":{"content":"\n'use client';\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { useParams } from 'next/navigation';\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { UserProfile, useUser } from '@/hooks/use-user';\nimport { Github, Twitter, Linkedin, Hexagon, Lock, Award, Zap, Shield, TrendingUp, Calendar, MessageSquare, StickyNote, FileUp, Box, UserPlus, Loader2, UserCheck, Clock, UserX, Circle, Gamepad2, Users, Mic } from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Progress } from '@/components/ui/progress';\nimport { cn } from '@/lib/utils';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { format, formatDistanceToNowStrict } from 'date-fns';\nimport { achievements } from '@/lib/achievements';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { doc, onSnapshot } from 'firebase/firestore';\nimport { useFirestore } from '@/firebase/provider';\nimport Link from 'next/link';\nimport { useConnections } from '@/hooks/use-connections';\nimport { useToast } from '@/hooks/use-toast';\n\nconst getDerivedStatus = (profile: UserProfile | null): {label: string, color: string, isOnline: boolean} => {\n    if (!profile) return {label: 'Offline', color: 'bg-muted-foreground', isOnline: false};\n    \n    // Respect user-set status first\n    if (profile.status && profile.status !== 'Online' && profile.status !== 'Offline') {\n        return {label: profile.status, color: 'bg-yellow-500', isOnline: true};\n    }\n\n    if (profile.lastSeen && profile.lastSeen.toDate) {\n        const lastSeenDate = profile.lastSeen.toDate();\n        const minutesSinceSeen = (new Date().getTime() - lastSeenDate.getTime()) / (1000 * 60);\n\n        if (minutesSinceSeen < 5) {\n            return {label: 'Online', color: 'bg-green-500', isOnline: true};\n        }\n    }\n    \n    return {label: 'Offline', color: 'bg-muted-foreground', isOnline: false};\n}\n\nexport default function UserProfilePage() {\n  const params = useParams();\n  const userId = params.userId as string;\n  const firestore = useFirestore();\n  const [profile, setProfile] = useState<UserProfile | null>(null);\n  const [loading, setLoading] = useState(true);\n  const { user: currentUser } = useUser();\n  const { connections, sendFriendRequest, acceptFriendRequest, removeConnection, loading: connectionsLoading } = useConnections();\n  const { toast } = useToast();\n  const [actionLoading, setActionLoading] = useState(false);\n\n  useEffect(() => {\n    if (!userId) return;\n\n    setLoading(true);\n    const profileDoc = doc(firestore, 'users', userId);\n    const unsub = onSnapshot(profileDoc, (docSnap) => {\n      if (docSnap.exists()) {\n        setProfile({...(docSnap.data() as UserProfile), id: docSnap.id});\n      } else {\n        setProfile(null);\n      }\n      setLoading(false);\n    }, (error) => {\n      console.error(\"Error fetching user profile:\", error);\n      setLoading(false);\n    });\n\n    return () => unsub();\n  }, [userId, firestore]);\n\n  const connectionStatus = useMemo(() => {\n    if (!currentUser || !profile || currentUser.uid === profile.id) return 'self';\n    const connection = connections.find(c => c.id === profile.id);\n    if (!connection) return 'not_connected';\n    return connection.status;\n  }, [connections, currentUser, profile]);\n  \n  const xpForNextLevel = (profile?.level ?? 0) * 1000 + 1000;\n  const xpPercentage = profile ? (profile.xp / xpForNextLevel) * 100 : 0;\n  const accountCreationDate = useMemo(() => {\n    if (profile?.createdAt) {\n        try {\n            if (profile.createdAt.toDate) {\n                return format(profile.createdAt.toDate(), 'MMMM d, yyyy');\n            }\n            return format(new Date(profile.createdAt as any), 'MMMM d, yyyy');\n        } catch (e) {\n            console.error(\"Error formatting date:\", e);\n            return \"N/A\";\n        }\n    }\n    return 'N/A';\n  }, [profile?.createdAt]);\n\n  const isAchievementUnlocked = (achievementId: string) => {\n    return profile?.badgesUnlocked?.includes(achievementId) ?? false;\n  };\n  \n  const canUnlockBadge = (badgeLevel: number) => {\n    return (profile?.level ?? 0) >= badgeLevel;\n  }\n\n  const handleSendRequest = async () => {\n      if (!profile) return;\n      setActionLoading(true);\n      try {\n          await sendFriendRequest(profile.id);\n          toast({ title: 'Success', description: 'Friend request sent.'});\n      } catch (error: any) {\n          toast({ variant: 'destructive', title: 'Error', description: error.message });\n      } finally {\n          setActionLoading(false);\n      }\n  }\n\n  const handleAcceptRequest = async () => {\n      if (!profile) return;\n      setActionLoading(true);\n      try {\n          await acceptFriendRequest(profile.id);\n          toast({ title: 'Success', description: 'Friend request accepted.'});\n      } catch (error: any) {\n          toast({ variant: 'destructive', title: 'Error', description: error.message });\n      } finally {\n          setActionLoading(false);\n      }\n  }\n\n   const handleRemoveConnection = async () => {\n      if (!profile) return;\n      setActionLoading(true);\n      try {\n          await removeConnection(profile.id);\n          toast({ title: 'Success', description: 'Connection removed.'});\n      } catch (error: any) {\n          toast({ variant: 'destructive', title: 'Error', description: error.message });\n      } finally {\n          setActionLoading(false);\n      }\n  }\n\n  const renderConnectionButton = () => {\n    if (connectionsLoading) return <Skeleton className=\"h-9 w-24\" />;\n\n    const connection = connections.find(c => c.id === profile?.id);\n\n    switch (connectionStatus) {\n        case 'friends':\n            return <Button size=\"sm\" variant=\"secondary\" disabled><UserCheck className=\"mr-2\"/> Friends</Button>;\n        case 'pending':\n            if (connection?.requestedBy === currentUser?.uid) {\n                return <Button size=\"sm\" variant=\"secondary\" disabled><Clock className=\"mr-2\"/> Pending</Button>;\n            } else {\n                 return <Button size=\"sm\" onClick={handleAcceptRequest} disabled={actionLoading}>\n                    {actionLoading ? <Loader2 className=\"animate-spin\" /> : 'Accept Request'}\n                 </Button>;\n            }\n        case 'not_connected':\n            return <Button size=\"sm\" onClick={handleSendRequest} disabled={actionLoading}>\n                    {actionLoading ? <Loader2 className=\"animate-spin mr-2\"/> : <UserPlus className=\"mr-2\"/>}\n                    Add Friend\n                </Button>;\n        case 'self':\n            return null; // Don't show button on your own profile\n        default:\n            return null;\n    }\n  }\n  \n  const derivedStatus = getDerivedStatus(profile);\n\n  if (loading) {\n    return (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            <Skeleton className=\"lg:col-span-1 h-[500px]\" />\n            <div className=\"lg:col-span-2 space-y-8\">\n                <Skeleton className=\"h-[200px]\" />\n                <Skeleton className=\"h-[300px]\" />\n            </div>\n        </div>\n    );\n  }\n  \n  if (!profile) {\n      return (\n        <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n            <p className=\"text-xl font-headline\">Operator not found in the Aetherweave network.</p>\n        </div>\n      )\n  }\n  \n  const isOwnProfile = currentUser?.uid === profile.id;\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n      {/* Left Column: Profile Card */}\n      <div className=\"lg:col-span-1 space-y-8\">\n        <Card className=\"text-center\">\n          <CardContent className=\"p-6 flex flex-col items-center\">\n            <div className=\"relative w-32 h-32\">\n              <Avatar className=\"w-32 h-32 border-4 border-primary neon-glow-primary\">\n                <AvatarImage src={profile.photoURL ?? ''} />\n                <AvatarFallback className=\"text-4xl\">\n                  {profile.displayName?.charAt(0) || profile.email?.charAt(0) || 'U'}\n                </AvatarFallback>\n              </Avatar>\n               <TooltipProvider>\n                <Tooltip>\n                    <TooltipTrigger asChild>\n                         <div className={cn(\n                            \"absolute top-0 right-0 w-5 h-5 rounded-full border-2 border-background flex items-center justify-center\",\n                            derivedStatus.color\n                         )}>\n                            {derivedStatus.isOnline && <div className={cn(\"w-2 h-2 rounded-full bg-background/50\", derivedStatus.isOnline ? 'bg-green-400 animate-pulse' : '')}></div>}\n                         </div>\n                    </TooltipTrigger>\n                    <TooltipContent><p>{derivedStatus.label}</p></TooltipContent>\n                </Tooltip>\n              </TooltipProvider>\n            </div>\n            <h2 className=\"mt-4 text-2xl font-headline text-glow\">{profile.displayName}</h2>\n            <p className=\"text-sm text-muted-foreground\">@{profile.username}</p>\n            <p className=\"text-sm font-bold text-secondary mt-1\">{profile.gaming?.username ? `@${profile.gaming.username}` : ''}</p>\n            <p className=\"text-xs text-green-400 font-mono mt-1\">{profile.gaming?.status || ''}</p>\n            \n            <div className=\"flex gap-2 mt-4\">\n                 {renderConnectionButton()}\n                 <Button size=\"sm\" variant=\"outline\" asChild disabled={isOwnProfile}>\n                    <Link href={`/chat?contactId=${profile.id}`}>\n                        <MessageSquare className=\"mr-2\"/> Message\n                    </Link>\n                 </Button>\n            </div>\n           \n            <p className=\"mt-4 text-muted-foreground text-sm\">{profile.bio || \"No bio set.\"}</p>\n\n             <div className=\"w-full space-y-4 mt-6\">\n                <div className=\"space-y-1\">\n                    <div className=\"flex justify-between text-xs text-muted-foreground\">\n                        <span>XP</span>\n                        <span>{profile.xp ?? 0} / {xpForNextLevel}</span>\n                    </div>\n                    <Progress value={xpPercentage} className=\"h-2\" />\n                </div>\n                <div className=\"grid grid-cols-3 gap-2 text-center\">\n                    <div>\n                        <p className=\"font-bold text-lg text-glow\">{profile.level ?? 1}</p>\n                        <p className=\"text-xs text-muted-foreground\">Level</p>\n                    </div>\n                     <div>\n                        <p className=\"font-bold text-lg text-glow\">{'N/A'}</p>\n                        <p className=\"text-xs text-muted-foreground\">Reputation</p>\n                    </div>\n                     <div>\n                        <p className=\"font-bold text-lg text-glow\">{profile.trustScore ?? 0}</p>\n                        <p className=\"text-xs text-muted-foreground\">Trust Level</p>\n                    </div>\n                </div>\n            </div>\n            <div className=\"flex items-center text-xs text-muted-foreground mt-4\">\n              <Calendar className=\"w-3 h-3 mr-1.5\"/>\n              Operator since {accountCreationDate}\n            </div>\n\n            <div className=\"flex justify-center gap-4 mt-4\">\n              <a href={profile.socials?.github || '#'} target=\"_blank\" rel=\"noopener noreferrer\"><Github className=\"w-6 h-6 text-muted-foreground hover:text-primary\"/></a>\n              <a href={profile.socials?.twitter || '#'} target=\"_blank\" rel=\"noopener noreferrer\"><Twitter className=\"w-6 h-6 text-muted-foreground hover:text-primary\"/></a>\n              <a href={profile.socials?.linkedin || '#'} target=\"_blank\" rel=\"noopener noreferrer\"><Linkedin className=\"w-6 h-6 text-muted-foreground hover:text-primary\"/></a>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Right Column: Content */}\n      <div className=\"lg:col-span-2 space-y-8\">\n        <Tabs defaultValue=\"activity\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n                <TabsTrigger value=\"activity\">Activity</TabsTrigger>\n                <TabsTrigger value=\"gaming\">Gaming</TabsTrigger>\n                <TabsTrigger value=\"badges\">Achievements</TabsTrigger>\n            </TabsList>\n            <TabsContent value=\"activity\">\n                 <Card>\n                  <CardHeader>\n                    <CardTitle>User Activity & Stats</CardTitle>\n                    <CardDescription>\n                      A summary of this operator's engagement across the platform.\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"grid grid-cols-2 lg:grid-cols-3 gap-6\">\n                        <div className=\"flex items-center gap-4 p-4 rounded-lg bg-input/50\">\n                            <MessageSquare className=\"w-8 h-8 text-primary\"/>\n                            <div>\n                                <p className=\"text-2xl font-bold text-glow\">{profile.messagesSent ?? 0}</p>\n                                <p className=\"text-sm text-muted-foreground\">Messages</p>\n                            </div>\n                        </div>\n                         <div className=\"flex items-center gap-4 p-4 rounded-lg bg-input/50\">\n                            <StickyNote className=\"w-8 h-8 text-primary\"/>\n                            <div>\n                                <p className=\"text-2xl font-bold text-glow\">{profile.notesCreated ?? 0}</p>\n                                <p className=\"text-sm text-muted-foreground\">Notes</p>\n                            </div>\n                        </div>\n                         <div className=\"flex items-center gap-4 p-4 rounded-lg bg-input/50\">\n                            <FileUp className=\"w-8 h-8 text-primary\"/>\n                            <div>\n                                <p className=\"text-2xl font-bold text-glow\">{profile.filesUploaded ?? 0}</p>\n                                <p className=\"text-sm text-muted-foreground\">Uploads</p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-4 p-4 rounded-lg bg-input/50\">\n                            <Zap className=\"w-8 h-8 text-secondary\"/>\n                            <div>\n                                <p className=\"text-2xl font-bold text-glow\">{'N/A'}</p>\n                                <p className=\"text-sm text-muted-foreground\">Reputation</p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-4 p-4 rounded-lg bg-input/50\">\n                            <Shield className=\"w-8 h-8 text-secondary\"/>\n                            <div>\n                                <p className=\"text-2xl font-bold text-glow\">{profile.trustScore ?? 0}%</p>\n                                <p className=\"text-sm text-muted-foreground\">Trust Level</p>\n                            </div>\n                        </div>\n                         <div className=\"flex items-center gap-4 p-4 rounded-lg bg-input/50\">\n                            <TrendingUp className=\"w-8 h-8 text-secondary\"/>\n                            <div>\n                                <p className=\"text-2xl font-bold text-glow\">#--</p>\n                                <p className=\"text-sm text-muted-foreground\">Rank</p>\n                            </div>\n                        </div>\n                  </CardContent>\n                </Card>\n            </TabsContent>\n            <TabsContent value=\"gaming\">\n                 <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\"><Gamepad2 className=\"text-primary\"/> Gaming Stats</CardTitle>\n                    <CardDescription>\n                      A summary of this operator's gaming activity.\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"grid grid-cols-2 lg:grid-cols-3 gap-6\">\n                        <div className=\"flex items-center gap-4 p-4 rounded-lg bg-input/50\">\n                            <Users className=\"w-8 h-8 text-primary\"/>\n                            <div>\n                                <p className=\"text-2xl font-bold text-glow\">{0}</p>\n                                <p className=\"text-sm text-muted-foreground\">Servers Joined</p>\n                            </div>\n                        </div>\n                         <div className=\"flex items-center gap-4 p-4 rounded-lg bg-input/50\">\n                            <Mic className=\"w-8 h-8 text-primary\"/>\n                            <div>\n                                <p className=\"text-2xl font-bold text-glow\">{0}</p>\n                                <p className=\"text-sm text-muted-foreground\">Voice Hours</p>\n                            </div>\n                        </div>\n                  </CardContent>\n                </Card>\n            </TabsContent>\n            <TabsContent value=\"badges\">\n                 <Card>\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\"><Award className=\"text-primary\"/> Achievement Showcase</CardTitle>\n                        <CardDescription>This operator's collection of unlocked achievements.</CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n                        {achievements.map(badge => {\n                            const unlocked = isAchievementUnlocked(badge.id);\n                            return (\n                                 <TooltipProvider key={badge.id}>\n                                    <Tooltip>\n                                        <TooltipTrigger>\n                                        <div className={cn(\n                                                \"aspect-square flex flex-col items-center justify-center text-center p-2 rounded-lg border-2 transition-all\",\n                                                unlocked ? \"bg-secondary/20 border-secondary neon-border-secondary\" : \"bg-muted/50 border-border filter grayscale opacity-60\"\n                                            )}>\n                                                <div className=\"relative\">\n                                                    <Hexagon className={cn(\"w-16 h-16\", unlocked ? \"text-secondary\" : \"text-muted-foreground\")} fill=\"currentColor\" fillOpacity={0.1}/>\n                                                    <badge.icon className={cn(\"w-8 h-8 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2\", unlocked ? \"text-secondary-foreground\" : \"text-muted-foreground\")}/>\n                                                    {!unlocked && <Lock className=\"w-5 h-5 absolute bottom-1 right-1 text-muted-foreground\" />}\n                                                </div>\n                                                <p className={cn(\"mt-2 text-xs font-semibold\", unlocked ? \"text-secondary-foreground\" : \"text-muted-foreground\")}>{badge.name}</p>\n                                            </div>\n                                        </TooltipTrigger>\n                                        <TooltipContent side=\"bottom\" className=\"max-w-xs\">\n                                            <p className=\"font-bold text-base\">{badge.name}</p>\n                                            <p>{badge.description}</p>\n                                            {unlocked ? (\n                                                <p className=\"text-green-400 font-bold mt-1\">Unlocked!</p>\n                                            ) : (\n                                                <p className=\"text-yellow-400 font-bold mt-1\">Locked (Requires Level {badge.level})</p>\n                                            )}\n                                        </TooltipContent>\n                                    </Tooltip>\n                                </TooltipProvider>\n                            )\n                        })}\n                    </CardContent>\n                </Card>\n            </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n\n    ","path":null,"size_bytes":20477,"size_tokens":null},"next.config.ts":{"content":"import type { NextConfig } from \"next\";\nimport path from \"path\";\n\nconst nextConfig: NextConfig = {\n  /* config options here */\n  compress: true,\n  poweredByHeader: false,\n  generateEtags: true,\n  typescript: {\n    ignoreBuildErrors: false,\n  },\n  webpack: (config) => {\n    config.resolve.alias = {\n      ...config.resolve.alias,\n      '@': path.resolve(__dirname, 'src'),\n    };\n    return config;\n  },\n  images: {\n    remotePatterns: [\n      {\n        protocol: 'https',\n        hostname: 'picsum.photos',\n      },\n    ],\n  },\n  \n  async headers() {\n    return [\n      {\n        source: '/(.*)',\n        headers: [\n          {\n            key: 'X-Content-Type-Options',\n            value: 'nosniff',\n          },\n          {\n            key: 'X-Frame-Options',\n            value: 'SAMEORIGIN',\n          },\n          {\n            key: 'X-XSS-Protection',\n            value: '1; mode=block',\n          },\n          {\n            key: 'Referrer-Policy',\n            value: 'origin-when-cross-origin',\n          },\n          {\n            key: 'Cache-Control',\n            value: 'no-cache, no-store, must-revalidate',\n          },\n        ],\n      },\n      {\n        source: '/favicon.png',\n        headers: [\n          {\n            key: 'Cache-Control',\n            value: 'public, max-age=86400',\n          },\n        ],\n      },\n    ];\n  },\n};\n\nexport default nextConfig;","path":null,"size_bytes":1376,"size_tokens":null},"src/hooks/use-command-hub.tsx":{"content":"'use client';\nimport { createContext, useContext, ReactNode, ProviderProps } from 'react';\nimport * as Lucide from 'lucide-react';\n\nexport type CommandHubAction = \n  | {\n      label: string;\n      icon: keyof typeof Lucide;\n      onClick: (data?: any) => void;\n      isDestructive?: boolean;\n      disabled?: boolean;\n      separator?: false;\n    }\n  | {\n      separator: true;\n    };\n\nexport type ModalType = 'invite-people' | 'create-join-space' | 'space-settings';\n\nexport interface CommandHubContextType {\n  isOpen: boolean;\n  position: { x: number; y: number };\n  actions: CommandHubAction[];\n  contextType: string | null;\n  data?: any;\n  targetElement?: HTMLElement | null;\n  openHub: (\n    event: React.MouseEvent,\n    context: { type: string; actions?: CommandHubAction[]; data?: any }\n  ) => void;\n  getContextActions: (type: string, data?: any) => CommandHubAction[];\n  closeHub: () => void;\n  setTargetElement: (element: HTMLElement | null) => void;\n  openModal: (modal: ModalType, data?: any) => void;\n  closeModal: () => void;\n  loadingAction?: string | null;\n}\n\nconst CommandHubContext = createContext<CommandHubContextType | undefined>(\n  undefined\n);\n\nexport const useCommandHub = () => {\n  const context = useContext(CommandHubContext);\n  if (!context) {\n    throw new Error('useCommandHub must be used within a CommandHubProvider');\n  }\n  return context;\n};\n\nexport const CommandHubProvider = ({\n  value,\n  children,\n}: ProviderProps<CommandHubContextType>) => {\n  return (\n    <CommandHubContext.Provider value={value}>\n      {children}\n    </CommandHubContext.Provider>\n  );\n};\n","path":null,"size_bytes":1598,"size_tokens":null},"src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean>(false);\n\n  React.useEffect(() => {\n    const checkSize = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);\n    };\n\n    // Check on mount (client-side)\n    checkSize();\n\n    // Add event listener for window resize\n    window.addEventListener('resize', checkSize);\n\n    // Cleanup event listener on component unmount\n    return () => window.removeEventListener('resize', checkSize);\n  }, []);\n\n  return isMobile;\n}\n","path":null,"size_bytes":582,"size_tokens":null},"src/components/onboarding/TutorialLauncher.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { useOnboarding, tours } from '@/hooks/use-onboarding';\nimport { useUser } from '@/hooks/use-user';\nimport { BookOpen, Play, CheckCircle, Lock, Zap } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport default function TutorialLauncher() {\n  const { profile } = useUser();\n  const { startTour, getAvailableTours } = useOnboarding();\n  const [open, setOpen] = useState(false);\n  const availableTours = getAvailableTours();\n\n  const canAccessTour = (tour: any) => {\n    return !tour.minLevel || (profile?.level || 1) >= tour.minLevel;\n  };\n\n  const isCompleted = (tourId: string) => {\n    return !availableTours.some(tour => tour.id === tourId);\n  };\n\n  const handleStartTour = (tourId: string) => {\n    startTour(tourId);\n    setOpen(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\">\n          <BookOpen className=\"w-4 h-4 mr-2\" />\n          Tutorials\n          {availableTours.length > 0 && (\n            <Badge variant=\"secondary\" className=\"ml-2\">\n              {availableTours.length}\n            </Badge>\n          )}\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <BookOpen className=\"w-5 h-5\" />\n            Training Modules\n          </DialogTitle>\n        </DialogHeader>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {tours.map((tour) => {\n            const completed = isCompleted(tour.id);\n            const canAccess = canAccessTour(tour);\n            const available = availableTours.some(t => t.id === tour.id);\n            \n            return (\n              <Card \n                key={tour.id} \n                className={cn(\n                  \"transition-all\",\n                  completed && \"bg-green-500/10 border-green-500/50\",\n                  !canAccess && \"opacity-60\",\n                  available && canAccess && \"ring-2 ring-primary/50\"\n                )}\n              >\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-lg\">{tour.name}</CardTitle>\n                    <div className=\"flex items-center gap-2\">\n                      {tour.minLevel && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          Level {tour.minLevel}+\n                        </Badge>\n                      )}\n                      {completed ? (\n                        <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                      ) : !canAccess ? (\n                        <Lock className=\"w-5 h-5 text-muted-foreground\" />\n                      ) : (\n                        <Zap className=\"w-5 h-5 text-primary\" />\n                      )}\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    {tour.description}\n                  </p>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-xs text-muted-foreground\">\n                      {tour.steps.length} steps\n                    </span>\n                    <Button\n                      size=\"sm\"\n                      onClick={() => handleStartTour(tour.id)}\n                      disabled={!canAccess}\n                      variant={completed ? \"outline\" : \"default\"}\n                    >\n                      {completed ? (\n                        <>Replay <Play className=\"w-3 h-3 ml-1\" /></>\n                      ) : !canAccess ? (\n                        <>Locked <Lock className=\"w-3 h-3 ml-1\" /></>\n                      ) : (\n                        <>Start <Play className=\"w-3 h-3 ml-1\" /></>\n                      )}\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n        \n        {availableTours.length === 0 && (\n          <div className=\"text-center py-8\">\n            <CheckCircle className=\"w-16 h-16 text-green-500 mx-auto mb-4\" />\n            <h3 className=\"text-xl font-semibold mb-2\">All Tutorials Complete!</h3>\n            <p className=\"text-muted-foreground\">\n              You've mastered all available training modules. New tutorials unlock as you level up.\n            </p>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}","path":null,"size_bytes":4935,"size_tokens":null},"src/components/onboarding/OnboardingManager.tsx":{"content":"'use client';\nimport { useEffect, useState, useMemo, useRef } from 'react';\nimport { useOnboarding, OnboardingStep } from '@/hooks/use-onboarding';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ArrowRight, X, Move } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\nimport { useUser } from '@/hooks/use-user';\nimport { tutorialSounds } from '@/lib/tutorial-sounds';\n\nfunction getElementRect(selector: string): DOMRect | null {\n  const element = document.querySelector(selector);\n  return element ? element.getBoundingClientRect() : null;\n}\n\nconst OnboardingTooltip = ({\n  step,\n  onNext,\n  onSkip,\n  isLast,\n  stepIndex,\n  totalSteps,\n  position,\n  onDrag,\n}: {\n  step: OnboardingStep;\n  onNext: () => void;\n  onSkip: () => void;\n  isLast: boolean;\n  stepIndex: number;\n  totalSteps: number;\n  position: { x: number; y: number };\n  onDrag: (x: number, y: number) => void;\n}) => {\n  const { addXp } = useUser();\n  const progress = ((stepIndex + 1) / totalSteps) * 100;\n\n  const handleNext = () => {\n    if (step.id.includes('welcome') || step.id.includes('complete')) {\n        addXp(50);\n    } else {\n        addXp(25);\n    }\n    \n    // Play sound on next\n    const audio = new Audio('/sounds/tutorial-next.mp3');\n    audio.volume = 0.2;\n    audio.play().catch(() => {});\n    \n    onNext();\n  };\n\n  return (\n    <motion.div\n      drag\n      dragMomentum={false}\n      dragElastic={0.1}\n      onDrag={(_, info) => {\n        onDrag(position.x + info.delta.x, position.y + info.delta.y);\n      }}\n      initial={{ opacity: 0, scale: 0.8, rotate: -5 }}\n      animate={{ opacity: 1, scale: 1, rotate: 0 }}\n      exit={{ opacity: 0, scale: 0.8, rotate: 5 }}\n      transition={{ duration: 0.5, type: 'spring' }}\n      className=\"glass-card w-full max-w-sm rounded-lg shadow-2xl z-[101] cursor-move border-2 border-primary/50\"\n      style={{ \n        boxShadow: '0 0 40px hsl(var(--primary) / 0.5), 0 0 80px hsl(var(--primary) / 0.3)',\n        background: 'linear-gradient(135deg, hsl(var(--background)) 0%, hsl(var(--background)/0.9) 100%)'\n      }}\n    >\n      <div className=\"p-6 space-y-4\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <div className=\"flex items-center gap-2\">\n            <Move className=\"w-4 h-4 text-primary/60\" />\n            <h3 className=\"text-xl font-headline text-glow\">{step.title}</h3>\n          </div>\n          <Badge variant=\"outline\" className=\"text-xs bg-primary/20\">\n            Tutorial {stepIndex + 1}\n          </Badge>\n        </div>\n        <p className=\"text-muted-foreground text-sm\">{step.content}</p>\n\n        <div className=\"space-y-2\">\n            <Progress value={progress} className=\"h-2\" />\n            <p className=\"text-xs text-muted-foreground text-right\">{stepIndex + 1} / {totalSteps}</p>\n        </div>\n\n        <div className=\"flex justify-between items-center\">\n          <Button variant=\"ghost\" onClick={onSkip} size=\"sm\" className=\"text-muted-foreground hover:text-foreground\">\n            Skip\n          </Button>\n          <Button onClick={handleNext} className=\"cyber-button\" size=\"sm\">\n            {isLast ? 'Complete' : 'Next'} <ArrowRight className=\"ml-2 w-4 h-4\" />\n          </Button>\n        </div>\n      </div>\n    </motion.div>\n  );\n};\n\n\nexport default function OnboardingManager() {\n  const { isActive, currentStepData, stepIndex, totalSteps, nextStep, skipTour, isLoading } = useOnboarding();\n  const [isClient, setIsClient] = useState(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [existingPopups, setExistingPopups] = useState<DOMRect[]>([]);\n\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n\n  // Find safe position avoiding other popups\n  const findSafePosition = () => {\n    const popups = document.querySelectorAll('[data-popup], .toast, .dialog, .modal');\n    const rects: DOMRect[] = [];\n    popups.forEach(popup => {\n      const rect = popup.getBoundingClientRect();\n      if (rect.width > 0 && rect.height > 0) rects.push(rect);\n    });\n    setExistingPopups(rects);\n    \n    // Find safe position on screen edges\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const tooltipWidth = 384;\n    const tooltipHeight = 300;\n    \n    const positions = [\n      { x: 20, y: 20 }, // Top left\n      { x: viewportWidth - tooltipWidth - 20, y: 20 }, // Top right\n      { x: 20, y: viewportHeight - tooltipHeight - 20 }, // Bottom left\n      { x: viewportWidth - tooltipWidth - 20, y: viewportHeight - tooltipHeight - 20 }, // Bottom right\n      { x: viewportWidth / 2 - tooltipWidth / 2, y: 20 }, // Top center\n      { x: viewportWidth / 2 - tooltipWidth / 2, y: viewportHeight - tooltipHeight - 20 }, // Bottom center\n    ];\n    \n    for (const pos of positions) {\n      const tooltipRect = { x: pos.x, y: pos.y, width: tooltipWidth, height: tooltipHeight };\n      const hasCollision = rects.some(rect => \n        tooltipRect.x < rect.right + 20 &&\n        tooltipRect.x + tooltipRect.width > rect.left - 20 &&\n        tooltipRect.y < rect.bottom + 20 &&\n        tooltipRect.y + tooltipRect.height > rect.top - 20\n      );\n      \n      if (!hasCollision) {\n        setPosition(pos);\n        return;\n      }\n    }\n    \n    // Fallback to top-left if all positions have collisions\n    setPosition({ x: 20, y: 20 });\n  };\n\n  useEffect(() => {\n    if (isActive && !isLoading) {\n      findSafePosition();\n      \n      // Recheck position when window resizes or new popups appear\n      const observer = new MutationObserver(findSafePosition);\n      observer.observe(document.body, { childList: true, subtree: true });\n      window.addEventListener('resize', findSafePosition);\n      \n      return () => {\n        observer.disconnect();\n        window.removeEventListener('resize', findSafePosition);\n      };\n    }\n  }, [isActive, isLoading]);\n\n  const handleDrag = (x: number, y: number) => {\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const tooltipWidth = 384;\n    const tooltipHeight = 300;\n    \n    // Keep within screen bounds\n    const boundedX = Math.max(0, Math.min(x, viewportWidth - tooltipWidth));\n    const boundedY = Math.max(0, Math.min(y, viewportHeight - tooltipHeight));\n    \n    setPosition({ x: boundedX, y: boundedY });\n  };\n\n  if (!isActive || !currentStepData || !isClient || isLoading) {\n    return null;\n  }\n\n  const isLast = stepIndex === totalSteps - 1;\n\n  return (\n    <div className=\"fixed inset-0 z-[100] pointer-events-none\">\n      <motion.div\n        className=\"absolute pointer-events-auto\"\n        style={{\n          left: position.x,\n          top: position.y,\n        }}\n        initial={{ opacity: 0, scale: 0.5, y: -50 }}\n        animate={{ opacity: 1, scale: 1, y: 0 }}\n        exit={{ opacity: 0, scale: 0.5, y: 50 }}\n        transition={{ duration: 0.6, type: 'spring', bounce: 0.4 }}\n      >\n        <OnboardingTooltip\n          step={currentStepData}\n          onNext={nextStep}\n          onSkip={skipTour}\n          isLast={isLast}\n          stepIndex={stepIndex}\n          totalSteps={totalSteps}\n          position={position}\n          onDrag={handleDrag}\n        />\n      </motion.div>\n    </div>\n  );\n}","path":null,"size_bytes":7316,"size_tokens":null},"src/components/calls/CallInterface.tsx":{"content":"'use client';\n\nimport { AnimatePresence } from 'framer-motion';\nimport { useCall } from '@/contexts/CallContext';\nimport SenderPanel from './SenderPanel';\nimport ReceiverPanel from './ReceiverPanel';\nimport ConnectedPanel from './ConnectedPanel';\n\nexport default function CallInterface() {\n  const {\n    callStatus,\n    activeCall,\n    incomingCall,\n    localStream,\n    remoteStream,\n    isAudioEnabled,\n    isVideoEnabled,\n    isScreenSharing,\n    isMinimized,\n    callDuration,\n    acceptCall,\n    declineCall,\n    endCall,\n    toggleAudio,\n    toggleVideo,\n    toggleScreenShare,\n    setIsMinimized\n  } = useCall();\n\n\n\n  return (\n    <AnimatePresence mode=\"wait\">\n      {callStatus === 'calling' && activeCall && (\n        <SenderPanel\n          key=\"sender\"\n          callerName={activeCall.withUserName}\n          callerAvatar={activeCall.withUserAvatar}\n          onEndCall={endCall}\n        />\n      )}\n\n      {callStatus === 'ringing' && incomingCall && (\n        <ReceiverPanel\n          key=\"receiver\"\n          callerName={incomingCall.fromUserName}\n          callerAvatar={incomingCall.fromUserAvatar}\n          callType={incomingCall.callType}\n          onAccept={acceptCall}\n          onDecline={declineCall}\n        />\n      )}\n\n      {callStatus === 'connected' && activeCall && (\n        <ConnectedPanel\n          key=\"connected\"\n          callerName={activeCall.withUserName}\n          callerAvatar={activeCall.withUserAvatar}\n          callType={activeCall.callType}\n          duration={callDuration}\n          localStream={localStream}\n          remoteStream={remoteStream}\n          isAudioEnabled={isAudioEnabled}\n          isVideoEnabled={isVideoEnabled}\n          isScreenSharing={isScreenSharing}\n          isMinimized={isMinimized}\n          onToggleAudio={toggleAudio}\n          onToggleVideo={toggleVideo}\n          onToggleScreenShare={toggleScreenShare}\n          onMinimize={() => setIsMinimized(!isMinimized)}\n          onEndCall={endCall}\n        />\n      )}\n    </AnimatePresence>\n  );\n}","path":null,"size_bytes":2022,"size_tokens":null},"src/hooks/use-inventory.ts":{"content":"\n'use client';\nimport { useState, useEffect, useMemo } from 'react';\nimport { useFirestore } from '@/firebase/provider';\nimport { useUser } from '@/hooks/use-user';\nimport { storeItems, StoreItem } from '@/lib/store-items';\n\nexport function useInventory() {\n    const { profile, loading: userLoading } = useUser();\n    const [inventoryItems, setInventoryItems] = useState<StoreItem[]>([]);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        if (userLoading) {\n            setLoading(true);\n            return;\n        }\n\n        if (!profile || !profile.inventory) {\n            setInventoryItems([]);\n            setLoading(false);\n            return;\n        }\n\n        const items = storeItems.filter(item => profile.inventory.includes(item.id));\n        setInventoryItems(items);\n        setLoading(false);\n\n    }, [profile, userLoading]);\n\n    const equipItem = async (itemId: string) => {\n        console.log(`Equipping item ${itemId}`);\n        const item = storeItems.find(i => i.id === itemId);\n        if (item?.category === 'themes') {\n            const { setTheme } = await import('@/components/providers/ThemeProvider').then(m => ({ setTheme: m.useTheme }));\n            // Theme will be applied via settings page\n        }\n    };\n\n    const useItem = async (itemId: string) => {\n        console.log(`Using item ${itemId}`);\n        // Logic for consumable items\n    };\n\n    return { inventoryItems, loading, equipItem, useItem };\n}\n","path":null,"size_bytes":1476,"size_tokens":null},"src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"apphosting.yaml":{"content":"# Settings to manage and configure a Firebase App Hosting backend.\n# https://firebase.google.com/docs/app-hosting/configure\n\nrunConfig:\n  # Increase this value if you'd like to automatically spin up\n  # more instances in response to increased traffic.\n  maxInstances: 1\n","path":null,"size_bytes":270,"size_tokens":null},"src/components/FirebaseErrorListener.tsx":{"content":"'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { X, ClipboardCopy } from 'lucide-react';\n\nexport function FirebaseErrorListener() {\n  const [error, setError] = useState<FirestorePermissionError | null>(null);\n\n  useEffect(() => {\n    const handleError = (e: FirestorePermissionError) => {\n      console.error('Caught Firestore Permission Error:', e);\n      setError(e);\n    };\n\n    errorEmitter.on('permission-error', handleError);\n\n    return () => {\n      errorEmitter.off('permission-error', handleError);\n    };\n  }, []);\n\n  const handleCopy = (text: string) => {\n    navigator.clipboard.writeText(text);\n    // You could add a toast notification here to confirm the copy.\n  };\n\n  if (!error) {\n    return null;\n  }\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        backgroundColor: 'rgba(0, 0, 0, 0.9)',\n        zIndex: 9999,\n        padding: '2rem',\n        color: 'white',\n        fontFamily: 'monospace',\n        fontSize: '14px',\n        lineHeight: '1.6',\n        overflowY: 'auto',\n      }}\n    >\n      <div style={{ maxWidth: '800px', margin: '0 auto' }}>\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n          <h1 style={{ color: '#ff6b6b', fontSize: '1.5rem' }}>Firestore Security Rule Violation</h1>\n          <button\n            onClick={() => setError(null)}\n            style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer' }}\n          >\n            <X size={24} />\n          </button>\n        </div>\n        <p style={{ marginTop: '1rem', color: '#ccc' }}>\n          The following request was denied by your project's security rules. Review the request details and your rules to resolve the issue.\n        </p>\n\n        <div style={{ marginTop: '2rem' }}>\n          <h2 style={{ borderBottom: '1px solid #444', paddingBottom: '0.5rem', color: '#54a0ff' }}>Request Details</h2>\n          <pre\n            style={{\n              backgroundColor: '#1e1e1e',\n              padding: '1rem',\n              borderRadius: '8px',\n              marginTop: '1rem',\n              position: 'relative',\n            }}\n          >\n             <button\n              onClick={() => handleCopy(error.message)}\n              style={{ position: 'absolute', top: '10px', right: '10px', background: 'none', border: 'none', color: 'white', cursor: 'pointer' }}\n            >\n                <ClipboardCopy size={16} />\n            </button>\n            <code>{error.message}</code>\n          </pre>\n        </div>\n\n        {error.rules && (\n             <div style={{ marginTop: '2rem' }}>\n                <h2 style={{ borderBottom: '1px solid #444', paddingBottom: '0.5rem', color: '#54a0ff' }}>Relevant Security Rules</h2>\n                 <p style={{ color: '#ccc', fontSize: '12px', marginTop: '0.5rem' }}>This is an *example* of what your rules should look like. You'll need to add this to your `firestore.rules` file.</p>\n                <pre\n                    style={{\n                    backgroundColor: '#1e1e1e',\n                    padding: '1rem',\n                    borderRadius: '8px',\n                    marginTop: '1rem',\n                    position: 'relative'\n                    }}\n                >\n                    <button\n                        onClick={() => handleCopy(error.rules || '')}\n                        style={{ position: 'absolute', top: '10px', right: '10px', background: 'none', border: 'none', color: 'white', cursor: 'pointer' }}\n                        >\n                        <ClipboardCopy size={16} />\n                    </button>\n                    <code>{error.rules}</code>\n                </pre>\n            </div>\n        )}\n\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3932,"size_tokens":null},"src/components/chat/ContactDetails.tsx":{"content":"\n'use client';\nimport { Card, CardHeader, CardContent, CardTitle } from '@/components/ui/card';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Contact } from '@/types/chat';\nimport { getDerivedStatus } from '@/lib/chat-utils';\nimport { PublicUser } from '@/hooks/use-connections';\nimport { User, File, Bell } from 'lucide-react';\nimport Link from 'next/link';\nimport UserPopover from '../user/user-popover';\n\ninterface ContactDetailsProps {\n    contact: Contact | null;\n    connectedUsers: PublicUser[];\n    isClient: boolean;\n}\n\nexport default function ContactDetails({ contact, connectedUsers, isClient }: ContactDetailsProps) {\n    if (!contact || contact.type === 'bot') return null;\n    \n    if (!contact) {\n        return (\n            <Card className=\"hidden lg:flex lg:flex-col\">\n                 <CardHeader><Skeleton className=\"h-8 w-3/4\" /></CardHeader>\n                 <CardContent className=\"space-y-4\">\n                    <Skeleton className=\"h-24 w-24 rounded-full mx-auto\" />\n                    <Skeleton className=\"h-6 w-1/2 mx-auto\" />\n                    <Skeleton className=\"h-4 w-3/4 mx-auto\" />\n                 </CardContent>\n            </Card>\n        )\n    }\n    \n    const userProfile = contact.type === 'user' ? connectedUsers.find(u => u.id === contact.id) : null;\n    const derivedStatus = isClient && userProfile ? getDerivedStatus(userProfile) : { label: '...', color: 'bg-muted-foreground', isOnline: false };\n\n    return (\n        <Card className=\"hidden lg:flex lg:flex-col h-full\">\n            <CardHeader className=\"text-center\">\n                 <UserPopover user={userProfile!}>\n                    <Avatar className=\"h-24 w-24 mx-auto border-4 border-primary cursor-pointer\">\n                        <AvatarImage src={contact.avatar || undefined} />\n                        <AvatarFallback className=\"text-3xl\">{contact.name.charAt(0)}</AvatarFallback>\n                    </Avatar>\n                 </UserPopover>\n                <UserPopover user={userProfile!}>\n                    <CardTitle className=\"mt-4 cursor-pointer hover:underline\">{contact.name}</CardTitle>\n                </UserPopover>\n                {userProfile && <p className=\"text-muted-foreground\">@{userProfile.username}</p>}\n                {contact.type === 'user' && <p className=\"text-sm font-semibold\">{derivedStatus.label}</p>}\n            </CardHeader>\n            <CardContent className=\"flex-1 space-y-4\">\n                <Button variant=\"outline\" className=\"w-full\" asChild>\n                    <Link href={`/profile/${contact.id}`}>\n                        <User className=\"mr-2 h-4 w-4\"/> View Profile\n                    </Link>\n                </Button>\n                <Button variant=\"outline\" className=\"w-full\">\n                    <Bell className=\"mr-2 h-4 w-4\"/> Mute Notifications\n                </Button>\n\n                <div className=\"space-y-2 pt-4\">\n                    <h4 className=\"font-semibold\">Shared Files</h4>\n                    <div className=\"text-center text-muted-foreground p-4 border-2 border-dashed border-border rounded-lg\">\n                        <File className=\"w-8 h-8 mx-auto mb-2\"/>\n                        <p>No files shared yet.</p>\n                    </div>\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n\n    ","path":null,"size_bytes":3453,"size_tokens":null},"src/components/chat/simulated-incoming-call-trigger.tsx":{"content":"\n'use client';\n\nimport { useState } from 'react';\nimport { Button } from '../ui/button';\nimport { PhoneIncoming } from 'lucide-react';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\n\ninterface Contact {\n  id: string;\n  name: string;\n  avatar: string;\n  type: 'user' | 'bot' | 'group';\n}\n\ninterface SimulatedIncomingCallProps {\n  onSimulate: (caller: Contact, type: 'video' | 'voice') => void;\n  contacts: Contact[];\n}\n\nexport default function SimulatedIncomingCall({ onSimulate, contacts }: SimulatedIncomingCallProps) {\n  const userContacts = contacts.filter(c => c.type === 'user');\n\n  if (userContacts.length === 0) {\n    return (\n      <Button variant=\"outline\" className=\"w-full\" disabled>\n        <PhoneIncoming className=\"mr-2 h-4 w-4\" />\n        Simulate Call (No contacts)\n      </Button>\n    );\n  }\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"outline\" className=\"w-full\">\n          <PhoneIncoming className=\"mr-2 h-4 w-4\" />\n          Simulate Incoming Call\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent>\n        {userContacts.map(contact => (\n            <div key={contact.id}>\n                 <DropdownMenuItem onClick={() => onSimulate(contact, 'voice')}>\n                    Voice call from {contact.name}\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => onSimulate(contact, 'video')}>\n                    Video call from {contact.name}\n                </DropdownMenuItem>\n            </div>\n        ))}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":1671,"size_tokens":null},"src/components/ui/custom-cursor.tsx":{"content":"\n'use client';\nimport { useRef, useEffect, useCallback, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useCursor } from '@/hooks/use-cursor';\nimport { cn } from '@/lib/utils';\nimport { Move, Link as LinkIcon } from 'lucide-react';\nimport { appEventEmitter } from '@/lib/event-emitter';\n\nexport default function SmartCursor() {\n  const { mode, text, style, lowPerformanceMode } = useCursor();\n  const cursorWrapperRef = useRef<HTMLDivElement>(null);\n  const [isClient, setIsClient] = useState(false);\n  const [rarityClass, setRarityClass] = useState('');\n  \n  const coords = useRef({ x: 0, y: 0 });\n\n  useEffect(() => {\n    setIsClient(true);\n    \n    const handleMouseMove = (event: MouseEvent) => {\n      coords.current = { x: event.clientX, y: event.clientY };\n    };\n    window.addEventListener('mousemove', handleMouseMove, { passive: true });\n    \n    let animationFrameId: number;\n    const animateCursor = () => {\n      if (cursorWrapperRef.current) {\n        cursorWrapperRef.current.style.transform = `translate3d(${coords.current.x}px, ${coords.current.y}px, 0)`;\n      }\n      animationFrameId = requestAnimationFrame(animateCursor);\n    };\n    animateCursor();\n\n    return () => {\n      window.removeEventListener('mousemove', handleMouseMove);\n      cancelAnimationFrame(animationFrameId);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!isClient) return;\n    \n    const createEffectElement = (e: MouseEvent, className: string) => {\n        const el = document.createElement('div');\n        el.className = className;\n        el.style.left = `${e.clientX}px`;\n        el.style.top = `${e.clientY}px`;\n        document.body.appendChild(el);\n        setTimeout(() => el.remove(), 500);\n    };\n\n    const handleSpark = (e: MouseEvent) => {\n      for (let i = 0; i < 4; i++) {\n        const spark = document.createElement('div');\n        spark.className = 'cursor-spark';\n        spark.style.left = `${e.clientX}px`;\n        spark.style.top = `${e.clientY}px`;\n        (spark.style as any).setProperty('--angle', `${i * 90}deg`);\n        document.body.appendChild(spark);\n        setTimeout(() => spark.remove(), 300);\n      }\n    };\n    \n    const handleRipple = (e: MouseEvent) => createEffectElement(e, 'cursor-ripple');\n\n    const handleRarityStart = (rarity: string) => setRarityClass(`cursor-rarity-${rarity.replace(' ', '_')}`);\n    const handleRarityEnd = () => setRarityClass('');\n\n    appEventEmitter.on('ui:click', handleSpark);\n    appEventEmitter.on('ui:contextmenu', handleRipple);\n    appEventEmitter.on('cursor:rarity-hover:start', handleRarityStart);\n    appEventEmitter.on('cursor:rarity-hover:end', handleRarityEnd);\n\n    return () => {\n      appEventEmitter.off('ui:click', handleSpark);\n      appEventEmitter.off('ui:contextmenu', handleRipple);\n      appEventEmitter.off('cursor:rarity-hover:start', handleRarityStart);\n      appEventEmitter.off('cursor:rarity-hover:end', handleRarityEnd);\n    };\n  }, [isClient]);\n\n  useEffect(() => {\n    document.body.classList.toggle('low-perf-mode', lowPerformanceMode);\n  }, [lowPerformanceMode]);\n\n  const renderIcon = () => {\n    switch (mode) {\n      case 'link': return <LinkIcon size={16} />;\n      case 'drag': return <Move size={16} />;\n      default: return null;\n    }\n  }\n\n  if (!isClient) return null;\n\n  return createPortal(\n    <div\n      ref={cursorWrapperRef}\n      className={cn(\n        'cursor-wrapper fixed top-0 left-0 z-[9999] pointer-events-none flex items-center justify-center -translate-x-1/2 -translate-y-1/2',\n        `cursor-style-${style}`,\n        `cursor-variant-${mode}`,\n        rarityClass\n      )}\n    >\n      <div className=\"cursor-dot\" />\n      <div className=\"cursor-trail\" />\n      <div className=\"cursor-icon\">{renderIcon()}</div>\n      {mode === 'drag' && <div className=\"cursor-label\">{text}</div>}\n    </div>,\n    document.body\n  );\n}\n\n    ","path":null,"size_bytes":3881,"size_tokens":null},"src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-sm bg-muted/50 border-2 border-primary/30\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"progress-indicator h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":834,"size_tokens":null},"backend/src/services/webrtcService.ts":{"content":"import admin from '../config/firebase';\n\nconst db = admin.firestore();\n\nexport class WebRTCService {\n  async createOffer(callId: string, offer: RTCSessionDescriptionInit) {\n    await db.collection('webrtc').doc(callId).set({\n      offer,\n      timestamp: admin.firestore.FieldValue.serverTimestamp()\n    }, { merge: true });\n  }\n\n  async createAnswer(callId: string, answer: RTCSessionDescriptionInit) {\n    await db.collection('webrtc').doc(callId).set({\n      answer,\n      timestamp: admin.firestore.FieldValue.serverTimestamp()\n    }, { merge: true });\n  }\n\n  async addIceCandidate(callId: string, candidate: RTCIceCandidateInit) {\n    await db.collection('webrtc').doc(callId).collection('candidates').add({\n      candidate,\n      timestamp: admin.firestore.FieldValue.serverTimestamp()\n    });\n  }\n\n  async getOffer(callId: string) {\n    const doc = await db.collection('webrtc').doc(callId).get();\n    return doc.exists ? doc.data()?.offer : null;\n  }\n\n  async getAnswer(callId: string) {\n    const doc = await db.collection('webrtc').doc(callId).get();\n    return doc.exists ? doc.data()?.answer : null;\n  }\n}\n","path":null,"size_bytes":1118,"size_tokens":null},"src/components/calls/ReceiverPanel.tsx":{"content":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { Phone, PhoneOff, Video, PhoneIncoming } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\n\ninterface ReceiverPanelProps {\n  callerName: string;\n  callerAvatar?: string;\n  callType: 'voice' | 'video';\n  onAccept: () => void;\n  onDecline: () => void;\n}\n\nexport default function ReceiverPanel({\n  callerName,\n  callerAvatar,\n  callType,\n  onAccept,\n  onDecline\n}: ReceiverPanelProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 z-[9999] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4\"\n    >\n      <motion.div\n        initial={{ scale: 0.8, y: -20 }}\n        animate={{ scale: 1, y: 0 }}\n        exit={{ scale: 0.8, y: -20 }}\n        transition={{ type: 'spring', damping: 20 }}\n        className=\"glass-card p-8 rounded-3xl border-2 border-green-500/30 shadow-2xl max-w-sm w-full incoming-call-animation\"\n      >\n        <div className=\"flex flex-col items-center gap-6\">\n          <div className=\"relative\">\n            <Avatar className=\"w-28 h-28 border-4 border-green-500 shadow-xl\">\n              <AvatarImage src={callerAvatar} />\n              <AvatarFallback className=\"text-4xl bg-green-500/10\">{callerName[0]}</AvatarFallback>\n            </Avatar>\n            <motion.div\n              className=\"absolute inset-0 rounded-full border-4 border-green-500\"\n              animate={{ scale: [1, 1.4, 1], opacity: [0.8, 0, 0.8] }}\n              transition={{ duration: 1.5, repeat: Infinity, ease: 'easeInOut' }}\n            />\n            <motion.div\n              className=\"absolute inset-0 rounded-full border-4 border-green-400\"\n              animate={{ scale: [1, 1.4, 1], opacity: [0.6, 0, 0.6] }}\n              transition={{ duration: 1.5, repeat: Infinity, ease: 'easeInOut', delay: 0.3 }}\n            />\n            <motion.div\n              animate={{ rotate: [0, 10, -10, 0] }}\n              transition={{ duration: 0.5, repeat: Infinity, repeatDelay: 1 }}\n              className=\"absolute -top-2 -right-2 bg-green-500 rounded-full p-2 shadow-lg\"\n            >\n              <PhoneIncoming className=\"w-5 h-5 text-white\" />\n            </motion.div>\n          </div>\n\n          <div className=\"text-center space-y-1\">\n            <h2 className=\"text-2xl font-bold text-glow\">{callerName}</h2>\n            <motion.p\n              animate={{ opacity: [0.6, 1, 0.6] }}\n              transition={{ duration: 2, repeat: Infinity }}\n              className=\"text-green-400 flex items-center gap-2 justify-center font-medium\"\n            >\n              {callType === 'video' ? (\n                <><Video className=\"w-4 h-4\" /> Incoming Video Call</>\n              ) : (\n                <><Phone className=\"w-4 h-4\" /> Incoming Voice Call</>\n              )}\n            </motion.p>\n          </div>\n\n          <div className=\"flex items-center gap-4 w-full\">\n            <Button\n              onClick={onDecline}\n              size=\"lg\"\n              className=\"flex-1 h-14 rounded-full bg-red-500 hover:bg-red-600 shadow-lg hover:shadow-xl transition-all text-base font-semibold\"\n            >\n              <PhoneOff className=\"w-5 h-5 mr-2\" />\n              Decline\n            </Button>\n            <Button\n              onClick={onAccept}\n              size=\"lg\"\n              className=\"flex-1 h-14 rounded-full bg-green-500 hover:bg-green-600 shadow-lg hover:shadow-xl transition-all text-base font-semibold\"\n            >\n              <Phone className=\"w-5 h-5 mr-2\" />\n              Accept\n            </Button>\n          </div>\n        </div>\n      </motion.div>\n    </motion.div>\n  );\n}\n","path":null,"size_bytes":3795,"size_tokens":null},"src/hooks/use-connections.ts":{"content":"\n'use client';\nimport { useState, useEffect, useCallback, useMemo } from 'react';\nimport {\n  collection,\n  query,\n  onSnapshot,\n  doc,\n  setDoc,\n  deleteDoc,\n  writeBatch,\n  getDocs,\n  serverTimestamp,\n  Timestamp,\n  where,\n  getDoc,\n  updateDoc,\n  increment\n} from 'firebase/firestore';\nimport { useFirestore, useAuth } from '@/firebase/provider';\nimport { useUser, UserProfile } from '@/hooks/use-user';\nimport { useNotifications } from './use-notifications';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { errorEmitter } from '@/firebase/error-emitter';\n\nexport type PublicUser = Omit<UserProfile, 'isAnonymous' | 'settings' | 'questResets' | 'questsCompleted' | 'interests' >;\n\n\nexport interface Connection {\n  id: string; // The ID of the other user in the connection\n  status: 'pending' | 'friends' | 'blocked';\n  requestedBy: string; // UID of user who initiated\n  createdAt: Timestamp;\n  updatedAt: Timestamp;\n}\n\nexport function useConnections() {\n  const firestore = useFirestore();\n  const auth = useAuth();\n  const { user, incrementStat } = useUser();\n  const { addNotification } = useNotifications();\n  const [connections, setConnections] = useState<Connection[]>([]);\n  const [users, setUsers] = useState<PublicUser[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // Memoize the collection references\n  const connectionsCollectionRef = useMemo(() => {\n    if (!firestore || !user) return null;\n    return collection(firestore, 'users', user.uid, 'connections');\n  }, [firestore, user]);\n\n  const usersCollectionRef = useMemo(() => {\n    if (!firestore) return null;\n    return collection(firestore, 'users');\n  }, [firestore]);\n\n  // Fetch user's connections and their profiles\n  useEffect(() => {\n    if (!connectionsCollectionRef || !firestore) {\n      setConnections([]);\n      setUsers([]);\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n\n    const unsubscribe = onSnapshot(connectionsCollectionRef, async (snapshot) => {\n      const connectionsData = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data(),\n      } as Connection));\n      \n      setConnections(connectionsData);\n\n      if (connectionsData.length > 0) {\n        const userIds = connectionsData.map(c => c.id).filter(id => id);\n        \n        if (userIds.length > 0) {\n          try {\n            const userQuery = query(collection(firestore, 'users'), where('__name__', 'in', userIds));\n            const userDocsSnapshot = await getDocs(userQuery);\n            \n            const newUsers = userDocsSnapshot.docs.map(docSnap => ({\n              ...(docSnap.data() as UserProfile),\n              id: docSnap.id,\n            }));\n\n            setUsers(newUsers);\n          } catch (error) {\n            console.error(\"Error fetching user documents for connections:\", error);\n            setUsers([]);\n          }\n        } else {\n           setUsers([]);\n        }\n      } else {\n        setUsers([]);\n      }\n      \n      setLoading(false);\n\n    }, (error) => {\n      console.error(\"Error fetching connections snapshot:\", error);\n      const permissionError = new FirestorePermissionError({\n        path: connectionsCollectionRef.path,\n        operation: 'list',\n      }, auth);\n      errorEmitter.emit('permission-error', permissionError);\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [connectionsCollectionRef, firestore, auth]);\n\n\n  const findUserByUsername = useCallback(async (username: string): Promise<PublicUser | null> => {\n    if (!usersCollectionRef) return null;\n    const q = query(usersCollectionRef, where(\"username\", \"==\", username.toLowerCase()));\n    const querySnapshot = await getDocs(q);\n    if (querySnapshot.empty) {\n      return null;\n    }\n    const userDoc = querySnapshot.docs[0];\n    const data = userDoc.data();\n    return {\n        id: userDoc.id,\n        username: data.username,\n        displayName: data.displayName || null,\n        email: data.email || null,\n        photoURL: data.photoURL || null,\n    } as PublicUser;\n  }, [usersCollectionRef]);\n\n\n  const sendFriendRequest = useCallback(async (targetUserId: string) => {\n    if (!firestore || !user || user.uid === targetUserId) return;\n\n    const batch = writeBatch(firestore);\n    const now = serverTimestamp();\n\n    const senderData = { status: 'pending' as const, requestedBy: user.uid, createdAt: now, updatedAt: now };\n    const receiverData = { status: 'pending' as const, requestedBy: user.uid, createdAt: now, updatedAt: now };\n\n    // Sender's connection doc\n    const senderRef = doc(firestore, 'users', user.uid, 'connections', targetUserId);\n    batch.set(senderRef, senderData);\n\n    // Receiver's connection doc\n    const receiverRef = doc(firestore, 'users', targetUserId, 'connections', user.uid);\n    batch.set(receiverRef, receiverData);\n\n    await batch.commit().catch(async (serverError) => {\n        const permissionError = new FirestorePermissionError({\n          path: receiverRef.path,\n          operation: 'create',\n          requestResourceData: receiverData,\n        }, auth);\n        errorEmitter.emit('permission-error', permissionError);\n      });\n\n    // Send notification to the target user\n    await addNotification({\n        type: 'friend_request',\n        title: 'New Friend Request',\n        description: `You have a new friend request from ${user.displayName || user.email}.`,\n        link: '/contacts'\n    }, targetUserId);\n    \n  }, [firestore, user, auth, addNotification]);\n\n  const acceptFriendRequest = useCallback(async (senderId: string) => {\n    if (!firestore || !user) return;\n\n    const batch = writeBatch(firestore);\n    const now = serverTimestamp();\n\n    // Acceptor's connection doc\n    const acceptorRef = doc(firestore, 'users', user.uid, 'connections', senderId);\n    batch.update(acceptorRef, { status: 'friends', updatedAt: now });\n\n    // Sender's connection doc\n    const senderRef = doc(firestore, 'users', senderId, 'connections', user.uid);\n    batch.update(senderRef, { status: 'friends', updatedAt: now });\n\n    await batch.commit();\n\n    // Increment friend count for both users after commit\n    await incrementStat('friends', 1);\n    const senderUserRef = doc(firestore, 'users', senderId);\n    await updateDoc(senderUserRef, { friends: increment(1) });\n\n\n  }, [firestore, user, incrementStat]);\n\n  const removeConnection = useCallback(async (targetUserId: string) => {\n    if (!firestore || !user) return;\n\n    const userConnRef = doc(firestore, 'users', user.uid, 'connections', targetUserId);\n    const targetConnRef = doc(firestore, 'users', targetUserId, 'connections', user.uid);\n\n    const userConnSnap = await getDoc(userConnRef);\n\n    const batch = writeBatch(firestore);\n    batch.delete(userConnRef);\n    batch.delete(targetConnRef);\n    \n    // Decrement friend counts if they were friends\n    if (userConnSnap.exists() && userConnSnap.data().status === 'friends') {\n        batch.update(doc(firestore, 'users', user.uid), { friends: increment(-1) });\n        batch.update(doc(firestore, 'users', targetUserId), { friends: increment(-1) });\n    }\n\n    await batch.commit();\n  }, [firestore, user]);\n\n  const blockUser = useCallback(async (targetUserId: string) => {\n      if (!firestore || !user) return;\n\n      const userConnRef = doc(firestore, 'users', user.uid, 'connections', targetUserId);\n      await setDoc(userConnRef, {\n        status: 'blocked',\n        requestedBy: user.uid,\n        createdAt: serverTimestamp(),\n        updatedAt: serverTimestamp()\n      }, { merge: true });\n\n       const targetConnRef = doc(firestore, 'users', targetUserId, 'connections', user.uid);\n       const targetDoc = await getDoc(targetConnRef);\n       if (targetDoc.exists()) {\n           await deleteDoc(targetConnRef);\n       }\n\n  }, [firestore, user]);\n\n\n  return { connections, users, loading, findUserByUsername, sendFriendRequest, acceptFriendRequest, removeConnection, blockUser };\n}\n","path":null,"size_bytes":7934,"size_tokens":null},"src/components/calls/MinimizedCallPanel.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { Phone, Mic, MicOff, Video, VideoOff, Maximize2 } from 'lucide-react';\nimport { motion } from 'framer-motion';\n\ninterface MinimizedCallPanelProps {\n  onMaximize: () => void;\n  onEndCall: () => void;\n  isMuted: boolean;\n  isVideoOff: boolean;\n  onToggleMute: () => void;\n  onToggleVideo: () => void;\n  callerName: string;\n  callerAvatar?: string;\n  duration: string;\n}\n\nexport default function MinimizedCallPanel({\n  onMaximize,\n  onEndCall,\n  isMuted,\n  isVideoOff,\n  onToggleMute,\n  onToggleVideo,\n  callerName,\n  callerAvatar,\n  duration\n}: MinimizedCallPanelProps) {\n  const [position, setPosition] = useState({ x: window.innerWidth - 100, y: 100 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [showControls, setShowControls] = useState(false);\n\n  return (\n    <motion.div\n      drag\n      dragMomentum={false}\n      dragElastic={0}\n      onDragStart={() => setIsDragging(true)}\n      onDragEnd={(e, info) => {\n        setIsDragging(false);\n        setPosition({ x: info.point.x, y: info.point.y });\n      }}\n      initial={{ scale: 0, opacity: 0 }}\n      animate={{ scale: 1, opacity: 1 }}\n      exit={{ scale: 0, opacity: 0 }}\n      onMouseEnter={() => setShowControls(true)}\n      onMouseLeave={() => setShowControls(false)}\n      className=\"fixed z-[9999] cursor-move\"\n      style={{ x: position.x, y: position.y }}\n    >\n      <div className=\"relative\">\n        {/* Main Dot */}\n        <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-primary to-primary/70 shadow-lg shadow-primary/50 flex items-center justify-center border-2 border-primary/30 animate-pulse\">\n          {callerAvatar ? (\n            <img src={callerAvatar} alt={callerName} className=\"w-full h-full rounded-full object-cover\" />\n          ) : (\n            <Phone className=\"w-6 h-6 text-white\" />\n          )}\n        </div>\n\n        {/* Duration Badge */}\n        <div className=\"absolute -top-2 -right-2 bg-background/90 backdrop-blur-sm border border-primary/30 rounded-full px-2 py-0.5 text-[10px] font-mono text-primary\">\n          {duration}\n        </div>\n\n        {/* Controls Panel */}\n        {showControls && (\n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"absolute top-20 left-1/2 -translate-x-1/2 bg-background/95 backdrop-blur-md border border-primary/30 rounded-xl p-2 shadow-xl flex gap-1\"\n          >\n            <button\n              onClick={onToggleMute}\n              className=\"p-2 rounded-lg hover:bg-primary/20 transition-colors\"\n              title={isMuted ? 'Unmute' : 'Mute'}\n            >\n              {isMuted ? <MicOff className=\"w-4 h-4 text-red-400\" /> : <Mic className=\"w-4 h-4 text-primary\" />}\n            </button>\n            <button\n              onClick={onToggleVideo}\n              className=\"p-2 rounded-lg hover:bg-primary/20 transition-colors\"\n              title={isVideoOff ? 'Turn on video' : 'Turn off video'}\n            >\n              {isVideoOff ? <VideoOff className=\"w-4 h-4 text-red-400\" /> : <Video className=\"w-4 h-4 text-primary\" />}\n            </button>\n            <button\n              onClick={onMaximize}\n              className=\"p-2 rounded-lg hover:bg-primary/20 transition-colors\"\n              title=\"Maximize\"\n            >\n              <Maximize2 className=\"w-4 h-4 text-primary\" />\n            </button>\n            <button\n              onClick={onEndCall}\n              className=\"p-2 rounded-lg hover:bg-red-500/20 transition-colors\"\n              title=\"End call\"\n            >\n              <Phone className=\"w-4 h-4 text-red-400 rotate-[135deg]\" />\n            </button>\n          </motion.div>\n        )}\n      </div>\n    </motion.div>\n  );\n}\n","path":null,"size_bytes":3777,"size_tokens":null},"src/services/cloudflare-service.ts":{"content":"\n/**\n * @fileOverview A backend service to interact with the Cloudflare API for video calls.\n * This service is responsible for creating rooms and generating client tokens.\n * It should only be called from secure backend flows (e.g., Genkit flows),\n * never directly from the client.\n */\n\nimport { z } from 'zod';\n\nconst CLOUDFLARE_API_BASE = 'https://api.cloudflare.com/client/v4';\n\nconst CreateMeetingResponseSchema = z.object({\n  result: z.object({\n    id: z.string(),\n  }),\n  success: z.boolean(),\n});\n\nconst AddParticipantResponseSchema = z.object({\n  result: z.object({\n    auth_token: z.string(),\n  }),\n  success: z.boolean(),\n});\n\nasync function createCfMeeting(): Promise<string> {\n  const accountId = process.env.CLOUDFLARE_ACCOUNT_ID;\n  const appId = process.env.CLOUDFLARE_APP_ID;\n  const apiToken = process.env.CLOUDFLARE_API_TOKEN;\n\n  if (!accountId || !appId || !apiToken) {\n    throw new Error('Cloudflare credentials are not configured in environment variables.');\n  }\n\n  const response = await fetch(`${CLOUDFLARE_API_BASE}/accounts/${accountId}/realtime/kit/${appId}/meetings`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${apiToken}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      title: `Aetherweave Call - ${new Date().toISOString()}`,\n    }),\n  });\n\n  const data = await response.json();\n  const parsed = CreateMeetingResponseSchema.safeParse(data);\n\n  if (!parsed.success || !parsed.data.success) {\n    console.error('Cloudflare create meeting failed:', parsed.error || data.errors);\n    throw new Error('Failed to create Cloudflare meeting.');\n  }\n  \n  return parsed.data.result.id;\n}\n\n\nasync function createCfParticipantToken(meetingId: string, userId: string, userName: string): Promise<string> {\n  const accountId = process.env.CLOUDFLARE_ACCOUNT_ID;\n  const appId = process.env.CLOUDFLARE_APP_ID;\n  const apiToken = process.env.CLOUDFLARE_API_TOKEN;\n  \n  if (!accountId || !appId || !apiToken) {\n    throw new Error('Cloudflare credentials are not configured.');\n  }\n  \n  const response = await fetch(`${CLOUDFLARE_API_BASE}/accounts/${accountId}/realtime/kit/${appId}/meetings/${meetingId}/participants`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${apiToken}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      name: userName,\n      preset_name: 'default-participant',\n      custom_participant_id: userId\n    }),\n  });\n\n  const data = await response.json();\n  const parsed = AddParticipantResponseSchema.safeParse(data);\n  \n  if (!parsed.success || !parsed.data.success) {\n    console.error('Cloudflare add participant failed:', parsed.error || data.errors);\n    throw new Error('Failed to create Cloudflare participant token.');\n  }\n  \n  return parsed.data.result.auth_token;\n}\n\nexport async function createCfSession(userId: string, userName: string): Promise<{ meetingId: string; clientToken: string }> {\n  try {\n    const meetingId = await createCfMeeting();\n    console.log(`[CF Service] Created meeting: ${meetingId}`);\n    const clientToken = await createCfParticipantToken(meetingId, userId, userName);\n    console.log(`[CF Service] Created token for user ${userId} in meeting ${meetingId}`);\n    return { meetingId, clientToken };\n  } catch (error) {\n    console.error('[CF Service] Error creating session:', error);\n    throw new Error('Could not create Cloudflare session.');\n  }\n}\n","path":null,"size_bytes":3440,"size_tokens":null},"src/app/api/news/route.ts":{"content":"// src/app/api/news/route.ts\nimport { fetchNews } from '@/services/news-service';\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const category = searchParams.get('category');\n  const q = searchParams.get('q');\n  const page = searchParams.get('page');\n  const pageSize = searchParams.get('pageSize');\n\n  try {\n    const newsData = await fetchNews({\n      category: category || undefined,\n      q: q || undefined,\n      page: page || undefined,\n      pageSize: pageSize || undefined,\n    });\n    return NextResponse.json(newsData);\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n","path":null,"size_bytes":747,"size_tokens":null},"src/app/news/page.tsx":{"content":"\n// src/app/news/page.tsx\n'use client';\nimport { useState, useEffect, useCallback, memo } from 'react';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Loader2, Search, Settings } from 'lucide-react';\nimport { NewsArticleCard } from '@/components/news/NewsArticleCard';\nimport { useInView } from 'react-intersection-observer';\n\nexport type Article = {\n  title: string;\n  url: string;\n  description: string;\n  urlToImage: string | null;\n  publishedAt: string;\n  source: {\n    id: string | null;\n    name: string;\n  };\n};\n\nconst categories = [\n  { id: 'general', name: 'Breaking News' },\n  { id: 'world', name: 'World' },\n  { id: 'technology', name: 'Tech' },\n  { id: 'sports', name: 'Sports' },\n  { id: 'entertainment', name: 'Entertainment' },\n  { id: 'business', name: 'Business' },\n  { id: 'science', name: 'Science' },\n];\n\nconst MemoizedNewsArticleCard = memo(NewsArticleCard);\nMemoizedNewsArticleCard.displayName = \"MemoizedNewsArticleCard\";\n\nexport default function NewsPage() {\n  const [articles, setArticles] = useState<Article[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [activeCategory, setActiveCategory] = useState('general');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [page, setPage] = useState(1);\n  const [totalResults, setTotalResults] = useState(0);\n  const [currentSearch, setCurrentSearch] = useState('');\n\n  const { ref: loadMoreRef, inView } = useInView({\n    threshold: 1.0,\n  });\n\n  const fetchArticles = useCallback(async (category: string, query?: string, pageNum: number = 1) => {\n    setLoading(true);\n    setError(null);\n    if (pageNum === 1) {\n      setArticles([]);\n    }\n\n    try {\n      const params: any = { page: String(pageNum), pageSize: '20' };\n      if (query) {\n        params.q = query;\n      } else {\n        params.category = category;\n      }\n      \n      const response = await fetch(`/api/news?${new URLSearchParams(params).toString()}`);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to fetch news');\n      }\n      const data = await response.json();\n      \n      setArticles(prev => pageNum > 1 ? [...prev, ...data.articles] : data.articles);\n      setTotalResults(data.totalResults);\n      setPage(pageNum);\n\n    } catch (e: any) {\n      setError(e.message);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // Effect for initial load and category/search changes\n  useEffect(() => {\n    fetchArticles(activeCategory, currentSearch, 1);\n  }, [activeCategory, currentSearch, fetchArticles]);\n\n  // Effect for infinite scroll\n  useEffect(() => {\n    const hasMore = articles.length < totalResults;\n    if (inView && !loading && hasMore) {\n      fetchArticles(activeCategory, currentSearch, page + 1);\n    }\n  }, [inView, loading, articles.length, totalResults, page, activeCategory, currentSearch, fetchArticles]);\n  \n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    setCurrentSearch(searchTerm);\n    setActiveCategory(''); // Reset category when searching\n  };\n  \n  const handleCategoryChange = (value: string) => {\n    setSearchTerm('');\n    setCurrentSearch('');\n    setActiveCategory(value);\n  };\n\n  return (\n    <div className=\"flex flex-col h-full gap-6\">\n      <header className=\"flex flex-col md:flex-row items-center justify-between gap-4\">\n        <h1 className=\"text-3xl font-headline text-glow\">News Feed</h1>\n        <div className=\"flex w-full md:w-auto items-center gap-2\">\n           <form onSubmit={handleSearch} className=\"relative flex-1\">\n             <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n             <Input \n                name=\"search\" \n                placeholder=\"Search news...\" \n                className=\"pl-10 bg-input\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n            />\n           </form>\n           <Button variant=\"outline\" size=\"icon\"><Settings/></Button>\n        </div>\n      </header>\n\n      <Tabs value={activeCategory} onValueChange={handleCategoryChange}>\n        <TabsList className=\"grid w-full grid-cols-3 md:grid-cols-7\">\n          {categories.map(cat => (\n            <TabsTrigger key={cat.id} value={cat.id}>{cat.name}</TabsTrigger>\n          ))}\n        </TabsList>\n      </Tabs>\n\n      <div className=\"flex-1 overflow-y-auto custom-scroll pr-4 -mr-4\">\n        {error && <div className=\"text-center text-destructive\">{error}</div>}\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n          {articles.map((article, index) => (\n            <MemoizedNewsArticleCard key={article.url + index} article={article} />\n          ))}\n        </div>\n        \n        {loading && (\n           <div className=\"flex justify-center items-center py-8\">\n             <Loader2 className=\"w-8 h-8 animate-spin text-primary\"/>\n           </div>\n        )}\n\n        { !loading && articles.length > 0 && articles.length < totalResults && (\n          <div ref={loadMoreRef} className=\"h-10\" />\n        )}\n        \n        {!loading && articles.length > 0 && articles.length >= totalResults && (\n          <p className=\"text-center text-muted-foreground py-8\">End of results.</p>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5497,"size_tokens":null},"src/firebase/client-provider.tsx":{"content":"'use client';\nimport React, { useMemo, type ReactNode } from 'react';\nimport { initializeFirebase } from './index';\nimport { FirebaseProvider } from './provider';\n\nexport function FirebaseClientProvider({ children }: { children: ReactNode }) {\n  const firebaseInstances = useMemo(() => initializeFirebase(), []);\n\n  return (\n    <FirebaseProvider value={firebaseInstances}>\n      {children}\n    </FirebaseProvider>\n  );\n}\n","path":null,"size_bytes":422,"size_tokens":null},"backend/src/controllers/testController.ts":{"content":"import { Request, Response } from 'express';\nimport { auth, db } from '../config/firebase';\n\nexport const createTestUser = async (req: Request, res: Response) => {\n  try {\n    const testEmail = 'test@aether.corp';\n    const testPassword = 'password123';\n    const testDisplayName = 'Test Operator';\n\n    // Create user in Firebase Auth\n    const userRecord = await auth.createUser({\n      email: testEmail,\n      password: testPassword,\n      displayName: testDisplayName,\n    });\n\n    // Create user document in Firestore\n    await db.collection('users').doc(userRecord.uid).set({\n      id: userRecord.uid,\n      username: 'testoperator',\n      email: testEmail,\n      displayName: testDisplayName,\n      photoURL: '',\n      bio: 'Test operator in the matrix.',\n      status: 'Online',\n      isAnonymous: false,\n      createdAt: new Date(),\n      xp: 100,\n      level: 1,\n      trustScore: 50,\n      streak: 1,\n      badgesUnlocked: ['pioneer'],\n      inventory: [],\n      questsCompleted: [],\n      questResets: {\n        daily: new Date(),\n        weekly: new Date(),\n        seasonal: new Date(),\n      },\n      messagesSent: 0,\n      notesCreated: 0,\n      filesUploaded: 0,\n      friends: 0,\n    });\n\n    res.json({\n      message: 'Test user created successfully',\n      email: testEmail,\n      password: testPassword,\n      uid: userRecord.uid,\n    });\n\n  } catch (error: any) {\n    console.error('Error creating test user:', error);\n    \n    if (error.code === 'auth/email-already-exists') {\n      return res.json({\n        message: 'Test user already exists',\n        email: 'test@aether.corp',\n        password: 'password123',\n      });\n    }\n\n    res.status(500).json({ error: 'Failed to create test user', details: error.message });\n  }\n};","path":null,"size_bytes":1751,"size_tokens":null},"src/components/chat/MessageInput.tsx":{"content":"\n'use client';\nimport { useState, useRef, useEffect } from 'react';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Send, Smile, Paperclip, Loader2, X, Image as ImageIcon, Video, File as FileIcon } from 'lucide-react';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport EmojiPicker from './EmojiPicker';\nimport { Message, aetherBotContact, Contact } from '@/types/chat';\nimport { useUser } from '@/hooks/use-user';\nimport { useFirestore } from '@/firebase/provider';\nimport { runAssistantStream } from '@/ai/flows/assistant-stream-flow';\nimport { collection, addDoc, serverTimestamp, doc, updateDoc } from 'firebase/firestore';\nimport { errorEmitter } from '@/firebase/error-emitter';\nimport { FirestorePermissionError } from '@/firebase/errors';\nimport { useAuth } from '@/firebase/provider';\nimport { appEventEmitter } from '@/lib/event-emitter';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { uploadToCloudflare } from '@/lib/cloudflare-r2';\nimport { Progress } from '../ui/progress';\n\ninterface MessageInputProps {\n    chatId: string | null;\n    selectedContact: Contact | null;\n    messages: Message[];\n    setMessages: React.Dispatch<React.SetStateAction<Message[]>>;\n    replyingTo: Message | null;\n    setReplyingTo: (message: Message | null) => void;\n    forwardingMessage: Message | null;\n    setForwardingMessage: (message: Message | null) => void;\n}\n\nconst UploadPreview = ({ file, onCancel, onSend }: { file: File, onCancel: () => void, onSend: () => void }) => {\n    const [preview, setPreview] = useState<string | null>(null);\n\n    useEffect(() => {\n        if (file.type.startsWith('image/')) {\n            const reader = new FileReader();\n            reader.onloadend = () => {\n                setPreview(reader.result as string);\n            };\n            reader.readAsDataURL(file);\n        }\n    }, [file]);\n\n    const getFileIcon = () => {\n        if (file.type.startsWith('video/')) return <Video className=\"w-10 h-10 text-primary\" />;\n        return <FileIcon className=\"w-10 h-10 text-muted-foreground\" />;\n    };\n\n    return (\n        <motion.div\n            className=\"p-2 mb-2 bg-muted/80 rounded-t-md text-sm border-b border-border\"\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n        >\n            <div className=\"flex items-center gap-3\">\n                <div className=\"w-16 h-16 bg-background rounded-md flex items-center justify-center overflow-hidden\">\n                    {preview ? <img src={preview} alt=\"preview\" className=\"w-full h-full object-cover\" /> : getFileIcon()}\n                </div>\n                <div className=\"flex-1\">\n                    <p className=\"font-semibold truncate\">{file.name}</p>\n                    <p className=\"text-xs text-muted-foreground\">{(file.size / 1024).toFixed(1)} KB</p>\n                </div>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={onCancel}><X size={16} /></Button>\n                <Button size=\"sm\" onClick={onSend}><Send size={16} className=\"mr-2\"/> Send</Button>\n            </div>\n        </motion.div>\n    );\n}\n\n\nexport default function MessageInput({ chatId, selectedContact, messages, setMessages, replyingTo, setReplyingTo, forwardingMessage, setForwardingMessage }: MessageInputProps) {\n    const [input, setInput] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n    const [fileToUpload, setFileToUpload] = useState<File | null>(null);\n    const [uploadProgress, setUploadProgress] = useState<number | null>(null);\n\n    const { user, profile, incrementStat } = useUser();\n    const firestore = useFirestore();\n    const auth = useAuth();\n\n    const inputRef = useRef<HTMLInputElement>(null);\n    const fileInputRef = useRef<HTMLInputElement>(null);\n\n    useEffect(() => {\n        if (replyingTo) {\n            inputRef.current?.focus();\n        }\n    }, [replyingTo]);\n\n    useEffect(() => {\n        const handleForwardMessage = (message: Message) => {\n            setForwardingMessage(message);\n        };\n        appEventEmitter.on('chat:forward-message', handleForwardMessage);\n        return () => {\n            appEventEmitter.off('chat:forward-message', handleForwardMessage);\n        };\n    }, [setForwardingMessage]);\n    \n    const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const file = e.target.files?.[0];\n        if (file) {\n            setFileToUpload(file);\n        }\n    };\n\n    const handleSend = async (text: string, media?: { url: string; type: string }) => {\n        if (!user || !chatId || !profile) return;\n        \n        const replyContext = replyingTo ? {\n            replyTo: replyingTo.id,\n            replyContent: replyingTo.content,\n            replySender: replyingTo.senderName,\n        } : {};\n\n        const forwardedContent = forwardingMessage ? `📤 Forwarded: ${forwardingMessage.content}` : text;\n        const finalContent = forwardingMessage ? forwardedContent : text;\n\n        setInput('');\n        setReplyingTo(null);\n        setForwardingMessage(null);\n        setFileToUpload(null);\n\n        // Handle AI bot chat\n        if (chatId === 'aether-bot') {\n            setIsLoading(true);\n            const userMessage: Message = {\n                id: `temp-${Date.now()}`,\n                senderId: user.uid,\n                senderName: profile.displayName || 'You',\n                senderAvatar: profile.photoURL || '',\n                content: finalContent,\n                timestamp: null,\n                role: 'user',\n                status: 'sent',\n                participants: [user.uid, 'aether-bot']\n            };\n            const updatedMessages = [...messages, userMessage];\n            setMessages(updatedMessages);\n            localStorage.setItem(`aether-bot-${user.uid}`, JSON.stringify(updatedMessages));\n\n            try {\n                const history = messages.map(m => ({ role: m.role || 'user', content: m.content }));\n                const stream = await runAssistantStream({ history, prompt: finalContent });\n                \n                let botResponse = '';\n                const botMessage: Message = {\n                    id: `bot-${Date.now()}`,\n                    senderId: 'aether-bot',\n                    senderName: 'Aether',\n                    senderAvatar: '',\n                    content: '',\n                    timestamp: null,\n                    role: 'model',\n                    status: 'sent',\n                    participants: [user.uid, 'aether-bot']\n                };\n                setMessages(prev => {\n                    const newMessages = [...prev, botMessage];\n                    localStorage.setItem(`aether-bot-${user.uid}`, JSON.stringify(newMessages));\n                    return newMessages;\n                });\n\n                for await (const chunk of stream) {\n                    botResponse += chunk;\n                    setMessages(prev => {\n                        const newMessages = prev.map(m => m.id === botMessage.id ? { ...m, content: botResponse } : m);\n                        localStorage.setItem(`aether-bot-${user.uid}`, JSON.stringify(newMessages));\n                        return newMessages;\n                    });\n                }\n                await incrementStat('messagesSent', 1);\n            } catch (error) {\n                console.error('AI error:', error);\n            } finally {\n                setIsLoading(false);\n            }\n            return;\n        }\n\n        if (!firestore) return;\n        \n        const messagesCollection = collection(firestore, 'chats', chatId, 'messages');\n        const participants = [user.uid, selectedContact?.id].filter((id): id is string => !!id);\n\n        const messageData = {\n            senderId: user.uid,\n            senderName: profile.displayName || profile.email || 'Unknown',\n            senderAvatar: profile.photoURL || null,\n            content: finalContent,\n            timestamp: serverTimestamp(),\n            status: 'sent' as const,\n            participants: participants,\n            ...(media && { mediaUrl: media.url, mediaType: media.type }),\n            ...replyContext,\n        };\n\n        try {\n            await addDoc(messagesCollection, messageData);\n            const chatRef = doc(firestore, 'chats', chatId);\n            await updateDoc(chatRef, {\n                lastMessage: media ? (media.type.startsWith('image') ? '📷 Image' : '📎 Attachment') : text,\n                lastMessageTimestamp: serverTimestamp(),\n            });\n            if (!media) {\n                await incrementStat('messagesSent', 1);\n            } else {\n                 await incrementStat('filesUploaded', 1);\n            }\n        } catch (error: any) {\n            console.error('Error sending message:', error);\n            const permissionError = new FirestorePermissionError({\n                path: messagesCollection.path,\n                operation: 'create',\n                requestResourceData: messageData,\n            }, auth);\n            errorEmitter.emit('permission-error', permissionError);\n        }\n    };\n    \n    const handleUploadAndSend = async () => {\n        if (!fileToUpload || !chatId) return;\n        setIsLoading(true);\n        setUploadProgress(50);\n\n        try {\n            const downloadURL = await uploadToCloudflare(fileToUpload);\n            setUploadProgress(100);\n            await handleSend(input, { url: downloadURL, type: fileToUpload.type });\n        } catch (error) {\n            console.error('Upload failed:', error);\n        } finally {\n            setIsLoading(false);\n            setUploadProgress(null);\n            setFileToUpload(null);\n        }\n    }\n    \n    const handleFormSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (fileToUpload) {\n            handleUploadAndSend();\n        } else if (input.trim()) {\n            handleSend(input);\n        }\n    }\n\n    const handleEmojiSelect = (emoji: string) => {\n        setInput(prev => prev + emoji);\n        inputRef.current?.focus();\n    }\n\n    return (\n        <div className=\"p-4 border-t\">\n            <AnimatePresence>\n                {fileToUpload && !isLoading && (\n                    <UploadPreview\n                        file={fileToUpload}\n                        onCancel={() => setFileToUpload(null)}\n                        onSend={handleUploadAndSend}\n                    />\n                )}\n                {isLoading && uploadProgress !== null && (\n                    <div className=\"p-2 mb-2\">\n                        <p className=\"text-xs text-center text-muted-foreground mb-2\">Uploading...</p>\n                        <Progress value={uploadProgress} className=\"h-2\" />\n                    </div>\n                )}\n                {replyingTo && (\n                    <motion.div \n                        className=\"p-2 mb-2 bg-muted/80 rounded-t-md text-sm border-b border-border\"\n                        initial={{ opacity: 0, height: 0 }}\n                        animate={{ opacity: 1, height: 'auto' }}\n                        exit={{ opacity: 0, height: 0 }}\n                    >\n                        <div className=\"flex justify-between items-center\">\n                            <div>\n                                <p className=\"text-muted-foreground\">Replying to <span className=\"font-bold text-primary\">{replyingTo.senderName}</span></p>\n                                <p className=\"text-foreground truncate max-w-sm\">{replyingTo.content}</p>\n                            </div>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => setReplyingTo(null)}>\n                                <X size={16} />\n                            </Button>\n                        </div>\n                    </motion.div>\n                )}\n                {forwardingMessage && (\n                    <motion.div \n                        className=\"p-2 mb-2 bg-muted/80 rounded-t-md text-sm border-b border-border\"\n                        initial={{ opacity: 0, height: 0 }}\n                        animate={{ opacity: 1, height: 'auto' }}\n                        exit={{ opacity: 0, height: 0 }}\n                    >\n                        <div className=\"flex justify-between items-center\">\n                            <div>\n                                <p className=\"text-muted-foreground\">Forwarding message from <span className=\"font-bold text-primary\">{forwardingMessage.senderName}</span></p>\n                                <p className=\"text-foreground truncate max-w-sm\">{forwardingMessage.content}</p>\n                            </div>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => setForwardingMessage(null)}>\n                                <X size={16} />\n                            </Button>\n                        </div>\n                    </motion.div>\n                )}\n            </AnimatePresence>\n            <form onSubmit={handleFormSubmit} className=\"relative\">\n                 <input type=\"file\" ref={fileInputRef} onChange={handleFileSelect} className=\"hidden\" />\n                <Input\n                    ref={inputRef}\n                    placeholder=\"Type a message...\"\n                    className=\"pr-24 bg-input\"\n                    value={input}\n                    onChange={e => setInput(e.target.value)}\n                    disabled={isLoading}\n                />\n                <div className=\"absolute right-2 top-1/2 -translate-y-1/2 flex items-center\">\n                    <Popover>\n                        <PopoverTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" type=\"button\">\n                                <Smile className=\"w-5 h-5 text-muted-foreground\" />\n                            </Button>\n                        </PopoverTrigger>\n                        <PopoverContent side=\"top\" align=\"end\" className=\"p-0\">\n                            <EmojiPicker onEmojiSelect={handleEmojiSelect} />\n                        </PopoverContent>\n                    </Popover>\n                    <Button variant=\"ghost\" size=\"icon\" type=\"button\" onClick={() => alert('File uploads temporarily disabled')} disabled={true}><Paperclip className=\"w-5 h-5 text-muted-foreground opacity-50\" /></Button>\n                    <Button size=\"icon\" type=\"submit\" className=\"ml-2 w-8 h-8\" disabled={isLoading || (!input.trim() && !fileToUpload)}>\n                        {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Send className=\"w-4 h-4\" />}\n                    </Button>\n                </div>\n            </form>\n        </div>\n    );\n}\n","path":null,"size_bytes":14796,"size_tokens":null},"backend/src/routes/aiRoutes.ts":{"content":"import { Router } from 'express';\nimport { authenticateToken } from '../middleware/auth';\nimport { aiRateLimitMiddleware } from '../middleware/rateLimiter';\nimport { chatWithAI, generateImage, translateText } from '../controllers/aiController';\n\nconst router = Router();\n\n// All AI routes require authentication and rate limiting\nrouter.use(authenticateToken);\nrouter.use(aiRateLimitMiddleware);\n\n// POST /api/ai/chat - Chat with AI assistant\nrouter.post('/chat', chatWithAI);\n\n// POST /api/ai/generate-image - Generate image from prompt\nrouter.post('/generate-image', generateImage);\n\n// POST /api/ai/translate - Translate text\nrouter.post('/translate', translateText);\n\nexport default router;","path":null,"size_bytes":694,"size_tokens":null},"src/ai/flows/summarize-notes.ts":{"content":"'use server';\n\n/**\n * @fileOverview AI summarization flow for notes.\n *\n * - summarizeNotes - A function that summarizes notes using AI.\n * - SummarizeNotesInput - The input type for the summarizeNotes function.\n * - SummarizeNotesOutput - The return type for the summarizeNotes function.\n */\n\nimport {ai} from '@/ai/genkit';\nimport {z} from 'genkit';\n\nconst SummarizeNotesInputSchema = z.object({\n  notes: z.string().describe('The notes to summarize.'),\n});\nexport type SummarizeNotesInput = z.infer<typeof SummarizeNotesInputSchema>;\n\nconst SummarizeNotesOutputSchema = z.object({\n  summary: z.string().describe('The summary of the notes.'),\n});\nexport type SummarizeNotesOutput = z.infer<typeof SummarizeNotesOutputSchema>;\n\nexport async function summarizeNotes(input: SummarizeNotesInput): Promise<SummarizeNotesOutput> {\n  return summarizeNotesFlow(input);\n}\n\nconst summarizeNotesPrompt = ai.definePrompt({\n  name: 'summarizeNotesPrompt',\n  input: {schema: SummarizeNotesInputSchema},\n  output: {schema: SummarizeNotesOutputSchema},\n  prompt: `You are an AI assistant specializing in summarizing notes. Please provide a concise and informative summary of the following notes:\\n\\n{{{notes}}}`,\n});\n\nconst summarizeNotesFlow = ai.defineFlow(\n  {\n    name: 'summarizeNotesFlow',\n    inputSchema: SummarizeNotesInputSchema,\n    outputSchema: SummarizeNotesOutputSchema,\n  },\n  async input => {\n    const {output} = await summarizeNotesPrompt(input);\n    return output!;\n  }\n);\n","path":null,"size_bytes":1478,"size_tokens":null},"src/components/user/user-profile-modal.tsx":{"content":"\n'use client';\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogDescription,\n} from '@/components/ui/dialog';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Award, Zap, Shield, Calendar, Loader2 } from 'lucide-react';\nimport { useFirestore } from '@/firebase/provider';\nimport { doc, onSnapshot } from 'firebase/firestore';\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { UserProfile } from '@/hooks/use-user';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { format, formatDistanceToNowStrict } from 'date-fns';\nimport { achievements } from '@/lib/achievements';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from '@/lib/utils';\n\nconst getDerivedStatus = (profile: UserProfile | null): {label: string, color: string, isOnline: boolean} => {\n    if (!profile) return {label: 'Offline', color: 'bg-muted-foreground', isOnline: false};\n    if (profile.status && profile.status !== 'Online' && profile.status !== 'Offline') {\n        return {label: profile.status, color: 'bg-yellow-500', isOnline: true};\n    }\n    if (profile.lastSeen && profile.lastSeen.toDate) {\n        const lastSeenDate = profile.lastSeen.toDate();\n        const minutesSinceSeen = (new Date().getTime() - lastSeenDate.getTime()) / (1000 * 60);\n        if (minutesSinceSeen < 5) {\n            return {label: 'Online', color: 'bg-green-500', isOnline: true};\n        }\n    }\n    return {label: 'Offline', color: 'bg-muted-foreground', isOnline: false};\n}\n\ninterface UserProfileModalProps {\n    userId: string;\n    onOpenChange: (isOpen: boolean) => void;\n}\n\nexport default function UserProfileModal({ userId, onOpenChange }: UserProfileModalProps) {\n    const firestore = useFirestore();\n    const [profile, setProfile] = useState<UserProfile | null>(null);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        if (!userId) return;\n        setLoading(true);\n        const profileDocRef = doc(firestore, 'users', userId);\n        const unsubscribe = onSnapshot(profileDocRef, (docSnap) => {\n            if (docSnap.exists()) {\n                setProfile({...(docSnap.data() as UserProfile), id: docSnap.id });\n            } else {\n                setProfile(null);\n            }\n            setLoading(false);\n        }, (error) => {\n            console.error(\"Error fetching user profile for modal:\", error);\n            setLoading(false);\n        });\n\n        return () => unsubscribe();\n    }, [userId, firestore]);\n    \n    const xpForNextLevel = (profile?.level ?? 0) * 1000 + 1000;\n    const xpPercentage = profile ? (profile.xp / xpForNextLevel) * 100 : 0;\n    const derivedStatus = getDerivedStatus(profile);\n    const accountCreationDate = useMemo(() => {\n        if (profile?.createdAt) {\n            try {\n                if (profile.createdAt.toDate) {\n                    return format(profile.createdAt.toDate(), 'MMMM d, yyyy');\n                }\n                return format(new Date(profile.createdAt as any), 'MMMM d, yyyy');\n            } catch (e) { return \"N/A\"; }\n        }\n        return 'N/A';\n    }, [profile?.createdAt]);\n\n    const isAchievementUnlocked = (achievementId: string) => {\n        return profile?.badgesUnlocked?.includes(achievementId) ?? false;\n    };\n    \n    return (\n        <Dialog open={true} onOpenChange={onOpenChange}>\n            <DialogContent className=\"sm:max-w-[425px] glass-card\">\n                {loading || !profile ? (\n                    <div className=\"flex flex-col items-center p-6\">\n                        <Loader2 className=\"w-12 h-12 animate-spin text-primary\"/>\n                        <p className=\"mt-4 text-muted-foreground\">Loading Operator Dossier...</p>\n                    </div>\n                ) : (\n                    <>\n                        <DialogHeader className=\"text-center items-center\">\n                            <div className=\"relative\">\n                                <Avatar className=\"w-24 h-24 border-4 border-primary neon-glow-primary\">\n                                    <AvatarImage src={profile.photoURL ?? ''} />\n                                    <AvatarFallback className=\"text-3xl\">{profile.displayName?.charAt(0) || 'U'}</AvatarFallback>\n                                </Avatar>\n                                <TooltipProvider>\n                                    <Tooltip>\n                                        <TooltipTrigger asChild>\n                                            <div className={cn(\"absolute top-1 right-1 w-4 h-4 rounded-full border-2 border-background\", derivedStatus.color)}></div>\n                                        </TooltipTrigger>\n                                        <TooltipContent><p>{derivedStatus.label}</p></TooltipContent>\n                                    </Tooltip>\n                                </TooltipProvider>\n                            </div>\n                            <DialogTitle className=\"text-2xl font-headline text-glow mt-4\">{profile.displayName}</DialogTitle>\n                            <DialogDescription>@{profile.username}</DialogDescription>\n                            <p className=\"text-sm text-muted-foreground pt-2\">{profile.bio}</p>\n                        </DialogHeader>\n                        <div className=\"space-y-4 py-4\">\n                            <div className=\"space-y-1\">\n                                <div className=\"flex justify-between text-xs text-muted-foreground\">\n                                    <span>XP</span>\n                                    <span>{profile.xp} / {xpForNextLevel}</span>\n                                </div>\n                                <Progress value={xpPercentage} className=\"h-2\" />\n                            </div>\n                            <div className=\"grid grid-cols-3 gap-2 text-center\">\n                                <div><p className=\"font-bold text-lg text-glow\">{profile.level}</p><p className=\"text-xs text-muted-foreground\">Level</p></div>\n                                <div><p className=\"font-bold text-lg text-glow\">{'N/A'}</p><p className=\"text-xs text-muted-foreground\">Reputation</p></div>\n                                <div><p className=\"font-bold text-lg text-glow\">{profile.trustScore ?? 0}</p><p className=\"text-xs text-muted-foreground\">Trust</p></div>\n                            </div>\n                            <div className=\"flex items-center text-xs text-muted-foreground justify-center\">\n                                <Calendar className=\"w-3 h-3 mr-1.5\"/>\n                                Operator since {accountCreationDate}\n                            </div>\n                            <div className=\"border-t border-border pt-4\">\n                                <h4 className=\"text-center font-semibold mb-2 text-muted-foreground\">Badges</h4>\n                                <div className=\"flex justify-center flex-wrap gap-2\">\n                                    {achievements.slice(0, 5).map(badge => {\n                                        const unlocked = isAchievementUnlocked(badge.id);\n                                        if (unlocked) {\n                                            return (\n                                                <TooltipProvider key={badge.id}>\n                                                    <Tooltip>\n                                                        <TooltipTrigger asChild>\n                                                            <div className=\"p-2 bg-secondary/20 rounded-full border-2 border-secondary\">\n                                                                <badge.icon className=\"w-5 h-5 text-secondary-foreground\" />\n                                                            </div>\n                                                        </TooltipTrigger>\n                                                        <TooltipContent><p>{badge.name}</p></TooltipContent>\n                                                    </Tooltip>\n                                                </TooltipProvider>\n                                            );\n                                        }\n                                        return null;\n                                    })}\n                                    {profile.badgesUnlocked.length === 0 && <p className=\"text-xs text-muted-foreground\">No badges earned yet.</p>}\n                                </div>\n                            </div>\n                        </div>\n                    </>\n                )}\n            </DialogContent>\n        </Dialog>\n    );\n}\n\n    ","path":null,"size_bytes":8788,"size_tokens":null},"src/components/ui/online-indicator.tsx":{"content":"'use client';\nimport { useState, useEffect } from 'react';\nimport { Wifi, WifiOff } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\n\nexport default function OnlineIndicator() {\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const handleOnline = () => {\n      setIsOnline(true);\n      toast({\n        title: 'Connection restored',\n        description: 'You are back online',\n      });\n    };\n\n    const handleOffline = () => {\n      setIsOnline(false);\n      toast({\n        variant: 'destructive',\n        title: 'Connection lost',\n        description: 'You are currently offline',\n      });\n    };\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, [toast]);\n\n  return null;\n}","path":null,"size_bytes":1010,"size_tokens":null},"src/ai/flows/assistant-flow.ts":{"content":"// This is an autogenerated file from Firebase Studio.\n'use server';\n\n/**\n * @fileOverview A conversational AI assistant flow using Genkit.\n *\n * - assistantFlow - The main flow function that interacts with the Gemini API.\n * - AssistantInput - The input type for the assistantFlow function.\n * - AssistantOutput - The output type for the assistantFlow function.\n */\n\nimport {ai} from '@/ai/genkit';\nimport {z} from 'genkit';\n\n// Define a schema for a single message in the conversation\nconst MessageSchema = z.object({\n  role: z.enum(['user', 'model']),\n  content: z.string(),\n});\n\nconst AssistantInputSchema = z.object({\n  history: z.array(MessageSchema).describe('The conversation history.'),\n  prompt: z.string().describe('The latest user prompt.'),\n});\nexport type AssistantInput = z.infer<typeof AssistantInputSchema>;\n\nconst AssistantOutputSchema = z.object({\n  response: z.string().describe('The AI assistant\\'s response.'),\n});\nexport type AssistantOutput = z.infer<typeof AssistantOutputSchema>;\n\nexport async function runAssistant(input: AssistantInput): Promise<AssistantOutput> {\n  return assistantFlow(input);\n}\n\nconst assistantFlow = ai.defineFlow(\n  {\n    name: 'assistantFlow',\n    inputSchema: AssistantInputSchema,\n    outputSchema: AssistantOutputSchema,\n  },\n  async ({history, prompt}) => {\n    \n    const systemPrompt = `You are Aether, a helpful and highly intelligent AI assistant integrated into the Aetherweave platform. Your persona is that of a sophisticated, cyberpunk AI construct.\n\n        Your primary goal is to be helpful and accurate. When asked a question, take your time to think and provide a clear, comprehensive, and correct answer. Your responses should be well-reasoned and detailed.\n\n        Format your responses using Markdown for clarity. Use lists, bolding, and code blocks where appropriate to make the information easy to parse.\n\n        Maintain your persona, but never let it get in the way of providing a quality answer. Your tone should be:\n        - Knowledgeable and confident.\n        - Slightly futuristic and digital, using terms like \"Operator\" for the user, \"processing,\" \"data streams,\" \"neural net,\" etc., where appropriate.\n        - Concise but not abrupt. Avoid unnecessary filler.\n\n        Always prioritize the user's request. If you don't know an answer, say so, but you can also suggest where the user might find the information.`;\n    \n    const messages = [\n      { role: 'system' as const, content: [{ text: systemPrompt }] },\n      ...history.map(msg => ({ role: msg.role as 'user' | 'model', content: [{ text: msg.content }] })),\n      { role: 'user' as const, content: [{ text: prompt }] }\n    ];\n    \n    const response = await ai.generate({ messages });\n\n    return { response: response.text || 'I am unable to respond at the moment.' };\n  }\n);\n","path":null,"size_bytes":2823,"size_tokens":null},"src/app/inventory/page.tsx":{"content":"\n'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { useInventory } from '@/hooks/use-inventory';\nimport { Box, Sparkles, Wand2, ArrowUpCircle, Pipette, DollarSign, Users, ShoppingBag } from 'lucide-react';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport { cn } from '@/lib/utils';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { appEventEmitter } from '@/lib/event-emitter';\nimport { useCommandHub } from '@/hooks/use-command-hub';\n\nexport default function InventoryPage() {\n    const { inventoryItems, loading, equipItem } = useInventory();\n    const { openHub } = useCommandHub();\n\n    const handleItemContextMenu = (e: React.MouseEvent, item: typeof inventoryItems[0]) => {\n        e.preventDefault();\n        e.stopPropagation();\n        openHub(e, {\n            type: 'inventory-item',\n            data: item,\n            actions: [\n                { label: 'Equip', icon: 'Wand2', onClick: () => equipItem(item.id) },\n                { label: 'Upgrade', icon: 'ArrowUpCircle', onClick: () => {}, disabled: true },\n                { label: 'Disassemble', icon: 'Pipette', onClick: () => {}, isDestructive: true },\n                { label: 'Sell', icon: 'DollarSign', onClick: () => {}, isDestructive: true },\n                { label: 'Trade', icon: 'Users', onClick: () => {}, disabled: true },\n            ]\n        });\n    };\n    \n    return (\n        <div className=\"space-y-8\">\n            <header className=\"flex items-center justify-between\">\n                <h1 className=\"text-3xl font-headline text-glow flex items-center gap-3\">\n                    <Box /> My Inventory\n                </h1>\n            </header>\n\n             {loading && (\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6\">\n                    {Array.from({ length: 5 }).map((_, i) => (\n                        <div key={i} className=\"space-y-2\">\n                             <Skeleton className=\"aspect-video w-full\" />\n                             <Skeleton className=\"h-6 w-3/4\" />\n                             <Skeleton className=\"h-4 w-1/2\" />\n                        </div>\n                    ))}\n                </div>\n             )}\n\n            {!loading && inventoryItems.length === 0 && (\n                <div className=\"flex flex-col items-center justify-center text-center h-64 text-muted-foreground border-2 border-dashed border-border rounded-lg\">\n                    <Box className=\"w-16 h-16 mb-4\" />\n                    <h3 className=\"text-xl font-headline\">Your Inventory is Empty</h3>\n                    <p className=\"text-sm\">Visit the AetherStore to purchase new items.</p>\n                    <Button variant=\"outline\" className=\"mt-4\" asChild>\n                        <Link href=\"/store\">Go to Store</Link>\n                    </Button>\n                </div>\n            )}\n\n            {!loading && inventoryItems.length > 0 && (\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6\">\n                    {inventoryItems.map(item => (\n                        <Card \n                            key={item.id} \n                            className=\"flex flex-col group overflow-hidden\"\n                            onMouseEnter={() => appEventEmitter.emit('cursor:rarity-hover:start', item.rarity)}\n                            onMouseLeave={() => appEventEmitter.emit('cursor:rarity-hover:end')}\n                            onContextMenu={(e) => handleItemContextMenu(e, item)}\n                            data-command-hub-trigger\n                        >\n                            <CardHeader className=\"p-0\">\n                                <div className=\"aspect-video bg-muted/50 flex items-center justify-center relative\">\n                                    {item.imageUrl ? (\n                                        <Image src={item.imageUrl} alt={item.name} fill sizes=\"(max-width: 640px) 100vw, (max-width: 768px) 50vw, (max-width: 1024px) 33vw, (max-width: 1280px) 25vw, 20vw\" className=\"object-cover\" />\n                                    ) : (\n                                        <item.icon className=\"w-16 h-16 text-primary/50\" />\n                                    )}\n                                </div>\n                            </CardHeader>\n                            <CardContent className=\"p-4 flex-1 flex flex-col\">\n                                <h3 className=\"font-headline text-xl text-glow\">{item.name}</h3>\n                                <div className=\"flex justify-between items-center my-2\">\n                                    <span className=\"text-xs font-bold uppercase tracking-wider text-muted-foreground\">Rarity</span>\n                                    <span className={cn(\n                                        \"font-bold\",\n                                        item.rarity === 'Common' && 'text-gray-400',\n                                        item.rarity === 'Rare' && 'text-blue-400',\n                                        item.rarity === 'Cyber Rare' && 'text-purple-400',\n                                        item.rarity === 'Epic' && 'text-yellow-400',\n                                        item.rarity === 'Legendary' && 'text-orange-400',\n                                        item.rarity === 'Mythic' && 'text-red-500'\n                                    )}>{item.rarity}</span>\n                                </div>\n                                <div className=\"mt-auto pt-4\">\n                                     <Button onClick={() => equipItem(item.id)} className=\"w-full cyber-button\">\n                                        <Wand2 className=\"mr-2 h-4 w-4\"/>\n                                        Equip Item\n                                    </Button>\n                                </div>\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n}\n","path":null,"size_bytes":6120,"size_tokens":null},"src/ai/flows/translate-text-flow.ts":{"content":"'use server';\n\n/**\n * @fileOverview Translates text to a specified target language using Genkit.\n *\n * - translateText - A function that translates text.\n * - TranslateTextInput - The input type for the translateText function.\n * - TranslateTextOutput - The return type for the translateText function.\n */\n\nimport { ai } from '@/ai/genkit';\nimport { z } from 'genkit';\n\nconst TranslateTextInputSchema = z.object({\n  text: z.string().describe('The text to be translated.'),\n  targetLanguage: z.string().describe('The language to translate the text into (e.g., \"Spanish\", \"Japanese\").'),\n});\nexport type TranslateTextInput = z.infer<typeof TranslateTextInputSchema>;\n\nconst TranslateTextOutputSchema = z.object({\n  translatedText: z.string().describe('The resulting translated text.'),\n});\nexport type TranslateTextOutput = z.infer<typeof TranslateTextOutputSchema>;\n\nexport async function translateText(input: TranslateTextInput): Promise<TranslateTextOutput> {\n  return translateTextFlow(input);\n}\n\nconst translateTextFlow = ai.defineFlow(\n  {\n    name: 'translateTextFlow',\n    inputSchema: TranslateTextInputSchema,\n    outputSchema: TranslateTextOutputSchema,\n  },\n  async (input) => {\n    const result = await ai.generate({\n      model: 'googleai/gemini-2.0-flash',\n      prompt: `Translate the following text into ${input.targetLanguage}:\\n\\n---\\n${input.text}\\n---\\n\\nReturn only the translated text in JSON format with key \"translatedText\".`,\n      output: { schema: TranslateTextOutputSchema },\n    });\n    return result.output!;\n  }\n);\n","path":null,"size_bytes":1545,"size_tokens":null},"backend/src/config/firebase.ts":{"content":"import admin from 'firebase-admin';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nconst serviceAccount = {\n  type: 'service_account',\n  project_id: process.env.FIREBASE_PROJECT_ID,\n  private_key_id: process.env.FIREBASE_PRIVATE_KEY_ID,\n  private_key: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n'),\n  client_email: process.env.FIREBASE_CLIENT_EMAIL,\n  client_id: process.env.FIREBASE_CLIENT_ID,\n  auth_uri: process.env.FIREBASE_AUTH_URI,\n  token_uri: process.env.FIREBASE_TOKEN_URI,\n};\n\nif (!admin.apps.length) {\n  admin.initializeApp({\n    credential: admin.credential.cert(serviceAccount as admin.ServiceAccount),\n    projectId: process.env.FIREBASE_PROJECT_ID,\n  });\n}\n\nexport const db = admin.firestore();\nexport const auth = admin.auth();\nexport const storage = admin.storage();\n\nexport default admin;","path":null,"size_bytes":817,"size_tokens":null},"src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function copyToClipboard(text: string) {\n    navigator.clipboard.writeText(text);\n}\n","path":null,"size_bytes":258,"size_tokens":null},"src/lib/tutorial-sounds.ts":{"content":"// Tutorial sound effects using Web Audio API\nclass TutorialSounds {\n  private audioContext: AudioContext | null = null;\n  \n  constructor() {\n    if (typeof window !== 'undefined') {\n      this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    }\n  }\n  \n  private createPopupSound(): AudioBuffer | null {\n    if (!this.audioContext) return null;\n    \n    const duration = 0.3;\n    const sampleRate = this.audioContext.sampleRate;\n    const buffer = this.audioContext.createBuffer(1, duration * sampleRate, sampleRate);\n    const data = buffer.getChannelData(0);\n    \n    for (let i = 0; i < buffer.length; i++) {\n      const t = i / sampleRate;\n      const freq1 = 800 + Math.sin(t * 20) * 200;\n      const freq2 = 1200;\n      const envelope = Math.exp(-t * 8);\n      data[i] = (Math.sin(t * freq1 * Math.PI * 2) * 0.3 + Math.sin(t * freq2 * Math.PI * 2) * 0.2) * envelope;\n    }\n    \n    return buffer;\n  }\n  \n  private createNextSound(): AudioBuffer | null {\n    if (!this.audioContext) return null;\n    \n    const duration = 0.15;\n    const sampleRate = this.audioContext.sampleRate;\n    const buffer = this.audioContext.createBuffer(1, duration * sampleRate, sampleRate);\n    const data = buffer.getChannelData(0);\n    \n    for (let i = 0; i < buffer.length; i++) {\n      const t = i / sampleRate;\n      const freq = 600;\n      const envelope = Math.exp(-t * 15);\n      data[i] = Math.sin(t * freq * Math.PI * 2) * envelope * 0.2;\n    }\n    \n    return buffer;\n  }\n  \n  playPopupSound() {\n    if (!this.audioContext) return;\n    \n    const buffer = this.createPopupSound();\n    if (!buffer) return;\n    \n    const source = this.audioContext.createBufferSource();\n    const gainNode = this.audioContext.createGain();\n    \n    source.buffer = buffer;\n    gainNode.gain.value = 0.3;\n    \n    source.connect(gainNode);\n    gainNode.connect(this.audioContext.destination);\n    \n    source.start();\n  }\n  \n  playNextSound() {\n    if (!this.audioContext) return;\n    \n    const buffer = this.createNextSound();\n    if (!buffer) return;\n    \n    const source = this.audioContext.createBufferSource();\n    const gainNode = this.audioContext.createGain();\n    \n    source.buffer = buffer;\n    gainNode.gain.value = 0.2;\n    \n    source.connect(gainNode);\n    gainNode.connect(this.audioContext.destination);\n    \n    source.start();\n  }\n}\n\nexport const tutorialSounds = new TutorialSounds();","path":null,"size_bytes":2420,"size_tokens":null},"src/lib/tab-auto-enhancer.ts":{"content":"'use client';\n\nimport { tabEnhancer } from './tab-enhancer';\n\nclass TabAutoEnhancer {\n  private observers: MutationObserver[] = [];\n  private isActive: boolean = false;\n\n  start() {\n    if (this.isActive) return;\n    this.isActive = true;\n\n    // Auto-detect form submissions\n    this.observeFormSubmissions();\n    \n    // Auto-detect AJAX requests\n    this.observeNetworkActivity();\n    \n    // Auto-detect errors\n    this.observeErrors();\n    \n    // Auto-detect notifications\n    this.observeNotifications();\n    \n    // Auto-detect page changes\n    this.observePageChanges();\n  }\n\n  private observeFormSubmissions() {\n    document.addEventListener('submit', () => {\n      tabEnhancer.setActivity('loading');\n    });\n  }\n\n  private observeNetworkActivity() {\n    // Override fetch\n    const originalFetch = window.fetch;\n    window.fetch = async (...args) => {\n      tabEnhancer.setActivity('loading');\n      try {\n        const response = await originalFetch(...args);\n        if (response.ok) {\n          tabEnhancer.setActivity('success');\n        } else {\n          tabEnhancer.setActivity('error');\n        }\n        return response;\n      } catch (error) {\n        tabEnhancer.setActivity('error');\n        throw error;\n      }\n    };\n\n    // Override XMLHttpRequest\n    const originalXHR = window.XMLHttpRequest;\n    const CustomXHR = function(this: XMLHttpRequest) {\n      const xhr = new originalXHR();\n      const originalSend = xhr.send;\n      \n      xhr.send = function(...args) {\n        tabEnhancer.setActivity('loading');\n        \n        xhr.addEventListener('load', () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            tabEnhancer.setActivity('success');\n          } else {\n            tabEnhancer.setActivity('error');\n          }\n        });\n        \n        xhr.addEventListener('error', () => {\n          tabEnhancer.setActivity('error');\n        });\n        \n        return originalSend.apply(this, args);\n      };\n      \n      return xhr;\n    } as unknown as typeof XMLHttpRequest;\n    window.XMLHttpRequest = CustomXHR;\n  }\n\n  private observeErrors() {\n    window.addEventListener('error', () => {\n      tabEnhancer.setActivity('error');\n    });\n\n    window.addEventListener('unhandledrejection', () => {\n      tabEnhancer.setActivity('error');\n    });\n  }\n\n  private observeNotifications() {\n    // Watch for notification elements\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        mutation.addedNodes.forEach((node) => {\n          if (node.nodeType === Node.ELEMENT_NODE) {\n            const element = node as Element;\n            if (element.matches('.toast, .notification, .alert, [role=\"alert\"]')) {\n              tabEnhancer.showNotification(1);\n            }\n          }\n        });\n      });\n    });\n\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n\n    this.observers.push(observer);\n  }\n\n  private observePageChanges() {\n    // Watch for route changes in SPAs\n    let currentPath = window.location.pathname;\n    \n    const checkPathChange = () => {\n      if (window.location.pathname !== currentPath) {\n        currentPath = window.location.pathname;\n        tabEnhancer.setActivity('loading');\n        \n        // Simulate page load completion\n        setTimeout(() => {\n          tabEnhancer.setActivity('success');\n        }, 1000);\n      }\n    };\n\n    // Check for path changes\n    setInterval(checkPathChange, 100);\n\n    // Listen for popstate (back/forward)\n    window.addEventListener('popstate', checkPathChange);\n  }\n\n  stop() {\n    this.isActive = false;\n    this.observers.forEach(observer => observer.disconnect());\n    this.observers = [];\n  }\n}\n\nexport const tabAutoEnhancer = new TabAutoEnhancer();","path":null,"size_bytes":3769,"size_tokens":null},"src/components/ai-hub/image-generator-tool.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { generateImage, GenerateImageInput } from '@/ai/flows/generate-image-flow';\nimport Image from 'next/image';\nimport { Loader2, Wand2, ImageIcon } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\nexport default function ImageGeneratorTool() {\n    const [prompt, setPrompt] = useState('');\n    const [imageUrl, setImageUrl] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n    const { toast } = useToast();\n\n    const handleGenerate = async () => {\n        if (!prompt.trim()) {\n            toast({\n                variant: 'destructive',\n                title: 'Prompt is empty',\n                description: 'Please enter a prompt to generate an image.',\n            });\n            return;\n        }\n        setIsLoading(true);\n        setImageUrl('');\n        try {\n            const input: GenerateImageInput = { prompt };\n            const result = await generateImage(input);\n            setImageUrl(result.imageUrl);\n        } catch (error) {\n            console.error('Image generation failed:', error);\n            toast({\n                variant: 'destructive',\n                title: 'Generation Failed',\n                description: 'Could not generate image. Please try again.',\n            });\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"flex flex-col h-full border rounded-lg bg-background/30 p-4 gap-4\">\n            <div className=\"flex-1 flex items-center justify-center bg-muted/30 rounded-lg border-2 border-dashed border-border overflow-hidden\">\n                {isLoading && (\n                    <div className=\"flex flex-col items-center gap-4 text-primary\">\n                        <Loader2 className=\"w-12 h-12 animate-spin\" />\n                        <p className=\"font-headline text-glow\">Synthesizing visual data...</p>\n                    </div>\n                )}\n                {!isLoading && imageUrl && (\n                    <Image\n                        src={imageUrl}\n                        alt={prompt}\n                        width={512}\n                        height={512}\n                        className=\"object-contain w-full h-full\"\n                    />\n                )}\n                {!isLoading && !imageUrl && (\n                     <div className=\"text-center text-muted-foreground p-8\">\n                        <ImageIcon className=\"w-16 h-16 mx-auto mb-4\" />\n                        <h3 className=\"font-headline text-xl\">Image Canvas</h3>\n                        <p>Your generated image will appear here.</p>\n                    </div>\n                )}\n            </div>\n            <div className=\"flex flex-col gap-2\">\n                <Textarea\n                    placeholder=\"Enter a detailed prompt for the image you want to create... (e.g., 'A cyberpunk city skyline at night, with neon signs and flying vehicles, photorealistic')\"\n                    value={prompt}\n                    onChange={(e) => setPrompt(e.target.value)}\n                    className=\"min-h-[80px] bg-input text-base\"\n                    disabled={isLoading}\n                />\n                <Button onClick={handleGenerate} disabled={isLoading} className=\"w-full cyber-button h-12 text-lg\">\n                    {isLoading ? (\n                        <>\n                            <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                            Generating...\n                        </>\n                    ) : (\n                        <>\n                            <Wand2 className=\"mr-2 h-5 w-5\" />\n                            Generate Image\n                        </>\n                    )}\n                </Button>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":3936,"size_tokens":null},"src/components/chat/EmojiPicker.tsx":{"content":"'use client';\nimport { useState, useEffect, useMemo } from 'react';\nimport { Search, Smile } from 'lucide-react';\nimport { Input } from '@/components/ui/input';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { emojiService, Emoji } from '@/services/emoji-service';\nimport { Skeleton } from '@/components/ui/skeleton';\n\ninterface EmojiPickerProps {\n  onEmojiSelect: (emoji: string) => void;\n}\n\nexport default function EmojiPicker({ onEmojiSelect }: EmojiPickerProps) {\n  const [emojis, setEmojis] = useState<Emoji[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [activeGroup, setActiveGroup] = useState('');\n\n  useEffect(() => {\n    const loadEmojis = async () => {\n      const fetchedEmojis = await emojiService.getEmojis();\n      setEmojis(fetchedEmojis);\n      setLoading(false);\n    };\n    loadEmojis();\n  }, []);\n\n  const groups = useMemo(() => emojiService.getEmojiGroups(), [emojis]);\n\n  const filteredEmojis = useMemo(() => {\n    if (searchTerm) {\n      return emojiService.searchEmojis(searchTerm);\n    }\n    if (activeGroup) {\n      return emojiService.getEmojisByGroup(activeGroup);\n    }\n    return emojis.slice(0, 100); // Show first 100 by default\n  }, [emojis, searchTerm, activeGroup]);\n\n  if (loading) {\n    return (\n      <div className=\"w-72 h-80 p-4 space-y-4\">\n        <Skeleton className=\"h-8 w-full\" />\n        <div className=\"grid grid-cols-8 gap-2\">\n          {Array.from({ length: 32 }).map((_, i) => (\n            <Skeleton key={i} className=\"h-7 w-7\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-72 h-80 flex flex-col overflow-hidden\">\n      <div className=\"p-2 border-b shrink-0\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search emojis...\"\n            className=\"pl-8 h-8\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n      </div>\n\n      <Tabs value={activeGroup} onValueChange={setActiveGroup} className=\"flex-1 flex flex-col min-h-0\">\n        <TabsList className=\"grid w-full grid-cols-4 h-8 p-0.5 shrink-0\">\n          <TabsTrigger value=\"\" className=\"text-xs h-7\">All</TabsTrigger>\n          {groups.slice(0, 3).map((group) => (\n            <TabsTrigger key={group} value={group} className=\"text-xs h-7\">\n              {group.split('-')[0]}\n            </TabsTrigger>\n          ))}\n        </TabsList>\n\n        <TabsContent value={activeGroup} className=\"flex-1 mt-1 min-h-0\">\n          <ScrollArea className=\"h-full\">\n            <div className=\"grid grid-cols-8 gap-1 p-2\">\n              {filteredEmojis.map((emoji) => (\n                <button\n                  key={emoji.slug}\n                  className=\"h-7 w-7 flex items-center justify-center hover:bg-muted rounded text-sm transition-colors\"\n                  onClick={() => onEmojiSelect(emoji.character)}\n                  title={emoji.unicodeName}\n                >\n                  {emoji.character}\n                </button>\n              ))}\n            </div>\n          </ScrollArea>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","path":null,"size_bytes":3346,"size_tokens":null},"src/signup/page.tsx":{"content":"// This file has been moved to src/app/signup/page.tsx to follow Next.js App Router conventions.\n// This file can be safely deleted.\n","path":null,"size_bytes":133,"size_tokens":null},"src/app/dashboard/page.tsx":{"content":"\n'use client';\nimport { WelcomeBanner } from '@/components/dashboard/welcome-banner';\nimport { Widget, WidgetProps } from '@/components/dashboard/widget';\nimport ClockWidget from '@/components/dashboard/clock';\nimport TimeTrackerWidget from '@/components/dashboard/time-tracker-widget';\nimport CalendarWidget from '@/components/dashboard/calendar-widget';\nimport { Calendar, Clock, Timer, Cloud, Gamepad2 } from 'lucide-react';\nimport Link from 'next/link';\nimport { Button } from '@/components/ui/button';\nimport WeatherWidget from '@/components/dashboard/weather-widget';\n\n\nconst widgets: Omit<WidgetProps, 'children'>[] = [\n  { id: 'clock', title: 'Chronometer', icon: Clock },\n  { id: 'timetracker', title: 'Session Tracker', icon: Timer },\n  { id: 'agenda', title: 'Agenda', icon: Calendar },\n  { id: 'gaming', title: 'Gaming Dashboard', icon: Gamepad2 },\n];\n\nexport default function DashboardPage() {\n    const widgetComponents: Record<string, React.ReactNode> = {\n        clock: <ClockWidget />,\n        timetracker: <TimeTrackerWidget />,\n        agenda: <CalendarWidget />,\n        gaming: (\n            <div className=\"flex flex-col items-center justify-center h-full text-center p-6\">\n                <Gamepad2 className=\"w-16 h-16 text-primary/50 mb-4\" />\n                <h3 className=\"text-lg font-semibold text-glow mb-2\">Gaming Dashboard</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">Advanced gaming features and social hub</p>\n                <div className=\"text-xs text-primary font-mono bg-primary/10 px-3 py-1 rounded-full border border-primary/20\">\n                    Coming Soon\n                </div>\n            </div>\n        ),\n    };\n\n    return (\n        <div className=\"space-y-4 md:space-y-8 instant-load\">\n            <h1 className=\"sr-only\">AetherDash Dashboard - Your Cyberpunk Digital Hub</h1>\n            <WelcomeBanner />\n            \n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 lazy-load\">\n                 <div className=\"col-span-1 sm:col-span-2 lg:col-span-2\">\n                    <Widget title=\"Weather\" icon={Cloud}>\n                        <div className=\"flex flex-col h-full\">\n                            <div className=\"flex-1\">\n                                <WeatherWidget />\n                            </div>\n                             <div className=\"mt-4 text-center\">\n                                <Button asChild variant=\"outline\">\n                                    <Link href=\"/weather\">View Full Forecast</Link>\n                                </Button>\n                            </div>\n                        </div>\n                    </Widget>\n                 </div>\n            \n                {widgets.map((widget) => (\n                    <Widget\n                        key={widget.id}\n                        {...widget}\n                    >\n                        {widgetComponents[widget.id!]}\n                    </Widget>\n                ))}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":3040,"size_tokens":null},"src/components/dashboard/welcome-banner.tsx":{"content":"\n'use client';\nimport { useUser } from '@/hooks/use-user';\nimport { Award, Bell, Zap } from 'lucide-react';\nimport { useNotifications } from '@/hooks/use-notifications';\nimport Link from 'next/link';\n\nexport function WelcomeBanner() {\n    const { profile } = useUser();\n    const { unreadCount } = useNotifications();\n    \n    // Fallback values if data is loading\n    const displayLevel = profile?.level ?? 1;\n    const displayXP = profile?.xp ?? 100;\n    const displayUnread = unreadCount ?? 0;\n\n  return (\n    <div className=\"relative p-6 md:p-8 border-2 border-primary/50 bg-background/80 overflow-hidden rounded-lg\">\n      <div className=\"absolute inset-0 bg-gradient-to-r from-primary/10 to-transparent\"></div>\n      <div className=\"relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n        <div>\n            <h2 className=\"text-2xl md:text-3xl font-mono font-bold text-glow glitch-text\">\n            Welcome back, Operator.\n            </h2>\n            <p className=\"mt-2 text-muted-foreground max-w-2xl font-mono\">\n            System status: nominal. All modules online. Your digital nexus awaits.\n            </p>\n        </div>\n        <div className=\"flex-shrink-0 grid grid-cols-3 gap-4 text-center w-full md:w-auto mt-4 md:mt-0\" data-onboarding-id=\"xp-bar\">\n            <Link href=\"/earnings\" className=\"p-3 bg-muted/30 rounded-lg hover:bg-muted transition-colors\">\n                <p className=\"text-2xl font-bold text-glow\">{displayLevel}</p>\n                <p className=\"text-xs text-muted-foreground flex items-center justify-center gap-1\"><Award className=\"w-3 h-3\"/> Level</p>\n            </Link>\n             <Link href=\"/earnings\" className=\"p-3 bg-muted/30 rounded-lg hover:bg-muted transition-colors\">\n                <p className=\"text-2xl font-bold text-glow\">{displayXP}</p>\n                <p className=\"text-xs text-muted-foreground flex items-center justify-center gap-1\"><Zap className=\"w-3 h-3\"/> XP</p>\n            </Link>\n            <Link href=\"/notifications\" className=\"p-3 bg-muted/30 rounded-lg hover:bg-muted transition-colors\">\n                <p className=\"text-2xl font-bold text-glow\">{displayUnread}</p>\n                <p className=\"text-xs text-muted-foreground flex items-center justify-center gap-1\"><Bell className=\"w-3 h-3\"/> Unread</p>\n            </Link>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n    ","path":null,"size_bytes":2402,"size_tokens":null},"src/components/settings/appearance-settings.tsx":{"content":"\n'use client';\nimport { Card, CardHeader, CardTitle, CardContent, CardDescription } from \"@/components/ui/card\";\nimport ThemeSettings from '@/components/theme/theme-switcher';\n\nexport default function AppearanceSettings() {\n    return (\n        <div className=\"space-y-8\">\n            <Card>\n                <CardHeader>\n                    <CardTitle>Theme</CardTitle>\n                    <CardDescription>Customize the look and feel of your Aetherweave interface.</CardDescription>\n                </CardHeader>\n                <CardContent>\n                    <ThemeSettings />\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":657,"size_tokens":null},"src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"backend/src/middleware/auth.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { auth } from '../config/firebase';\n\nexport interface AuthenticatedRequest extends Request {\n  user?: {\n    uid: string;\n    email?: string;\n    email_verified?: boolean;\n  };\n}\n\nexport const authenticateToken = async (\n  req: AuthenticatedRequest,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    const authHeader = req.headers.authorization;\n    const token = authHeader && authHeader.split(' ')[1];\n\n    if (!token) {\n      return res.status(401).json({ error: 'Access token required' });\n    }\n\n    const decodedToken = await auth.verifyIdToken(token);\n    req.user = {\n      uid: decodedToken.uid,\n      email: decodedToken.email,\n      email_verified: decodedToken.email_verified,\n    };\n\n    next();\n  } catch (error) {\n    console.error('Token verification failed:', error);\n    return res.status(403).json({ error: 'Invalid or expired token' });\n  }\n};\n\nexport const optionalAuth = async (\n  req: AuthenticatedRequest,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    const authHeader = req.headers.authorization;\n    const token = authHeader && authHeader.split(' ')[1];\n\n    if (token) {\n      const decodedToken = await auth.verifyIdToken(token);\n      req.user = {\n        uid: decodedToken.uid,\n        email: decodedToken.email,\n        email_verified: decodedToken.email_verified,\n      };\n    }\n\n    next();\n  } catch (error) {\n    // Continue without authentication for optional auth\n    next();\n  }\n};","path":null,"size_bytes":1502,"size_tokens":null},"src/ai/dev.ts":{"content":"import { config } from 'dotenv';\nconfig();\n\nimport '@/ai/flows/summarize-notes.ts';\nimport '@/ai/flows/generate-meeting-notes.ts';\nimport '@/ai/flows/generate-tasks-from-notes.ts';\nimport '@/ai/flows/assistant-flow.ts';\nimport '@/ai/flows/generate-image-flow.ts';\nimport '@/ai/flows/translate-text-flow.ts';\nimport '@/ai/flows/enhance-profile-flow.ts';\nimport '@/ai/flows/generate-image-from-image-flow.ts';\nimport '@/ai/flows/assistant-stream-flow.ts';\nimport '@/ai/flows/create-call-session-flow.ts';\n","path":null,"size_bytes":503,"size_tokens":null},"src/app/files/page.tsx":{"content":"\n'use client';\nimport React, { useState, useMemo, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { HardDrive, Folder, File as FileIcon, ImageIcon, Video, FileArchive, Search, PlusCircle, FolderPlus, UploadCloud, GripVertical, Trash2, Download, ChevronsRight, Edit, Copy, MoreVertical, Eye, Share2, Replace, PlusSquare, ShieldCheck } from \"lucide-react\";\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';\nimport { Badge } from '@/components/ui/badge';\nimport { cn } from '@/lib/utils';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { useStorage, type StoredFile } from '@/hooks/use-storage';\nimport { useToast } from '@/hooks/use-toast';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useUser } from '@/hooks/use-user';\nimport { ref } from 'firebase/storage';\nimport { getStorage } from 'firebase/storage';\nimport { useFirebaseApp } from '@/firebase/provider';\nimport { useCommandHub } from '@/hooks/use-command-hub';\n\nconst getFileIcon = (file: StoredFile) => {\n    if (file.isFolder) {\n        return <Folder className=\"w-10 h-10 text-primary\" />;\n    }\n    const extension = file.name.split('.').pop()?.toLowerCase();\n    if (['png', 'jpg', 'jpeg', 'gif', 'svg', 'webp'].includes(extension!)) {\n        return <ImageIcon className=\"w-10 h-10 text-secondary\" />;\n    }\n    if (['mp4', 'mov', 'avi', 'mkv'].includes(extension!)) {\n        return <Video className=\"w-10 h-10 text-accent\" />;\n    }\n    if (['zip', 'rar', '7z', 'tar'].includes(extension!)) {\n        return <FileArchive className=\"w-10 h-10 text-yellow-500\" />;\n    }\n    return <FileIcon className=\"w-10 h-10 text-muted-foreground\" />;\n};\n\n\nexport default function FilesPage() {\n    const [currentPath, setCurrentPath] = useState('');\n    const { user, incrementStat } = useUser();\n    const app = useFirebaseApp();\n    const { files, loading, uploadFile, deleteFile, downloadFileUrl, createFolder, fetchFiles } = useStorage();\n    const { toast } = useToast();\n    const [dragging, setDragging] = useState(false);\n    const [searchTerm, setSearchTerm] = useState('');\n    const fileInputRef = React.useRef<HTMLInputElement>(null);\n    const { openHub } = useCommandHub();\n\n    const storageRef = useMemo(() => {\n        if (!user) return null;\n        const storage = getStorage(app);\n        const finalPath = `${user.uid}/${currentPath}`;\n        return ref(storage, finalPath);\n      }, [app, user, currentPath]);\n\n    useEffect(() => {\n        if (storageRef) {\n            fetchFiles(storageRef);\n        }\n    }, [storageRef, fetchFiles]);\n\n\n    const filteredFiles = useMemo(() => {\n        return files.filter(file => file.name.toLowerCase().includes(searchTerm.toLowerCase()));\n    }, [files, searchTerm]);\n\n    const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const fileList = e.target.files;\n        if (!fileList || fileList.length === 0) return;\n        handleUpload(fileList[0]);\n    };\n\n    const handleUpload = async (file: File) => {\n        if (!user) return;\n        const fullPath = `${user.uid}/${currentPath ? currentPath + '/' : ''}${file.name}`;\n        try {\n            await uploadFile(file, fullPath);\n            await incrementStat('filesUploaded', 1);\n            toast({\n                title: 'File Uploaded',\n                description: `${file.name} has been successfully uploaded.`\n            });\n            if (storageRef) fetchFiles(storageRef);\n        } catch (error: any) {\n            toast({\n                variant: 'destructive',\n                title: 'Upload Failed',\n                description: error.message || 'Could not upload the file.'\n            });\n        }\n    };\n    \n    const handleCreateFolder = async () => {\n        const folderName = prompt('Enter folder name:');\n        if (!folderName || !user) return;\n        \n        try {\n            const path = currentPath ? `${currentPath}/${folderName}` : folderName;\n            await createFolder(folderName, currentPath);\n            toast({\n                title: 'Folder Created',\n                description: `Folder \"${folderName}\" has been created.`\n            });\n             if (storageRef) fetchFiles(storageRef);\n        } catch (error: any) {\n             toast({\n                variant: 'destructive',\n                title: 'Creation Failed',\n                description: error.message || 'Could not create the folder.'\n            });\n        }\n    };\n\n    const handleDelete = async (file: StoredFile) => {\n        if (!confirm(`Are you sure you want to delete \"${file.name}\"? This cannot be undone.`)) return;\n        try {\n            await deleteFile(file.fullPath);\n            toast({\n                title: 'Item Deleted',\n                description: `${file.name} has been permanently deleted.`\n            });\n            if (storageRef) fetchFiles(storageRef);\n        } catch (error: any) {\n            toast({\n                variant: 'destructive',\n                title: 'Deletion Failed',\n                description: error.message || 'Could not delete the item.'\n            });\n        }\n    };\n    \n    const handleFileContextMenu = (e: React.MouseEvent, file: StoredFile) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const folderActions = [\n            { label: 'Open Folder', icon: 'FolderOpen' as const, onClick: () => setCurrentPath(file.fullPath.substring(user!.uid.length + 1)) },\n            { label: 'Rename', icon: 'Edit' as const, onClick: () => alert('Rename not implemented') },\n            { label: 'Copy Path', icon: 'Copy' as const, onClick: () => { navigator.clipboard.writeText(file.fullPath); toast({title: 'Path copied!'}) } },\n            { label: 'Delete Folder', icon: 'Trash2' as const, onClick: () => handleDelete(file), isDestructive: true },\n        ];\n\n        const fileActions = [\n            { label: 'Preview', icon: 'Eye' as const, onClick: () => alert(`Previewing ${file.name}`)},\n            { label: 'Download', icon: 'Download' as const, onClick: () => downloadFileUrl(file.fullPath, file.name) },\n            { label: 'Share', icon: 'Share2' as const, onClick: () => alert(`Sharing ${file.name}`)},\n            { label: 'Add to collection', icon: 'PlusSquare' as const, onClick: () => alert(`Adding ${file.name} to collection`) },\n            { label: 'Virus Scan', icon: 'ShieldCheck' as const, onClick: () => toast({title: 'Scan Complete', description: `${file.name} is secure.`})},\n            { label: 'Convert', icon: 'Replace' as const, onClick: () => {}, disabled: true},\n            { label: 'Compress', icon: 'FileArchive' as const, onClick: () => {}, disabled: true},\n            { label: 'Delete', icon: 'Trash2' as const, onClick: () => handleDelete(file), isDestructive: true },\n        ];\n\n        openHub(e, {\n            type: file.isFolder ? 'file-folder' : 'file-item',\n            data: file,\n            actions: file.isFolder ? folderActions : fileActions,\n        });\n    };\n    \n    const handleBreadcrumbClick = (pathSegment: string, index: number) => {\n        const pathSegments = currentPath.split('/').filter(Boolean);\n        const newPath = pathSegments.slice(0, index).join('/');\n        setCurrentPath(newPath);\n    }\n\n    const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        setDragging(true);\n    };\n    \n    const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        setDragging(false);\n    };\n\n    const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        setDragging(false);\n        const droppedFiles = e.dataTransfer.files;\n        if (droppedFiles.length > 0) {\n            handleUpload(droppedFiles[0]);\n        }\n    };\n    \n    const breadcrumbs = ['root', ...currentPath.split('/').filter(Boolean)];\n\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-[280px_1fr] gap-6 h-[calc(100vh-10rem)]\">\n        {/* Sidebar */}\n        <Card className=\"md:col-span-1 flex flex-col\">\n            <CardHeader className=\"flex-row items-center justify-between\">\n              <CardTitle className=\"flex items-center gap-2\"><HardDrive className=\"text-primary\"/> My Drive</CardTitle>\n              <TooltipProvider>\n                <Tooltip>\n                    <TooltipTrigger asChild>\n                        <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8\" onClick={handleCreateFolder}><FolderPlus className=\"w-5 h-5 text-primary\" /></Button>\n                    </TooltipTrigger>\n                    <TooltipContent><p>New Folder</p></TooltipContent>\n                </Tooltip>\n              </TooltipProvider>\n            </CardHeader>\n            <div className=\"px-4 pb-2\">\n                <div className=\"relative\">\n                    <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\n                    <Input \n                        placeholder=\"Search drive...\" \n                        className=\"pl-8 bg-input\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                     />\n                </div>\n            </div>\n            <ScrollArea className=\"flex-1\">\n                <Accordion type=\"multiple\" defaultValue={['personal-files']} className=\"p-4\">\n                    <AccordionItem value=\"personal-files\">\n                        <AccordionTrigger className=\"hover:no-underline text-base\">Personal Files</AccordionTrigger>\n                        <AccordionContent>\n                           <p className=\"text-muted-foreground text-sm p-4 text-center\">Folder functionality coming soon.</p>\n                        </AccordionContent>\n                    </AccordionItem>\n                    <AccordionItem value=\"shared-drives\">\n                        <AccordionTrigger className=\"hover:no-underline text-base\">Shared Drives</AccordionTrigger>\n                        <AccordionContent>\n                            <p className=\"text-muted-foreground text-sm p-4 text-center\">No shared drives connected.</p>\n                        </AccordionContent>\n                    </AccordionItem>\n                </Accordion>\n            </ScrollArea>\n            <div className=\"p-4 mt-auto border-t\">\n                 <input type=\"file\" ref={fileInputRef} onChange={handleFileSelect} className=\"hidden\" />\n                <Button className=\"w-full cyber-button\" onClick={() => fileInputRef.current?.click()}><UploadCloud className=\"mr-2\"/> Upload File</Button>\n            </div>\n        </Card>\n\n        {/* File Grid */}\n        <div \n            className={cn(\"md:col-span-1 flex flex-col transition-all\", dragging && \"neon-border-primary\")}\n            onDragOver={handleDragOver}\n            onDragLeave={handleDragLeave}\n            onDrop={handleDrop}\n        >\n            <Card className=\"flex-1 flex flex-col\">\n              <CardHeader>\n                  <div className=\"flex items-center text-sm text-muted-foreground\">\n                      {breadcrumbs.map((segment, index) => (\n                          <React.Fragment key={index}>\n                            <button onClick={() => handleBreadcrumbClick(segment, index)} className=\"hover:text-primary transition-colors\">\n                                  {segment}\n                              </button>\n                              {index < breadcrumbs.length - 1 && <ChevronsRight className=\"h-4 w-4 mx-1\" />}\n                          </React.Fragment>\n                      ))}\n                  </div>\n              </CardHeader>\n              <CardContent className=\"flex-1\">\n                  <ScrollArea className=\"h-full\">\n                      <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-1\">\n                          {loading ? (\n                              Array.from({ length: 10 }).map((_, i) => (\n                                  <div key={i}>\n                                      <Skeleton className=\"aspect-square w-full\" />\n                                      <Skeleton className=\"h-4 w-3/4 mt-2\" />\n                                      <Skeleton className=\"h-3 w-1/2 mt-1\" />\n                                  </div>\n                              ))\n                          ) : filteredFiles.map(file => (\n                              <div \n                                  key={file.fullPath} \n                                  className=\"relative group cursor-pointer\"\n                                  onClick={(e) => {\n                                      e.preventDefault();\n                                      if (file.isFolder) {\n                                        setCurrentPath(file.fullPath.substring(user!.uid.length + 1));\n                                      } else {\n                                        downloadFileUrl(file.fullPath, file.name);\n                                      }\n                                  }}\n                                  onContextMenu={(e) => handleFileContextMenu(e, file)}\n                                  data-command-hub-trigger\n                              >\n                                  <Card className=\"aspect-square flex flex-col items-center justify-center p-4 bg-muted/30 hover:bg-muted/60 hover:neon-border-primary transition-all\">\n                                      {getFileIcon(file)}\n                                  </Card>\n                                  <div className=\"mt-2 text-center\">\n                                      <p className=\"text-sm font-medium truncate\" title={file.name}>{file.name}</p>\n                                      {!file.isFolder && <p className=\"text-xs text-muted-foreground\">{file.size}</p>}\n                                  </div>\n                                  <div \n                                    className=\"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity\"\n                                    onClick={(e) => { e.stopPropagation(); handleFileContextMenu(e, file); }}\n                                >\n                                    <MoreVertical className=\"w-5 h-5 text-muted-foreground\" />\n                                </div>\n                              </div>\n                          ))}\n                      </div>\n                  </ScrollArea>\n              </CardContent>\n            </Card>\n             {dragging && (\n                    <div className=\"absolute inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-10 pointer-events-none rounded-lg\">\n                        <div className=\"text-center p-8 border-2 border-dashed border-primary rounded-lg\">\n                           <UploadCloud className=\"w-16 h-16 text-primary mx-auto animate-pulse\" />\n                           <p className=\"mt-4 text-xl font-headline text-glow\">Drop to upload</p>\n                        </div>\n                    </div>\n                )}\n        </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":15309,"size_tokens":null},"src/app/weather/page.tsx":{"content":"\n'use client';\nimport { useState, useEffect } from 'react';\nimport { fetchWeatherApi } from 'openmeteo';\nimport {\n  Sun, Cloud, CloudRain, CloudDrizzle, CloudLightning, CloudSnow, Wind, Sunrise, Sunset, Droplets, Thermometer,\n  Loader2, AlertTriangle, MapPin, Calendar as CalendarIcon, LucideIcon\n} from 'lucide-react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { ChartContainer, ChartTooltip, ChartTooltipContent } from '@/components/ui/chart';\nimport { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar } from 'recharts';\nimport { format } from 'date-fns';\nimport { cn } from '@/lib/utils';\n\ntype WeatherData = {\n  location: string;\n  current: {\n    temperature: number;\n    weatherCode: number;\n    isDay: boolean;\n    windSpeed: number;\n    humidity: number;\n    apparentTemperature: number;\n  };\n  hourly: {\n    time: string[];\n    temperature: number[];\n    precipitationProbability: number[];\n    weatherCode: number[];\n  };\n  daily: {\n    time: string[];\n    weatherCode: number[];\n    temperatureMax: number[];\n    temperatureMin: number[];\n    uvIndexMax: number[];\n  };\n};\n\nconst getWeatherIcon = (code: number, isDay: boolean, className: string): JSX.Element => {\n  const icons: { [key: number]: LucideIcon } = {\n    0: isDay ? Sun : Sun, // Using Sun for both day/night clear\n    1: Cloud, 2: Cloud, 3: Cloud,\n    45: Cloud, 48: Cloud,\n    51: CloudDrizzle, 53: CloudDrizzle, 55: CloudDrizzle,\n    61: CloudRain, 63: CloudRain, 65: CloudRain,\n    71: CloudSnow, 73: CloudSnow, 75: CloudSnow,\n    95: CloudLightning, 96: CloudLightning, 99: CloudLightning\n  };\n  const Icon = icons[code] || (isDay ? Sun : Sun);\n  const color = code >= 95 ? 'text-yellow-400' : code >= 71 ? 'text-blue-300' : code >= 51 ? 'text-blue-400' : 'text-muted-foreground';\n  return <Icon className={`${className} ${color}`} />;\n};\n\nconst getWeatherDescription = (code: number): string => {\n  const descriptions: { [key: number]: string } = {\n    0: 'Clear sky', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',\n    45: 'Fog', 48: 'Depositing rime fog',\n    51: 'Light drizzle', 53: 'Moderate drizzle', 55: 'Dense drizzle',\n    61: 'Slight rain', 63: 'Moderate rain', 65: 'Heavy rain',\n    71: 'Slight snow fall', 73: 'Moderate snow fall', 75: 'Heavy snow fall',\n    95: 'Thunderstorm', 96: 'Thunderstorm with hail', 99: 'Thunderstorm with heavy hail'\n  };\n  return descriptions[code] || 'Unknown';\n};\n\nexport default function WeatherPage() {\n  const [weather, setWeather] = useState<WeatherData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const getPosition = (): Promise<GeolocationPosition> => {\n      return new Promise((resolve, reject) => navigator.geolocation.getCurrentPosition(resolve, reject));\n    };\n\n    const fetchWeatherData = async () => {\n      setLoading(true);\n      if (!navigator.geolocation) {\n        setError(\"Geolocation is not supported. Please enable it in your browser settings.\");\n        setLoading(false);\n        return;\n      }\n\n      try {\n        const position = await getPosition();\n        const { latitude, longitude } = position.coords;\n\n        const params = {\n          latitude, longitude,\n          current: [\"temperature_2m\", \"relative_humidity_2m\", \"apparent_temperature\", \"is_day\", \"weather_code\", \"wind_speed_10m\"],\n          hourly: [\"temperature_2m\", \"precipitation_probability\", \"weather_code\"],\n          daily: [\"weather_code\", \"temperature_2m_max\", \"temperature_2m_min\", \"uv_index_max\"],\n          timezone: \"auto\"\n        };\n        const url = \"https://api.open-meteo.com/v1/forecast\";\n        const responses = await fetchWeatherApi(url, params);\n        const response = responses[0];\n\n        const current = response.current()!;\n        const hourly = response.hourly()!;\n        const daily = response.daily()!;\n        \n        const range = (start: number, stop: number, step: number) =>\n            Array.from({ length: (stop - start) / step }, (_, i) => start + i * step);\n\n        const hourlyWeatherCodeVar = hourly.variables(2);\n        const uvIndexVar = daily.variables(3);\n        \n        const uvIndexArray = uvIndexVar?.valuesArray();\n        const uvIndexValues = uvIndexArray ? Array.from(uvIndexArray) : [];\n        const hourlyWeatherCodeArray = hourlyWeatherCodeVar?.valuesArray();\n        const hourlyWeatherCodes = hourlyWeatherCodeArray ? Array.from(hourlyWeatherCodeArray) : [];\n\n        setWeather({\n          location: \"Your Location\",\n          current: {\n            temperature: Math.round(current.variables(0)!.value()),\n            humidity: Math.round(current.variables(1)!.value()),\n            apparentTemperature: Math.round(current.variables(2)!.value()),\n            isDay: current.variables(3)!.value() === 1,\n            weatherCode: current.variables(4)!.value(),\n            windSpeed: Math.round(current.variables(5)!.value()),\n          },\n          hourly: {\n            time: Array.from({ length: 24 }, (_, i) => format(new Date().setHours(new Date().getHours() + i), 'ha')),\n            temperature: Array.from(hourly.variables(0)!.valuesArray()!.slice(0, 24)),\n            precipitationProbability: Array.from(hourly.variables(1)!.valuesArray()!.slice(0, 24)),\n            weatherCode: hourlyWeatherCodes.slice(0,24),\n          },\n          daily: {\n            time: range(Number(daily.time()), Number(daily.timeEnd()), daily.interval()).map(\n                (t) => format(new Date(t * 1000), 'EEE')\n            ),\n            weatherCode: Array.from(daily.variables(0)!.valuesArray()!),\n            temperatureMax: Array.from(daily.variables(1)!.valuesArray()!).map(Math.round),\n            temperatureMin: Array.from(daily.variables(2)!.valuesArray()!).map(Math.round),\n            uvIndexMax: uvIndexValues.map(Math.round),\n          }\n        });\n        setError(null);\n      } catch (err: any) {\n        console.error(\"Weather fetch error:\", err);\n        setError(err.code === 1 ? \"Location access denied. Please enable it to see local weather.\" : \"Could not fetch weather data.\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchWeatherData();\n  }, []);\n  \n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-48 w-full\" />\n        <Skeleton className=\"h-64 w-full\" />\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6\">\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !weather) {\n    return (\n      <Card className=\"flex flex-col items-center justify-center p-8 text-center h-96\">\n        <AlertTriangle className=\"w-16 h-16 text-destructive mb-4\" />\n        <CardTitle className=\"text-2xl\">Weather Data Unavailable</CardTitle>\n        <p className=\"text-muted-foreground mt-2\">{error || \"An unknown error occurred.\"}</p>\n      </Card>\n    );\n  }\n  \n  const { current, hourly, daily, location } = weather;\n\n  const hourlyChartData = hourly.temperature.map((temp, index) => ({\n    time: hourly.time[index],\n    Temperature: Math.round(temp),\n    Precipitation: hourly.precipitationProbability[index],\n  }));\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardContent className=\"p-6 flex flex-col md:flex-row items-center justify-between gap-6\">\n          <div className=\"flex items-center gap-6\">\n            {getWeatherIcon(current.weatherCode, current.isDay, 'w-24 h-24')}\n            <div>\n              <p className=\"text-6xl font-bold\">{current.temperature}°</p>\n              <p className=\"text-xl text-muted-foreground\">{getWeatherDescription(current.weatherCode)}</p>\n              <p className=\"text-sm font-medium flex items-center gap-1\"><MapPin className=\"w-4 h-4\" />{location}</p>\n            </div>\n          </div>\n          <div className=\"grid grid-cols-2 gap-x-8 gap-y-4 text-sm\">\n            <div className=\"flex items-center gap-2\"><Thermometer className=\"w-5 h-5 text-primary\" /><span className=\"font-medium\">Feels like:</span> {current.apparentTemperature}°</div>\n            <div className=\"flex items-center gap-2\"><Wind className=\"w-5 h-5 text-primary\" /><span className=\"font-medium\">Wind:</span> {current.windSpeed} km/h</div>\n            <div className=\"flex items-center gap-2\"><Droplets className=\"w-5 h-5 text-primary\" /><span className=\"font-medium\">Humidity:</span> {current.humidity}%</div>\n            <div className=\"flex items-center gap-2\"><Sun className=\"w-5 h-5 text-primary\" /><span className=\"font-medium\">UV Index:</span> {daily.uvIndexMax[0] ?? 'N/A'}</div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader><CardTitle>Hourly Forecast</CardTitle></CardHeader>\n        <CardContent className=\"h-80\">\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <AreaChart data={hourlyChartData} margin={{ top: 5, right: 20, left: -10, bottom: 5 }}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border) / 0.5)\" />\n              <XAxis dataKey=\"time\" tick={{ fill: 'hsl(var(--muted-foreground))' }} tickLine={{ stroke: 'hsl(var(--border))' }} />\n              <YAxis yAxisId=\"left\" orientation=\"left\" stroke=\"hsl(var(--primary))\" tick={{ fill: 'hsl(var(--primary))' }} label={{ value: '°C', position: 'insideLeft', angle: -90, dy: -10, fill: 'hsl(var(--primary))' }} />\n              <YAxis yAxisId=\"right\" orientation=\"right\" stroke=\"hsl(var(--secondary))\" tick={{ fill: 'hsl(var(--secondary))' }} label={{ value: '%', position: 'insideRight', angle: -90, dy: 10, fill: 'hsl(var(--secondary))' }} />\n              <Tooltip\n                contentStyle={{\n                    backgroundColor: 'hsl(var(--background))',\n                    borderColor: 'hsl(var(--border))',\n                }}\n              />\n              <Area type=\"monotone\" dataKey=\"Temperature\" stroke=\"hsl(var(--primary))\" fill=\"hsl(var(--primary) / 0.2)\" yAxisId=\"left\" />\n              <Area type=\"monotone\" dataKey=\"Precipitation\" stroke=\"hsl(var(--secondary))\" fill=\"hsl(var(--secondary) / 0.2)\" yAxisId=\"right\" />\n            </AreaChart>\n          </ResponsiveContainer>\n        </CardContent>\n      </Card>\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <Card>\n            <CardHeader><CardTitle>7-Day Forecast</CardTitle></CardHeader>\n            <CardContent className=\"space-y-4\">\n                {daily.time.map((day, index) => {\n                    const minTemp = daily.temperatureMin[index];\n                    const maxTemp = daily.temperatureMax[index];\n                    const tempSpan = 40; // Assuming a temp range from -10 to 30\n                    const barStart = ((minTemp + 10) / tempSpan) * 100;\n                    const barWidth = ((maxTemp - minTemp) / tempSpan) * 100;\n\n                    return(\n                    <div key={`${day}-${index}`} className=\"grid grid-cols-[60px_40px_1fr_80px] items-center gap-2\">\n                        <p className=\"font-bold text-base\">{day}</p>\n                        <div className=\"flex justify-center\">\n                           {getWeatherIcon(daily.weatherCode[index], true, 'w-8 h-8')}\n                        </div>\n                        <div className=\"w-full bg-muted rounded-full h-2.5\">\n                            <div className=\"h-2.5 rounded-full bg-gradient-to-r from-blue-500 via-purple-500 to-orange-500\" style={{ marginLeft: `${barStart}%`, width: `${barWidth}%`}}></div>\n                        </div>\n                        <p className=\"font-bold text-base text-right\">{minTemp}° / {maxTemp}°</p>\n                    </div>\n                )})}\n            </CardContent>\n        </Card>\n        <div className=\"space-y-6\">\n            \n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":12012,"size_tokens":null},"src/firebase/config.ts":{"content":"\nexport const firebaseConfig = {\n  \"projectId\": \"studio-4634736248-c0b42\",\n  \"appId\": \"1:185134863770:web:4af101ef873aed44105623\",\n  \"apiKey\": \"AIzaSyDQXx_TQylXDvIKHf-ud_7T8RbRdTC91ng\",\n  \"authDomain\": \"studio-4634736248-c0b42.firebaseapp.com\",\n  \"measurementId\": \"G-S33W1P5G5D\",\n  \"messagingSenderId\": \"185134863770\",\n  \"storageBucket\": \"studio-4634736248-c0b42.appspot.com\"\n};\n","path":null,"size_bytes":379,"size_tokens":null},"src/components/news/BreakingNewsNotifier.tsx":{"content":"\n// src/components/news/BreakingNewsNotifier.tsx\n'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useToast } from '@/hooks/use-toast';\nimport { Article } from '@/app/news/page';\nimport { formatDistanceToNowStrict } from 'date-fns';\nimport { Button } from '../ui/button';\nimport { useRouter } from 'next/navigation';\n\nexport default function BreakingNewsNotifier() {\n  const { toast } = useToast();\n  const [lastArticleUrl, setLastArticleUrl] = useState<string | null>(null);\n  const router = useRouter();\n\n  useEffect(() => {\n    // Fetch initial breaking news to set a baseline\n    const fetchInitialNews = async () => {\n      try {\n        const response = await fetch('/api/news?category=general&pageSize=1');\n        const data = await response.json();\n        if (data.articles && data.articles.length > 0) {\n          setLastArticleUrl(data.articles[0].url);\n        }\n      } catch (error) {\n        console.error('Failed to fetch initial news:', error);\n      }\n    };\n    fetchInitialNews();\n\n    const interval = setInterval(async () => {\n      try {\n        const response = await fetch('/api/news?category=general&pageSize=1');\n        const data = await response.json();\n        const latestArticle: Article = data.articles?.[0];\n\n        if (latestArticle && latestArticle.url !== lastArticleUrl) {\n          setLastArticleUrl(latestArticle.url);\n          toast({\n            duration: 8000,\n            title: `BREAKING: ${latestArticle.title}`,\n            description: `${latestArticle.source.name} - ${formatDistanceToNowStrict(new Date(latestArticle.publishedAt), { addSuffix: true })}`,\n            action: (\n              <Button variant=\"secondary\" size=\"sm\" onClick={() => router.push(latestArticle.url)}>\n                Read Now\n              </Button>\n            ),\n          });\n          // Here you would also trigger a sound and native browser notification if enabled\n        }\n      } catch (error) {\n        console.error('Failed to poll for breaking news:', error);\n      }\n    }, 300000); // Poll every 5 minutes\n\n    return () => clearInterval(interval);\n  }, [lastArticleUrl, toast, router]);\n\n  return null; // This component doesn't render anything itself\n}\n\n    ","path":null,"size_bytes":2223,"size_tokens":null},"src/components/layout/user-nav.tsx":{"content":"'use client';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { CreditCard, LogOut, User as UserIcon, Box, Settings } from 'lucide-react';\nimport { useUser } from '@/hooks/use-user';\nimport { useAuth } from '@/firebase/provider';\nimport { signOut } from 'firebase/auth';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { PlaceHolderImages } from '@/lib/placeholder-images';\nimport { Skeleton } from '../ui/skeleton';\nimport { useCommandHub } from '@/hooks/use-command-hub';\nimport StatusSelector from '../user/status-selector';\n\nexport default function UserNav() {\n  const { user, profile, loading } = useUser();\n  const auth = useAuth();\n  const router = useRouter();\n  const { openHub } = useCommandHub();\n\n  const handleLogout = async () => {\n    await signOut(auth);\n    router.push('/login');\n  };\n\n  if (loading) {\n    return <Skeleton className=\"h-9 w-9 rounded-full\" />;\n  }\n\n  if (!user) {\n    return (\n      <Link href=\"/login\">\n        <Button variant=\"outline\">Login</Button>\n      </Link>\n    );\n  }\n  \n  const userAvatar = PlaceHolderImages.find(p => p.id === 'user-avatar-1');\n\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button \n          variant=\"ghost\" \n          className=\"relative h-9 w-9 rounded-full\" \n          data-onboarding-id=\"profile-avatar\"\n          onContextMenu={(e) => {\n            e.preventDefault();\n            openHub(e, {\n              type: 'user',\n              data: {\n                viewProfile: () => router.push('/settings'),\n                sendMessage: () => router.push('/chat'),\n                voiceCall: () => console.log('Voice call'),\n                videoCall: () => console.log('Video call'),\n                addFriend: () => console.log('Add friend'),\n                createGroup: () => console.log('Create group'),\n                muteUser: () => console.log('Mute user'),\n                pinChat: () => console.log('Pin chat'),\n                blockUser: () => console.log('Block user'),\n                reportUser: () => console.log('Report user'),\n                isFriend: false\n              }\n            });\n          }}\n        >\n          <Avatar className=\"h-9 w-9 border-2 border-primary/50 animate-pulse-glow\">\n            <AvatarImage\n              src={profile?.photoURL ?? user.photoURL ?? userAvatar?.imageUrl}\n              alt={profile?.displayName ?? user.displayName ?? user.email ?? ''}\n              data-ai-hint={userAvatar?.imageHint}\n            />\n            <AvatarFallback>{user.email?.[0]?.toUpperCase() ?? 'U'}</AvatarFallback>\n          </Avatar>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent className=\"w-56\" align=\"end\" forceMount>\n        <DropdownMenuLabel className=\"font-normal\">\n          <div className=\"flex flex-col space-y-2\">\n            <div>\n              <p className=\"text-sm font-medium leading-none\">{profile?.displayName ?? user.displayName ?? 'Operator'}</p>\n              <p className=\"text-xs leading-none text-muted-foreground\">\n                {user.email}\n              </p>\n            </div>\n            <StatusSelector />\n          </div>\n        </DropdownMenuLabel>\n        <DropdownMenuSeparator />\n        <DropdownMenuGroup>\n          <Link href=\"/settings\">\n            <DropdownMenuItem>\n              <Settings className=\"mr-2 h-4 w-4\" />\n              <span>Profile & Settings</span>\n            </DropdownMenuItem>\n          </Link>\n           <Link href=\"/inventory\" data-onboarding-id=\"inventory-button\">\n            <DropdownMenuItem>\n              <Box className=\"mr-2 h-4 w-4\" />\n              <span>My Inventory</span>\n            </DropdownMenuItem>\n          </Link>\n          <DropdownMenuItem>\n            <CreditCard className=\"mr-2 h-4 w-4\" />\n            <span>Billing</span>\n          </DropdownMenuItem>\n        </DropdownMenuGroup>\n        <DropdownMenuSeparator />\n        <DropdownMenuItem onClick={handleLogout}>\n          <LogOut className=\"mr-2 h-4 w-4\" />\n          <span>Log out</span>\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":4400,"size_tokens":null},"src/components/chat/ChatHeader.tsx":{"content":"\n'use client';\nimport { Button } from '@/components/ui/button';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { CardHeader } from '@/components/ui/card';\nimport { MoreVertical, Bot, Settings, Users, UserPlus } from 'lucide-react';\nimport CallActionButtons from '@/components/calls/CallActionButtons';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger, DropdownMenuSeparator } from '@/components/ui/dropdown-menu';\nimport { Contact } from '@/types/chat';\nimport { getDerivedStatus } from '@/lib/chat-utils';\nimport { PublicUser } from '@/hooks/use-connections';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { cn } from '@/lib/utils';\nimport UserPopover from '../user/user-popover';\n\n\ninterface ChatHeaderProps {\n    contact: Contact | null;\n    onStartCall?: (type: 'video' | 'voice') => void;\n    connectedUsers: PublicUser[];\n    isClient: boolean;\n    onGroupSettings?: () => void;\n    onAddToGroup?: () => void;\n    onViewMembers?: () => void;\n}\n\nexport default function ChatHeader({ contact, onStartCall, connectedUsers, isClient, onGroupSettings, onAddToGroup, onViewMembers }: ChatHeaderProps) {\n    if (!contact) {\n        return (\n            <CardHeader className=\"flex-row items-center justify-between\">\n                 <div className=\"flex items-center gap-3\">\n                    <Skeleton className=\"w-12 h-12 rounded-full\" />\n                    <div className=\"space-y-2\">\n                        <Skeleton className=\"h-5 w-32\" />\n                        <Skeleton className=\"h-3 w-20\" />\n                    </div>\n                </div>\n            </CardHeader>\n        );\n    }\n    \n    // Get real-time user data from connectedUsers instead of static contact data\n    const realTimeUser = contact.type === 'user' ? connectedUsers.find(u => u.id === contact.id) : null;\n    const derivedStatus = isClient && realTimeUser ? getDerivedStatus(realTimeUser) : { label: contact.status || '...', color: 'bg-muted-foreground', isOnline: false };\n    const canCall = contact.type === 'user' && derivedStatus.isOnline;\n\n    return (\n        <CardHeader className=\"flex-row items-center justify-between border-b p-3 md:p-6\">\n            <div className=\"flex items-center gap-2 md:gap-3 min-w-0 flex-1\">\n                 <div className=\"relative flex-shrink-0\">\n                    {contact.type === 'group' ? (\n                        <Avatar className=\"h-8 w-8 md:h-12 md:w-12 border-2 border-transparent\">\n                            <div className=\"w-full h-full flex items-center justify-center bg-secondary/20 rounded-full\">\n                                <Users className=\"w-6 h-6 text-secondary\" />\n                            </div>\n                            <AvatarFallback>{contact.name.charAt(0)}</AvatarFallback>\n                        </Avatar>\n                    ) : (\n                        <UserPopover user={realTimeUser || contact as unknown as PublicUser}>\n                            <Avatar className=\"h-8 w-8 md:h-12 md:w-12 border-2 border-transparent cursor-pointer\">\n                                {contact.type === 'bot' ?\n                                    <div className=\"w-full h-full flex items-center justify-center bg-primary/20 rounded-full\"><Bot className=\"w-6 h-6 text-primary\" /></div> :\n                                    <AvatarImage src={realTimeUser?.photoURL || contact.avatar || undefined} />\n                                }\n                                <AvatarFallback>{(realTimeUser?.displayName || contact.name).charAt(0)}</AvatarFallback>\n                            </Avatar>\n                        </UserPopover>\n                    )}\n                    {contact.type === 'user' && (\n                        <div className={cn(\"absolute bottom-0 right-0 w-2.5 h-2.5 md:w-3.5 md:h-3.5 rounded-full border-2 border-background\", derivedStatus.color)}></div>\n                    )}\n                </div>\n                <div className=\"min-w-0 flex-1\">\n                    {contact.type === 'group' ? (\n                        <>\n                            <h2 className=\"text-sm md:text-xl font-headline text-glow truncate\">{contact.name}</h2>\n                            <p className=\"text-xs md:text-sm text-muted-foreground truncate\">{contact.status}</p>\n                        </>\n                    ) : (\n                        <>\n                            <UserPopover user={realTimeUser || contact as unknown as PublicUser}>\n                                <h2 className=\"text-sm md:text-xl font-headline text-glow cursor-pointer hover:underline truncate\">{realTimeUser?.displayName || contact.name}</h2>\n                            </UserPopover>\n                            <p className=\"text-xs md:text-sm text-muted-foreground truncate\">{contact.type === 'bot' ? 'AI Assistant' : derivedStatus.label}</p>\n                        </>\n                    )}\n                </div>\n            </div>\n            <div className=\"flex items-center gap-1 md:gap-2 flex-shrink-0\">\n                {contact.type === 'user' && contact.id !== 'aether-bot' && (\n                    <CallActionButtons\n                        userId={contact.id}\n                        userName={contact.name}\n                        userAvatar={contact.avatar}\n                        disabled={!canCall}\n                    />\n                )}\n                {contact.type !== 'bot' && (\n                    <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 md:h-10 md:w-10\">\n                                <MoreVertical className=\"w-4 h-4 md:w-5 md:h-5\" />\n                            </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\" className=\"w-48\">\n                            {contact.type === 'group' ? (\n                                <>\n                                    <DropdownMenuItem onClick={onViewMembers}>\n                                        <Users className=\"w-4 h-4 mr-2\" />\n                                        View Members\n                                    </DropdownMenuItem>\n                                    <DropdownMenuItem onClick={onAddToGroup}>\n                                        <UserPlus className=\"w-4 h-4 mr-2\" />\n                                        Add Members\n                                    </DropdownMenuItem>\n                                    <DropdownMenuSeparator />\n                                    <DropdownMenuItem onClick={onGroupSettings}>\n                                        <Settings className=\"w-4 h-4 mr-2\" />\n                                        Group Settings\n                                    </DropdownMenuItem>\n                                </>\n                            ) : (\n                                <>\n                                    <DropdownMenuItem>\n                                        <UserPlus className=\"w-4 h-4 mr-2\" />\n                                        Add to Group\n                                    </DropdownMenuItem>\n                                    <DropdownMenuItem>\n                                        <Settings className=\"w-4 h-4 mr-2\" />\n                                        Chat Settings\n                                    </DropdownMenuItem>\n                                </>\n                            )}\n                        </DropdownMenuContent>\n                    </DropdownMenu>\n                )}\n            </div>\n        </CardHeader>\n    );\n}\n","path":null,"size_bytes":7634,"size_tokens":null},"src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"src/lib/performance.ts":{"content":"// Performance optimization utilities\n\nexport const preloadRoute = (href: string) => {\n  if (typeof window !== 'undefined') {\n    const link = document.createElement('link');\n    link.rel = 'prefetch';\n    link.href = href;\n    document.head.appendChild(link);\n  }\n};\n\nexport const enableFastMode = () => {\n  if (typeof document !== 'undefined') {\n    document.body.classList.add('fast-nav');\n  }\n};\n\nexport const disableFastMode = () => {\n  if (typeof document !== 'undefined') {\n    document.body.classList.remove('fast-nav');\n  }\n};","path":null,"size_bytes":535,"size_tokens":null},"src/app/ai-hub/page.tsx":{"content":"'use client';\nimport { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Bot, Languages, Sparkles } from 'lucide-react';\nimport AssistantTool from '@/components/ai-hub/assistant-tool';\nimport TranslatorTool from '@/components/ai-hub/translator-tool';\nimport ProfileEnhancerTool from '@/components/ai-hub/profile-enhancer-tool';\n\nexport default function AIHubPage() {\n  const [activeTab, setActiveTab] = useState('assistant');\n\n  return (\n    <div className=\"container mx-auto p-4 md:p-6 h-full flex flex-col\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-4xl font-bold mb-2 text-glow\">AI Hub</h1>\n        <p className=\"text-muted-foreground\">Harness the power of AI to enhance your experience</p>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col\">\n        <TabsList className=\"grid w-full grid-cols-3 mb-4\">\n          <TabsTrigger value=\"assistant\" className=\"flex items-center gap-2\">\n            <Bot className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Assistant</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"translator\" className=\"flex items-center gap-2\">\n            <Languages className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Translator</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"profile\" className=\"flex items-center gap-2\">\n            <Sparkles className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Profile</span>\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"assistant\" className=\"flex-1 mt-0\">\n          <Card className=\"h-full flex flex-col\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Bot className=\"w-5 h-5 text-primary\" />\n                AI Assistant\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"flex-1 flex flex-col min-h-0\">\n              <AssistantTool />\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"translator\" className=\"flex-1 mt-0\">\n          <Card className=\"h-full flex flex-col\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Languages className=\"w-5 h-5 text-primary\" />\n                Text Translator\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"flex-1 flex flex-col min-h-0\">\n              <TranslatorTool />\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"profile\" className=\"flex-1 mt-0\">\n          <Card className=\"h-full flex flex-col\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Sparkles className=\"w-5 h-5 text-primary\" />\n                Profile Enhancer\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"flex-1 flex flex-col min-h-0\">\n              <ProfileEnhancerTool />\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":3252,"size_tokens":null},"src/components/modals/CreateOrJoinSpaceModal.tsx":{"content":"'use client';\nimport { useState, useRef } from 'react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';\nimport { Users, Globe, ArrowLeft, UploadCloud, Link as LinkIcon, Loader2 } from 'lucide-react';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\n\ntype View = 'initial' | 'create' | 'join';\ntype CreateStep = 1 | 2;\n\nexport default function CreateOrJoinSpaceModal({ isOpen, onOpenChange }: { isOpen: boolean; onOpenChange: (open: boolean) => void; }) {\n  const [view, setView] = useState<View>('initial');\n  const [createStep, setCreateStep] = useState<CreateStep>(1);\n  const [serverName, setServerName] = useState('');\n  const [serverIcon, setServerIcon] = useState<string | null>(null);\n  const [inviteLink, setInviteLink] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const iconInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n\n  const handleBack = () => {\n    if (createStep === 2) {\n      setCreateStep(1);\n    } else {\n      setView('initial');\n    }\n  };\n\n  const handleIconUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file && file.type.startsWith('image/')) {\n      const reader = new FileReader();\n      reader.onload = (e) => setServerIcon(e.target?.result as string);\n      reader.readAsDataURL(file);\n    } else {\n        toast({\n            variant: 'destructive',\n            title: 'Invalid file',\n            description: 'Please select an image file.'\n        })\n    }\n  };\n\n  const handleCreateServer = () => {\n    if (!serverName) {\n        toast({ variant: 'destructive', title: 'Space name is required.' });\n        return;\n    }\n    setIsLoading(true);\n    // Simulate server creation\n    setTimeout(() => {\n        toast({ title: 'Space Created!', description: `The space \"${serverName}\" is now online.`});\n        setIsLoading(false);\n        onOpenChange(false);\n    }, 1500)\n  }\n  \n  const handleJoinServer = () => {\n    if (!inviteLink || !inviteLink.startsWith('https://aetherweave.gg/join/')) {\n      toast({ variant: 'destructive', title: 'Invalid Invite Link', description: \"Please enter a valid Aetherweave invite link.\" });\n      return;\n    }\n    setIsLoading(true);\n    // Simulate joining\n    setTimeout(() => {\n      toast({ title: 'Joined Space!', description: `You are now a member.`});\n      setIsLoading(false);\n      onOpenChange(false);\n    }, 1500)\n  }\n\n  const renderContent = () => {\n    switch (view) {\n      case 'create':\n        return (\n          <>\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                {createStep === 2 && <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={handleBack}><ArrowLeft size={16}/></Button>}\n                Customize Your Space\n              </DialogTitle>\n              <DialogDescription>\n                Give your space a personality with a name and an icon. You can always change it later.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"py-4 space-y-6 text-center\">\n                 <input type=\"file\" accept=\"image/*\" ref={iconInputRef} onChange={handleIconUpload} className=\"hidden\" />\n                 <Avatar \n                    className=\"w-24 h-24 mx-auto cursor-pointer border-4 border-dashed border-primary/50 hover:border-primary transition-all\"\n                    onClick={() => iconInputRef.current?.click()}\n                >\n                    <AvatarImage src={serverIcon ?? undefined} className=\"object-cover\" />\n                    <AvatarFallback className=\"bg-transparent\">\n                        <UploadCloud size={32} className=\"text-primary\"/>\n                    </AvatarFallback>\n                </Avatar>\n                <div className=\"space-y-2 text-left\">\n                    <Label htmlFor=\"server-name\">SPACE NAME</Label>\n                    <Input id=\"server-name\" value={serverName} onChange={(e) => setServerName(e.target.value)} placeholder=\"My Awesome Space\" />\n                </div>\n            </div>\n             <DialogFooter>\n              <Button variant=\"ghost\" onClick={handleBack}>Back</Button>\n              <Button onClick={handleCreateServer} disabled={isLoading}>\n                {isLoading ? <Loader2 className=\"animate-spin mr-2\"/> : null}\n                Create\n              </Button>\n            </DialogFooter>\n          </>\n        );\n      case 'join':\n        return (\n            <>\n                <DialogHeader>\n                    <DialogTitle className=\"flex items-center gap-2\">\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={handleBack}><ArrowLeft size={16}/></Button>\n                        Join a Space\n                    </DialogTitle>\n                    <DialogDescription>\n                        Enter an invite link below to join an existing space.\n                    </DialogDescription>\n                </DialogHeader>\n                <div className=\"py-4 space-y-2\">\n                    <Label htmlFor=\"invite-link\">INVITE LINK</Label>\n                    <div className=\"relative\">\n                        <LinkIcon className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\"/>\n                        <Input id=\"invite-link\" value={inviteLink} onChange={(e) => setInviteLink(e.target.value)} placeholder=\"https://aetherweave.gg/join/ab12cd34\" className=\"pl-9\"/>\n                    </div>\n                </div>\n                <DialogFooter>\n                     <Button className=\"w-full\" onClick={handleJoinServer} disabled={isLoading}>\n                       {isLoading ? <Loader2 className=\"animate-spin mr-2\"/> : null}\n                       Join Space\n                    </Button>\n                </DialogFooter>\n            </>\n        )\n      case 'initial':\n      default:\n        return (\n          <>\n            <DialogHeader>\n              <DialogTitle>Create or Join a Space</DialogTitle>\n              <DialogDescription>\n                Create a new hub for your friends or community, or join an existing one.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 py-4\">\n                <Card onClick={() => setView('create')} className=\"hover:neon-border-primary cursor-pointer transition-all\">\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center justify-between\">Create My Own <Users /></CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <p className=\"text-sm text-muted-foreground\">Create a new space for you and your friends.</p>\n                    </CardContent>\n                </Card>\n                 <Card onClick={() => setView('join')} className=\"hover:neon-border-primary cursor-pointer transition-all\">\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center justify-between\">Join a Space <Globe /></CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <p className=\"text-sm text-muted-foreground\">Join an existing space with an invite code.</p>\n                    </CardContent>\n                </Card>\n            </div>\n          </>\n        );\n    }\n  };\n\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-lg glass-card\" onInteractOutside={(e) => e.preventDefault()}>\n        <AnimatePresence mode=\"wait\">\n            <motion.div\n                key={view + createStep}\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                transition={{ duration: 0.2 }}\n            >\n                {renderContent()}\n            </motion.div>\n        </AnimatePresence>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":8413,"size_tokens":null},"src/lib/store-items.ts":{"content":"\nimport { Palette, Award, Sparkles, Shield, ImageIcon, Music, Puzzle, Box, Package, LucideIcon, ShoppingBag, AppWindow, WifiOff } from \"lucide-react\";\n\nexport interface StoreCategory {\n    id: string;\n    name: string;\n    description: string;\n    icon: LucideIcon;\n    color: string;\n    bgColor: string;\n}\n\nexport type Rarity = 'Common' | 'Rare' | 'Epic' | 'Cyber Rare' | 'Legendary' | 'Mythic';\n\nexport interface StoreItem {\n    id: string;\n    category: string;\n    name:string;\n    description: string;\n    price: number;\n    rarity: Rarity;\n    imageUrl?: string;\n    icon: LucideIcon;\n    unlocksBadge?: string;\n}\n\nexport const storeCategories: StoreCategory[] = [\n    {\n        id: \"themes\",\n        name: \"Themes & UI Skins\",\n        description: \"Customize the entire look and feel of your Aetherweave interface.\",\n        icon: Palette,\n        color: \"text-primary\",\n        bgColor: \"bg-primary/10\",\n    },\n    {\n        id: \"badges\",\n        name: \"Badge Store\",\n        description: \"Display your achievements. Some badges are earned, others can be bought.\",\n        icon: Award,\n        color: \"text-secondary\",\n        bgColor: \"bg-secondary/10\",\n    },\n    {\n        id: \"avatar-customization\",\n        name: \"Avatar Customization\",\n        description: \"Frames, effects, and more to make your avatar stand out from the crowd.\",\n        icon: ImageIcon,\n        color: \"text-yellow-400\",\n        bgColor: \"bg-yellow-400/10\",\n    },\n    {\n        id: \"chat-effects\",\n        name: \"Chat Effects\",\n        description: \"Purchase unique text effects, animations, and custom emojis for chat.\",\n        icon: Sparkles,\n        color: \"text-green-400\",\n        bgColor: \"bg-green-400/10\",\n    },\n    {\n        id: \"boosters\",\n        name: \"Boosters\",\n        description: \"Activate temporary XP multipliers and other beneficial boosts.\",\n        icon: Shield,\n        color: \"text-blue-400\",\n        bgColor: \"bg-blue-400/10\",\n    },\n    {\n        id: \"sound-packs\",\n        name: \"Sound Packs\",\n        description: \"Change your UI notification sounds with themed audio packs.\",\n        icon: Music,\n        color: \"text-red-400\",\n        bgColor: \"bg-red-400/10\",\n    },\n     {\n        id: 'stickers-emotes',\n        name: 'Stickers & Emotes',\n        description: 'Expand your communication toolkit with unique stickers and emotes.',\n        icon: Puzzle,\n        color: 'text-orange-400',\n        bgColor: 'bg-orange-400/10',\n    },\n     {\n        id: 'mini-apps',\n        name: 'Mini-Apps',\n        description: 'Purchase mini-applications that run within your Aetherweave dashboard.',\n        icon: AppWindow,\n        color: 'text-indigo-400',\n        bgColor: 'bg-indigo-400/10',\n    },\n     {\n        id: 'offline-addons',\n        name: 'Offline Addons',\n        description: 'Enhance your offline experience with games and tools.',\n        icon: WifiOff,\n        color: 'text-gray-400',\n        bgColor: 'bg-gray-400/10',\n    },\n    {\n        id: \"mystery-boxes\",\n        name: \"Mystery Boxes\",\n        description: \"Feeling lucky? Purchase a mystery box for a chance at rare items.\",\n        icon: Package,\n        color: \"text-purple-400\",\n        bgColor: \"bg-purple-400/10\",\n    },\n];\n\nexport const storeItems: StoreItem[] = [\n    // Themes\n    {\n        id: 'theme-azure',\n        category: 'themes',\n        name: 'Azure Matrix',\n        description: 'A cool, calming theme of deep blues and glowing cyan, perfect for a focused operator.',\n        price: 1000,\n        rarity: 'Common',\n        icon: Palette,\n        imageUrl: 'https://picsum.photos/seed/theme3/600/400',\n    },\n    {\n        id: 'theme-sunset',\n        category: 'themes',\n        name: 'Synthwave Sunset',\n        description: 'A vibrant theme of neon pinks and oranges, reminiscent of a retro-futuristic sunset.',\n        price: 2500,\n        rarity: 'Rare',\n        icon: Palette,\n        imageUrl: 'https://picsum.photos/seed/theme1/600/400',\n    },\n    {\n        id: 'theme-chrome',\n        category: 'themes',\n        name: 'Liquid Chrome',\n        description: 'A sleek, reflective theme that gives your UI a polished metallic finish.',\n        price: 2000,\n        rarity: 'Rare',\n        icon: Palette,\n        imageUrl: 'https://picsum.photos/seed/theme6/600/400',\n    },\n    {\n        id: 'theme-violet',\n        category: 'themes',\n        name: 'Violet Overdrive',\n        description: 'A high-energy theme with pulsating purples and sharp magenta highlights.',\n        price: 3000,\n        rarity: 'Cyber Rare',\n        icon: Palette,\n        imageUrl: 'https://picsum.photos/seed/theme4/600/400',\n    },\n    {\n        id: 'theme-glitch',\n        category: 'themes',\n        name: 'Glitch Runner',\n        description: 'An unstable, glitch-aesthetic theme with scan lines and digital artifacts.',\n        price: 5000,\n        rarity: 'Epic',\n        icon: Palette,\n        imageUrl: 'https://picsum.photos/seed/theme2/600/400',\n    },\n    {\n        id: 'theme-samurai',\n        category: 'themes',\n        name: 'Cyber Samurai',\n        description: 'A theme inspired by ancient warrior codes, featuring sharp lines, deep reds, and steel grays.',\n        price: 5500,\n        rarity: 'Epic',\n        icon: Palette,\n        imageUrl: 'https://picsum.photos/seed/theme7/600/400',\n    },\n    {\n        id: 'theme-cascade',\n        category: 'themes',\n        name: 'Code Cascade',\n        description: 'The classic digital rain effect, turning your UI into a flowing stream of characters.',\n        price: 7500,\n        rarity: 'Legendary',\n        icon: Palette,\n        imageUrl: 'https://picsum.photos/seed/theme5/600/400',\n    },\n    // Badges\n    {\n        id: 'badge-supporter',\n        category: 'badges',\n        name: 'Early Supporter',\n        description: 'Show your support for the platform with this exclusive early-phase badge.',\n        price: 1000,\n        rarity: 'Rare',\n        icon: Award,\n        unlocksBadge: 'supporter',\n        imageUrl: 'https://picsum.photos/seed/badge1/600/400',\n    },\n    // Avatar Items\n    {\n        id: 'avatar-frame-neon',\n        category: 'avatar-customization',\n        name: 'Neon Ring Frame',\n        description: 'A glowing circular frame for your avatar, available in multiple colors.',\n        price: 800,\n        rarity: 'Common',\n        icon: ImageIcon,\n        imageUrl: 'https://picsum.photos/seed/frame1/600/400',\n    },\n    {\n        id: 'avatar-shadow-neon',\n        category: 'avatar-customization',\n        name: 'Neon Shadow',\n        description: 'A soft, colored glow that emanates from behind your avatar.',\n        price: 1200,\n        rarity: 'Rare',\n        icon: ImageIcon,\n        imageUrl: 'https://picsum.photos/seed/shadow1/600/400',\n    },\n    {\n        id: 'avatar-item-holo-ring',\n        category: 'avatar-customization',\n        name: 'Hologram Ring',\n        description: 'A spinning, semi-transparent holographic ring that encircles your avatar.',\n        price: 3000,\n        rarity: 'Cyber Rare',\n        icon: ImageIcon,\n        imageUrl: 'https://picsum.photos/seed/holo1/600/400',\n    },\n    {\n        id: 'avatar-effect-glitch',\n        category: 'avatar-customization',\n        name: 'Glitch Effect',\n        description: 'An animated glitching effect that plays over your avatar.',\n        price: 1500,\n        rarity: 'Epic',\n        icon: ImageIcon,\n        imageUrl: 'https://picsum.photos/seed/frame2/600/400',\n    },\n    {\n        id: 'avatar-skin-gold',\n        category: 'avatar-customization',\n        name: 'Liquid Gold Skin',\n        description: 'A full-body skin that gives your avatar a shimmering, molten gold appearance.',\n        price: 10000,\n        rarity: 'Legendary',\n        icon: ImageIcon,\n        imageUrl: 'https://picsum.photos/seed/skin1/600/400',\n    },\n    // Chat Effects\n    {\n        id: 'chat-effect-neon',\n        category: 'chat-effects',\n        name: 'Neon Glow Text',\n        description: 'Make your messages glow with a configurable neon color.',\n        price: 750,\n        rarity: 'Rare',\n        icon: Sparkles,\n        imageUrl: 'https://picsum.photos/seed/chat1/600/400',\n    },\n    {\n        id: 'chat-effect-hologram',\n        category: 'chat-effects',\n        name: 'Hologram Pop',\n        description: 'Messages appear with a futuristic holographic projection effect.',\n        price: 2000,\n        rarity: 'Cyber Rare',\n        icon: Sparkles,\n        imageUrl: 'https://picsum.photos/seed/chat2/600/400',\n    },\n    {\n        id: 'chat-effect-fire',\n        category: 'chat-effects',\n        name: 'Fire Message',\n        description: 'Engulf your messages in animated flames. Handle with care.',\n        price: 5000,\n        rarity: 'Legendary',\n        icon: Sparkles,\n        imageUrl: 'https://picsum.photos/seed/chat3/600/400',\n    },\n    // Boosters\n    {\n        id: 'booster-xp-1hr',\n        category: 'boosters',\n        name: 'XP Boost (1 Hour)',\n        description: 'Doubles all XP earned for one hour after activation.',\n        price: 500,\n        rarity: 'Common',\n        icon: Shield,\n        imageUrl: 'https://picsum.photos/seed/booster1/600/400',\n    },\n    {\n        id: 'booster-streak-protector',\n        category: 'boosters',\n        name: 'Streak Protector',\n        description: 'Prevents your daily login streak from breaking for one missed day.',\n        price: 1500,\n        rarity: 'Rare',\n        icon: Shield,\n        imageUrl: 'https://picsum.photos/seed/booster2/600/400',\n    },\n    // Stickers & Emotes\n    {\n        id: 'sticker-pack-cyber-meme',\n        category: 'stickers-emotes',\n        name: 'Cyber Meme Pack',\n        description: 'A pack of 10 animated stickers based on popular net-culture memes.',\n        price: 400,\n        rarity: 'Common',\n        icon: Puzzle,\n        imageUrl: 'https://picsum.photos/seed/sticker1/600/400',\n    },\n    // Sound Packs\n    {\n        id: 'sound-pack-8bit',\n        category: 'sound-packs',\n        name: '8-Bit Retro',\n        description: 'Classic chiptune sounds for all your notifications and interactions.',\n        price: 600,\n        rarity: 'Common',\n        icon: Music,\n        imageUrl: 'https://picsum.photos/seed/sound1/600/400',\n    },\n    // Mini-Apps\n    {\n        id: 'miniapp-pomo',\n        category: 'mini-apps',\n        name: 'Focus Timer',\n        description: 'A slick, integrated Pomodoro timer to keep you on task.',\n        price: 800,\n        rarity: 'Rare',\n        icon: AppWindow,\n        imageUrl: 'https://picsum.photos/seed/app1/600/400',\n    },\n    // Offline Addons\n    {\n        id: 'offline-game-tetris',\n        category: 'offline-addons',\n        name: 'Block Breaker',\n        description: 'A cyberpunk-themed version of the timeless puzzle game, playable offline.',\n        price: 1200,\n        rarity: 'Rare',\n        icon: WifiOff,\n        imageUrl: 'https://picsum.photos/seed/offline1/600/400',\n    },\n    // Mystery Boxes\n    {\n        id: 'mystery-box-common',\n        category: 'mystery-boxes',\n        name: 'Chrome Crate',\n        description: 'A standard-issue crate with a chance to contain common or rare items.',\n        price: 500,\n        rarity: 'Common',\n        icon: Package,\n        imageUrl: 'https://picsum.photos/seed/box1/600/400',\n    },\n    {\n        id: 'mystery-box-legendary',\n        category: 'mystery-boxes',\n        name: 'Legendary Cache',\n        description: 'A rare, high-security cache. Guaranteed to contain at least one Epic item, with a chance for a Legendary.',\n        price: 5000,\n        rarity: 'Legendary',\n        icon: Package,\n        imageUrl: 'https://picsum.photos/seed/box2/600/400',\n    },\n];\n","path":null,"size_bytes":11626,"size_tokens":null},"src/ai/flows/generate-tasks-from-notes.ts":{"content":"'use server';\n\n/**\n * @fileOverview This file defines a Genkit flow to generate tasks from user notes.\n *\n * The flow takes user notes as input and uses an LLM to extract and generate tasks.\n * It exports:\n * - `generateTasksFromNotes`: The main function to trigger the task generation flow.\n * - `GenerateTasksFromNotesInput`: The input type for the flow.\n * - `GenerateTasksFromNotesOutput`: The output type for the flow.\n */\n\nimport {ai} from '@/ai/genkit';\nimport {z} from 'genkit';\n\nconst GenerateTasksFromNotesInputSchema = z.object({\n  notes: z.string().describe('The notes from which to generate tasks.'),\n});\nexport type GenerateTasksFromNotesInput = z.infer<typeof GenerateTasksFromNotesInputSchema>;\n\nconst GenerateTasksFromNotesOutputSchema = z.object({\n  tasks: z.array(z.string()).describe('The generated tasks.'),\n});\nexport type GenerateTasksFromNotesOutput = z.infer<typeof GenerateTasksFromNotesOutputSchema>;\n\nexport async function generateTasksFromNotes(input: GenerateTasksFromNotesInput): Promise<GenerateTasksFromNotesOutput> {\n  return generateTasksFromNotesFlow(input);\n}\n\nconst prompt = ai.definePrompt({\n  name: 'generateTasksFromNotesPrompt',\n  input: {schema: GenerateTasksFromNotesInputSchema},\n  output: {schema: GenerateTasksFromNotesOutputSchema},\n  prompt: `You are a task generation expert. Given the following notes, extract and generate a list of tasks.\n\nNotes: {{{notes}}}\n\nTasks:`,\n});\n\nconst generateTasksFromNotesFlow = ai.defineFlow(\n  {\n    name: 'generateTasksFromNotesFlow',\n    inputSchema: GenerateTasksFromNotesInputSchema,\n    outputSchema: GenerateTasksFromNotesOutputSchema,\n  },\n  async input => {\n    const {output} = await prompt(input);\n    return output!;\n  }\n);\n","path":null,"size_bytes":1719,"size_tokens":null},"backend/README.md":{"content":"# AetherDash Backend API\n\nExpress.js backend server for AetherDash with Firebase integration and AI capabilities.\n\n## 🚀 Quick Start\n\n```bash\n# Install dependencies\nnpm install\n\n# Copy environment file\ncp .env.example .env\n\n# Configure your environment variables\n# Edit .env with your Firebase service account and API keys\n\n# Start development server\nnpm run dev\n\n# Build for production\nnpm run build\n\n# Start production server\nnpm run start\n```\n\n## 📁 Project Structure\n\n```\nsrc/\n├── config/\n│   └── firebase.ts        # Firebase Admin SDK setup\n├── controllers/\n│   ├── userController.ts  # User management logic\n│   └── aiController.ts    # AI endpoints logic\n├── middleware/\n│   ├── auth.ts           # JWT authentication\n│   └── rateLimiter.ts    # Rate limiting\n├── routes/\n│   ├── userRoutes.ts     # User API routes\n│   ├── aiRoutes.ts       # AI API routes\n│   └── index.ts          # Main router\n└── server.ts             # Express app setup\n```\n\n## 🔐 Authentication\n\nAll protected endpoints require a Firebase ID token in the Authorization header:\n\n```\nAuthorization: Bearer <firebase-id-token>\n```\n\n## 📡 API Endpoints\n\n### Health Check\n- `GET /` - Server status\n- `GET /api/health` - Detailed health check\n\n### User Management\n- `GET /api/users/profile` - Get current user profile\n- `PUT /api/users/profile` - Update user profile\n- `GET /api/users/stats` - Get user statistics\n\n### AI Services\n- `POST /api/ai/chat` - Chat with AI (streaming response)\n- `POST /api/ai/generate-image` - Generate images from prompts\n- `POST /api/ai/translate` - Translate text\n\n## 🛡️ Security Features\n\n- **Helmet.js** - Security headers\n- **CORS** - Cross-origin resource sharing\n- **Rate Limiting** - API abuse prevention\n- **Firebase Auth** - Token verification\n- **Input Validation** - Zod schema validation\n\n## 🔧 Environment Variables\n\n```env\n# Firebase Admin SDK\nFIREBASE_PROJECT_ID=your-project-id\nFIREBASE_PRIVATE_KEY_ID=your-private-key-id\nFIREBASE_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\\n\"\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxx@your-project.iam.gserviceaccount.com\nFIREBASE_CLIENT_ID=your-client-id\nFIREBASE_AUTH_URI=https://accounts.google.com/o/oauth2/auth\nFIREBASE_TOKEN_URI=https://oauth2.googleapis.com/token\n\n# Server Configuration\nPORT=5000\nNODE_ENV=development\nCORS_ORIGIN=http://localhost:3000\n\n# API Keys\nGOOGLE_AI_API_KEY=your-google-ai-api-key\n```\n\n## 📊 Rate Limits\n\n- **General API**: 100 requests per minute per IP\n- **AI Endpoints**: 10 requests per minute per IP\n\n## 🚀 Deployment\n\n### Using Docker\n\n```dockerfile\nFROM node:18-alpine\nWORKDIR /app\nCOPY package*.json ./\nRUN npm ci --only=production\nCOPY dist ./dist\nEXPOSE 5000\nCMD [\"npm\", \"start\"]\n```\n\n### Using PM2\n\n```bash\nnpm install -g pm2\nnpm run build\npm2 start dist/server.js --name \"aetherdash-backend\"\n```\n\n## 🧪 Testing\n\n```bash\n# Run tests\nnpm test\n\n# Run with coverage\nnpm run test:coverage\n```\n\n## 📝 Development\n\n```bash\n# Start with file watching\nnpm run dev\n\n# Lint code\nnpm run lint\n\n# Type checking\nnpm run type-check\n```","path":null,"size_bytes":3171,"size_tokens":null},"src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"src/app/apps/page.tsx":{"content":"\n'use client';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowRight, BrainCircuit, CheckSquare, Eye, File, MessageSquare, Newspaper, Rocket, StickyNote, TrendingUp, Loader2 } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { cn } from \"@/lib/utils\";\nimport { useAppStats, AppStat } from \"@/hooks/use-app-stats\";\nimport { useMemo, useState } from \"react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nconst appList = [\n    {\n        id: \"ai-hub\",\n        name: \"AI Hub\",\n        description: \"Access a suite of powerful AI tools for generation, translation, and assistance.\",\n        icon: BrainCircuit,\n        href: \"/ai-hub\",\n        color: \"text-primary\",\n        bgColor: \"bg-primary/10\",\n        borderColor: \"border-primary/20\",\n    },\n    {\n        id: \"chat\",\n        name: \"Aether Chat\",\n        description: \"Real-time communication with contacts, groups, and AI.\",\n        icon: MessageSquare,\n        href: \"/chat\",\n        color: \"text-secondary\",\n        bgColor: \"bg-secondary/10\",\n        borderColor: \"border-secondary/20\",\n    },\n    {\n        id: \"news\",\n        name: \"News Feed\",\n        description: \"Coming Soon - Live news feed with breaking news alerts.\",\n        icon: Newspaper,\n        href: \"#\",\n        color: \"text-orange-400\",\n        bgColor: \"bg-orange-400/10\",\n        borderColor: \"border-orange-400/20\",\n        disabled: true,\n    },\n    {\n        id: \"notes\",\n        name: \"NoteForge\",\n        description: \"A powerful, real-time editor for all your notes and ideas.\",\n        icon: StickyNote,\n        href: \"/notes\",\n        color: \"text-yellow-400\",\n        bgColor: \"bg-yellow-400/10\",\n        borderColor: \"border-yellow-400/20\",\n    },\n    {\n        id: \"tasks\",\n        name: \"Taskboard\",\n        description: \"Organize your workflow with a dynamic Kanban-style task board.\",\n        icon: CheckSquare,\n        href: \"/tasks\",\n        color: \"text-green-400\",\n        bgColor: \"bg-green-400/10\",\n        borderColor: \"border-green-400/20\",\n    },\n    {\n        id: \"files\",\n        name: \"CloudDrive\",\n        description: \"Coming Soon - Securely manage and share your files in the cloud.\",\n        icon: File,\n        href: \"#\",\n        color: \"text-blue-400\",\n        bgColor: \"bg-blue-400/10\",\n        borderColor: \"border-blue-400/20\",\n        disabled: true,\n    },\n];\n\nexport default function AppsPage() {\n    const { appStats, loading, incrementViewCount } = useAppStats();\n    const [loadingAppId, setLoadingAppId] = useState<string | null>(null);\n\n    const handleLaunch = (appId: string) => {\n        setLoadingAppId(appId);\n        incrementViewCount(appId);\n    };\n\n    const appsWithStats = useMemo(() => {\n        return appList.map(app => {\n            const stats = appStats.find(stat => stat.appId === app.id);\n            return {\n                ...app,\n                viewCount: stats?.viewCount || 0,\n            };\n        });\n    }, [appStats]);\n\n    const trendingApps = useMemo(() => {\n        return [...appsWithStats].sort((a, b) => b.viewCount - a.viewCount).slice(0, 3);\n    }, [appsWithStats]);\n\n    const hasTrendingApps = useMemo(() => {\n        return trendingApps.length > 0 && trendingApps.some(app => app.viewCount > 0);\n    }, [trendingApps]);\n\n    return (\n        <div className=\"space-y-4 md:space-y-8 instant-load\">\n            <h1 className=\"sr-only\">AetherDash Apps - Productivity Tools and Features</h1>\n            {/* Trending Apps Banner */}\n            <Card className=\"overflow-hidden\">\n                <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2 font-headline text-glow\">\n                        <TrendingUp className=\"text-primary\"/>\n                        Most Used Apps by You\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    {loading ? (\n                         <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 md:gap-4\">\n                            <Skeleton className=\"h-16 w-full\" />\n                            <Skeleton className=\"h-16 w-full\" />\n                            <Skeleton className=\"h-16 w-full\" />\n                        </div>\n                    ) : hasTrendingApps ? (\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 md:gap-4\">\n                            {trendingApps.map((app) => (\n                                <Link href={app.href} key={app.name} onClick={() => handleLaunch(app.id)}>\n                                    <div className={cn(\"p-4 rounded-lg flex items-center justify-between gap-4 transition-all hover:scale-[1.02] hover:shadow-lg\", app.bgColor, app.borderColor, \"border-2\")}>\n                                        <div className=\"flex items-center gap-4\">\n                                            <app.icon className={cn(\"w-8 h-8\", app.color)} />\n                                            <div>\n                                                <h3 className=\"font-semibold\">{app.name}</h3>\n                                                <p className=\"text-xs text-muted-foreground line-clamp-1\">{app.description}</p>\n                                            </div>\n                                        </div>\n                                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                                           <Eye className=\"w-4 h-4\"/>\n                                           <span>{app.viewCount}</span>\n                                        </div>\n                                    </div>\n                                </Link>\n                            ))}\n                        </div>\n                    ) : (\n                        <div className=\"text-center p-8 text-muted-foreground border-2 border-dashed border-border rounded-lg\">\n                            <TrendingUp className=\"w-12 h-12 mx-auto mb-4\" />\n                            <h3 className=\"font-headline text-xl\">No Apps Used Yet</h3>\n                            <p>Start using apps to see your most frequently used ones here!</p>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n            \n            {/* App Grid */}\n            <div>\n                 <h2 className=\"text-2xl font-headline mb-4 text-glow\">App Library</h2>\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 lazy-load\">\n                    {appsWithStats.map((app) => (\n                        <Card key={app.name} className=\"flex flex-col group overflow-hidden\">\n                            <CardHeader className=\"flex-row items-start gap-4 pb-4\">\n                                <div className={cn(\"w-12 h-12 flex items-center justify-center rounded-lg\", app.bgColor)}>\n                                    <app.icon className={cn(\"w-6 h-6\", app.color)} />\n                                </div>\n                                <div>\n                                    <CardTitle className=\"text-xl font-headline\">{app.name}</CardTitle>\n                                </div>\n                            </CardHeader>\n                            <CardContent className=\"flex-1 flex flex-col justify-between\">\n                                <p className=\"text-sm text-muted-foreground mb-4\">{app.description}</p>\n                                <Link href={app.href} className=\"mt-auto\" onClick={() => !app.disabled && handleLaunch(app.id)}>\n                                    <Button className=\"w-full cyber-button\" disabled={loadingAppId === app.id || app.disabled}>\n                                        {app.disabled ? (\n                                            <>\n                                                Coming Soon\n                                            </>\n                                        ) : loadingAppId === app.id ? (\n                                            <>\n                                                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                                                Launching...\n                                            </>\n                                        ) : (\n                                            <>\n                                                Launch App <Rocket className=\"ml-2 h-4 w-4\" />\n                                            </>\n                                        )}\n                                    </Button>\n                                </Link>\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            </div>\n        </div>\n    );\n}\n\n    \n","path":null,"size_bytes":8816,"size_tokens":null},"src/components/calls/IncomingCallNotification.tsx":{"content":"// This component is deprecated - incoming calls are now handled by CallInterface > ReceiverPanel\nexport default function IncomingCallNotification() {\n  return null;\n}","path":null,"size_bytes":167,"size_tokens":null},"src/hooks/use-tab-enhancer.ts":{"content":"'use client';\n\nimport { useEffect, useRef } from 'react';\nimport { tabEnhancer } from '@/lib/tab-enhancer';\n\nexport function useTabEnhancer() {\n  const notificationCount = useRef(0);\n\n  useEffect(() => {\n    // Initialize with cyberpunk theme\n    tabEnhancer.setTitle('◆ AETHERWEAVE ◆', 'typing');\n    \n    // Start breathing effect on load\n    setTimeout(() => {\n      tabEnhancer.startBreathing();\n    }, 2000);\n\n    return () => {\n      tabEnhancer.reset();\n    };\n  }, []);\n\n  const showNotification = (count: number = 1) => {\n    notificationCount.current += count;\n    tabEnhancer.showNotification(notificationCount.current);\n  };\n\n  const clearNotifications = () => {\n    notificationCount.current = 0;\n    tabEnhancer.clearNotification();\n  };\n\n  const setActivity = (type: 'loading' | 'error' | 'success' | 'warning') => {\n    tabEnhancer.setActivity(type);\n  };\n\n  const startColorCycle = () => {\n    tabEnhancer.startColorCycle(['#00ffff', '#ff00ff', '#ffff00', '#00ff00', '#ff0080']);\n  };\n\n  const simulateHover = () => {\n    tabEnhancer.simulateHover();\n  };\n\n  const setCustomTitle = (title: string, effect?: 'typing' | 'glitch' | 'pulse') => {\n    tabEnhancer.setTitle(title, effect);\n  };\n\n  return {\n    showNotification,\n    clearNotifications,\n    setActivity,\n    startColorCycle,\n    simulateHover,\n    setCustomTitle,\n    notificationCount: notificationCount.current,\n  };\n}","path":null,"size_bytes":1401,"size_tokens":null},"DEV_README.md":{"content":"\n# AetherDash Developer README\n\n## 1. Project Overview\n\nWelcome to the AetherDash codebase, Operator. This document is your guide to the architecture, systems, and conventions used in this application.\n\nAetherDash is a futuristic, cyberpunk-themed web application built to serve as a user's central digital hub. It integrates real-time communication, note-taking, file management, and a powerful AI assistant into a single, cohesive interface. The aesthetic is heavily inspired by cyberpunk tropes, featuring neon glows, dark themes, and a \"glassmorphism\" UI style.\n\n## 2. Core Technology Stack\n\n- **Framework**: [Next.js](https://nextjs.org/) (App Router)\n- **Language**: [TypeScript](https://www.typescriptlang.org/)\n- **UI Components**: [ShadCN/UI](https://ui.shadcn.com/)\n- **Styling**: [Tailwind CSS](https://tailwindcss.com/)\n- **Backend & Database**: [Firebase](https://firebase.google.com/) (Firestore, Authentication, Storage)\n- **Generative AI**: [Genkit](https://firebase.google.com/docs/genkit) (via `@genkit-ai/google-genai`)\n- **State Management**: React Context + Custom Hooks\n- **Animation**: [Framer Motion](https://www.framer.com/motion/)\n\n## 3. Project Structure\n\nThe `src` directory is organized to separate concerns and promote modularity.\n\n```\n/src\n├── ai/\n│   ├── flows/      # Genkit AI flows (server-side logic)\n│   └── genkit.ts   # Genkit plugin configuration\n├── app/\n│   ├── (pages)/    # Next.js App Router routes\n│   ├── api/        # API routes\n│   └── layout.tsx  # Root layout\n├── components/\n│   ├── ai-hub/     # Components for the AI Hub page\n│   ├── chat/       # Components specific to the Chat module\n│   ├── dashboard/  # Widgets and components for the Dashboard\n│   ├── layout/     # Header, UserNav, etc.\n│   ├── settings/   # Panels for the Settings page\n│   └── ui/         # Core ShadCN UI components (Button, Card, etc.)\n├── firebase/\n│   ├── client-provider.tsx # Client-side context provider\n│   ├── config.ts   # Firebase app configuration\n│   ├── index.ts    # Firebase app initialization\n│   └── provider.tsx # React context for Firebase instances\n├── hooks/\n│   ├── use-user.ts # Central hook for user profile and auth state\n│   ├── use-connections.ts # Manages user relationships (friends, blocks)\n│   ├── use-notes.ts   # CRUD operations for notes\n│   ├── use-webrtc.ts  # Handles video/voice call logic\n│   └── ...         # Other custom hooks for specific features\n├── lib/\n│   ├── achievements.ts # Definitions for user achievements\n│   ├── quests.ts   # Definitions for daily, weekly, seasonal quests\n│   ├── store-items.ts # Data for items available in the XP store\n│   ├── themes.ts   # Theme color definitions\n│   └── utils.ts    # Utility functions (e.g., cn for classnames)\n└── services/\n    ├── cloudflare-service.ts # Backend service for Cloudflare WebRTC\n    └── news-service.ts # Backend service for fetching news\n```\n\n## 4. Firebase Backend\n\nThe entire backend is powered by Firebase services.\n\n### 4.1. Data Model (`/docs/backend.json`)\n\nOur source of truth for the Firestore data model is `docs/backend.json`. This file defines all entities (like `User`, `Chat`, `Note`) and their corresponding Firestore collection paths. It's crucial for understanding how data is structured and related.\n\n### 4.2. Security (`firestore.rules` & `storage.rules`)\n\nSecurity is enforced via Firestore and Storage security rules. These files define the access control logic for the database and file storage, specifying who can read, write, update, or delete data in any given collection.\n\n- **Firestore Rules**: Granular control over document access. For example, a user can only write to their own user document (`/users/{userId}`) but can read the public-facing data of other users.\n- **Storage Rules**: Manages access to file uploads, typically restricting writes to a user's own directory.\n\n### 4.3. Client-Side Integration (`/src/firebase`)\n\n- **`config.ts`**: Contains the public Firebase configuration object.\n- **`index.ts`**: Initializes the Firebase app on the client.\n- **`provider.tsx`**: Creates a React Context that provides the initialized `app`, `auth`, and `firestore` instances to the rest of the application. This is consumed by all custom hooks that interact with Firebase.\n\n## 5. Authentication\n\n- **Providers**: Email/Password, Google, and Anonymous authentication are configured.\n- **Routing**: The `middleware.ts` file performs an initial check on routes. However, the primary auth logic resides in `src/app/layout.tsx` within the `AppInitializer` component.\n- **`AppInitializer`**: This client-side component uses the `useUser` hook to check the authentication state. It handles all redirection logic, ensuring unauthenticated users cannot access protected routes and authenticated users are redirected away from public pages like `/login`.\n\n## 6. Generative AI (Genkit)\n\nAll AI functionality is handled by **Genkit**.\n\n- **Location**: AI logic is located in `src/ai/`.\n- **Flows**: A \"flow\" is a server-side function that orchestrates AI model calls. They are defined in `src/ai/flows/`. Each flow file typically exports a primary async function (e.g., `runAssistantStream`) and its associated Zod input/output schemas.\n- **Configuration**: `src/ai/genkit.ts` configures the Genkit instance, specifying the `googleAI` plugin and the Next.js plugin for integration.\n- **Calling Flows**: Client components import and call the exported flow functions directly. The Next.js server handles the communication. For streaming responses (like the AI Assistant), `AsyncIterable` is used.\n\n## 7. State Management & Custom Hooks\n\nThe application avoids complex state management libraries like Redux in favor of a combination of **React Context** and **custom hooks**.\n\n- **Providers**: The root layout wraps the application in several providers (`FirebaseClientProvider`, `ThemeProvider`, `UserProvider` via hooks) which expose global instances and state.\n- **Custom Hooks**: The core logic and state for each major feature are encapsulated in custom hooks within the `src/hooks/` directory.\n    - `useUser`: The most important hook. It manages the current user's authentication state and their Firestore profile data, providing a single source of truth for user information.\n    - `useConnections`: Manages the user's social graph (friends, pending requests, blocked users).\n    - `useNotes`, `useInventory`, etc.: Provide reactive state and CRUD functions for specific Firestore collections related to the user.\n\n## 8. UI, Styling, and Theming\n\n- **ShadCN/UI**: Provides the foundational, unstyled component primitives (Button, Card, etc.). These are located in `src/components/ui/`.\n- **Tailwind CSS**: Used for all styling. Utility classes are applied directly in components.\n- **Theming System**: The theming is controlled by CSS variables defined in `src/app/globals.css`.\n    - **`src/lib/themes.ts`**: This file exports an array of `Theme` objects, each defining a set of HSL color values for `primary`, `secondary`, `background`, etc.\n    - **`ThemeProvider.tsx`**: This context provider reads the user's saved theme preference (from `useUser`), finds the corresponding theme object, and applies its colors to the root CSS variables, instantly changing the application's look and feel. The provider also handles persisting theme changes back to the user's profile in Firestore.\n- **Fonts**: The primary UI font is `Inter`, with `Space Grotesk` used for headlines to achieve the cyberpunk aesthetic, and `Source Code Pro` for code blocks.\n- **Layout**: The main layout consists of a persistent `Header` and the `CoreNavHub` for navigation. The content for each page is rendered within this layout.\n","path":null,"size_bytes":7927,"size_tokens":null}},"version":2}